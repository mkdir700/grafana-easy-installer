"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9136],{63392:(St,Q,o)=>{o.r(Q),o.d(Q,{default:()=>cr});var t=o(96540),W=o(16817),D=o(32264),O=o(64388),$=o(17205),ae=o(39419),K=o(33390),U=o(79999),y=o(31678),p=o(32196),f=o(58476),g=o(12131),L=o(71678),b=o(40845),x=o(37390),h=o(55852),z=o(16233);const Ee=t.memo(({dashboard:e})=>{const a=(0,t.useMemo)(()=>g.Ny.getLocation().pathname,[e]),{showModal:n,hideModal:r}=(0,t.useContext)(L.wE);(0,t.useEffect)(()=>{const l=d=>{be(e,e.getInitialSaveModel())||e.state.isDirty&&(d.preventDefault(),d.returnValue="")};return window.addEventListener("beforeunload",l),()=>window.removeEventListener("beforeunload",l)},[e]);const s=l=>a===l.pathname||be(e,e.getInitialSaveModel())||!e.state.isDirty?!0:(n(Ct,{dashboard:e,onSaveDashboardClick:()=>{r(),e.openSaveDrawer({onSaveSuccess:()=>{ye(l)}})},onDiscard:()=>{e.exitEditMode({skipConfirm:!0}),r(),ye(l)},onDismiss:r}),!1);return t.createElement(f.XG,{when:!0,message:s})});Ee.displayName="DashboardPrompt";function ye(e){e&&setTimeout(()=>g.Ny.push(e),10)}const Ct=({onDiscard:e,onDismiss:a,onSaveDashboardClick:n})=>{const r=(0,b.of)(Tt);return t.createElement(x.a,{isOpen:!0,title:"Unsaved changes",onDismiss:a,icon:"exclamation-triangle",className:r.modal},t.createElement("h5",null,"Do you want to save your changes?"),t.createElement(x.a.ButtonRow,null,t.createElement(h.$n,{variant:"secondary",onClick:a,fill:"outline"},"Cancel"),t.createElement(h.$n,{variant:"destructive",onClick:e},"Discard"),t.createElement(h.$n,{onClick:n},"Save dashboard")))},Tt=()=>({modal:(0,p.css)({width:"500px"})});function be(e,a){if(!a||a.version===0||!z.TP.isSignedIn||!e)return!0;const{canSave:n,fromScript:r,fromFile:s}=e.state.meta;return!z.TP.isEditor&&!n?!0:!n||r||s}var Pe=o(72255);function Dt({match:e,route:a,queryParams:n,history:r}){const s=(0,Pe.sP)(),{dashboard:l,isLoading:d,loadError:i}=s.useState(),u=r.location.state?.routeReloadCounter,c=(0,t.useMemo)(()=>!!K.A.getObject(U.us),[e.params.uid,e.params.slug,e.params.type]);return(0,t.useEffect)(()=>(a.routeName===y.DashboardRoutes.Normal&&e.params.type==="snapshot"?s.loadSnapshot(e.params.slug):s.loadDashboard({uid:e.params.uid??"",route:a.routeName,urlFolderUid:n.folderUid,keepDashboardFromExploreInLocalStorage:!1}),()=>{s.clearState()}),[s,e.params.uid,a.routeName,n.folderUid,u,e.params.slug,e.params.type]),(0,t.useEffect)(()=>{l&&c&&a.routeName!==y.DashboardRoutes.New&&l.onEnterEditMode(c)},[l,c,a.routeName]),l?l.state.uid&&l.state.uid!==e.params.uid?null:t.createElement(t.Fragment,null,t.createElement(l.Component,{model:l,key:l.state.key}),t.createElement(Ee,{dashboard:l})):t.createElement($.Y,{layout:O.k.Canvas,"data-testid":"dashboard-scene-page"},d&&t.createElement(ae.A,null),i&&t.createElement("h2",null,i))}const Se=Dt;var H=o(63329),Nt=o(71733),P=o(13544),Ce=o(82467),xt=o(7392),Mt=o(76888),Te=o(3169);function wt(e){switch(e.kiosk){case"tv":return y.KioskMode.TV;case"1":case!0:return y.KioskMode.Full;default:return null}}var De=o(17422),Ne=o(6473),xe=o(14110),V=o(42418),It=o(61680);const Rt="grafana.angularDeprecation.dashboardNoticeAndMigration.isDismissed";function Lt(e){return Rt+"."+e}function At(){const e="__feature.autoMigrateOldPanels",a=new URL(window.location.toString());a.searchParams.has(e)||a.searchParams.append(e,"true"),window.open(a.toString(),"_self")}function Ft({dashboardUid:e,showAutoMigrateLink:a}){return t.createElement(It.b,{storageKey:Lt(e),defaultValue:!1},(n,r)=>n?null:t.createElement("div",null,t.createElement(V.F,{severity:"warning",title:"This dashboard depends on Angular, which is deprecated and will stop working in future releases of Grafana.",onRemove:()=>{(0,xe.rR)("angular_deprecation_notice_dismissed"),r(!0)}},t.createElement("div",{className:"markdown-html"},t.createElement("a",{href:"https://grafana.com/docs/grafana/latest/developers/angular_deprecation/",className:"external-link",target:"_blank",rel:"noreferrer"},"Read our deprecation notice and migration advice."),t.createElement("br",null),a&&t.createElement(h.$n,{fill:"outline",size:"sm",onClick:At,style:{marginTop:10}},"Try migration")))))}var Ut=o(8480);const Ot=()=>{const e=new URL(window.location.toString()),a=new URLSearchParams(e.search);a.forEach((n,r)=>{if(r.startsWith("__feature.")){const s=r.substring(10);Ut.mz.has(s)&&a.delete(r)}}),window.location.href=new URL(e.origin+e.pathname+"?"+a.toString()).toString()},$t=()=>{window.open("https://github.com/grafana/grafana/issues/new?assignees=&labels=&projects=&template=0-bug-report.yaml&title=Product+Area%3A+Short+description+of+bug")};function zt({dashboardUid:e}){const a=(0,b.of)(Vt),[n,r]=(0,t.useState)(!0);return n?t.createElement(V.F,{severity:"info",title:"This dashboard was migrated from Angular. Please make sure everything is behaving as expected and save and refresh this dashboard to persist the migration.",onRemove:()=>r(!1)},t.createElement("div",{className:"markdown-html"},t.createElement(h.$n,{fill:"outline",size:"sm",className:a.linkButton,onClick:$t},"Report issue"),t.createElement(h.$n,{fill:"outline",size:"sm",className:a.linkButton,onClick:Ot},"Revert migration"))):null}const Vt=e=>({linkButton:(0,p.css)({marginRight:10})});var ur=o(53652);function mr(e){const a=e.match.params.slug??"",n=useAsync(()=>getGrafanaStorage().list("content/"+a),[a]),r=a.length>0?`g/${a}/`:"g/",s=Me(a),l=()=>n.value?n.value.fields[0].values.map(u=>{let c=u;const m=c.indexOf(".")<0,v=!m&&c.endsWith(".json"),E=`${r}${c}`;return React.createElement(Card,{key:c,href:m||v?E:void 0},React.createElement(Card.Heading,null,c),React.createElement(Card.Figure,null,React.createElement(Icon,{name:m?"folder":v?"gf-grid":"file-alt",size:"sm"})))}):n.loading?React.createElement(Spinner,null):React.createElement("div",null,"?"),d=we();return React.createElement(Page,{navModel:d,pageNav:s},l())}function Me(e){const a=e.split("/");let n=[],r="g",s;for(let l=0;l<a.length;l++)r+=`/${a[l]}`,n.push({text:a[l],url:r,parentItem:s}),s=n[n.length-1];return s}function we(){return{main:{text:"C:"},node:{text:"Content",url:"/g"}}}const pr=null;var A=o(28444),Ie=o(72401),Bt=o(75096),Re=o(10354),ne=o(14578),re=o(40276),Le=o(36974),Wt=o(48889),Ae=o(17706);const Gt=()=>{const e=(0,b.of)(kt),[a,n]=(0,t.useState)(""),r=(0,y.useSelector)(i=>i.dashboard.getModel()),s=(0,t.useMemo)(()=>(0,Ae.nr)(),[]),l=(0,t.useMemo)(()=>(0,Ae.CO)(s,a),[s,a]),d=()=>{g.Ny.partial({addWidget:null})};return t.createElement(x.a,{title:"Select widget type",closeOnEscape:!0,closeOnBackdropClick:!0,isOpen:!0,className:e.modal,onClickBackdrop:d,onDismiss:d},t.createElement(Re.p,{type:"search",autoFocus:!0,className:e.searchInput,value:a,prefix:t.createElement(ne.I,{name:"search"}),placeholder:"Search widget",onChange:i=>{n(i.currentTarget.value)}}),t.createElement(re.E,null,t.createElement("div",{className:e.grid},l.map((i,u)=>t.createElement(Wt.f,{disabled:!1,key:i.id,isCurrent:!1,plugin:i,onClick:c=>{const m=(0,Le.ob)(r,i.id);g.Ny.partial({editPanel:m,addWidget:null})}})))))},kt=e=>({modal:(0,p.css)`
    width: 65%;
    max-width: 960px;

    ${e.breakpoints.down("md")} {
      width: 100%;
    }
  `,searchInput:(0,p.css)`
    margin-bottom: ${e.spacing(2)};
  `,grid:(0,p.css)`
    display: grid;
    grid-gap: ${e.spacing(1)};
  `});var Qt=o(16495),Kt=o(59757),Ht=o(9980),j=o(2543),jt=o(28138),Jt=o(40996),Xt=o(57767),Yt=o(43535),Zt=o(88861);const Fe=({panel:e,folderUid:a,isUnsavedPrompt:n,onDismiss:r,onConfirm:s,onDiscard:l})=>{const[d,i]=(0,t.useState)(""),u=(0,W.A)(async()=>{const C=await(0,Xt.xV)(e.libraryPanel.uid);return C.length>0?C.map(w=>w.title):[]},[e.libraryPanel.uid]),[c,m]=(0,t.useState)([]);(0,Jt.A)(()=>u.value?m(u.value.filter(C=>C.toLowerCase().includes(d.toLowerCase()))):m([]),300,[u.value,d]);const{saveLibraryPanel:v}=(0,Zt.b)(),E=(0,b.of)(Yt.o),M=(0,t.useCallback)(()=>{l()},[l]),S=n?"Unsaved library panel changes":"Save library panel";return t.createElement(x.a,{title:S,icon:"save",onDismiss:r,isOpen:!0},t.createElement("div",null,t.createElement("p",{className:E.textInfo},"This update will affect ",t.createElement("strong",null,e.libraryPanel.meta?.connectedDashboards," ",e.libraryPanel.meta?.connectedDashboards===1?"dashboard":"dashboards","."),"The following dashboards using the panel will be affected:"),t.createElement(Re.p,{className:E.dashboardSearch,prefix:t.createElement(ne.I,{name:"search"}),placeholder:"Search affected dashboards",value:d,onChange:C=>i(C.currentTarget.value)}),u.loading?t.createElement("p",null,"Loading connected dashboards..."):t.createElement("table",{className:E.myTable},t.createElement("thead",null,t.createElement("tr",null,t.createElement("th",null,"Dashboard name"))),t.createElement("tbody",null,c.map((C,w)=>t.createElement("tr",{key:`dashrow-${w}`},t.createElement("td",null,C))))),t.createElement(x.a.ButtonRow,null,t.createElement(h.$n,{variant:"secondary",onClick:r,fill:"outline"},"Cancel"),n&&t.createElement(h.$n,{variant:"destructive",onClick:M},"Discard"),t.createElement(h.$n,{onClick:()=>{v(e,a).then(()=>{s()})}},"Update all"))))};var qt=o(98365),Ue=o(19752),se=o(79971),Oe=o(80095),F=o(53466);function _t(e,a){return async n=>{const r=a.initEditPanel(e);n((0,F.GU)({panel:r,sourcePanel:e}))}}function $e(){return async(e,a)=>{const{getPanel:n}=a().panelEditor;n().configRev=0,e((0,F.MJ)(!0))}}function ea(e,a){return n=>{if(e.libraryPanel?.uid===void 0||!a)return;const r=e.getSaveModel();for(const s of a.panels){if(ta(e,s))continue;s.restoreModel({...r,...(0,j.pick)(s,"gridPos","id")});const l=s.plugin?.meta.id!==e.plugin?.meta.id;s.plugin=e.plugin,s.configRev++,l&&(s.generateNewKey(),n((0,Oe.XM)({key:s.key,plugin:s.plugin}))),setTimeout(()=>{s.getQueryRunner().useLastResultFrom(e.getQueryRunner())},20)}e.repeat&&setTimeout(()=>a.processRepeats(),20)}}function ta(e,a){return!!(a.libraryPanel?.uid!==e.libraryPanel.uid||a.id&&a.id===e.id||a.repeatPanelId)}function aa(){return async(e,a)=>{const n=a().dashboard.getModel(),{getPanel:r,getSourcePanel:s,shouldDiscardChanges:l}=a().panelEditor,d=r();n&&n.exitPanelEditor();const i=s();if(na(d)&&!l){const u=d.getSaveModel(),c=i.type!==d.type;e(ea(d,n)),i.restoreModel(u),i.configRev++,c&&(i.plugin=d.plugin,i.generateNewKey(),await e((0,Oe.XM)({key:i.key,plugin:d.plugin}))),setTimeout(()=>{i.getQueryRunner().useLastResultFrom(d.getQueryRunner()),i.render(),d.hasSavedPanelEditChange&&!d.hasChanged&&(i.configRev=0)},20)}i.isNew&&(l?n&&(0,Ue.FC)(n,i,!0):delete i.isNew),e((0,se.O6)(d.key)),e((0,F.Ox)())}}function na(e){return e.hasChanged||e.hasSavedPanelEditChange||e.isAngularPlugin()}function oe(e){return(a,n)=>{const r={...n().panelEditor.ui,...e};a((0,F.fR)(r));try{K.A.setObject(F.wi,r)}catch(s){console.error(s)}}}var ra=o(78050);const sa=({dashboard:e,onSaveSuccess:a,onDiscard:n,onDismiss:r})=>t.createElement(x.a,{isOpen:!0,title:"Unsaved changes",onDismiss:r,icon:"exclamation-triangle",className:(0,p.css)`
        width: 500px;
      `},t.createElement("h5",null,"Do you want to save your changes?"),t.createElement(x.a.ButtonRow,null,t.createElement(h.$n,{variant:"secondary",onClick:r,fill:"outline"},"Cancel"),t.createElement(h.$n,{variant:"destructive",onClick:n},"Discard"),t.createElement(ra.C,{dashboard:e,onSaveSuccess:a}))),ze=t.memo(({dashboard:e})=>{const[a,n]=(0,t.useState)({original:null}),r=(0,y.useDispatch)(),{original:s,originalPath:l}=a,{showModal:d,hideModal:i}=(0,t.useContext)(L.wE);(0,t.useEffect)(()=>{const c=setTimeout(()=>{const v=g.Ny.getLocation().pathname,E=e.getSaveModelCloneOld();n({originalPath:v,original:E})},1e3),m=jt.l.subscribe(A.Eu,()=>{const v=e.getSaveModelCloneOld();n({originalPath:l,original:v})});return()=>{clearTimeout(c),m.unsubscribe()}},[e,l]),(0,t.useEffect)(()=>{const c=m=>{Ve(e,s)||We(e,s)&&(m.preventDefault(),m.returnValue="")};return window.addEventListener("beforeunload",c),()=>window.removeEventListener("beforeunload",c)},[e,s]);const u=c=>{const m=e.panelInEdit,v=new URLSearchParams(c.search);return m&&m.libraryPanel&&m.hasChanged&&!v.has("editPanel")?(d(Fe,{isUnsavedPrompt:!0,panel:e.panelInEdit,folderUid:e.meta.folderUid??"",onConfirm:()=>{i(),J(c)},onDiscard:()=>{r($e()),J(c),i()},onDismiss:i}),!1):l===c.pathname||!s?(m&&!v.has("editPanel")&&r(aa()),!0):Ve(e,s)||!We(e,s)?!0:(d(sa,{dashboard:e,onSaveSuccess:()=>{i(),J(c)},onDiscard:()=>{n({...a,original:null}),i(),J(c)},onDismiss:i}),!1)};return t.createElement(f.XG,{when:!0,message:u})});ze.displayName="DashboardPrompt";function J(e){e&&setTimeout(()=>g.Ny.push(e),10)}function Ve(e,a){if(!a||a.version===0||!z.TP.isSignedIn||!e)return!0;const{canSave:n,fromScript:r,fromFile:s}=e.meta;return!z.TP.isEditor&&!n?!0:!n||r||s}function Be(e){const a=new qt.G(e);a.expandRows();const n=a.getSaveModelClone();if(delete n.time,delete n.refresh,n.schemaVersion=0,delete n.timezone,n.panels=[],n.templating?.list)for(const r of n.templating.list)delete r.current,delete r.options,delete r.filters;return n}function We(e,a){if(e.hasUnsavedChanges())return!0;const n=Be(e.getSaveModelCloneOld()),r=Be(a),s=(0,j.find)(n.nav,{type:"timepicker"}),l=(0,j.find)(r.nav,{type:"timepicker"});s&&l&&(s.now=l.now);const d=JSON.stringify(n,null),i=JSON.stringify(r,null);return d!==i}var oa=o(16561),I=o(16560),Ge=o(40334),le=o(70713),ke=o(41987),Qe=o(87978),X=o(67061),la=o(86460),ie=o(63021),Y=o(40675),ia=o(62930),Z=o(88575),ca=o(88323),Ke=o(10534),da=o(32372),q=o(66864),G=o(15292),ua=o(4213),ma=o.n(ua),pa=o(72724),_=o(83195),ga=o(2619),ha=o(6729),B=o(74856),fa=o(34214),He=o(18803),k=(e=>(e[e.Support=0]="Support",e[e.Data=1]="Data",e))(k||{}),ee=(e=>(e[e.PanelSnapshot=0]="PanelSnapshot",e[e.GithubComment=1]="GithubComment",e))(ee||{});class va extends ga.Q{constructor(a){super({panel:a,panelTitle:a.replaceVariables(a.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:"GitHub comment",description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:"Panel support snapshot",description:"Dashboard JSON used to help troubleshoot visualization issues",value:0}]}),this.onCurrentTabChange=n=>{this.setState({currentTab:n})},this.onShowMessageChange=n=>{this.setState({showMessage:n.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:n}=this.state,r=Math.pow(1024,2)*1.5;return n.length>r?(this.setState({error:{title:"Copy to clipboard failed",message:"Snapshot is too large, consider download and attaching a file instead"}}),""):n},this.onDownloadDashboard=()=>{const{snapshotText:n,panelTitle:r}=this.state,s=new Blob([n],{type:"text/plain"}),l=`debug-${r}-${(0,pa.LE)(new Date)}.json.txt`;ma()(s,l)},this.onSetSnapshotText=n=>{this.setState({snapshotText:n})},this.onToggleRandomize=n=>{const{randomize:r}=this.state;this.setState({randomize:{...r,[n]:!r[n]}})},this.onPreviewDashboard=()=>{const{snapshot:n}=this.state;n&&((0,U.OI)({meta:{},dashboard:n}),o.g.open(D.$.appUrl+"dashboard/new","_blank"))}}async buildDebugDashboard(){const{panel:a,randomize:n,snapshotUpdate:r}=this.state,s=await(0,He.E_)(a,n,(0,B.jG)().timeRange()),l=JSON.stringify(s,null,2),d=(0,He.jD)(a,l),i=(0,_.cN)((0,_.j_)("bytes")(l?.length??0));let u;if(!a.isAngularPlugin())try{const c=new fa.G(s,{isEmbedded:!0});u=(0,ha.EH)(c).state.body}catch(c){console.log("Error creating scene:",c)}this.setState({snapshot:s,snapshotText:l,markdownText:d,snapshotSize:i,snapshotUpdate:r+1,scene:u})}}function Ea({panel:e,plugin:a,onClose:n}){const r=(0,b.of)(ya),s=(0,t.useMemo)(()=>new va(e),[e]),{currentTab:l,loading:d,error:i,options:u,showMessage:c,snapshotSize:m,markdownText:v,snapshotText:E,randomize:M,panelTitle:S,scene:C}=s.useState();if((0,t.useEffect)(()=>{s.buildDebugDashboard()},[s,a,M]),!a)return null;const w=[{label:"Snapshot",value:k.Support},{label:"Data",value:k.Data}],R=D.$.supportBundlesEnabled&&z.TP.hasPermission(y.AccessControlAction.ActionSupportBundlesCreate);return t.createElement(Qe._,{title:"Get help with this panel",size:"lg",onClose:n,subtitle:t.createElement(X.B,{direction:"column",gap:1},t.createElement(X.B,{direction:"row",gap:1},t.createElement(la.y,{featureState:ke.Ay.beta}),t.createElement("a",{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",target:"blank",className:"external-link",rel:"noopener noreferrer"},"Troubleshooting docs ",t.createElement(ne.I,{name:"external-link-alt"}))),t.createElement("span",{className:"muted"},"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings."),R&&t.createElement("span",{className:"muted"},"You can also retrieve a support bundle containing information concerning your Grafana instance and configured datasources in the ",t.createElement("a",{href:"/support-bundles"},"support bundles section"),".")),tabs:t.createElement(ie.U,null,w.map((T,te)=>t.createElement(Y.o,{key:`${T.value}-${te}`,label:T.label,active:T.value===l,onChangeTab:()=>s.onCurrentTabChange(T.value)})))},d&&t.createElement(ia.y,null),i&&t.createElement(V.F,{title:i.title},i.message),l===k.Data&&t.createElement("div",{className:r.code},t.createElement("div",{className:r.opts},t.createElement(Z.D,{label:"Template",className:r.field},t.createElement(ca.l6,{options:u,value:c,onChange:s.onShowMessageChange})),c===ee.GithubComment?t.createElement(Ke.b,{icon:"copy",getText:s.onGetMarkdownForClipboard},"Copy to clipboard"):t.createElement(h.$n,{icon:"download-alt",onClick:s.onDownloadDashboard},"Download (",m,")")),t.createElement(le.Ay,{disableWidth:!0},({height:T})=>t.createElement(da.B,{width:"100%",height:T,language:c===ee.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:c===ee.GithubComment?v:E,readOnly:!1,onBlur:s.onSetSnapshotText}))),l===k.Support&&t.createElement(t.Fragment,null,t.createElement(Z.D,{label:"Randomize data",description:"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal."},t.createElement(q.Gy,null,t.createElement(G.K,{label:"Labels",id:"randomize-labels",showLabel:!0,value:!!M.labels,onChange:()=>s.onToggleRandomize("labels")}),t.createElement(G.K,{label:"Field names",id:"randomize-field-names",showLabel:!0,value:!!M.names,onChange:()=>s.onToggleRandomize("names")}),t.createElement(G.K,{label:"String values",id:"randomize-string-values",showLabel:!0,value:!!M.values,onChange:()=>s.onToggleRandomize("values")}))),t.createElement(Z.D,{label:"Support snapshot",description:`Panel: ${S}`},t.createElement(X.B,null,t.createElement(h.$n,{icon:"download-alt",onClick:s.onDownloadDashboard},"Dashboard (",m,")"),t.createElement(Ke.b,{icon:"github",getText:s.onGetMarkdownForClipboard,title:"Copy a complete GitHub comment to the clipboard"},"Copy to clipboard"),t.createElement(h.$n,{onClick:s.onPreviewDashboard,variant:"secondary",title:"Open support snapshot dashboard in a new tab"},"Preview"))),t.createElement(le.Ay,{disableWidth:!0},({height:T})=>t.createElement("div",{style:{height:T,overflow:"auto"}},C&&t.createElement(C.Component,{model:C})))))}const ya=e=>({code:(0,p.css)`
    flex-grow: 1;
    height: 100%;
    overflow: scroll;
  `,field:(0,p.css)`
    width: 100%;
  `,opts:(0,p.css)`
    display: flex;
    display: flex;
    width: 100%;
    flex-grow: 0;
    align-items: center;
    justify-content: flex-end;

    button {
      margin-left: 8px;
    }
  `});var ce=o(39070);const de=(e,a,n)=>{const r=(0,t.useRef)(),[s,l]=(0,t.useState)();return(0,t.useEffect)(()=>{let d=-1,i=0;return r.current=e.getQueryRunner().getData({withTransforms:a.withTransforms,withFieldConfig:!1}).subscribe({next:u=>{if(n){if(d===u.structureRev){const c=Date.now();if(c-i<1e4)return;i=c}d=u.structureRev??-1}l(u)}}),()=>{r.current&&r.current.unsubscribe()}},[e,a.withTransforms]),{data:s,isLoading:s?.state===ce.Gu.Loading,hasSeries:s?!!s.series:!1,hasError:!!(s&&(s.error||s?.errors?.length||s.state===ce.Gu.Error))}};var je=o(72574),ue=o(44836),ba=o(61453),Pa=o(82344),Sa=o(61396);const Ca=({data:e,metadataDatasource:a})=>!a||!a.components?.MetadataInspector?t.createElement(ue.x6,{i18nKey:"dashboard.inspect-meta.no-inspector"},"No Metadata Inspector"):t.createElement(a.components.MetadataInspector,{datasource:a,data:e.series});var Ta=o(32067),Da=o(90820);const Na=({panel:e,plugin:a,dashboard:n,tabs:r,data:s,isDataLoading:l,dataOptions:d,metadataDatasource:i,defaultTab:u,onDataOptionsChange:c,onClose:m})=>{const[v,E]=(0,t.useState)(u??I.q.Data);if(!a)return null;let M=xa(s),S=v;r.find(R=>R.value===v)||(S=I.q.JSON);const C=(0,je.w)().replace(e.title,e.scopedVars,"text")||"Panel",w=(0,ue.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:C});return t.createElement(Qe._,{title:w,subtitle:s&&Ma(s),onClose:m,tabs:t.createElement(ie.U,null,r.map((R,T)=>t.createElement(Y.o,{key:`${R.value}-${T}`,label:R.label,active:R.value===S,onChangeTab:()=>E(R.value||I.q.Data)})))},S===I.q.Data&&t.createElement(ba.q,{dataName:e.getDisplayTitle(),panelPluginId:e.type,fieldConfig:e.fieldConfig,hasTransformations:!!e.transformations?.length,data:s&&s.series,isLoading:l,options:d,onOptionsChange:c,timeZone:n.timezone,app:ke.Jk.Dashboard}),s&&S===I.q.Meta&&t.createElement(Ca,{data:s,metadataDatasource:i}),S===I.q.JSON&&t.createElement(Sa.w,{panel:e,dashboard:n,data:s,onClose:m}),S===I.q.Error&&t.createElement(Pa.y,{errors:M}),s&&S===I.q.Stats&&t.createElement(Ta.N,{data:s,timeZone:n.getTimezone()}),s&&S===I.q.Query&&t.createElement(Da.e,{data:s,onRefreshQuery:()=>e.refresh()}))};function xa(e){let a=e?.errors??[];return e?.error&&!a.includes(e.error)&&(a=[e.error,...a]),!a.length&&e?.state===ce.Gu.Error?[{message:"Error loading data"}]:a}function Ma(e){const{request:a}=e;if(!a||(0,j.isEmpty)(a))return"";const n=a.targets.length,r=a.endTime?a.endTime-a.startTime:0,s=(0,_.cN)((0,_.j_)("ms")(r));return t.createElement(ue.x6,{i18nKey:"dashboard.inspect.subtitle"},{queryCount:n}," queries with total query time of ",{formatted:s})}var Je=o(65123);const wa=({panel:e,dashboard:a,plugin:n})=>{const r=(0,f.zy)(),s=new URLSearchParams(r.search).get("inspectTab"),[l,d]=(0,t.useState)({withTransforms:s===I.q.Error,withFieldConfig:!0}),{data:i,isLoading:u,hasError:c}=de(e,l,!1),m=(0,Je.sd)(i),v=(0,Je.kx)(e,a,n,c,m),E=()=>{g.Ny.partial({inspect:null,inspectTab:null})};return n?s===I.q.Help?t.createElement(Ea,{panel:e,plugin:n,onClose:E}):t.createElement(Na,{dashboard:a,panel:e,plugin:n,defaultTab:s,tabs:v,data:i,isDataLoading:u,dataOptions:l,onDataOptionsChange:d,metadataDatasource:m,onClose:E}):null},Ia=(e,a)=>{const n=(0,Ge.U)(e,a.panel);return n?{plugin:n.plugin}:{plugin:null}},Ra=(0,H.connect)(Ia)(wa);var Xe=o(64423),Ye=o(94354),me=o(27746),La=o(15068),Ze=o(3911),Aa=o(75269),qe=o(58720),Fa=o(10096),pe=o(12470),ge=o(56034),Ua=o(20601),Oa=o(13344);const $a=e=>{const a=(0,t.useMemo)(()=>Ua.B.get(e.variable.type).picker,[e.variable]);return e.variable?t.createElement("div",{className:"gf-form"},t.createElement(za,{variable:e.variable}),e.variable.hide!==pe.zL.hideVariable&&a&&t.createElement(a,{variable:e.variable,readOnly:e.readOnly??!1})):t.createElement("div",null,"Couldn't load variable")};function za({variable:e}){const a=(0,t.useMemo)(()=>e.label||e.name,[e]);if(e.hide!==pe.zL.dontHide)return null;const n=Oa.qz+e.id;return e.description?t.createElement(ge.m,{content:e.description,placement:"bottom"},t.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":P.Tp.pages.Dashboard.SubMenu.submenuItemLabels(a),htmlFor:n},a)):t.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":P.Tp.pages.Dashboard.SubMenu.submenuItemLabels(a),htmlFor:n},a)}const _e=({variables:e,readOnly:a})=>{const[n,r]=(0,t.useState)([]);return(0,t.useEffect)(()=>{r(e.filter(s=>s.hide!==pe.zL.hideVariable))},[e]),n.length===0?null:t.createElement(t.Fragment,null,n.map(s=>t.createElement("div",{key:s.id,className:"submenu-item gf-form-inline","data-testid":P.Tp.pages.Dashboard.SubMenu.submenuItem},t.createElement($a,{variable:s,readOnly:a}))))};var Va=o(81862),Ba=o(54174),et=o(82792),he=o(87421),Wa=o(39569),Ga=o(62367),ka=o(70497),Qa=o(26443),Ka=o(19727),Ha=o(41394);const tt=e=>a=>a.plugins.panels[e]||(0,Ha.$)(`Panel plugin not found (${e})`,!0),fe=({panel:e})=>{const a=(0,y.useDispatch)(),n=(0,y.useSelector)(tt(e.type)),r=(0,y.useSelector)(i=>i.panelEditor.ui.isPanelOptionsVisible),s=(0,y.useSelector)(i=>i.panelEditor.isVizPickerOpen),l=()=>{a((0,F.eK)(!s))},d=()=>{a(oe({isPanelOptionsVisible:!r}))};return n?t.createElement("div",{className:at.wrapper},t.createElement(Ka.e,null,t.createElement(me.I,{className:at.vizButton,tooltip:"Click to change visualization",imgSrc:n.meta.info.logos.small,isOpen:s,onClick:l,"data-testid":P.Tp.components.PanelEditor.toggleVizPicker,"aria-label":"Change Visualization",variant:"canvas",fullWidth:!0},n.meta.name),t.createElement(me.I,{tooltip:r?"Close options pane":"Show options pane",icon:r?"angle-right":"angle-left",onClick:d,variant:"canvas","data-testid":P.Tp.components.PanelEditor.toggleVizOptions,"aria-label":r?"Close options pane":"Show options pane"}))):null};fe.displayName="VisualizationTab";const at={wrapper:(0,p.css)`
    display: flex;
    flex-direction: column;
  `,vizButton:(0,p.css)`
    text-align: left;
  `};var ja=o(78685),Ja=o(67647),nt=o(15054),rt=o(14792),Xa=o(68313),Ya=o(96227),Za=o(96374);const qa=({onConfirm:e,onDismiss:a,panel:n})=>{const r=(0,et.X)(n),s=`${r?"Changing":"Replace with"} library panel`,l=`${r?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return t.createElement(Za.u,{onConfirm:e,onDismiss:a,confirmText:r?"Change":"Replace",title:s,body:l,dismissText:"Cancel",isOpen:!0})};var _a=o(83791);const en=({panel:e,searchQuery:a,isWidget:n=!1})=>{const[r,s]=(0,t.useState)(!1),[l,d]=(0,t.useState)(void 0),[i,u]=(0,t.useState)([]),c=(0,t.useCallback)(C=>{u(C.map(w=>w.id))},[u]),m=(0,rt.UA)().getCurrent(),v=(0,y.useDispatch)(),E=async()=>{l&&(d(void 0),v((0,se.Xk)(e,l)))},M=()=>s(!0),S=()=>d(void 0);return t.createElement(q.gW,{spacing:"md"},!e.libraryPanel&&t.createElement(q.gW,{align:"center"},t.createElement(h.$n,{icon:"plus",onClick:M,variant:"secondary",fullWidth:!0},"Create new library panel")),t.createElement(Xa.$,{onChange:c,isWidget:n}),t.createElement("div",{className:tn.libraryPanelsView},t.createElement(_a.y,{currentPanelId:e.libraryPanel?.uid,searchString:a,panelFilter:i,onClickCard:d,showSecondaryActions:!0,isWidget:n})),r&&t.createElement(Ya.o,{panel:e,onDismiss:()=>s(!1),initialFolderUid:m?.meta.folderUid,isOpen:r}),l&&t.createElement(qa,{panel:e,onDismiss:S,onConfirm:E}))},tn={libraryPanelsView:(0,p.css)`
    width: 100%;
  `};var an=o(56707),st=o(86292),N=o(32696);const ot=({panel:e,data:a})=>{const n=(0,y.useSelector)(tt(e.type)),[r,s]=(0,t.useState)(""),l=!!n.meta.skipDataQuery,d=!!(l&&D.$.featureToggles.vizAndWidgetSplit),i=d?nt.MM:nt.wV,u=d?N.__.Widgets:N.__.Visualizations,[c,m]=(0,ja.A)(i,u),v=(0,y.useDispatch)(),E=(0,b.of)(nn),M=(0,t.useRef)(null),S=(0,t.useCallback)(T=>{v((0,se.gW)({panel:e,...T})),T.withModKey||v((0,F.eK)(!1))},[v,e]),C=()=>{v((0,F.eK)(!1))};if(!n)return null;const w=[{label:"Visualizations",value:N.__.Visualizations},{label:"Suggestions",value:N.__.Suggestions},{label:"Library panels",value:N.__.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}],R=[{label:"Widgets",value:N.__.Widgets},{label:"Library panels",value:N.__.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}];return t.createElement("div",{className:E.openWrapper},t.createElement("div",{className:E.formBox},t.createElement("div",{className:E.searchRow},t.createElement(Ja.Z,{value:r,onChange:s,ref:M,autoFocus:!0,placeholder:"Search for..."}),t.createElement(h.$n,{title:"Close",variant:"secondary",icon:"angle-up",className:E.closeButton,"aria-label":P.Tp.components.PanelEditor.toggleVizPicker,onClick:C})),t.createElement(Z.D,{className:E.customFieldMargin},t.createElement(Ye.z,{options:d?R:w,value:c,onChange:m,fullWidth:!0}))),t.createElement("div",{className:E.scrollWrapper},t.createElement(re.E,{autoHeightMin:"100%"},t.createElement("div",{className:E.scrollContent},c===N.__.Visualizations&&t.createElement(st.G,{pluginId:n.meta.id,onChange:S,searchQuery:r}),c===N.__.Widgets&&t.createElement(st.G,{pluginId:n.meta.id,onChange:S,searchQuery:r,isWidget:!0}),c===N.__.Suggestions&&t.createElement(an.a,{onChange:S,searchQuery:r,panel:e,data:a}),c===N.__.LibraryPanels&&t.createElement(en,{searchQuery:r,panel:e,key:"Panel Library",isWidget:l})))))};ot.displayName="VisualizationSelectPane";const nn=e=>({icon:(0,p.css)`
      color: ${e.v1.palette.gray33};
    `,wrapper:(0,p.css)`
      display: flex;
      flex-direction: column;
      flex: 1 1 0;
      height: 100%;
    `,vizButton:(0,p.css)`
      text-align: left;
    `,scrollWrapper:(0,p.css)`
      flex-grow: 1;
      min-height: 0;
    `,scrollContent:(0,p.css)`
      padding: ${e.spacing(1)};
    `,openWrapper:(0,p.css)`
      display: flex;
      flex-direction: column;
      flex: 1 1 100%;
      height: 100%;
      background: ${e.colors.background.primary};
      border: 1px solid ${e.colors.border.weak};
    `,searchRow:(0,p.css)`
      display: flex;
      margin-bottom: ${e.spacing(1)};
    `,closeButton:(0,p.css)`
      margin-left: ${e.spacing(1)};
    `,customFieldMargin:(0,p.css)`
      margin-bottom: ${e.spacing(1)};
    `,formBox:(0,p.css)`
      padding: ${e.spacing(1)};
      padding-bottom: 0;
    `}),rn=({plugin:e,panel:a,onFieldConfigsChange:n,onPanelOptionsChanged:r,onPanelConfigChange:s,dashboard:l,instanceState:d})=>{const i=(0,b.of)(sn),u=(0,y.useSelector)(m=>m.panelEditor.isVizPickerOpen),{data:c}=de(a,{withTransforms:!0,withFieldConfig:!1},!0);return t.createElement("div",{className:i.wrapper,"aria-label":P.Tp.components.PanelEditor.OptionsPane.content},!u&&t.createElement(t.Fragment,null,t.createElement("div",{className:i.vizButtonWrapper},t.createElement(fe,{panel:a})),t.createElement("div",{className:i.optionsWrapper},t.createElement(Qa.Ff,{panel:a,dashboard:l,plugin:e,instanceState:d,data:c,onFieldConfigsChange:n,onPanelOptionsChanged:r,onPanelConfigChange:s}))),u&&t.createElement(ot,{panel:a,data:c}))},sn=e=>({wrapper:(0,p.css)`
      height: 100%;
      width: 100%;
      display: flex;
      flex: 1 1 0;
      flex-direction: column;
      padding: 0;
    `,optionsWrapper:(0,p.css)`
      flex-grow: 1;
      min-height: 0;
    `,vizButtonWrapper:(0,p.css)`
      padding: 0 ${e.spacing(2,2)} 0;
    `,legacyOptions:(0,p.css)`
      label: legacy-options;
      .panel-options-grid {
        display: flex;
        flex-direction: column;
      }
      .panel-options-group {
        margin-bottom: 0;
      }
      .panel-options-group__body {
        padding: ${e.spacing(2)} 0;
      }

      .section {
        display: block;
        margin: ${e.spacing(2)} 0;

        &:first-child {
          margin-top: 0;
        }
      }
    `});var lt=o(3591),on=o(91052),ln=o(20726),cn=o(36663),dn=(e=>(e.Error="Error",e.Info="Info",e.Links="Links",e))(dn||{});class un extends t.Component{constructor(){super(...arguments),this.timeSrv=(0,B.jG)(),this.getInfoMode=()=>{const{panel:a,error:n}=this.props;if(n)return"Error";if(a.description)return"Info";if(a.links&&a.links.length)return"Links"},this.getInfoContent=()=>{const{panel:a}=this.props,n=a.description||"",r=(0,je.w)().replace(n,a.scopedVars),s=(0,cn.G)(r),l=this.props.links&&this.props.links.getLinks(a.replaceVariables);return t.createElement("div",{className:"panel-info-content markdown-html"},t.createElement("div",{dangerouslySetInnerHTML:{__html:s}}),l&&l.length>0&&t.createElement("ul",{className:"panel-info-corner-links"},l.map((d,i)=>t.createElement("li",{key:i},t.createElement("a",{className:"panel-info-corner-links__item",href:d.href,target:d.target},d.title)))))},this.onClickError=()=>{g.Ny.partial({inspect:this.props.panel.id,inspectTab:I.q.Error})}}renderCornerType(a,n,r){const s=a==="Error"?"error":"info",l=`panel-info-corner panel-info-corner--${a.toLowerCase()}`,d=P.Tp.components.Panels.Panel.headerCornerInfo(a.toLowerCase());return t.createElement(ge.m,{content:n,placement:"top-start",theme:s,interactive:!0},t.createElement("button",{type:"button",className:l,onClick:r,"aria-label":d},t.createElement("i",{"aria-hidden":!0,className:"fa"}),t.createElement("span",{className:"panel-info-corner-inner"})))}render(){const{error:a}=this.props,n=this.getInfoMode();return n?n==="Error"&&a?this.renderCornerType(n,a,this.onClickError):n==="Info"||n==="Links"?this.renderCornerType(n,this.getInfoContent):null:null}}const mn=un;function pn({width:e,height:a,panel:n,dashboard:r}){const{data:s}=de(n,{withTransforms:!0,withFieldConfig:!1},!1),[l,d]=(0,t.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});if((0,t.useEffect)(()=>{const u=(0,B.jG)(),c=n.events.subscribe(lt._,()=>{const m=(0,Ue.nk)(n,u.timeRange());n.runAllPanelQueries({dashboardUID:r.uid,dashboardTimezone:r.getTimezone(),timeData:m,width:e})});return()=>{c.unsubscribe()}},[n,r,e]),!s)return null;const i=s?.errors?s.errors.length>1?"Multiple errors found. Click for more details":s.errors[0].message:s?.error?.message;return t.createElement(on.NR,{width:e,height:a,padding:"none"},(u,c)=>t.createElement(t.Fragment,null,t.createElement(mn,{panel:n,error:i}),t.createElement(ln.m,{title:"Raw data",pluginId:"table",width:u,height:c,data:s,options:l,onOptionsChange:d})))}var it=o(69731),ct=o(8984),gn=o(40980),dt=o(27747);const hn=({panel:e,dashboard:a,...n})=>{const{rules:r,loading:s}=(0,dt.S)({panelId:e.id,dashboardUID:a.uid});return t.createElement(Y.o,{...n,counter:s?null:r.length})};var fn=o(39558),vn=o(76885),ut=o(25027),En=o(63066);const mt=({dashboard:e,panel:a,className:n})=>{const r=(0,y.useSelector)(u=>u.templating),s=(0,f.zy)(),{loading:l,value:d}=(0,W.A)(()=>(0,En.mp)(a,e),[a,e,r]);if(l)return t.createElement(h.$n,{disabled:!0},"New alert rule");if(!d)return t.createElement(V.F,{severity:"info",title:"No alerting capable query found"},"Cannot create alerts from this panel because no query to an alerting capable datasource is found.");const i=vn.kM.renderUrl("alerting/new",{defaults:JSON.stringify(d),returnTo:s.pathname+s.search});return t.createElement(h.z9,{icon:"bell",onClick:()=>(0,ut.fH)(ut.le.alertRuleFromPanel),href:i,className:n,"data-testid":"create-alert-rule-button"},"New alert rule")};var yn=o(14618),bn=o(75471);const Pn=({dashboard:e,panel:a})=>{const n=(0,b.of)(Sn),{errors:r,loading:s,rules:l}=(0,dt.S)({dashboardUID:e.uid,panelId:a.id,poll:!0}),d=(0,bn.Wd)("grafana"),i=z.TP.hasPermission(d.create),u=r.length?t.createElement(V.F,{title:"Errors loading rules",severity:"error"},r.map((c,m)=>t.createElement("div",{key:m},"Failed to load Grafana rules state: ",c.message||"Unknown error."))):null;return s&&!l.length?t.createElement("div",{className:n.innerWrapper},u,t.createElement(fn._,{text:"Loading rules..."})):l.length?t.createElement(re.E,{autoHeightMin:"100%"},t.createElement("div",{className:n.innerWrapper},u,t.createElement(yn.s,{rules:l}),!!e.meta.canSave&&i&&t.createElement(mt,{className:n.newButton,panel:a,dashboard:e}))):t.createElement("div",{"data-testid":P.Tp.components.PanelAlertTabContent.content,className:n.noRulesWrapper},u,!!e.uid&&t.createElement(t.Fragment,null,t.createElement("p",null,"There are no alert rules linked to this panel."),!!e.meta.canSave&&i&&t.createElement(mt,{panel:a,dashboard:e})),!e.uid&&!!e.meta.canSave&&t.createElement(V.F,{severity:"info",title:"Dashboard not saved"},"Dashboard must be saved before alerts can be added."))},Sn=e=>({newButton:(0,p.css)`
    margin-top: ${e.spacing(3)};
  `,innerWrapper:(0,p.css)`
    padding: ${e.spacing(2)};
  `,noRulesWrapper:(0,p.css)`
    margin: ${e.spacing(2)};
    background-color: ${e.colors.background.secondary};
    padding: ${e.spacing(3)};
  `});var Cn=o(66879),Tn=o(22391),Dn=o(47311),ve=o(31193),Nn=o(37464);class xn extends t.PureComponent{constructor(a){super(a),this.updateLastUsedDatasource=n=>{(0,Dn.tw)(n)},this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{g.Ny.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=n=>{const{panel:r}=this.props;r.updateQueries(n),n.dataSource.uid!==r.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(a){const n=a.datasource??{default:!0},r=(0,ve.tR)().getInstanceSettings(n);return this.updateLastUsedDatasource(n),{cacheTimeout:r?.meta.queryOptions?.cacheTimeout?a.cacheTimeout:void 0,dataSource:{default:r?.isDefault,type:r?.type,uid:r?.uid},queryCachingTTL:r?.cachingConfig?.enabled?a.queryCachingTTL:void 0,queries:a.targets,maxDataPoints:a.maxDataPoints,minInterval:a.interval,timeRange:{from:a.timeFrom,shift:a.timeShift,hide:a.hideTimeOverride}}}async componentDidMount(){const{panel:a}=this.props;if(!a.datasource){let n;const r=(0,rt.UA)().getCurrent()?.uid??"",s=(0,Le.CW)(r);s?.datasourceUid!==null&&(n=(0,ve.tR)().getInstanceSettings(s?.datasourceUid)),n||(n=(0,ve.tR)().getInstanceSettings(null)),a.datasource=(0,Tn.p$)(n),this.forceUpdate()}}render(){const{panel:a}=this.props;if(!a.datasource)return null;const n=this.buildQueryOptions(a);return t.createElement(Nn.g,{options:n,queryRunner:a.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const pt=t.memo(({panel:e,dashboard:a,tabs:n,onChangeTab:r})=>{const s=(0,it.C)(),l=(0,b.of)(wn),d=(0,t.useCallback)(c=>{let m="panel_editor_tabs_changed";D.$.featureToggles.transformationsRedesign&&(m="transformations_redesign_"+m),c.active||(0,xe.rR)(m,{tab_id:c.id}),r(c)},[r]);(0,t.useEffect)(()=>{const c=new Xe.yU;return c.add(e.events.subscribe(A.zq,s)),c.add(e.events.subscribe(A.JI,s)),()=>c.unsubscribe()},[e,a,s]);const i=n.find(c=>c.active);if(n.length===0)return null;const u=D.$.unifiedAlertingEnabled;return t.createElement("div",{className:l.wrapper},t.createElement(ie.U,{className:l.tabBar,hideBorder:!0},n.map(c=>c.id===N.M8.Alert&&u?t.createElement(hn,{key:c.id,label:c.text,active:c.active,onChangeTab:()=>r(c),icon:(0,ct.toIconName)(c.icon),panel:e,dashboard:a}):t.createElement(Y.o,{key:c.id,label:c.text,active:c.active,onChangeTab:()=>d(c),icon:(0,ct.toIconName)(c.icon),counter:Mn(e,c)}))),t.createElement(gn.J,{className:l.tabContent},i.id===N.M8.Query&&t.createElement(xn,{panel:e,queries:e.targets}),i.id===N.M8.Alert&&t.createElement(Pn,{panel:e,dashboard:a}),i.id===N.M8.Transform&&t.createElement(Cn.o,{panel:e})))});pt.displayName="PanelEditorTabs";function Mn(e,a){switch(a.id){case N.M8.Query:return e.targets.length;case N.M8.Alert:return e.alert?1:0;case N.M8.Transform:return(e.getTransformations()??[]).length}return null}const wn=e=>({wrapper:(0,p.css)`
      display: flex;
      flex-direction: column;
      height: 100%;
    `,tabBar:(0,p.css)`
      padding-left: ${e.spacing(2)};
    `,tabContent:(0,p.css)`
      padding: 0;
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
      background: ${e.colors.background.primary};
      border: 1px solid ${e.components.panel.borderColor};
      border-left: none;
      border-bottom: none;
      border-top-right-radius: ${e.shape.borderRadius(1.5)};
    `});var In=o(95689),Rn=o(54612);const Ln=(e,a)=>{const n=e.panelEditor.getPanel(),r=(0,Ge.U)(e,n);return{panel:n,plugin:r?.plugin,instanceState:r?.instanceState,initDone:e.panelEditor.initDone,uiState:e.panelEditor.ui,tableViewEnabled:e.panelEditor.tableViewEnabled,variables:(0,he.SS)(a.dashboard.uid,e)}},An={initPanelEditor:_t,discardPanelChanges:$e,updatePanelEditorUIState:oe,updateTimeZoneForSession:Va.Cj,toggleTableView:F.kw,notifyApp:Ce.dx},Fn=(0,H.connect)(Ln,An);class Un extends t.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{g.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{Fa.lE.publish(new A.S8({component:ka.$,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,et.X)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=a=>{g.Ny.partial({tab:a.id})},this.onFieldConfigChange=a=>{this.props.panel.updateFieldConfig({...a})},this.onPanelOptionsChanged=a=>{this.props.panel.updateOptions(a)},this.onPanelConfigChanged=(a,n)=>{this.props.panel.setProperty(a,n),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=a=>{const{updatePanelEditorUIState:n}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),n({mode:a})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{g.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:a,initDone:n}=this.props;n&&!this.eventSubs&&(this.eventSubs=new Xe.yU,this.eventSubs.add(a.events.subscribe(A.PR,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(a,n){const{dashboard:r,panel:s,uiState:l,tableViewEnabled:d,theme:i}=this.props;return t.createElement("div",{className:a.mainPaneWrapper,key:"panel"},this.renderPanelToolbar(a),t.createElement("div",{className:a.panelWrapper},t.createElement(le.Ay,null,({width:u,height:c})=>{if(u<3||c<3)return null;if(n&&(c-=i.spacing.gridSize*2),d)return t.createElement(pn,{width:u,height:c,panel:s,dashboard:r});const m=(0,Rn.A)(l.mode,u,c,s);return t.createElement("div",{className:a.centeringContainer,style:{width:u,height:c}},t.createElement("div",{style:m,"data-panelid":s.id},t.createElement(Wa.L,{key:s.key,stateKey:s.key,dashboard:r,panel:s,isEditing:!0,isViewing:!1,lazy:!1,width:m.width,height:m.height})))})))}renderPanelAndEditor(a,n){const{panel:r,dashboard:s,plugin:l,tab:d}=this.props,i=(0,In.a)(d,l),u=i.length===0,c=this.renderPanel(n,u);return i.length===0?t.createElement("div",{className:n.onlyPanel},c):t.createElement(qe.g,{splitOrientation:"horizontal",maxSize:-200,paneSize:a.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:m=>{m&&oe({topPaneSize:m/window.innerHeight})}},c,t.createElement("div",{className:n.tabsWrapper,"aria-label":P.Tp.components.PanelEditor.DataPane.content,key:"panel-editor-tabs"},t.createElement(pt,{key:r.key,panel:r,dashboard:s,tabs:i,onChangeTab:this.onChangeTab})))}renderTemplateVariables(a){const{variables:n}=this.props;return n.length?t.createElement("div",{className:a.variablesWrapper},t.createElement(_e,{variables:n})):null}renderPanelToolbar(a){const{dashboard:n,uiState:r,variables:s,updateTimeZoneForSession:l,panel:d,tableViewEnabled:i}=this.props;return t.createElement("div",{className:a.panelToolbar},t.createElement(q.Gy,{justify:s.length>0?"space-between":"flex-end",align:"flex-start"},this.renderTemplateVariables(a),t.createElement(X.B,{gap:1},t.createElement(G.K,{label:"Table view",showLabel:!0,id:"table-view",value:i,onClick:this.onToggleTableView,"aria-label":P.Tp.components.PanelEditor.toggleTableView}),t.createElement(Ye.z,{value:r.mode,options:N.Nt,onChange:this.onDisplayModeChange}),t.createElement(Ga.$,{dashboard:n,onChangeTimeZone:l,isOnCanvas:!0}),!r.isPanelOptionsVisible&&t.createElement(fe,{panel:d}))))}renderEditorActions(){const a="sm";let n=[t.createElement(h.$n,{onClick:this.onDiscard,title:"Undo all changes",key:"discard",size:a,variant:"destructive",fill:"outline"},"Discard"),this.props.panel.libraryPanel?t.createElement(h.$n,{onClick:this.onSaveLibraryPanel,variant:"primary",size:a,title:"Apply changes and save library panel",key:"save-panel"},"Save library panel"):t.createElement(h.$n,{onClick:this.onSaveDashboard,title:"Apply changes and save dashboard",key:"save",size:a,variant:"secondary"},"Save"),t.createElement(h.$n,{onClick:this.onBack,variant:"primary",title:"Apply changes and go back to dashboard","data-testid":P.Tp.components.PanelEditor.applyButton,key:"apply",size:a},"Apply")];return this.props.panel.libraryPanel&&(n.splice(1,0,t.createElement(L.$s,{key:"unlink-controller"},({showModal:r,hideModal:s})=>t.createElement(me.I,{onClick:()=>{r(Ba.l,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:s,isOpen:!0})},title:"Disconnects this panel from the library panel so that you can edit it regularly.",key:"unlink"},"Unlink"))),n.pop()),n}renderOptionsPane(){const{plugin:a,dashboard:n,panel:r,instanceState:s}=this.props;return a?t.createElement(rn,{plugin:a,dashboard:n,panel:r,instanceState:s,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):t.createElement("div",null)}render(){const{initDone:a,uiState:n,theme:r,sectionNav:s,pageNav:l,className:d,updatePanelEditorUIState:i}=this.props,u=$n(r,this.props);return a?t.createElement($.Y,{navModel:s,pageNav:l,"aria-label":P.Tp.components.PanelEditor.General.content,layout:O.k.Custom,className:d},t.createElement(Aa.H,{actions:t.createElement(La.U,{alignment:"right"},this.renderEditorActions())}),t.createElement("div",{className:u.wrapper},t.createElement("div",{className:u.verticalSplitPanesWrapper},n.isPanelOptionsVisible?t.createElement(qe.g,{splitOrientation:"vertical",maxSize:-300,paneSize:n.rightPaneSize,primary:"second",onDragFinished:c=>{c&&i({rightPaneSize:c/window.innerWidth})}},this.renderPanelAndEditor(n,u),this.renderOptionsPane()):this.renderPanelAndEditor(n,u)),this.state.showSaveLibraryPanelModal&&t.createElement(Fe,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel}))):null}}const On=(0,b.cV)(Fn(Un)),$n=(0,Ze.N)((e,a)=>{const{uiState:n}=a,r=e.spacing(2);return{wrapper:(0,p.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:e.spacing(2)}),verticalSplitPanesWrapper:(0,p.css)`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      position: relative;
    `,mainPaneWrapper:(0,p.css)`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      padding-right: ${n.isPanelOptionsVisible?0:r};
    `,variablesWrapper:(0,p.css)`
      label: variablesWrapper;
      display: flex;
      flex-grow: 1;
      flex-wrap: wrap;
      gap: ${e.spacing(1,2)};
    `,panelWrapper:(0,p.css)`
      flex: 1 1 0;
      min-height: 0;
      width: 100%;
      padding-left: ${r};
    `,tabsWrapper:(0,p.css)`
      height: 100%;
      width: 100%;
    `,panelToolbar:(0,p.css)`
      display: flex;
      padding: 0 0 ${r} ${r};
      justify-content: space-between;
      flex-wrap: wrap;
    `,angularWarning:(0,p.css)`
      display: flex;
      height: theme.spacing(4);
      align-items: center;
    `,toolbarLeft:(0,p.css)`
      padding-left: ${e.spacing(1)};
    `,centeringContainer:(0,p.css)`
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      flex-direction: column;
    `,onlyPanel:(0,p.css)`
      height: 100%;
      position: absolute;
      overflow: hidden;
      width: 100%;
    `}});var zn=o(1702),Vn=o(39268),Bn=o(14186),Wn=o(89963),Gn=o(42972);const kn=({annotation:e,events:a,onEnabledChanged:n})=>{const[r,s]=(0,t.useState)(!1),l=(0,b.of)(Qn),d=()=>(0,Gn.Dh)().cancel(e);return(0,t.useEffect)(()=>{const i=a.getStream(A.xc).subscribe({next:c=>{c.payload===e&&s(!0)}}),u=a.getStream(A.yj).subscribe({next:c=>{c.payload===e&&s(!1)}});return()=>{i.unsubscribe(),u.unsubscribe()}}),t.createElement("div",{key:e.name,className:l.annotation},t.createElement(Vn.C,null,t.createElement(Bn.I,{label:e.name,disabled:r,"data-testid":P.Tp.pages.Dashboard.SubMenu.Annotations.annotationLabel(e.name)},t.createElement(G.K,{label:e.name,value:e.enable,onChange:()=>n(e),disabled:r,"data-testid":P.Tp.pages.Dashboard.SubMenu.Annotations.annotationToggle(e.name)})),t.createElement("div",{className:l.indicator},t.createElement(Wn.I,{loading:r,onCancel:d}))))};function Qn(e){return{annotation:(0,p.css)`
      display: inline-block;
      margin-right: ${e.spacing(1)};

      .fa-caret-down {
        font-size: 75%;
        padding-left: ${e.spacing(1)};
      }

      .gf-form-inline .gf-form {
        margin-bottom: 0;
      }
    `,indicator:(0,p.css)`
      align-self: center;
      padding: 0 ${e.spacing(.5)};
    `}}const Kn=({annotations:e,onAnnotationChanged:a,events:n})=>{const[r,s]=(0,t.useState)([]);return(0,t.useEffect)(()=>{s(e.filter(l=>l.hide!==!0))},[e]),r.length===0?null:t.createElement("div",{"data-testid":P.Tp.pages.Dashboard.SubMenu.Annotations.annotationsWrapper},r.map(l=>t.createElement(kn,{events:n,annotation:l,onEnabledChanged:a,key:l.name})))};var Hn=o(94701),jn=o(80997),Jn=o(4588),Xn=o(6923),gt=o(52424);const Yn=({dashboard:e,links:a})=>{const n=(0,it.C)();return(0,Hn.A)(()=>{const r=e.events.subscribe(lt.sR,n);return()=>r.unsubscribe()}),a.length?t.createElement(t.Fragment,null,a.map((r,s)=>{const l=(0,Xn.mQ)().getAnchorInfo(r),d=`${r.title}-$${s}`;if(r.type==="dashboards")return t.createElement(gt.aK,{key:d,link:r,linkInfo:l,dashboardUID:e.uid});const i=Jn.G[r.icon],u=t.createElement(gt.Zx,{href:(0,jn.Jf)(l.href),target:r.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":P.Tp.components.DashboardLinks.link,icon:i},l.title);return t.createElement("div",{key:d,"data-testid":P.Tp.components.DashboardLinks.container},r.tooltip?t.createElement(ge.m,{content:l.tooltip},u):u)})):null};class Zn extends t.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=a=>{for(let n=0;n<this.props.dashboard.annotations.list.length;n++){const r=this.props.dashboard.annotations.list[n];if(r.name===a.name){r.enable=!r.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()},this.disableSubmitOnEnter=a=>{a.preventDefault()}}render(){const{dashboard:a,variables:n,links:r,annotations:s,theme:l}=this.props,d=_n(l),i=a.meta.isSnapshot??!1;return t.createElement("div",{className:d.submenu},t.createElement("form",{"aria-label":"Template variables",className:d.formStyles,onSubmit:this.disableSubmitOnEnter},t.createElement(_e,{variables:n,readOnly:i})),t.createElement(Kn,{annotations:s,onAnnotationChanged:this.onAnnotationStateChanged,events:a.events}),t.createElement("div",{className:d.spacer}),a&&t.createElement(Yn,{dashboard:a,links:r}))}}const qn=(e,a)=>{const{uid:n}=a.dashboard,r=(0,he.nx)(n,e);return{variables:(0,he.pi)(n,r.variables)}},_n=(0,Ze.N)(e=>({formStyles:(0,p.css)`
      display: flex;
      flex-wrap: wrap;
      display: contents;
    `,submenu:(0,p.css)`
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      align-content: flex-start;
      align-items: flex-start;
      gap: ${e.spacing(1)} ${e.spacing(2)};
      padding: 0 0 ${e.spacing(1)} 0;
    `,spacer:(0,p.css)({flexGrow:1})})),ht=(0,b.cV)((0,H.connect)(qn)(Zn));ht.displayName="SubMenu";var er=o(2118),tr=o(61582),ft=o(84423),ar=o(3673);const nr=e=>({initPhase:e.dashboard.initPhase,initError:e.dashboard.initError,dashboard:e.dashboard.getModel(),navIndex:e.navIndex}),rr={initDashboard:U.vR,cleanUpDashboardAndVariables:ar.Bz,notifyApp:Ce.dx,cancelVariables:Ie.Y7,templateVarsChangedInUrl:Ie.Hn},sr=(0,H.connect)(nr,rr);class or extends t.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.updateLiveTimer=()=>{let a;this.props.dashboard?.liveNow&&(a=(0,B.jG)().timeRange()),tr.a.setLiveTimeRange(a)},this.setScrollRef=a=>{this.setState({scrollElement:a})},this.onCloseShareModal=()=>{g.Ny.partial({shareView:null})}}static{this.contextType=Mt.YE}getCleanState(){return{editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.history.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:a,match:n,queryParams:r}=this.props;a&&this.closeDashboard(),this.props.initDashboard({urlSlug:n.params.slug,urlUid:n.params.uid,urlType:n.params.type,urlFolderUid:r.folderUid,panelType:r.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:n.params.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(a,n){const{dashboard:r,match:s,templateVarsChangedInUrl:l}=this.props,d=this.props.history.location.state?.routeReloadCounter;if(r){if(a.match.params.uid!==s.params.uid||d!==void 0&&this.forceRouteReloadCounter!==d){this.initDashboard(),this.forceRouteReloadCounter=d;return}if(a.location.search!==this.props.location.search){const i=a.queryParams,u=this.props.queryParams;(u?.from!==i?.from||u?.to!==i?.to)&&((0,B.jG)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!i?.refresh&&u?.refresh&&(0,B.jG)().setAutoRefresh(u.refresh);const c=(0,Bt.Wz)(this.props.queryParams,a.queryParams);c&&l(r.uid,c)}this.state.editPanel&&!n.editPanel&&(Ne.t.setEditingState(!0),this.props.dashboard?.events.publish(new A.sL(this.state.editPanel.id))),!this.state.editPanel&&n.editPanel&&(Ne.t.setEditingState(!1),this.props.dashboard?.events.publish(new A.i0(n.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,Te.gi)("Permission to edit panel denied")),g.Ny.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,Te.gi)("Panel not found")),g.Ny.partial({editPanel:null,viewPanel:null}))}}static getDerivedStateFromProps(a,n){const{dashboard:r,queryParams:s}=a,l=s.editPanel,d=s.viewPanel;if(!r)return n;const i={...n};if(!n.editPanel&&l){const u=r.getPanelByUrlId(l);u?r.canEditPanel(u)?(i.editPanel=u,i.rememberScrollTop=n.scrollElement?.scrollTop):i.editPanelAccessDenied=!0:i.panelNotFound=!0}else n.editPanel&&!l&&(i.editPanel=null,i.updateScrollTop=n.rememberScrollTop);if(!n.viewPanel&&d){const u=r.getPanelByUrlId(d);u?(r.initViewPanel(u),i.viewPanel=u,i.rememberScrollTop=n.scrollElement?.scrollTop,i.updateScrollTop=0):i.panelNotFound=!0}else n.viewPanel&&!d&&(r.exitViewPanel(n.viewPanel),i.viewPanel=null,i.updateScrollTop=n.rememberScrollTop);return(n.panelNotFound||n.editPanelAccessDenied&&!l)&&(i.panelNotFound=!1,i.editPanelAccessDenied=!1),lr(a,i)}getInspectPanel(){const{dashboard:a,queryParams:n}=this.props,r=n.inspect;if(!a||!r)return null;const s=a.getPanelById(parseInt(r,10));return s||null}render(){const{dashboard:a,initError:n,queryParams:r}=this.props,{editPanel:s,viewPanel:l,updateScrollTop:d,pageNav:i,sectionNav:u}=this.state,c=wt(this.props.queryParams);if(!a||!i||!u)return t.createElement(Ht.P,{initPhase:this.props.initPhase});const m=this.getInspectPanel(),v=!s&&!c&&!this.props.queryParams.editview&&a.isSubMenuVisible(),E=c!==y.KioskMode.Full&&!r.editview,M=(0,p.cx)({"panel-in-fullscreen":!!l,"page-hidden":!!(r.editview||s)});if(a.meta.dashboardNotFound)return t.createElement($.Y,{navId:"dashboards/browse",layout:O.k.Canvas,pageNav:{text:"Not found"}},t.createElement(xt.L,{entity:"Dashboard"}));const S=new Set(["autoMigrateOldPanels","autoMigrateGraphPanel","autoMigrateTablePanel","autoMigratePiechartPanel","autoMigrateWorldmapPanel","autoMigrateStatPanel","disableAngular"]),C=()=>{const T=new URLSearchParams(window.location.search);let te=!1;return T.forEach((yt,bt)=>{if(bt.startsWith("__feature.")){const Pt=bt.substring(10),dr=yt==="true"||yt==="";if(D.$.featureToggles[Pt])return;if(S.has(Pt)&&dr){te=!0;return}}}),te},w=a.panels.some(T=>T.autoMigrateFrom&&ft.NB[T.autoMigrateFrom]!=null),R=D.$.featureToggles.angularDeprecationUI&&w&&C()&&a.uid!==null;return t.createElement(t.Fragment,null,t.createElement($.Y,{navModel:u,pageNav:i,layout:O.k.Canvas,className:M,scrollRef:this.setScrollRef,scrollTop:d},E&&t.createElement("header",{"data-testid":P.Tp.pages.Dashboard.DashNav.navV2},t.createElement(Qt.U,{dashboard:a,title:a.title,folderTitle:a.meta.folderTitle,isFullscreen:!!l,kioskMode:c,hideTimePicker:a.timepicker.hidden})),t.createElement(ze,{dashboard:a}),n&&t.createElement(Kt.y,null),v&&t.createElement("section",{"aria-label":P.Tp.pages.Dashboard.SubMenu.submenu},t.createElement(ht,{dashboard:a,annotations:a.annotations.list,links:a.links})),D.$.featureToggles.angularDeprecationUI&&a.hasAngularPlugins()&&a.uid!==null&&t.createElement(Ft,{dashboardUid:a.uid,showAutoMigrateLink:a.panels.some(T=>ft.vI.includes(T.type))}),R&&t.createElement(zt,{dashboardUid:a.uid}),t.createElement(er.N,{dashboard:a,isEditable:!!a.meta.canEdit,viewPanel:l,editPanel:s}),m&&t.createElement(Ra,{dashboard:a,panel:m}),r.shareView&&t.createElement(zn.ShareModal,{dashboard:a,onDismiss:this.onCloseShareModal})),s&&t.createElement(On,{dashboard:a,sourcePanel:s,tab:this.props.queryParams.tab,sectionNav:u,pageNav:i}),r.editview&&t.createElement(oa.s,{dashboard:a,editview:r.editview,pageNav:i,sectionNav:u}),r.addWidget&&D.$.featureToggles.vizAndWidgetSplit&&t.createElement(Gt,null))}}function lr(e,a){const{dashboard:n,navIndex:r}=e;if(!n)return a;let s=a.pageNav,l=a.sectionNav;(!s||n.title!==s.text||n.meta.folderUrl!==s.parentItem?.url)&&(s={text:n.title,url:Nt.I.getUrlForPartial(e.history.location,{editview:null,editPanel:null,viewPanel:null})});const{folderUid:d}=n.meta;if(d&&s){const i=(0,De.tc)(r,`folder-dashboards-${d}`).main;i.id!=="not-found"&&(s={...s,parentItem:i})}if(e.route.routeName===y.DashboardRoutes.Path){l=we();const i=Me(e.match.params.slug);i?.parentItem&&(i.parentItem=i.parentItem)}else l=(0,De.tc)(e.navIndex,"dashboards/browse");return(a.editPanel||a.viewPanel)&&(s={...s,text:`${a.editPanel?"Edit":"View"} panel`,parentItem:s,url:void 0}),a.pageNav===s&&a.sectionNav===l?a:{...a,pageNav:s,sectionNav:l}}const vt=(0,b.cV)(or);vt.displayName="DashboardPage";const Et=sr(vt);function ir(e){const a=e.queryParams.scenes===!0,n=e.queryParams.scenes===!1;if(a||D.$.featureToggles.dashboardScene&&!n)return t.createElement(Se,{...e});const r=(0,Pe.sP)(),s=!!(e.route.routeName===y.DashboardRoutes.Home||e.route.routeName===y.DashboardRoutes.Normal&&e.match.params.uid),l=(0,W.A)(async()=>e.match.params.type==="snapshot"?null:r.fetchDashboard({route:e.route.routeName,uid:e.match.params.uid??"",keepDashboardFromExploreInLocalStorage:!0}),[e.match.params.uid,e.route.routeName]);return D.$.featureToggles.dashboardSceneForViewers?l.loading||l?.value?.dashboard?.uid!==e.match.params.uid&&l.value?.meta?.isNew!==!0?null:l.value&&!(l.value.meta?.canEdit||l.value.meta?.canMakeEditable)&&s?t.createElement(Se,{...e}):t.createElement(Et,{...e}):t.createElement(Et,{...e})}const cr=ir},53652:(St,Q,o)=>{o.d(Q,{E:()=>K,o:()=>y});var t=o(89667),W=o(57875),D=o(17172),O=o(32264),$=o(27677);class ae{constructor(){}async get(f){const g=`api/storage/read/${f}`.replace("//","/");return(0,D.AI)().get(g)}async list(f){let g="api/storage/list/";f&&(g+=f+"/");const L=await(0,D.AI)().get(g);if(L?.data){const b=(0,t.or)(L);for(const x of b.fields)x.display=(0,W.J)({field:x,theme:O.$.theme2});return b}}async createFolder(f){const g=await(0,D.AI)().post("/api/storage/createFolder",JSON.stringify({path:f}));return g.success?{}:{error:g.message??"unknown error"}}async deleteFolder(f){const g=await(0,D.AI)().post("/api/storage/deleteFolder",JSON.stringify(f));return g.success?{}:{error:g.message??"unknown error"}}async deleteFile(f){const g=await(0,D.AI)().post(`/api/storage/delete/${f.path}`);return g.success?{}:{error:g.message??"unknown error"}}async delete(f){return f.isFolder?this.deleteFolder({path:f.path,force:!0}):this.deleteFile({path:f.path})}async upload(f,g,L){const b=new FormData;b.append("folder",f),b.append("file",g),b.append("overwriteExistingFile",String(L));const x=await fetch("/api/storage/upload",{method:"POST",body:b});let h=await x.json();return h||(h={}),h.status=x.status,h.statusText=x.statusText,x.status!==200&&!h.err&&(h.err=!0),h}async write(f,g){return $.IB.post(`/api/storage/write/${f}`,g)}async getConfig(){return(0,D.AI)().get("/api/storage/config")}async getOptions(f){return(0,D.AI)().get(`/api/storage/options/${f}`)}}function K(p,f){const L=p.toLowerCase().trim();return f.map(x=>x.trim().toLowerCase()).includes(L)}let U;function y(){return U||(U=new ae),U}}}]);

//# sourceMappingURL=DashboardPageProxy.d72724497437c7fc7f71.js.map