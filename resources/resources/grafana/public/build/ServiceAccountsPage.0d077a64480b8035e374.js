"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6777],{74409:(le,O,n)=>{n.r(O),n.d(O,{ServiceAccountsListPageUnconnected:()=>b,default:()=>ge,getStyles:()=>te});var o=n(32196),s=n(55127),C=n.n(s),e=n(96540),h=n(63329),m=n(40845),r=n(55852),P=n(14186),V=n(67647),g=n(94354),R=n(69529),S=n(67061),j=n(19384),N=n(96374),G=n(7521),B=n(17205),v=n(2913),c=n(10096),l=n(44836),a=n(31678),x=n(98788),i=n(70255),p=n(14578),k=n(29158),W=n(72129),I=n(89062),$=n(5133);const A=t=>`Edit service account's ${t} details`,D=(0,e.memo)(({serviceAccount:t,onRoleChange:f,roleOptions:ne,onRemoveButtonClick:F,onDisable:K,onEnable:ae,onAddTokenClick:X})=>{const L=`org/serviceaccounts/${t.id}`,y=(0,m.of)(q),z=c.TP.hasPermissionInMetadata(a.AccessControlAction.ServiceAccountsWrite,t),Z=c.TP.hasPermission(a.AccessControlAction.ActionRolesList)&&c.TP.hasPermission(a.AccessControlAction.ActionUserRolesList);return e.createElement("tr",{key:t.id,className:(0,o.cx)({[y.disabled]:t.isDisabled})},e.createElement("td",{className:"width-4 text-center link-td"},e.createElement("a",{href:L,"aria-label":A(t.name)},e.createElement("img",{className:"filter-table__avatar",src:t.avatarUrl,alt:`Avatar for user ${t.name}`}))),e.createElement("td",{className:"link-td max-width-10"},e.createElement("a",{className:"ellipsis",href:L,title:t.name,"aria-label":A(t.name)},t.name)),e.createElement("td",{className:"link-td max-width-10"},e.createElement("a",{className:y.accountId,href:L,title:t.login,"aria-label":A(t.name)},t.login)),c.TP.licensedAccessControlEnabled()?e.createElement("td",null,Z&&e.createElement(I.y,{userId:t.id,orgId:t.orgId,basicRole:t.role,roles:t.roles||[],onBasicRoleChange:Q=>f(Q,t),roleOptions:ne,basicRoleDisabled:!z,disabled:t.isExternal||t.isDisabled,width:40})):e.createElement("td",null,e.createElement($.r,{"aria-label":"Role",value:t.role,disabled:t.isExternal||!z||t.isDisabled,onChange:Q=>f(Q,t)})),e.createElement("td",{className:"link-td max-width-10"},e.createElement("a",{className:"ellipsis",href:L,title:"Tokens","aria-label":A(t.name)},e.createElement("div",{className:(0,o.cx)(y.tokensInfo,{[y.tokensInfoSecondary]:!t.tokens})},e.createElement("span",null,e.createElement(p.I,{name:"key-skeleton-alt"})),t.tokens||"No tokens"))),e.createElement("td",null,!t.isExternal&&e.createElement(S.B,{alignItems:"center",justifyContent:"flex-end"},c.TP.hasPermission(a.AccessControlAction.ServiceAccountsWrite)&&!t.tokens&&e.createElement(r.$n,{onClick:()=>X(t),disabled:t.isDisabled,className:y.actionButton},"Add token"),c.TP.hasPermissionInMetadata(a.AccessControlAction.ServiceAccountsWrite,t)&&(t.isDisabled?e.createElement(r.$n,{variant:"primary",onClick:()=>ae(t),className:y.actionButton},"Enable"):e.createElement(r.$n,{variant:"secondary",onClick:()=>K(t),className:y.actionButton},"Disable")),c.TP.hasPermissionInMetadata(a.AccessControlAction.ServiceAccountsDelete,t)&&e.createElement(k.K,{className:y.deleteButton,name:"trash-alt",size:"md",onClick:()=>F(t),tooltip:`Delete service account ${t.name}`})),t.isExternal&&e.createElement(S.B,{alignItems:"center",justifyContent:"flex-end"},e.createElement(k.K,{disabled:!0,name:"lock",size:"md",tooltip:"This is a managed service account and cannot be modified."}))))});D.displayName="ServiceAccountListItem";const T=({rootProps:t})=>{const f=(0,m.of)(Y);return e.createElement("tr",{...t},e.createElement("td",{className:"width-4 text-center"},e.createElement(i.A,{containerClassName:f.blockSkeleton,circle:!0,width:25,height:25})),e.createElement("td",{className:"max-width-10"},e.createElement(i.A,{width:100})),e.createElement("td",{className:"max-width-10"},e.createElement(i.A,{width:100})),e.createElement("td",null,e.createElement(i.A,{containerClassName:f.blockSkeleton,width:"100%",height:32})),e.createElement("td",{className:"max-width-10"},e.createElement(i.A,{width:40})),e.createElement("td",null,e.createElement(S.B,{alignItems:"center",justifyContent:"flex-end"},e.createElement(i.A,{containerClassName:f.blockSkeleton,width:102,height:32}),e.createElement(i.A,{containerClassName:f.blockSkeleton,width:85,height:32}),e.createElement(i.A,{containerClassName:(0,o.cx)(f.blockSkeleton,f.deleteButton),width:16,height:16}))))},U=(0,W.j)(D,T),Y=t=>({blockSkeleton:(0,o.css)({display:"block",lineHeight:1}),deleteButton:(0,o.css)({marginRight:t.spacing(.5)})}),q=t=>({iconRow:(0,o.css)({svg:{marginLeft:t.spacing(.5)}}),accountId:(0,o.cx)("ellipsis",(0,o.css)({color:t.colors.text.secondary})),deleteButton:(0,o.css)({color:t.colors.text.secondary}),tokensInfo:(0,o.css)({span:{marginRight:t.spacing(1)}}),tokensInfoSecondary:(0,o.css)({color:t.colors.text.secondary}),disabled:(0,o.css)({"td a":{color:t.colors.text.secondary}}),actionButton:(0,o.css)({minWidth:85})}),M=U;var E=n(12966);function _(t){return{...t.serviceAccounts}}const ee={changePage:E.yd,changeQuery:E.nM,fetchACOptions:E.pJ,fetchServiceAccounts:E.iJ,deleteServiceAccount:E.W4,updateServiceAccount:E.mV,changeStateFilter:E.qS,createServiceAccountToken:E.yC},J=(0,h.connect)(_,ee),H=[{label:"All",value:a.ServiceAccountStateFilter.All},{label:"With expired tokens",value:a.ServiceAccountStateFilter.WithExpiredTokens},{label:"Disabled",value:a.ServiceAccountStateFilter.Disabled}];v.Ay.featureToggles.externalServiceAccounts&&H.push({label:"Managed",value:a.ServiceAccountStateFilter.External});const b=({page:t,changePage:f,totalPages:ne,serviceAccounts:F,isLoading:K,roleOptions:ae,query:X,serviceAccountStateFilter:L,changeQuery:y,fetchACOptions:z,fetchServiceAccounts:Z,deleteServiceAccount:Q,updateServiceAccount:oe,changeStateFilter:ve,createServiceAccountToken:fe})=>{const ce=(0,m.of)(te),[he,ie]=(0,e.useState)(!1),[pe,re]=(0,e.useState)(!1),[De,de]=(0,e.useState)(!1),[ye,me]=(0,e.useState)(""),[u,w]=(0,e.useState)(null);(0,e.useEffect)(()=>{Z({withLoadingIndicator:!0}),c.TP.licensedAccessControlEnabled()&&z()},[z,Z]);const se=F.length===0&&L===a.ServiceAccountStateFilter.All&&!X,Ce=async(d,Ne)=>{const Be={...Ne,role:d};oe(Be),c.TP.licensedAccessControlEnabled()&&z()},Se=d=>{y(d)},Ae=d=>{ve(d)},Te=d=>{w(d),re(!0)},Pe=async()=>{u&&Q(u.id),ue()},Ie=d=>{w(d),de(!0)},xe=()=>{u&&oe({...u,isDisabled:!0}),Ee()},ke=d=>{oe({...d,isDisabled:!1})},Me=d=>{w(d),ie(!0)},be=async d=>{u&&fe(u.id,d,me)},Le=()=>{ie(!1),w(null),me("")},ue=()=>{re(!1),w(null)},Ee=()=>{de(!1),w(null)},Oe=e.createElement("a",{className:"external-link",href:"https://grafana.com/docs/grafana/latest/administration/service-accounts/",target:"_blank",rel:"noopener noreferrer"},"documentation."),Re=e.createElement("span",null,"Service accounts and their tokens can be used to authenticate against the Grafana API. Find out more in our"," ",Oe);return e.createElement(B.Y,{navId:"serviceaccounts",subTitle:Re,actions:e.createElement(e.Fragment,null,!se&&c.TP.hasPermission(a.AccessControlAction.ServiceAccountsCreate)&&e.createElement(r.z9,{href:"org/serviceaccounts/create",variant:"primary"},"Add service account"))},e.createElement(B.Y.Contents,null,e.createElement("div",{className:"page-action-bar"},e.createElement(P.I,{grow:!0},e.createElement(V.Z,{placeholder:"Search service account by name",value:X,onChange:Se,width:50})),e.createElement(g.z,{options:H,onChange:Ae,value:L,className:ce.filter})),!K&&!se&&F.length===0&&e.createElement(R.p,{variant:"not-found",message:(0,l.t)("service-accounts.empty-state.message","No services accounts found")}),!K&&se&&e.createElement(e.Fragment,null,e.createElement(G.A,{title:"You haven't created any service accounts yet.",buttonIcon:"key-skeleton-alt",buttonLink:"org/serviceaccounts/create",buttonTitle:"Add service account",buttonDisabled:!c.TP.hasPermission(a.AccessControlAction.ServiceAccountsCreate),proTip:"Remember, you can provide specific permissions for API access to other applications.",proTipLink:"",proTipLinkTitle:"",proTipTarget:"_blank"})),(K||F.length!==0)&&e.createElement(e.Fragment,null,e.createElement("div",{className:(0,o.cx)(ce.table,"admin-list-table")},e.createElement("table",{className:"filter-table filter-table--hover"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Account"),e.createElement("th",null,"ID"),e.createElement("th",null,"Roles"),e.createElement("th",null,"Tokens"),e.createElement("th",{style:{width:"120px"}}))),e.createElement("tbody",null,K?e.createElement(e.Fragment,null,e.createElement(M.Skeleton,null),e.createElement(M.Skeleton,null),e.createElement(M.Skeleton,null)):F.map(d=>e.createElement(M,{serviceAccount:d,key:d.id,roleOptions:ae,onRoleChange:Ce,onRemoveButtonClick:Te,onDisable:Ie,onEnable:ke,onAddTokenClick:Me})))),e.createElement(S.B,{justifyContent:"flex-end"},e.createElement(j.d,{hideWhenSinglePage:!0,currentPage:t,numberOfPages:ne,onNavigate:f})))),u&&e.createElement(e.Fragment,null,e.createElement(N.u,{isOpen:pe,body:`Are you sure you want to delete '${u.name}'${u.tokens?` and ${u.tokens} accompanying ${C()("token",u.tokens)}`:""}?`,confirmText:"Delete",title:"Delete service account",onConfirm:Pe,onDismiss:ue}),e.createElement(N.u,{isOpen:De,title:"Disable service account",body:`Are you sure you want to disable '${u.name}'?`,confirmText:"Disable service account",onConfirm:xe,onDismiss:Ee}),e.createElement(x.z,{isOpen:he,token:ye,serviceAccountLogin:u.login,onCreateToken:be,onClose:Le}))))},te=t=>({table:(0,o.css)({marginTop:t.spacing(3)}),filter:(0,o.css)({margin:`0 ${t.spacing(1)}`}),row:(0,o.css)({display:"flex",alignItems:"center",height:"100% !important",a:{padding:`${t.spacing(.5)} 0 !important`}}),unitTooltip:(0,o.css)({display:"flex",flexDirection:"column"}),unitItem:(0,o.css)({cursor:"pointer",padding:t.spacing(.5,0),marginRight:t.spacing(1)}),disabled:(0,o.css)({color:t.colors.text.disabled}),link:(0,o.css)({color:"inherit",cursor:"pointer",textDecoration:"underline"}),pageHeader:(0,o.css)({display:"flex",marginBottom:t.spacing(2)}),apiKeyInfoLabel:(0,o.css)({marginLeft:t.spacing(1),lineHeight:2.2,flexGrow:1,color:t.colors.text.secondary,span:{padding:t.spacing(.5)}}),filterDelimiter:(0,o.css)({flexGrow:1})}),ge=J(b)},98788:(le,O,n)=>{n.d(O,{z:()=>N});var o=n(32196),s=n(96540),C=n(62938),e=n(32264),h=n(40845),m=n(37390),r=n(88575),P=n(10354),V=n(94354),g=n(98239),R=n(55852),S=n(10534);const j=[{label:"No expiration",value:!1},{label:"Set expiration date",value:!0}],N=({isOpen:v,token:c,serviceAccountLogin:l,onCreateToken:a,onClose:x})=>{const i=new Date;i.setDate(i.getDate()+1);const p=new Date;e.$.tokenExpirationDayLimit!==void 0&&e.$.tokenExpirationDayLimit>-1?p.setDate(p.getDate()+e.$.tokenExpirationDayLimit+1):p.setDate(864e13);const k=e.$.tokenExpirationDayLimit!==void 0&&e.$.tokenExpirationDayLimit>0,[W,I]=(0,s.useState)(""),[$,A]=(0,s.useState)(""),[D,T]=(0,s.useState)(k),[U,Y]=(0,s.useState)(i),[q,M]=(0,s.useState)(U!==""),E=(0,h.of)(B);(0,s.useEffect)(()=>{v&&I(`${l}-${(0,C.A)()}`)},[l,v]);const _=b=>{M(b!==""),Y(b)},ee=()=>{a({name:$||W,secondsToLive:D?G(U):void 0})},J=()=>{A(""),I(""),T(k),Y(i),M(U!==""),x()},H=c?"Service account token created":"Add service account token";return s.createElement(m.a,{isOpen:v,title:H,onDismiss:J,className:E.modal},c?s.createElement(s.Fragment,null,s.createElement(r.D,{label:"Token",description:"Copy the token now as you will not be able to see it again. Losing a token requires creating a new one."},s.createElement("div",{className:E.modalTokenRow},s.createElement(P.p,{name:"tokenValue",value:c,readOnly:!0}),s.createElement(S.b,{className:E.modalCopyToClipboardButton,variant:"primary",size:"md",icon:"copy",getText:()=>c},"Copy clipboard"))),s.createElement(m.a.ButtonRow,null,s.createElement(S.b,{variant:"primary",getText:()=>c,onClipboardCopy:J},"Copy to clipboard and close"),s.createElement(R.$n,{variant:"secondary",onClick:J},"Close"))):s.createElement("div",null,s.createElement(r.D,{label:"Display name",description:"Name to easily identify the token",required:!0},s.createElement(P.p,{name:"tokenName",value:$,placeholder:W,onChange:b=>{A(b.currentTarget.value)}})),s.createElement(r.D,{label:"Expiration"},s.createElement(V.z,{options:j,value:D,onChange:T,size:"md"})),D&&s.createElement(r.D,{label:"Expiration date"},s.createElement(g.l,{onChange:_,value:U,placeholder:"",minDate:i,maxDate:p})),s.createElement(m.a.ButtonRow,null,s.createElement(R.$n,{onClick:ee,disabled:D&&!q},"Generate token"))))},G=v=>{const c=new Date(v),l=new Date;return Math.ceil((c.getTime()-l.getTime())/1e3)},B=v=>({modal:(0,o.css)({width:"550px"}),modalTokenRow:(0,o.css)({display:"flex"}),modalCopyToClipboardButton:(0,o.css)({marginLeft:v.spacing(.5)})})},12966:(le,O,n)=>{n.d(O,{W4:()=>j,iJ:()=>g,mV:()=>S,nM:()=>B,pJ:()=>V,qS:()=>v,yC:()=>N,yd:()=>c});var o=n(2543),s=n.n(o),C=n(17172),e=n(85927),h=n(16233),m=n(31678),r=n(1936);const P="/api/serviceaccounts";function V(){return async l=>{try{if(h.TP.licensedAccessControlEnabled()&&h.TP.hasPermission(m.AccessControlAction.ActionRolesList)){const a=await(0,e.RL)();l((0,r.ew)(a))}}catch(a){console.error(a)}}}function g({withLoadingIndicator:l}={withLoadingIndicator:!1}){return async(a,x)=>{try{if(h.TP.hasPermission(m.AccessControlAction.ServiceAccountsRead)){l&&a((0,r.FW)());const{perPage:i,page:p,query:k,serviceAccountStateFilter:W}=x().serviceAccounts,I=await(0,C.AI)().get(`/api/serviceaccounts/search?perpage=${i}&page=${p}&query=${k}${G(W)}&accesscontrol=true`);if(h.TP.licensedAccessControlEnabled()&&h.TP.hasPermission(m.AccessControlAction.ActionUserRolesList)){a((0,r.dJ)());const $=h.TP.user.orgId,A=I?.serviceAccounts.map(T=>T.id),D=await(0,C.AI)().post("/api/access-control/users/roles/search",{userIds:A,orgId:$});I.serviceAccounts.forEach(T=>{T.roles=D?D[T.id]||[]:[]}),a((0,r.jE)())}a((0,r.zh)(I))}}catch(i){console.error(i)}finally{a((0,r.Yh)())}}}const R=(0,o.debounce)(l=>l(g()),500,{leading:!0});function S(l){return async a=>{await(0,C.AI)().patch(`${P}/${l.id}?accesscontrol=true`,{...l}),a(g())}}function j(l){return async a=>{await(0,C.AI)().delete(`${P}/${l}`),a(g())}}function N(l,a,x){return async i=>{const p=await(0,C.AI)().post(`${P}/${l}/tokens`,a);x(p.key),i(g())}}const G=l=>{switch(l){case m.ServiceAccountStateFilter.WithExpiredTokens:return"&expiredTokens=true";case m.ServiceAccountStateFilter.Disabled:return"&disabled=true";case m.ServiceAccountStateFilter.External:return"&external=true";default:return""}};function B(l){return async a=>{a((0,r.L5)(l)),R(a)}}function v(l){return async a=>{a((0,r.c3)(l)),a(g())}}function c(l){return async a=>{a((0,r.EC)(l)),a(g())}}}}]);

//# sourceMappingURL=ServiceAccountsPage.0d077a64480b8035e374.js.map