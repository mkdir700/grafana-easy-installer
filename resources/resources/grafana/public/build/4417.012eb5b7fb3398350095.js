(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4417],{35931:(dt,Ve,d)=>{"use strict";d.d(Ve,{H:()=>A});var w=d(32196),Re=d(96540),I=d(40845);function A(ye){const{description:j,suffix:he,feature:M}=ye,ce=`Learn more about ${M}`,D=(0,I.of)(r);return Re.createElement("span",{className:D.container},j,Re.createElement("a",{"aria-label":ce,href:`https://grafana.com/docs/grafana/next/datasources/${he}`,rel:"noreferrer",target:"_blank"},ce))}const r=ye=>({container:(0,w.css)({color:ye.colors.text.secondary,a:(0,w.css)({color:ye.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})})},92762:(dt,Ve,d)=>{"use strict";d.d(Ve,{Z:()=>j});var w=d(32196),Re=d(28848),I=d.n(Re),A=d(96540),r=d(40672),ye=d(40845);function j({query:M,language:ce,className:D}){const J=(0,ye.$j)(),Ee=he(J),S=I().highlight(M,ce.grammar,ce.name);return A.createElement("div",{className:(0,w.cx)(Ee.editorField,"prism-syntax-highlight",D),"aria-label":"selector",dangerouslySetInnerHTML:{__html:r.sQ.sanitize(S)}})}const he=M=>({editorField:(0,w.css)({fontFamily:M.typography.fontFamilyMonospace,fontSize:M.typography.bodySmall.fontSize})})},60016:(dt,Ve,d)=>{"use strict";d.d(Ve,{TO:()=>Ee,iB:()=>Ke,kl:()=>we,wU:()=>Ie});var w=d(2543),Re=d.n(w),I=d(96540),A=d(32264),r=d(67061),ye=d(38894),j=d(94354),he=d(14186),M=d(10354),ce=d(88323),D=d(56587),J=d(43269);const Ee=[{value:J.U3.Range,label:"Range",description:"Run query over a range of time."},{value:J.U3.Instant,label:"Instant",description:'Run query against a single point in time. For this query, the "To" time is used.'}];A.$.featureToggles.lokiExperimentalStreaming&&Ee.push({value:J.U3.Stream,label:"Stream",description:"Run a query and keep sending results on an interval"});const Ke=[{value:1,label:"1/1"}].concat((0,w.map)([2,3,4,5,10],L=>({value:L,label:"1/"+L})));function we(L){const{lineLimitValue:re,resolution:be,onRunQuery:Pe,runOnBlur:Ae,onChange:Ue}=L,_=L.query??{},Ne=(0,D.Io)(_);function Fe(Z){const ie={..._,maxLines:Ie(Z)};Ue(ie)}function rt(Z){const{instant:ie,range:ue,...K}=_;Ue({...K,queryType:Z})}function Ze(Z){_.maxLines!==Ie(Z.currentTarget.value)&&Fe(Z.currentTarget.value)}function F(Z){Z.key==="Enter"&&Pe()}function X(Z){const ie={..._,resolution:Z.value};Ue(ie)}return I.createElement(r.B,{alignItems:"flex-start",gap:.5,"aria-label":"Loki extra field"},I.createElement(r.B,{wrap:"nowrap",gap:0,"data-testid":"queryTypeField","aria-label":"Query type field"},I.createElement(ye.I,{width:"auto"},"Query type"),I.createElement(j.z,{options:Ee,value:Ne,onChange:Z=>{rt(Z),Ae&&Pe()}})),I.createElement(r.B,{wrap:"nowrap",gap:0,"data-testid":"lineLimitField","aria-label":"Line limit field"},I.createElement(he.I,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query."},I.createElement(M.p,{className:"width-4",placeholder:"auto",type:"number",min:0,onChange:Ze,onKeyDown:F,value:re,onBlur:()=>{Ae&&Pe()}})),I.createElement(he.I,{label:"Resolution",tooltip:"Resolution 1/1 sets step parameter of Loki metrics range queries such that each pixel corresponds to one data point. For better performance, lower resolutions can be picked. 1/2 only retrieves a data point for every other pixel, and 1/10 retrieves one data point per 10 pixels."},I.createElement(ce.l6,{isSearchable:!1,onChange:X,options:Ke,value:be,"aria-label":"Select resolution"}))))}var pe=(0,I.memo)(we);function Ie(L){const re=parseInt(L,10);if(!(isNaN(re)||re<0))return re}},95881:(dt,Ve,d)=>{"use strict";d.d(Ve,{W:()=>ye});var w=d(96540),Re=d(97535);const I=w.lazy(()=>d.e(1952).then(d.bind(d,51639))),A=j=>w.createElement(w.Suspense,{fallback:null},w.createElement(I,{...j})),r=j=>{const he=(0,w.useRef)(null),{onRunQuery:M,onChange:ce,...D}=j,J=S=>{he.current=S,ce(S),M()},Ee=S=>{ce(S)};return w.createElement(A,{onRunQuery:J,onBlur:Ee,onChange:ce,...D})};class ye extends w.PureComponent{constructor(he){super(he),this._isMounted=!1,this.onChangeQuery=(M,ce)=>{const{query:D,onChange:J,onRunQuery:Ee}=this.props;if(J){const S={...D,expr:M};J(S),ce&&Ee&&Ee()}},this.state={labelsLoaded:!1}}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(this.props.range),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(he){const{range:M,datasource:{languageProvider:ce}}=this.props;(0,Re.WV)(M,he.range)&&ce.fetchLabels({timeRange:M})}render(){const{ExtraFieldElement:he,query:M,datasource:ce,history:D,onRunQuery:J,range:Ee}=this.props,S=this.props.placeholder??"Enter a Loki query (run with Shift+Enter)";return w.createElement(w.Fragment,null,w.createElement("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"]},w.createElement("div",{className:"gf-form--grow flex-shrink-1 min-width-15"},w.createElement(r,{datasource:ce,history:D??[],onChange:this.onChangeQuery,onRunQuery:J,initialValue:M.expr??"",placeholder:S,timeRange:Ee}))),he)}}},20065:(dt,Ve,d)=>{"use strict";d.d(Ve,{B:()=>Re,a:()=>ye});var w=d(56245);function Re(j,he,M,ce){if(!j)return!1;const D=I(he,ce);if(!D.length)return!1;let J=D;if(j!==he){const Ee=I(j,ce);J=D.flatMap(S=>Ee.filter(Ke=>S.text===Ke.text)||S)}return J.map(Ee=>A(j,M,Ee)).filter(r)}function I(j,he){const M=[];return he.parse(j).iterate({enter:D=>{if(D.type.id===w.Ql){const J=D.node;M.push({node:J,text:j.substring(J.from,J.to)})}}}),M}function A(j,he,M){if(he.length===1){const J=M.node.from===M.node.to,Ee=J&&M.node.parent?M.node.parent:M.node,S=J?j.substring(Ee.from,Ee.to):M.text;return{startLineNumber:1,startColumn:Ee.from+1,endLineNumber:1,endColumn:Ee.to+1,error:S}}let ce=0,D=0;for(let J=0;J<he.length;J++){if(D=ce+he[J].length,M.node.from>D){ce+=he[J].length+1;continue}return{startLineNumber:J+1,startColumn:M.node.from-ce+1,endLineNumber:J+1,endColumn:M.node.to-ce+1,error:M.text}}return null}function r(j){return j!==null}const ye={__interval:{text:"1s",value:"1s"},__rate_interval:{text:"1s",value:"1s"},__auto:{text:"1s",value:"1s"},__interval_ms:{text:"1000",value:1e3},__range_ms:{text:"1000",value:1e3},__range_s:{text:"1",value:1},__range:{text:"1s",value:"1s"}}},27724:(dt,Ve,d)=>{"use strict";d.d(Ve,{we:()=>ar,VQ:()=>ha,lb:()=>ga,Gf:()=>Rt,M1:()=>jt,mL:()=>Yr,In:()=>nr});var w=d(2543),Re=d(13288),I=d(44240),A=d(62467),r=d(75505),ye=d(81160),j=d(66847),he=d(59099),M=d(63720),ce=d(65879),D=d(39070),J=d(9557),Ee=d(76885),S=d(41987),Ke=d(78368),we=d(43659),pe=d(36195),Ie=d(26657),L=d(72574),re=d(32264);const be=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Pe=new Set,Ae=typeof process=="object"&&process?process:{},Ue=(m,n,a,i)=>{typeof Ae.emitWarning=="function"?Ae.emitWarning(m,n,a,i):console.error(`[${a}] ${n}: ${m}`)};let _=globalThis.AbortController,Ne=globalThis.AbortSignal;if(typeof _>"u"){Ne=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(i,o){this._onabort.push(o)}},_=class{constructor(){n()}signal=new Ne;abort(i){if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(const o of this.signal._onabort)o(i);this.signal.onabort?.(i)}}};let m=Ae.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const n=()=>{m&&(m=!1,Ue("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",n))}}const Fe=m=>!Pe.has(m),rt=Symbol("type"),Ze=m=>m&&m===Math.floor(m)&&m>0&&isFinite(m),F=m=>Ze(m)?m<=Math.pow(2,8)?Uint8Array:m<=Math.pow(2,16)?Uint16Array:m<=Math.pow(2,32)?Uint32Array:m<=Number.MAX_SAFE_INTEGER?X:null:null;class X extends Array{constructor(n){super(n),this.fill(0)}}class Z{heap;length;static#l=!1;static create(n){const a=F(n);if(!a)return[];Z.#l=!0;const i=new Z(n,a);return Z.#l=!1,i}constructor(n,a){if(!Z.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new a(n),this.length=0}push(n){this.heap[this.length++]=n}pop(){return this.heap[--this.length]}}class ie{#l;#d;#g;#h;#T;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#v;#a;#r;#e;#c;#p;#o;#s;#O;#i;#y;#b;#f;#E;#S;#u;static unsafeExposeInternals(n){return{starts:n.#b,ttls:n.#f,sizes:n.#y,keyMap:n.#a,keyList:n.#r,valList:n.#e,next:n.#c,prev:n.#p,get head(){return n.#o},get tail(){return n.#s},free:n.#O,isBackgroundFetch:a=>n.#t(a),backgroundFetch:(a,i,o,c)=>n.#C(a,i,o,c),moveToTail:a=>n.#w(a),indexes:a=>n.#x(a),rindexes:a=>n.#P(a),isStale:a=>n.#m(a)}}get max(){return this.#l}get maxSize(){return this.#d}get calculatedSize(){return this.#v}get size(){return this.#n}get fetchMethod(){return this.#T}get dispose(){return this.#g}get disposeAfter(){return this.#h}constructor(n){const{max:a=0,ttl:i,ttlResolution:o=1,ttlAutopurge:c,updateAgeOnGet:f,updateAgeOnHas:v,allowStale:O,dispose:R,disposeAfter:U,noDisposeOnSet:z,noUpdateTTL:Y,maxSize:ae=0,maxEntrySize:Te=0,sizeCalculation:xe,fetchMethod:Be,noDeleteOnFetchRejection:Le,noDeleteOnStaleGet:ze,allowStaleOnFetchRejection:nt,allowStaleOnFetchAbort:je,ignoreFetchAbort:st}=n;if(a!==0&&!Ze(a))throw new TypeError("max option must be a nonnegative integer");const vt=a?F(a):Array;if(!vt)throw new Error("invalid max value: "+a);if(this.#l=a,this.#d=ae,this.maxEntrySize=Te||this.#d,this.sizeCalculation=xe,this.sizeCalculation){if(!this.#d&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(Be!==void 0&&typeof Be!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#T=Be,this.#S=!!Be,this.#a=new Map,this.#r=new Array(a).fill(void 0),this.#e=new Array(a).fill(void 0),this.#c=new vt(a),this.#p=new vt(a),this.#o=0,this.#s=0,this.#O=Z.create(a),this.#n=0,this.#v=0,typeof R=="function"&&(this.#g=R),typeof U=="function"?(this.#h=U,this.#i=[]):(this.#h=void 0,this.#i=void 0),this.#E=!!this.#g,this.#u=!!this.#h,this.noDisposeOnSet=!!z,this.noUpdateTTL=!!Y,this.noDeleteOnFetchRejection=!!Le,this.allowStaleOnFetchRejection=!!nt,this.allowStaleOnFetchAbort=!!je,this.ignoreFetchAbort=!!st,this.maxEntrySize!==0){if(this.#d!==0&&!Ze(this.#d))throw new TypeError("maxSize must be a positive integer if specified");if(!Ze(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#X()}if(this.allowStale=!!O,this.noDeleteOnStaleGet=!!ze,this.updateAgeOnGet=!!f,this.updateAgeOnHas=!!v,this.ttlResolution=Ze(o)||o===0?o:1,this.ttlAutopurge=!!c,this.ttl=i||0,this.ttl){if(!Ze(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#A()}if(this.#l===0&&this.ttl===0&&this.#d===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#d){const At="LRU_CACHE_UNBOUNDED";Fe(At)&&(Pe.add(At),Ue("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",At,ie))}}getRemainingTTL(n){return this.#a.has(n)?1/0:0}#A(){const n=new X(this.#l),a=new X(this.#l);this.#f=n,this.#b=a,this.#D=(c,f,v=be.now())=>{if(a[c]=f!==0?v:0,n[c]=f,f!==0&&this.ttlAutopurge){const O=setTimeout(()=>{this.#m(c)&&this.delete(this.#r[c])},f+1);O.unref&&O.unref()}},this.#Q=c=>{a[c]=n[c]!==0?be.now():0},this.#L=(c,f)=>{if(n[f]){const v=n[f],O=a[f];if(!v||!O)return;c.ttl=v,c.start=O,c.now=i||o();const R=c.now-O;c.remainingTTL=v-R}};let i=0;const o=()=>{const c=be.now();if(this.ttlResolution>0){i=c;const f=setTimeout(()=>i=0,this.ttlResolution);f.unref&&f.unref()}return c};this.getRemainingTTL=c=>{const f=this.#a.get(c);if(f===void 0)return 0;const v=n[f],O=a[f];if(!v||!O)return 1/0;const R=(i||o())-O;return v-R},this.#m=c=>{const f=a[c],v=n[c];return!!v&&!!f&&(i||o())-f>v}}#Q=()=>{};#L=()=>{};#D=()=>{};#m=()=>!1;#X(){const n=new X(this.#l);this.#v=0,this.#y=n,this.#$=a=>{this.#v-=n[a],n[a]=0},this.#I=(a,i,o,c)=>{if(this.#t(i))return 0;if(!Ze(o))if(c){if(typeof c!="function")throw new TypeError("sizeCalculation must be a function");if(o=c(i,a),!Ze(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o},this.#R=(a,i,o)=>{if(n[a]=i,this.#d){const c=this.#d-n[a];for(;this.#v>c;)this.#F(!0)}this.#v+=n[a],o&&(o.entrySize=i,o.totalCalculatedSize=this.#v)}}#$=n=>{};#R=(n,a,i)=>{};#I=(n,a,i,o)=>{if(i||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#x({allowStale:n=this.allowStale}={}){if(this.#n)for(let a=this.#s;!(!this.#N(a)||((n||!this.#m(a))&&(yield a),a===this.#o));)a=this.#p[a]}*#P({allowStale:n=this.allowStale}={}){if(this.#n)for(let a=this.#o;!(!this.#N(a)||((n||!this.#m(a))&&(yield a),a===this.#s));)a=this.#c[a]}#N(n){return n!==void 0&&this.#a.get(this.#r[n])===n}*entries(){for(const n of this.#x())this.#e[n]!==void 0&&this.#r[n]!==void 0&&!this.#t(this.#e[n])&&(yield[this.#r[n],this.#e[n]])}*rentries(){for(const n of this.#P())this.#e[n]!==void 0&&this.#r[n]!==void 0&&!this.#t(this.#e[n])&&(yield[this.#r[n],this.#e[n]])}*keys(){for(const n of this.#x()){const a=this.#r[n];a!==void 0&&!this.#t(this.#e[n])&&(yield a)}}*rkeys(){for(const n of this.#P()){const a=this.#r[n];a!==void 0&&!this.#t(this.#e[n])&&(yield a)}}*values(){for(const n of this.#x())this.#e[n]!==void 0&&!this.#t(this.#e[n])&&(yield this.#e[n])}*rvalues(){for(const n of this.#P())this.#e[n]!==void 0&&!this.#t(this.#e[n])&&(yield this.#e[n])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(n,a={}){for(const i of this.#x()){const o=this.#e[i],c=this.#t(o)?o.__staleWhileFetching:o;if(c!==void 0&&n(c,this.#r[i],this))return this.get(this.#r[i],a)}}forEach(n,a=this){for(const i of this.#x()){const o=this.#e[i],c=this.#t(o)?o.__staleWhileFetching:o;c!==void 0&&n.call(a,c,this.#r[i],this)}}rforEach(n,a=this){for(const i of this.#P()){const o=this.#e[i],c=this.#t(o)?o.__staleWhileFetching:o;c!==void 0&&n.call(a,c,this.#r[i],this)}}purgeStale(){let n=!1;for(const a of this.#P({allowStale:!0}))this.#m(a)&&(this.delete(this.#r[a]),n=!0);return n}info(n){const a=this.#a.get(n);if(a===void 0)return;const i=this.#e[a],o=this.#t(i)?i.__staleWhileFetching:i;if(o===void 0)return;const c={value:o};if(this.#f&&this.#b){const f=this.#f[a],v=this.#b[a];if(f&&v){const O=f-(be.now()-v);c.ttl=O,c.start=Date.now()}}return this.#y&&(c.size=this.#y[a]),c}dump(){const n=[];for(const a of this.#x({allowStale:!0})){const i=this.#r[a],o=this.#e[a],c=this.#t(o)?o.__staleWhileFetching:o;if(c===void 0||i===void 0)continue;const f={value:c};if(this.#f&&this.#b){f.ttl=this.#f[a];const v=be.now()-this.#b[a];f.start=Math.floor(Date.now()-v)}this.#y&&(f.size=this.#y[a]),n.unshift([i,f])}return n}load(n){this.clear();for(const[a,i]of n){if(i.start){const o=Date.now()-i.start;i.start=be.now()-o}this.set(a,i.value,i)}}set(n,a,i={}){if(a===void 0)return this.delete(n),this;const{ttl:o=this.ttl,start:c,noDisposeOnSet:f=this.noDisposeOnSet,sizeCalculation:v=this.sizeCalculation,status:O}=i;let{noUpdateTTL:R=this.noUpdateTTL}=i;const U=this.#I(n,a,i.size||0,v);if(this.maxEntrySize&&U>this.maxEntrySize)return O&&(O.set="miss",O.maxEntrySizeExceeded=!0),this.delete(n),this;let z=this.#n===0?void 0:this.#a.get(n);if(z===void 0)z=this.#n===0?this.#s:this.#O.length!==0?this.#O.pop():this.#n===this.#l?this.#F(!1):this.#n,this.#r[z]=n,this.#e[z]=a,this.#a.set(n,z),this.#c[this.#s]=z,this.#p[z]=this.#s,this.#s=z,this.#n++,this.#R(z,U,O),O&&(O.set="add"),R=!1;else{this.#w(z);const Y=this.#e[z];if(a!==Y){if(this.#S&&this.#t(Y)){Y.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:ae}=Y;ae!==void 0&&!f&&(this.#E&&this.#g?.(ae,n,"set"),this.#u&&this.#i?.push([ae,n,"set"]))}else f||(this.#E&&this.#g?.(Y,n,"set"),this.#u&&this.#i?.push([Y,n,"set"]));if(this.#$(z),this.#R(z,U,O),this.#e[z]=a,O){O.set="replace";const ae=Y&&this.#t(Y)?Y.__staleWhileFetching:Y;ae!==void 0&&(O.oldValue=ae)}}else O&&(O.set="update")}if(o!==0&&!this.#f&&this.#A(),this.#f&&(R||this.#D(z,o,c),O&&this.#L(O,z)),!f&&this.#u&&this.#i){const Y=this.#i;let ae;for(;ae=Y?.shift();)this.#h?.(...ae)}return this}pop(){try{for(;this.#n;){const n=this.#e[this.#o];if(this.#F(!0),this.#t(n)){if(n.__staleWhileFetching)return n.__staleWhileFetching}else if(n!==void 0)return n}}finally{if(this.#u&&this.#i){const n=this.#i;let a;for(;a=n?.shift();)this.#h?.(...a)}}}#F(n){const a=this.#o,i=this.#r[a],o=this.#e[a];return this.#S&&this.#t(o)?o.__abortController.abort(new Error("evicted")):(this.#E||this.#u)&&(this.#E&&this.#g?.(o,i,"evict"),this.#u&&this.#i?.push([o,i,"evict"])),this.#$(a),n&&(this.#r[a]=void 0,this.#e[a]=void 0,this.#O.push(a)),this.#n===1?(this.#o=this.#s=0,this.#O.length=0):this.#o=this.#c[a],this.#a.delete(i),this.#n--,a}has(n,a={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:o}=a,c=this.#a.get(n);if(c!==void 0){const f=this.#e[c];if(this.#t(f)&&f.__staleWhileFetching===void 0)return!1;if(this.#m(c))o&&(o.has="stale",this.#L(o,c));else return i&&this.#Q(c),o&&(o.has="hit",this.#L(o,c)),!0}else o&&(o.has="miss");return!1}peek(n,a={}){const{allowStale:i=this.allowStale}=a,o=this.#a.get(n);if(o===void 0||!i&&this.#m(o))return;const c=this.#e[o];return this.#t(c)?c.__staleWhileFetching:c}#C(n,a,i,o){const c=a===void 0?void 0:this.#e[a];if(this.#t(c))return c;const f=new _,{signal:v}=i;v?.addEventListener("abort",()=>f.abort(v.reason),{signal:f.signal});const O={signal:f.signal,options:i,context:o},R=(xe,Be=!1)=>{const{aborted:Le}=f.signal,ze=i.ignoreFetchAbort&&xe!==void 0;if(i.status&&(Le&&!Be?(i.status.fetchAborted=!0,i.status.fetchError=f.signal.reason,ze&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),Le&&!ze&&!Be)return z(f.signal.reason);const nt=ae;return this.#e[a]===ae&&(xe===void 0?nt.__staleWhileFetching?this.#e[a]=nt.__staleWhileFetching:this.delete(n):(i.status&&(i.status.fetchUpdated=!0),this.set(n,xe,O.options))),xe},U=xe=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=xe),z(xe)),z=xe=>{const{aborted:Be}=f.signal,Le=Be&&i.allowStaleOnFetchAbort,ze=Le||i.allowStaleOnFetchRejection,nt=ze||i.noDeleteOnFetchRejection,je=ae;if(this.#e[a]===ae&&(!nt||je.__staleWhileFetching===void 0?this.delete(n):Le||(this.#e[a]=je.__staleWhileFetching)),ze)return i.status&&je.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),je.__staleWhileFetching;if(je.__returned===je)throw xe},Y=(xe,Be)=>{const Le=this.#T?.(n,c,O);Le&&Le instanceof Promise&&Le.then(ze=>xe(ze===void 0?void 0:ze),Be),f.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(xe(void 0),i.allowStaleOnFetchAbort&&(xe=ze=>R(ze,!0)))})};i.status&&(i.status.fetchDispatched=!0);const ae=new Promise(Y).then(R,U),Te=Object.assign(ae,{__abortController:f,__staleWhileFetching:c,__returned:void 0});return a===void 0?(this.set(n,Te,{...O.options,status:void 0}),a=this.#a.get(n)):this.#e[a]=Te,Te}#t(n){if(!this.#S)return!1;const a=n;return!!a&&a instanceof Promise&&a.hasOwnProperty("__staleWhileFetching")&&a.__abortController instanceof _}async fetch(n,a={}){const{allowStale:i=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:c=this.noDeleteOnStaleGet,ttl:f=this.ttl,noDisposeOnSet:v=this.noDisposeOnSet,size:O=0,sizeCalculation:R=this.sizeCalculation,noUpdateTTL:U=this.noUpdateTTL,noDeleteOnFetchRejection:z=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:Y=this.allowStaleOnFetchRejection,ignoreFetchAbort:ae=this.ignoreFetchAbort,allowStaleOnFetchAbort:Te=this.allowStaleOnFetchAbort,context:xe,forceRefresh:Be=!1,status:Le,signal:ze}=a;if(!this.#S)return Le&&(Le.fetch="get"),this.get(n,{allowStale:i,updateAgeOnGet:o,noDeleteOnStaleGet:c,status:Le});const nt={allowStale:i,updateAgeOnGet:o,noDeleteOnStaleGet:c,ttl:f,noDisposeOnSet:v,size:O,sizeCalculation:R,noUpdateTTL:U,noDeleteOnFetchRejection:z,allowStaleOnFetchRejection:Y,allowStaleOnFetchAbort:Te,ignoreFetchAbort:ae,status:Le,signal:ze};let je=this.#a.get(n);if(je===void 0){Le&&(Le.fetch="miss");const st=this.#C(n,je,nt,xe);return st.__returned=st}else{const st=this.#e[je];if(this.#t(st)){const ir=i&&st.__staleWhileFetching!==void 0;return Le&&(Le.fetch="inflight",ir&&(Le.returnedStale=!0)),ir?st.__staleWhileFetching:st.__returned=st}const vt=this.#m(je);if(!Be&&!vt)return Le&&(Le.fetch="hit"),this.#w(je),o&&this.#Q(je),Le&&this.#L(Le,je),st;const At=this.#C(n,je,nt,xe),Nr=At.__staleWhileFetching!==void 0&&i;return Le&&(Le.fetch=vt?"stale":"refresh",Nr&&vt&&(Le.returnedStale=!0)),Nr?At.__staleWhileFetching:At.__returned=At}}get(n,a={}){const{allowStale:i=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:c=this.noDeleteOnStaleGet,status:f}=a,v=this.#a.get(n);if(v!==void 0){const O=this.#e[v],R=this.#t(O);return f&&this.#L(f,v),this.#m(v)?(f&&(f.get="stale"),R?(f&&i&&O.__staleWhileFetching!==void 0&&(f.returnedStale=!0),i?O.__staleWhileFetching:void 0):(c||this.delete(n),f&&i&&(f.returnedStale=!0),i?O:void 0)):(f&&(f.get="hit"),R?O.__staleWhileFetching:(this.#w(v),o&&this.#Q(v),O))}else f&&(f.get="miss")}#M(n,a){this.#p[a]=n,this.#c[n]=a}#w(n){n!==this.#s&&(n===this.#o?this.#o=this.#c[n]:this.#M(this.#p[n],this.#c[n]),this.#M(this.#s,n),this.#s=n)}delete(n){let a=!1;if(this.#n!==0){const i=this.#a.get(n);if(i!==void 0)if(a=!0,this.#n===1)this.clear();else{this.#$(i);const o=this.#e[i];if(this.#t(o)?o.__abortController.abort(new Error("deleted")):(this.#E||this.#u)&&(this.#E&&this.#g?.(o,n,"delete"),this.#u&&this.#i?.push([o,n,"delete"])),this.#a.delete(n),this.#r[i]=void 0,this.#e[i]=void 0,i===this.#s)this.#s=this.#p[i];else if(i===this.#o)this.#o=this.#c[i];else{const c=this.#p[i];this.#c[c]=this.#c[i];const f=this.#c[i];this.#p[f]=this.#p[i]}this.#n--,this.#O.push(i)}}if(this.#u&&this.#i?.length){const i=this.#i;let o;for(;o=i?.shift();)this.#h?.(...o)}return a}clear(){for(const n of this.#P({allowStale:!0})){const a=this.#e[n];if(this.#t(a))a.__abortController.abort(new Error("deleted"));else{const i=this.#r[n];this.#E&&this.#g?.(a,i,"delete"),this.#u&&this.#i?.push([a,i,"delete"])}}if(this.#a.clear(),this.#e.fill(void 0),this.#r.fill(void 0),this.#f&&this.#b&&(this.#f.fill(0),this.#b.fill(0)),this.#y&&this.#y.fill(0),this.#o=0,this.#s=0,this.#O.length=0,this.#v=0,this.#n=0,this.#u&&this.#i){const n=this.#i;let a;for(;a=n?.shift();)this.#h?.(...a)}}}var ue=d(40187),K=d(43127),Qe=d(97535),Q=d(56587),x=d(60706),P=d(75723),b=d(43269);const H=1e6;class de extends ue.Is{constructor(n,a){super(),this.started=!1,this.seriesCache=new ie({max:10}),this.labelsCache=new ie({max:10}),this.request=async(i,o)=>{try{return await this.datasource.metadataRequest(i,o)}catch(c){console.error(c)}},this.start=i=>{const o=i??this.getDefaultTimeRange();return(!this.startTask||this.startedTimeRange?.from.isSame(o.from)===!1||this.startedTimeRange?.to.isSame(o.to)===!1)&&(this.startedTimeRange=o,this.startTask=this.fetchLabels({timeRange:o}).then(()=>(this.started=!0,[]))),this.startTask},this.fetchSeriesLabels=async(i,o)=>{const c=this.datasource.interpolateString(i),f="series",v=o?.timeRange??this.getDefaultTimeRange(),{start:O,end:R}=this.datasource.getTimeRangeParams(v),U=this.generateCacheKey(f,O,R,c);let z=this.seriesCache.get(U);if(!z){const Y={"match[]":c,start:O,end:R},ae=await this.request(f,Y);if(!Array.isArray(ae))return{};const{values:Te}=(0,Qe.P7)(ae);z=Te,this.seriesCache.set(U,z)}return z},this.fetchSeries=async(i,o)=>{const c="series",f=o?.timeRange??this.getDefaultTimeRange(),{start:v,end:O}=this.datasource.getTimeRangeParams(f),R={"match[]":i,start:v,end:O};return await this.request(c,R)},this.datasource=n,this.labelKeys=[],Object.assign(this,a)}getLabelKeys(){return this.labelKeys}importFromAbstractQuery(n){return{refId:n.refId,expr:(0,Qe.tt)(n),queryType:b.U3.Range}}exportToAbstractQuery(n){if(!n.expr||n.expr.length===0)return{refId:n.refId,labelMatchers:[]};const i=(0,Q.pk)(n.expr).map(o=>(0,x.u_)(o).query.labels.map(v=>({name:v.label,value:v.value,operator:Qe.sM[v.op]})));return{refId:n.refId,labelMatchers:(0,w.flatten)(i)}}async fetchLabels(n){const a="labels",i=n?.timeRange??this.getDefaultTimeRange(),o=this.datasource.getTimeRangeParams(i),c=await this.request(a,o);if(Array.isArray(c)){const f=c.slice().sort().filter(v=>v!=="__name__");return this.labelKeys=f,this.labelKeys}return[]}generateCacheKey(n,a,i,o){return[n,this.roundTime(a),this.roundTime(i),o].join()}roundTime(n){return n?Math.floor(n/H/1e3/60/5):0}async fetchLabelValues(n,a){const i=encodeURIComponent(this.datasource.interpolateString(n)),o=a?.streamSelector?encodeURIComponent(this.datasource.interpolateString(a.streamSelector)):void 0,c=`label/${i}/values`,f=a?.timeRange??this.getDefaultTimeRange(),v=this.datasource.getTimeRangeParams(f),{start:O,end:R}=v,U={start:O,end:R};let z=i;o&&(U.query=o,z+=o);const Y=this.generateCacheKey(c,O,R,z);let ae=this.labelsCache.get(Y);if(!ae){this.labelsCache.set(Y,[]);const Te=await this.request(c,U);Array.isArray(Te)&&(ae=Te.slice().sort(),this.labelsCache.set(Y,ae))}return ae??[]}async getParserAndLabelKeys(n,a){const i={extractedLabelKeys:[],structuredMetadataKeys:[],unwrapLabelKeys:[],hasJSON:!1,hasLogfmt:!1,hasPack:!1};if(!re.$.featureToggles.lokiQueryHints)return i;const o=await this.datasource.getDataSamples({expr:n,refId:"data-samples",maxLines:a?.maxLines||ar},a?.timeRange??this.getDefaultTimeRange());if(!o.length)return i;const{hasLogfmt:c,hasJSON:f,hasPack:v}=(0,P.YB)(o[0]);return{extractedLabelKeys:[...(0,P.fV)(o[0],b.HD.Indexed),...(0,P.fV)(o[0],b.HD.Parsed)],structuredMetadataKeys:(0,P.fV)(o[0],b.HD.StructuredMetadata),unwrapLabelKeys:(0,P.aN)(o[0]),hasJSON:f,hasPack:v,hasLogfmt:c}}getDefaultTimeRange(){return(0,K.E2)()}}var ee=d(39697),Me=d(37748),_e=d(69862),at=d(69850),et=d(31635),Ye=d(13752),Ot=d(75508),Gt=d(88483),Ba=d(64423),lr=d(39741),ea={url:"",deserializer:function(m){return JSON.parse(m.data)},serializer:function(m){return JSON.stringify(m)}},cr="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",ta=function(m){(0,et.__extends)(n,m);function n(a,i){var o=m.call(this)||this;if(o._socket=null,a instanceof Gt.c)o.destination=i,o.source=a;else{var c=o._config=(0,et.__assign)({},ea);if(o._output=new Ye.B,typeof a=="string")c.url=a;else for(var f in a)a.hasOwnProperty(f)&&(c[f]=a[f]);if(!c.WebSocketCtor&&WebSocket)c.WebSocketCtor=WebSocket;else if(!c.WebSocketCtor)throw new Error("no WebSocket constructor can be found");o.destination=new lr.m}return o}return n.prototype.lift=function(a){var i=new n(this._config,this.destination);return i.operator=a,i.source=this,i},n.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new lr.m),this._output=new Ye.B},n.prototype.multiplex=function(a,i,o){var c=this;return new Gt.c(function(f){try{c.next(a())}catch(O){f.error(O)}var v=c.subscribe({next:function(O){try{o(O)&&f.next(O)}catch(R){f.error(R)}},error:function(O){return f.error(O)},complete:function(){return f.complete()}});return function(){try{c.next(i())}catch(O){f.error(O)}v.unsubscribe()}})},n.prototype._connectSocket=function(){var a=this,i=this._config,o=i.WebSocketCtor,c=i.protocol,f=i.url,v=i.binaryType,O=this._output,R=null;try{R=c?new o(f,c):new o(f),this._socket=R,v&&(this._socket.binaryType=v)}catch(z){O.error(z);return}var U=new Ba.yU(function(){a._socket=null,R&&R.readyState===1&&R.close()});R.onopen=function(z){var Y=a._socket;if(!Y){R.close(),a._resetState();return}var ae=a._config.openObserver;ae&&ae.next(z);var Te=a.destination;a.destination=Ot.vU.create(function(xe){if(R.readyState===1)try{var Be=a._config.serializer;R.send(Be(xe))}catch(Le){a.destination.error(Le)}},function(xe){var Be=a._config.closingObserver;Be&&Be.next(void 0),xe&&xe.code?R.close(xe.code,xe.reason):O.error(new TypeError(cr)),a._resetState()},function(){var xe=a._config.closingObserver;xe&&xe.next(void 0),R.close(),a._resetState()}),Te&&Te instanceof lr.m&&U.add(Te.subscribe(a.destination))},R.onerror=function(z){a._resetState(),O.error(z)},R.onclose=function(z){R===a._socket&&a._resetState();var Y=a._config.closeObserver;Y&&Y.next(z),z.wasClean?O.complete():O.error(z)},R.onmessage=function(z){try{var Y=a._config.deserializer;O.next(Y(z))}catch(ae){O.error(ae)}}},n.prototype._subscribe=function(a){var i=this,o=this.source;return o?o.subscribe(a):(this._socket||this._connectSocket(),this._output.subscribe(a),a.add(function(){var c=i._socket;i._output.observers.length===0&&(c&&(c.readyState===1||c.readyState===0)&&c.close(),i._resetState())}),a)},n.prototype.unsubscribe=function(){var a=this._socket;a&&(a.readyState===1||a.readyState===0)&&a.close(),this._resetState(),m.prototype.unsubscribe.call(this)},n}(Ye.k);function kr(m){return new ta(m)}var ra=d(33526),mt=d(11261),aa=d(38823),Xt=d(8227);function Wa(m){if(!(0,Xt.A)(m))throw TypeError("Invalid UUID");let n;const a=new Uint8Array(16);return a[0]=(n=parseInt(m.slice(0,8),16))>>>24,a[1]=n>>>16&255,a[2]=n>>>8&255,a[3]=n&255,a[4]=(n=parseInt(m.slice(9,13),16))>>>8,a[5]=n&255,a[6]=(n=parseInt(m.slice(14,18),16))>>>8,a[7]=n&255,a[8]=(n=parseInt(m.slice(19,23),16))>>>8,a[9]=n&255,a[10]=(n=parseInt(m.slice(24,36),16))/1099511627776&255,a[11]=n/4294967296&255,a[12]=n>>>24&255,a[13]=n>>>16&255,a[14]=n>>>8&255,a[15]=n&255,a}const Va=Wa;function Ur(m){m=unescape(encodeURIComponent(m));const n=[];for(let a=0;a<m.length;++a)n.push(m.charCodeAt(a));return n}const Br="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Ea="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function xa(m,n,a){function i(o,c,f,v){var O;if(typeof o=="string"&&(o=Ur(o)),typeof c=="string"&&(c=Va(c)),((O=c)===null||O===void 0?void 0:O.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let R=new Uint8Array(16+o.length);if(R.set(c),R.set(o,c.length),R=a(R),R[6]=R[6]&15|n,R[8]=R[8]&63|128,f){v=v||0;for(let U=0;U<16;++U)f[v+U]=R[U];return f}return(0,aa.k)(R)}try{i.name=m}catch{}return i.DNS=Br,i.URL=Ea,i}function ja(m,n,a,i){switch(m){case 0:return n&a^~n&i;case 1:return n^a^i;case 2:return n&a^n&i^a&i;case 3:return n^a^i}}function pt(m,n){return m<<n|m>>>32-n}function Ht(m){const n=[1518500249,1859775393,2400959708,3395469782],a=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof m=="string"){const f=unescape(encodeURIComponent(m));m=[];for(let v=0;v<f.length;++v)m.push(f.charCodeAt(v))}else Array.isArray(m)||(m=Array.prototype.slice.call(m));m.push(128);const i=m.length/4+2,o=Math.ceil(i/16),c=new Array(o);for(let f=0;f<o;++f){const v=new Uint32Array(16);for(let O=0;O<16;++O)v[O]=m[f*64+O*4]<<24|m[f*64+O*4+1]<<16|m[f*64+O*4+2]<<8|m[f*64+O*4+3];c[f]=v}c[o-1][14]=(m.length-1)*8/Math.pow(2,32),c[o-1][14]=Math.floor(c[o-1][14]),c[o-1][15]=(m.length-1)*8&4294967295;for(let f=0;f<o;++f){const v=new Uint32Array(80);for(let ae=0;ae<16;++ae)v[ae]=c[f][ae];for(let ae=16;ae<80;++ae)v[ae]=pt(v[ae-3]^v[ae-8]^v[ae-14]^v[ae-16],1);let O=a[0],R=a[1],U=a[2],z=a[3],Y=a[4];for(let ae=0;ae<80;++ae){const Te=Math.floor(ae/20),xe=pt(O,5)+ja(Te,R,U,z)+Y+n[Te]+v[ae]>>>0;Y=z,z=U,U=pt(R,30)>>>0,R=O,O=xe}a[0]=a[0]+O>>>0,a[1]=a[1]+R>>>0,a[2]=a[2]+U>>>0,a[3]=a[3]+z>>>0,a[4]=a[4]+Y>>>0}return[a[0]>>24&255,a[0]>>16&255,a[0]>>8&255,a[0]&255,a[1]>>24&255,a[1]>>16&255,a[1]>>8&255,a[1]&255,a[2]>>24&255,a[2]>>16&255,a[2]>>8&255,a[2]&255,a[3]>>24&255,a[3]>>16&255,a[3]>>8&255,a[3]&255,a[4]>>24&255,a[4]>>16&255,a[4]>>8&255,a[4]&255]}const Yt=xa("v5",80,Ht),La="6ec946da-0f49-47a8-983a-1d76d17e7c92";function _a(m,n){const a=m.streams;if(!a||!a.length)return;const i=n.fields[0],o=n.fields[1],c=n.fields[2],f={};for(const v of a){const O=Object.entries(v.stream).map(([R,U])=>`${R}="${U}"`).sort().join("");for(const[R,U]of v.values)i.values.push(new Date(parseInt(R.slice(0,-6),10)).toISOString()),o.values.push(U),c.values.push(Sa(R,O,U,f,n.refId))}}function Sa(m,n,a,i,o){let c=Yt(`${m}_${n}_${a}`,La);if(c in i){const f=i[c]+1;i[c]=f,c=`${c}_${f}`}else i[c]=0;return o?`${o}_${c}`:c}class Zt{constructor(){this.streams={}}getStream(n,a=5e3){let i=this.streams[n.url];if(i)return i;const o=new ra.x({capacity:n.size});return o.addField({name:"Time",type:mt.PU.time,config:{}}),o.addField({name:"Line",type:mt.PU.string}),o.addField({name:"id",type:mt.PU.string}),o.meta={...o.meta,preferredVisualisationType:"logs"},o.refId=n.refId,i=kr(n.url).pipe((0,ye.T)(c=>(_a(c,o),[o])),(0,Me.l)(c=>c.pipe((0,_e.Z)((f,v)=>{const O=v+1;return f.code===1006&&O<30?(O>10&&console.warn(`Websocket connection is being disrupted. We keep reconnecting but consider starting new live tailing again. Error: ${f.reason}`),(0,ee.O)(a)):(0,Re.$)(f)}))),(0,at.j)(()=>{delete this.streams[n.url]})),this.streams[n.url]=i,i}}var lt=d(47232),kt=d(85404),Lt=d(32196),ge=d(96540),Wr=d(16817),yr=d(36663),ur=d(92762),Ft=d(14110),Vr=d(40845),yt=d(42418),na=d(56034),gt=d(55852),br=d(82762),za=d(14578),Ka=d(62930),Ut=d(60029),Er=d(88323),jr=d(39268),Bt=d(14186),_r=d(44522),zr=d(15292),Qa=d(71713);function Jt(m){return{labels:(0,Lt.css)`
      display: flex;
      gap: ${m.spacing(.5)};
    `,wrapper:(0,Lt.css)`
      display: flex;
      flex-direction: column;
      flex: 1;
      gap: ${m.spacing(.5)};
      position: relative;
    `,textWrapper:(0,Lt.css)`
      display: flex;
      align-items: center;
    `,hidden:(0,Lt.css)`
      visibility: hidden;
    `,label:(0,Lt.css)`
      max-width: 100%;
      &:first-of-type {
        margin-bottom: ${m.spacing(2)};
      }
      &:not(:first-of-type) {
        margin: ${m.spacing(2)} 0;
      }
    `,rawQueryContainer:(0,Lt.css)`
      text-align: start;
      line-break: anywhere;
      margin-top: -${m.spacing(.25)};
      margin-right: ${m.spacing(6)};
      min-height: ${m.spacing(4)};
    `,ui:(0,Lt.css)`
      background-color: ${m.colors.background.secondary};
      padding: ${m.spacing(2)};
    `,notification:(0,Lt.css)({position:"absolute",zIndex:m.zIndex.portal,top:0,right:0}),rawQuery:(0,Lt.css)`
      display: inline;
    `,queryDescription:(0,Lt.css)`
      margin-left: ${m.spacing(.5)};
    `,iconButton:(0,Lt.css)`
      position: absolute;
      top: ${m.spacing(1)};
      right: ${m.spacing(1)};
      z-index: ${m.zIndex.navbarFixed};
    `,operationsToggle:(0,Lt.css)`
      margin: ${m.spacing(1)} 0 ${m.spacing(-1)} 0;
      & > div {
        margin: 0;
        & > label {
          padding: 0;
        }
      }
    `}}const sa="isLogContextQueryUiOpen";function $a(m){const{row:n,logContextProvider:a,updateFilter:i,onClose:o,origQuery:c,runContextQuery:f}=m,v=(0,Vr.of)(Jt),[O,R]=(0,ge.useState)([]),[U,z]=(0,ge.useState)(!1),[Y,ae]=(0,ge.useState)(!1),[Te,xe]=(0,ge.useState)(!1),[Be,Le]=(0,ge.useState)(window.localStorage.getItem(sa)==="true"),[ze,nt]=(0,ge.useState)(window.localStorage.getItem(St)==="true"),je=ge.useRef(),st=ge.useRef(!1),vt=ge.useRef([]),At=(0,ge.useMemo)(()=>!(Y&&O.some(C=>C.nonIndexed===C.enabled)||ze&&a.queryContainsValidPipelineStages(c)),[O,ze,Y,a,c]);(0,ge.useEffect)(()=>{if(Y){if(!st.current){st.current=Y;return}if(O.filter(({enabled:C,nonIndexed:G})=>C&&!G).length===0){R(vt.current);return}return vt.current=structuredClone(O),je.current&&clearTimeout(je.current),xe(!0),je.current=window.setTimeout(()=>{i(O.filter(({enabled:G})=>G));const C={removedLabels:[],selectedExtractedLabels:[]};O.forEach(({enabled:G,nonIndexed:Oe,label:Xe})=>{!G&&!Oe&&C.removedLabels.push(Xe),G&&Oe&&C.selectedExtractedLabels.push(Xe)}),window.localStorage.setItem(_t,JSON.stringify(C)),xe(!1)},1500),()=>{clearTimeout(je.current)}}},[O,Y]),(0,ge.useEffect)(()=>()=>{clearTimeout(je.current),o()},[o]),(0,Wr.A)(async()=>{xe(!0);const C=await a.getInitContextFilters(n,c,{from:(0,lt.KQ)(n.timeEpochMs),to:(0,lt.KQ)(n.timeEpochMs),raw:{from:(0,lt.KQ)(n.timeEpochMs),to:(0,lt.KQ)(n.timeEpochMs)}});R(C.contextFilters),z(C.preservedFiltersApplied),ae(!0),xe(!1)}),(0,ge.useEffect)(()=>{U&&setTimeout(()=>{z(!1)},2e3)},[U]),(0,ge.useEffect)(()=>((0,Ft.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:n.uid,type:"load"}),()=>{(0,Ft.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:n.uid,type:"unload"})}),[n.uid]);const Ir=O.filter(({nonIndexed:C})=>!C),Nr=Ir.filter(({enabled:C})=>C),ir=O.filter(({nonIndexed:C})=>C),Ma=ir.filter(({enabled:C})=>C),N=(0,ge.useCallback)(C=>({label:`${C.label}="${(0,Qe.Bb)(C.value)}"`,value:C.label}),[]),W=ir.length>0;let q=a.prepareExpression(O.filter(({enabled:C})=>C),c);return ge.createElement("div",{className:v.wrapper},U&&ge.createElement(yt.F,{className:v.notification,title:"Previously used filters have been applied.",severity:"info",elevated:!0}),ge.createElement(na.m,{content:"Revert to initial log context query."},ge.createElement("div",{className:v.iconButton},ge.createElement(gt.$n,{"data-testid":"revert-button",icon:"history-alt",variant:"secondary",disabled:At,onClick:C=>{(0,Ft.rR)("grafana_explore_logs_loki_log_context_reverted",{logRowUid:n.uid}),R(G=>G.map(Oe=>({...Oe,enabled:!Oe.nonIndexed}))),window.localStorage.removeItem(_t),window.localStorage.removeItem(St),nt(!1)}}))),ge.createElement(br.S,{collapsible:!0,isOpen:Be,onToggle:()=>{window.localStorage.setItem(sa,(!Be).toString()),Le(C=>!C),(0,Ft.rR)("grafana_explore_logs_loki_log_context_toggled",{logRowUid:n.uid,action:Be?"close":"open"})},label:ge.createElement("div",{className:v.rawQueryContainer},Y?ge.createElement(ge.Fragment,null,ge.createElement(ur.Z,{language:{grammar:Qa.vB,name:"loki"},query:q,className:v.rawQuery}),ge.createElement(na.m,{content:"The initial log context query is created from all labels defining the stream for the selected log line. Use the editor below to customize the log context query."},ge.createElement(za.I,{name:"info-circle",size:"sm",className:v.queryDescription}))):ge.createElement(Ka.y,null))},ge.createElement("div",{className:v.ui},ge.createElement(Ut.J,{className:v.label,description:"The initial log context query is created from all labels defining the stream for the selected log line. You can broaden your search by removing one or more of the label filters."},"Widen the search"),ge.createElement(Er.KF,{isLoading:Te,options:Ir.map(N),value:Nr.map(N),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",onChange:(C,G)=>(G.action==="select-option"&&(0,Ft.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:n.uid,type:"label",action:"select"}),G.action==="remove-value"&&(0,Ft.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:n.uid,type:"label",action:"remove"}),R(O.map(Oe=>(Oe.nonIndexed||(Oe.enabled=C.some(Xe=>Xe.value===Oe.label)),Oe))))}),W&&ge.createElement(ge.Fragment,null,ge.createElement(Ut.J,{className:v.label,description:"By using a parser in your original query, you can use filters for extracted labels. Refine your search by applying extracted labels created from the selected log line."},"Refine the search"),ge.createElement(Er.KF,{isLoading:Te,options:ir.map(N),value:Ma.map(N),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",isClearable:!0,onChange:(C,G)=>{G.action==="select-option"&&(0,Ft.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:n.uid,type:"parsed_label",action:"select"}),G.action==="remove-value"&&(0,Ft.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:n.uid,type:"parsed_label",action:"remove"}),R(O.map(Oe=>(Oe.nonIndexed&&(Oe.enabled=C.some(Xe=>Xe.value===Oe.label)),Oe)))}})),a.queryContainsValidPipelineStages(c)&&ge.createElement(jr.C,{className:v.operationsToggle},ge.createElement(Bt.I,{label:"Include LogQL pipeline operations",tooltip:ge.createElement(_r.I,{content:(0,yr.G)("This will include LogQL operations such as `line_format` or `label_format`. It won't include line or label filter operations.")})},ge.createElement(zr.K,{value:ze,showLabel:!0,transparent:!0,onChange:C=>{(0,Ft.rR)("grafana_explore_logs_loki_log_context_pipeline_toggled",{logRowUid:n.uid,action:C.currentTarget.checked?"enable":"disable"}),window.localStorage.setItem(St,C.currentTarget.checked.toString()),nt(C.currentTarget.checked),f&&f()}}))))))}var Je=d(12798),qt=(m=>(m[m.Ascending=0]="Ascending",m[m.Descending=1]="Descending",m))(qt||{});function Ga(m,n){const a=m.values,{nanos:i}=m,o=Array(a.length);for(let f=0;f<o.length;f++)o[f]=f;const c=n===0;return o.sort((f,v)=>{const O=a[f],R=a[v];if(O<R)return c?-1:1;if(O>R)return c?1:-1;if(i===void 0)return 0;const U=i[f],z=i[v];return U<z?c?-1:1:U>z?c?1:-1:0}),o}function dr(m,n){const{fields:a,...i}=m,o=a.find(f=>f.type===mt.PU.time);if(o===void 0)throw new Error("missing timestamp field. should never happen");const c=Ga(o,n);return{...i,fields:a.map(f=>({...f,values:Dt(f.values,c),nanos:f.nanos===void 0?void 0:Dt(f.nanos,c)}))}}function Dt(m,n){return m.map((a,i)=>m[n[i]])}const _t="lokiLogContextPreservedLabels",St="lokiLogContextShouldIncludePipelineOperations";class ia{constructor(n){this.getLogRowContextQuery=async(a,i,o,c=!0)=>{const{query:f}=await this.getQueryAndRange(a,i,o,c);return c||(this.cachedContextFilters=[]),f},this.getLogRowContext=async(a,i,o)=>{const c=i&&i.direction||J.ZF.Backward,{query:f,range:v}=await this.getQueryAndRange(a,i,o),O=U=>{const Y=U.data.map(ae=>dr(ae,qt.Descending));return{...U,data:Y}},R=S.Jk.Explore;return(0,r.s)(this.datasource.query(nr(f,v,R,`${jt}${c}`)).pipe((0,j.W)(U=>{throw{message:"Error during context query. Please check JS console logs.",status:U.status,statusText:U.statusText}}),(0,M.n)(U=>(0,A.of)(O(U)))))},this.processContextFiltersToExpr=(a,i)=>{let c=`{${a.map(f=>!f.nonIndexed&&f.enabled?`${f.label}="${(0,Qe.Qn)(f.value)}"`:"").filter(f=>!!f).join(",")}}`;if(i){let f=!1;if((0,Q.MX)(i.expr).parserCount===1){f=!0;const O=(0,Q.aw)(i.expr);O&&(c=(0,Je.aH)(c,O))}const v=a.filter(O=>O.nonIndexed&&O.enabled);for(const O of v)O.enabled&&(c=(0,Je.tE)(c,O.label,"=",O.value,f?b.HD.Parsed:b.HD.StructuredMetadata))}return c},this.processPipelineStagesToExpr=(a,i)=>{let o=a;const c=i?.expr??"";if((0,Q.MX)(c).parserCount>1)return o;const f=(0,Q.TQ)(c,[pe.t3,pe.iT,pe.c$,pe.LM,pe.CX,pe.bY]),v=f.filter(R=>R.type?.id===pe.t3),O=f.filter(R=>R.type?.id!==pe.t3);for(const R of v)O.some(U=>R.contains(U))||(o+=` ${R.getExpression(c)}`);return o},this.queryContainsValidPipelineStages=a=>{const i=a?.expr??"",o=(0,Q.TQ)(i,[pe.t3,pe.iT,pe.CX,pe.bY]),c=o.filter(v=>v.type?.id===pe.t3),f=o.filter(v=>v.type?.id!==pe.t3);return c.some(v=>f.every(O=>v.contains(O)===!1))},this.getInitContextFilters=async(a,i,o)=>{let c=!1;if(!i||(0,w.isEmpty)(a.labels))return{contextFilters:[],preservedFiltersApplied:c};const f=a.labels;let v=[];if(!(0,Q.MX)(i.expr).queryWithParser)await this.datasource.languageProvider.start(o),v=this.datasource.languageProvider.getLabelKeys();else{const z=(0,Q.pk)(i.expr),Y=await this.datasource.languageProvider.fetchSeriesLabels(z[0],{timeRange:o});v=Object.keys(Y)}const O=[];Object.entries(f).forEach(([z,Y])=>{const ae=(0,Qe.Ed)(z,a.dataFrame,a.rowIndex),Te={label:z,value:Y,enabled:v.includes(z),nonIndexed:ae!==null&&ae!==b.HD.Indexed};O.push(Te)});let R;const U=window.localStorage.getItem(_t);if(U)try{R=JSON.parse(U)}catch{}if(R){let z=!1;const Y=O.map(Te=>R.removedLabels.includes(Te.label)?(z=!0,{...Te,enabled:!1}):R.selectedExtractedLabels.includes(Te.label)?(z=!0,{...Te,enabled:!0}):{...Te});return Y.some(({enabled:Te,nonIndexed:xe})=>Te&&!xe)?(z&&(c=!0),{contextFilters:Y,preservedFiltersApplied:c}):{contextFilters:O,preservedFiltersApplied:c}}else return{contextFilters:O,preservedFiltersApplied:c}},this.datasource=n,this.cachedContextFilters=[]}async getQueryAndRange(n,a,i,o=!0){const c=a&&a.direction||J.ZF.Backward,f=a&&a.limit||this.datasource.maxLines;if(this.cachedContextFilters.length===0||!o){const v=(await this.getInitContextFilters(n,i,{from:(0,lt.KQ)(n.timeEpochMs),to:(0,lt.KQ)(n.timeEpochMs),raw:{from:(0,lt.KQ)(n.timeEpochMs),to:(0,lt.KQ)(n.timeEpochMs)}})).contextFilters.filter(O=>O.enabled);this.cachedContextFilters=v}return await this.prepareLogRowContextQueryTarget(n,f,c,i)}async prepareLogRowContextQueryTarget(n,a,i,o){const c=this.prepareExpression(this.cachedContextFilters,o),f=2*60*60*1e3,v=i===J.ZF.Forward?b.ti.Forward:b.ti.Backward,O={expr:c,queryType:b.U3.Range,refId:`${jt}_${Math.random().toString()}`,maxLines:a,direction:v,datasource:{uid:this.datasource.uid,type:this.datasource.type}},U=new kt.L(n.dataFrame).getFirstFieldOfType(mt.PU.time);if(U===void 0)throw new Error("loki: data frame missing time-field, should never happen");const z=U.values[n.rowIndex],Y=(0,lt.yT)(z),ae=v===b.ti.Forward?{from:Y,to:(0,lt.yT)(n.timeEpochMs+f)}:{from:(0,lt.yT)(n.timeEpochMs-f),to:Y};return{query:O,range:{from:ae.from,to:ae.to,raw:ae}}}getLogRowContextUi(n,a,i){const o=c=>{this.cachedContextFilters=c,a&&a()};return this.onContextClose=this.onContextClose??(()=>{this.cachedContextFilters=[]}),$a({row:n,origQuery:i,updateFilter:o,onClose:this.onContextClose,logContextProvider:this,runContextQuery:a})}prepareExpression(n,a){let i=this.processContextFiltersToExpr(n,a);return window.localStorage.getItem(St)==="true"&&(i=this.processPipelineStagesToExpr(i,a)),i}}var bt=d(65474),Et=d(29505),ht=d(84596),Wt=d(10354);const It=/^label_names\(\)\s*$/,xr=/^label_values\((?:(.+),\s*)?([a-zA-Z_$][a-zA-Z0-9_]*)\)\s*$/;function Vt(m){if(typeof m!="string")return m;const n={refId:"LokiVariableQueryEditor-VariableQuery",type:b.ie.LabelNames};if(m.match(It))return{...n,type:b.ie.LabelNames};const i=m.match(xr);return i?{...n,type:b.ie.LabelValues,label:i[2]?i[2]:i[1],stream:i[2]?i[1]:void 0}:n}const oa=[{label:"Label names",value:b.ie.LabelNames},{label:"Label values",value:b.ie.LabelValues}],wa="LokiVariableQueryEditor-VariableQuery",pr=({onChange:m,query:n,datasource:a,range:i})=>{const[o,c]=(0,ge.useState)(void 0),[f,v]=(0,ge.useState)(""),[O,R]=(0,ge.useState)([]),[U,z]=(0,ge.useState)(""),Y=(0,ht.A)(o);(0,ge.useEffect)(()=>{if(!n)return;const Le=typeof n=="string"?Vt(n):n;c(Le.type),v(Le.label||""),z(Le.stream||"")},[n]),(0,ge.useEffect)(()=>{o!==b.ie.LabelValues||Y===o||a.languageProvider.fetchLabels({timeRange:i}).then(Le=>{R(Le.map(ze=>({label:ze,value:ze})))})},[a,o,i,Y]);const ae=Le=>{c(Le.value),Le.value!==void 0&&m({type:Le.value,label:f,stream:U,refId:wa})},Te=Le=>{v(Le.value||"")},xe=Le=>{z(Le.currentTarget.value)},Be=()=>{o!==void 0&&m({type:o,label:f,stream:U,refId:"LokiVariableQueryEditor-VariableQuery"})};return ge.createElement(ge.Fragment,null,ge.createElement(jr.C,null,ge.createElement(Bt.I,{label:"Query type",labelWidth:20},ge.createElement(Er.l6,{"aria-label":"Query type",onChange:ae,onBlur:Be,value:o,options:oa,width:16})),o===b.ie.LabelValues&&ge.createElement(ge.Fragment,null,ge.createElement(Bt.I,{label:"Label",labelWidth:20},ge.createElement(Er.l6,{"aria-label":"Label",onChange:Te,onBlur:Be,value:{label:f,value:f},options:O,width:16,allowCustomValue:!0})))),o===b.ie.LabelValues&&ge.createElement(jr.C,null,ge.createElement(Bt.I,{label:"Stream selector",labelWidth:20,grow:!0,tooltip:ge.createElement("div",null,'Optional. If defined, a list of values for the specified log stream selector is returned. For example: {label="value"} or {label="$variable"}')},ge.createElement(Wt.p,{type:"text","aria-label":"Stream selector",placeholder:"Optional stream selector",value:U,onChange:xe,onBlur:Be}))))};class la extends Et.f5{constructor(n){super(),this.datasource=n,this.editor=pr}async execute(n,a,i){return this.datasource.metricFindQuery(n,{scopedVars:a,range:i})}query(n){const a=this.execute(n.targets[0],n.scopedVars,n.range);return(0,bt.H)(a).pipe((0,ye.T)(i=>({data:i})))}}var ca=d(14236),Ta=d(19347);function $t(m,n){if(!n.length)return[];const a=(0,w.groupBy)(n,"name"),i=Object.values(a).map(ut),o=m.fields.find(f=>f.type===mt.PU.string);if(o===void 0)throw new Error("invalid logs-dataframe, string-field missing");const c=m.fields.find(f=>f.type===mt.PU.other&&f.name==="labels");for(let f=0;f<o.values.length;f++)for(const v of i)if(a[v.name][0].matcherType==="label"&&c){const O=c.values[f];if(O){const R=Object.keys(O).find(U=>a[v.name][0].matcherRegex===U);if(R){v.values.push(O[R]);continue}}v.values.push(null)}else if(a[v.name][0].matcherType==="regex"||a[v.name][0].matcherType===void 0){const R=o.values[f].match(a[v.name][0].matcherRegex);if(R&&R[1]){v.values.push(R[1]);continue}v.values.push(null)}else v.values.push(null);return i}function ut(m){const n=(0,Ta.l)(),a=m.reduce((i,o)=>{if(o.datasourceUid){const c=n.getInstanceSettings(o.datasourceUid),f=v=>{switch(v){case"tempo":return"traceql";case"grafana-x-ray-datasource":return"getTrace";default:return}};i.push({title:o.urlDisplayLabel||"",url:"",internal:{query:{query:o.url,queryType:f(c?.type)},datasourceUid:o.datasourceUid,datasourceName:c?.name??"Data source not found"}})}else o.url&&i.push({title:o.urlDisplayLabel||"",url:o.url});return i},[]);return{name:m[0].name,type:mt.PU.string,config:{links:a},values:[]}}function zt(m){const n=m.filter(i=>i.refId!==void 0),a=(0,w.groupBy)(n,i=>i.refId);return Object.entries(a).map(([i,o])=>xt(o,i))}function xt(m,n){const a={name:"Time",config:{},values:[],type:mt.PU.time},i={name:`Value #${n}`,config:{},values:[],type:mt.PU.number},o=new Set(m.map(v=>v.fields.map(O=>Object.keys(O.labels??{})).flat()).flat()),f=Array.from(o).sort().map(v=>({name:v,config:{filterable:!0},values:[],type:mt.PU.string}));return m.forEach(v=>{const O=v.fields.find(ae=>ae.type===mt.PU.time),R=v.fields.find(ae=>ae.type===mt.PU.number);if(O==null||R==null)return;const U=O.values,z=R.values;for(let ae of U)a.values.push(ae);for(let ae of z)i.values.push(ae);const Y=R.labels??{};for(let ae of f){const Te=Y[ae.name]??"";for(let xe=0;xe<z.length;xe++)ae.values.push(Te)}}),{fields:[a,...f,i],refId:n,meta:{preferredVisualisationType:"table"},length:a.values.length}}function ua(m){return m.fields.every(n=>n.type===mt.PU.time||n.type===mt.PU.number)}function Kr(m,n){const{meta:a,...i}=m,o={...a,...n};return{...i,meta:o}}function Pr(m,n,a){const i={...m.meta?.custom,lokiQueryStatKey:"Summary: total bytes processed"};(0,P.nE)(m)&&(i.error="Error when parsing some of the logs");const o={preferredVisualisationType:"logs",limit:n?.maxLines,searchWords:n!==void 0?(0,Q.H0)(n.expr):void 0,custom:i},c=Kr(m,o),f=$t(c,a);return{...c,fields:[...c.fields,...f]}}function Gr(m,n,a){return m.map(i=>{const o=i.refId!==void 0?n.get(i.refId):void 0;return Pr(i,o,a)})}function Lr(m){return m.length>0?zt(m):[]}function da(m){const n={preferredVisualisationType:"graph"};return m.map(a=>Kr(a,n))}function fr(m,n){const a=[],i=[],o=[];return m.forEach(c=>{ua(c)?c.refId!=null&&n.get(c.refId)?.queryType===b.U3.Instant?i.push(c):o.push(c):a.push(c)}),{streamsFrames:a,metricInstantFrames:i,metricRangeFrames:o}}function Ra(m,n){if(m===void 0)return m;const{refId:a,message:i}=m;if(a===void 0||i===void 0)return m;const o=n.get(a);return o===void 0?m:i.includes("escape")&&o.expr.includes("\\")?{...m,message:`${i}. Make sure that all special characters are escaped with \\. For more information on escaping of special characters visit LogQL documentation at https://grafana.com/docs/loki/latest/logql/.`}:m}function pa(m,n,a){const{data:i,error:o,...c}=m,f=i.map(z=>{if(!(0,ca.ci)(z))throw new Error("transformation only supports dataframe responses");return z}),v=new Map(n.map(z=>[z.refId,z])),{streamsFrames:O,metricInstantFrames:R,metricRangeFrames:U}=fr(f,v);return{...c,error:Ra(o,v),data:[...da(U),...Lr(R),...Gr(O,v,a)]}}var Ct=d(9e4),Nt=d(81580),ct=d(67061),wt=d(60016),Tt=d(95881);const Pt=(0,ge.memo)(function(n){const{annotation:a,onAnnotationChange:i,history:o}=n;if(a===void 0||i===void 0)return null;const c=v=>{const O=(0,Q.vV)(v).queryType===b.U3.Instant;i({...a,expr:v.expr,maxLines:v.maxLines,instant:O})},f={refId:"",expr:a.expr,maxLines:a.maxLines,instant:a.instant,queryType:a.queryType};return ge.createElement(ct.B,{gap:5,direction:"column"},ge.createElement(ct.B,{gap:0,direction:"column"},ge.createElement(Tt.W,{datasource:n.datasource,query:f,onChange:c,onRunQuery:()=>{},history:o,ExtraFieldElement:ge.createElement(wt.kl,{lineLimitValue:f?.maxLines?.toString()||"",resolution:f.resolution||1,query:f,onRunQuery:()=>{},onChange:c})})),ge.createElement(Ct.U,null,ge.createElement(Nt.c,{label:"Title",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance."},ge.createElement(Wt.p,{type:"text",placeholder:"alertname",value:a.titleFormat,onChange:v=>{i({...a,titleFormat:v.currentTarget.value})}})),ge.createElement(Nt.c,{label:"Tags"},ge.createElement(Wt.p,{type:"text",placeholder:"label1,label2",value:a.tagKeys,onChange:v=>{i({...a,tagKeys:v.currentTarget.value})}})),ge.createElement(Nt.c,{label:"Text",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance."},ge.createElement(Wt.p,{type:"text",placeholder:"instance",value:a.textFormat,onChange:v=>{i({...a,textFormat:v.currentTarget.value})}}))))});var Sr=d(20065);function Qr(m,n){if(n.length===0)return[];const a=[],{queryWithParser:i,parserCount:o}=(0,Q.MX)(m);if(!i){const{hasLogfmt:v,hasJSON:O,hasPack:R}=(0,P.YB)(n[0]);O&&(R?a.push({type:"ADD_UNPACK_PARSER",label:"Selected log stream selector has packed logs.",fix:{title:"add unpack parser",label:"Consider using unpack parser.",action:{type:"ADD_UNPACK_PARSER",query:m}}}):a.push({type:"ADD_JSON_PARSER",label:"Selected log stream selector has JSON formatted logs.",fix:{title:"add json parser",label:"Consider using JSON parser.",action:{type:"ADD_JSON_PARSER",query:m}}})),v&&a.push({type:"ADD_LOGFMT_PARSER",label:"Selected log stream selector has logfmt formatted logs.",fix:{title:"add logfmt parser",label:"Consider using logfmt parser to turn key-value pairs in your log lines to labels.",action:{type:"ADD_LOGFMT_PARSER",query:m}}})}if(i){if(o===1){const O=(0,Q.d_)(m);(0,P.db)(n[0])&&!O&&a.push({type:"ADD_NO_PIPELINE_ERROR",label:"Some logs in your selected log streams have parsing error.",fix:{title:"remove pipeline errors",label:"Consider filtering out logs with parsing errors.",action:{type:"ADD_NO_PIPELINE_ERROR",query:m}}})}(0,Q.pS)(m)||a.push({type:"ADD_LABEL_FILTER",label:"Consider filtering logs by their label and value.",fix:{title:"add label filter",label:"",action:{type:"ADD_LABEL_FILTER",query:m}}})}if(!(0,Q._i)(m)){const v=(0,P.Ac)(n[0]),O=(0,P.sz)(n[0]);!v&&O&&a.push({type:"ADD_LEVEL_LABEL_FORMAT",label:`Some logs in your selected log stream have "${O}" label.`,fix:{title:"add label level format",label:`If ${O} label has level values, consider using label_format to rename it to "level". Level label can be then visualized in log volumes.`,action:{type:"ADD_LEVEL_LABEL_FORMAT",query:m,options:{renameTo:"level",originalLabel:O}}}})}return(0,Q.Rn)(m)||a.push({type:"ADD_LINE_FILTER",label:"Consider filtering logs for specific string.",fix:{title:"add line filter",label:"",action:{type:"ADD_LINE_FILTER",query:m}}}),a}var er=d(62938),$r=d(33948),Ha=d(52622),wr=d(70416),Tr=d(80822);function Ya(m,n,a){if(n-m<=a)return[[m,n]];const i=[];for(let o=n;o>m;o-=a){const c=Math.max(o-a,m);i.push([c,o])}return i.reverse(),i}function Fa(m,n,a,i){if(i<a)return[[m,n]];const o=Math.trunc(i/a)*a,c=m-m%a,f=[];for(let v=c;v<n;v+=o){const O=Math.min(v+o-a,n);f.push([v,O])}return f}var fa=d(79007);function Ca(m,n,a,i){const o=n.from.toDate().getTime(),c=n.to.toDate().getTime();return(m?Ya(o,c,i):Fa(o,c,a,i)).map(([v,O])=>{const R=(0,lt.KQ)(v),U=(0,lt.KQ)(O);return{from:R,to:U,raw:{from:R,to:U}}})}function Za(m,n){return n?m.map(a=>{if(!a.maxLines||!(0,Q.sI)(a.expr))return a;const i=n.data.find(c=>c.refId===a.refId);if(!i)return a;const o=a.maxLines-i.length;return{...a,maxLines:o<0?0:o}}).filter(a=>a.maxLines===void 0||a.maxLines>0):m}function Rr(m,n){const a=n.length?n[0].request.queryGroupId:(0,er.A)();let i={data:[],state:D.Gu.Streaming,key:a};const o=Math.max(...n.map(({partition:U})=>U.length)),c=n.filter(({partition:U})=>U.length===o)[0].partition;let f=!1,v=null;const O=(U,z,Y)=>{if(f){U.complete();return}const ae=()=>{i.state=D.Gu.Done,U.next(i),U.complete()},Te=()=>{const{nextRequestN:nt,nextRequestGroup:je}=mr(n,Y,z);if(nt>0&&je>=0){O(U,nt,je);return}ae()},xe=n[Y],Be=xe.partition[z-1],Le=Za(xe.request.targets,i);if(!Le.length){Te();return}const ze={...n[Y].request,range:Be,targets:Le};xe.request.requestId&&(ze.requestId=`${xe.request.requestId}_${z}`),v=m.runQuery(ze).subscribe({next:nt=>{i=(0,Tr.Wn)(i,nt),i=Fr(i,ze,c,z),((i.errors??[]).length>0||i.error!=null)&&(f=!0)},complete:()=>{U.next(i),Te()},error:nt=>{U.error(nt)}})};return new Gt.c(U=>(O(U,o,0),()=>{f=!0,v?.unsubscribe()}))}const tr="loki-splitting-progress";function Fr(m,n,a,i){if((0,Q.sI)(n.targets[0].expr)||(m.data=m.data.filter(c=>c.name!==tr),i<=1))return m;const o=(0,$r.I)([{time:a[0].from.valueOf(),timeEnd:a[i-2].to.valueOf(),isRegion:!0,color:"rgba(120, 120, 120, 0.1)"}]);return o.name=tr,o.meta={dataTopic:Ha.QR.Annotations},m.data.push(o),m}function mr(m,n,a){for(let i=n+1;i<m.length;i++)if(m[i].partition[a-1])return{nextRequestGroup:i,nextRequestN:a};return{nextRequestGroup:m.findIndex(i=>i?.partition[a-1]!==void 0),nextRequestN:a-1}}function Cr(m){return m.queryType!==b.U3.Instant&&!(0,Q.Cg)(m.expr)}function Ja(m,n){const a=n.targets.filter(Y=>!Y.hide).filter(Y=>Y.expr),[i,o]=(0,w.partition)(a,Y=>!Cr(Y)),[c,f]=(0,w.partition)(o,Y=>(0,Q.sI)(Y.expr));n.queryGroupId=(0,er.A)();const v=24*60*60*1e3,O=(0,w.groupBy)(c,Y=>Y.splitDuration?(0,wr.WT)((0,wr.E9)(Y.splitDuration)):v),R=(0,w.groupBy)(f,Y=>Y.splitDuration?(0,wr.WT)((0,wr.E9)(Y.splitDuration)):v),U=[];for(const[Y,ae]of Object.entries(O)){const Te=(0,w.groupBy)(ae,xe=>xe.resolution||1);for(const xe in Te)U.push({request:{...n,targets:Te[xe]},partition:Ca(!0,n.range,n.intervalMs,Number(Y))})}for(const[Y,ae]of Object.entries(R)){const Te=(0,w.groupBy)(ae,xe=>qa(n.intervalMs,n.range,xe.resolution||1,xe.step));for(const xe in Te){const Be=Te[xe].map(Le=>{const{maxLines:ze,...nt}=Le;return nt});U.push({request:{...n,targets:Be},partition:Ca(!1,n.range,Number(xe),Number(Y))})}}i.length&&U.push({request:{...n,targets:i},partition:[n.range]});const z=new Date;return Rr(m,U).pipe((0,he.M)(Y=>{Y.state===D.Gu.Done&&(0,fa.uJ)(Y,U,n,z,{predefinedOperations:m.predefinedOperations})}))}function qa(m,n,a,i){const o=/(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])/;if(i?.match(o))return ce.intervalToMs(i)*a;const c=m*a,f=Math.round((n.to.valueOf()-n.from.valueOf())/11e3);return Math.max(c,f)}var Aa=d(56245),rr=d(72316),en=d(9631),Ar=d(55004),Hr=d(78731);async function Dr(m){const n=JSON.stringify({expr:m.expr}),a=new TextEncoder().encode(n),i=await crypto.subtle.digest("SHA-1",a);return Array.from(new Uint8Array(i.slice(0,8))).map(c=>c.toString(16).padStart(2,"0")).join("")}function ma(m,n,a){const i=a.range,o=i.to.valueOf()-i.from.valueOf()+1e3;let c=a.maxDataPoints??1e3;c>100&&(c*=2);let f;const v=O=>{if(O?.message){const R=O.message;f?f.push(R):f=en.k9.fromDataFrameJSON(R,{maxLength:c,maxDelta:o,displayNameFormat:m.legendFormat})}return f};return(0,rr.v)(()=>Dr(m)).pipe((0,_e.Z)(O=>(0,Hr.oF)().getStream({scope:Ar.qD.DataSource,namespace:n.uid,path:`tail/${O}`,data:{...m,timeRange:{from:i.from.valueOf().toString(),to:i.to.valueOf().toString()}}}).pipe((0,ye.T)(R=>{const U=v(R);return{data:U?[U]:[],state:D.Gu.Streaming}}))))}const Da=m=>{let a=`${window.location.protocol==="https:"?"wss://":"ws://"}${window.location.host}${re.$.appSubUrl}`;return a.endsWith("/")&&(a=a.slice(0,-1)),`${a}${m}`},tn=1e3,ar=10,mn="/loki/api/v1",ga="loki-data-samples",Rt="annotation-",jt="log-row-context-query-",Yr="log-volume-",Ia="log-sample-",rn="log-stats-",Na=1e6;function nr(m,n,a,i,o){const c=ce.calculateInterval(n,1);return{targets:[m],requestId:i,interval:c.interval,intervalMs:c.intervalMs,range:n,scopedVars:{},timezone:"UTC",app:a,startTime:Date.now(),hideFromInspector:o}}class ha extends Ie.iy{constructor(n,a=(0,L.w)()){super(n),this.instanceSettings=n,this.templateSrv=a,this.streams=new Zt,this.runLiveQuery=(o,c)=>{const f=this.createLiveTarget(o,c);return this.streams.getStream(f).pipe((0,ye.T)(v=>({data:v||[],key:`loki-${f.refId}`,state:D.Gu.Streaming})),(0,j.W)(v=>(0,Re.$)(()=>`Live tailing was stopped due to following error: ${v.reason}`)))},this.getLogRowContext=async(o,c,f)=>await this.logContextProvider.getLogRowContext(o,c,(0,Q.sc)(f)),this.getLogRowContextQuery=async(o,c,f,v)=>await this.logContextProvider.getLogRowContextQuery(o,c,(0,Q.sc)(f),v),this.languageProvider=new de(this);const i=n.jsonData||{};this.maxLines=parseInt(i.maxLines??"0",10)||tn,this.predefinedOperations=i.predefinedOperations??"",this.annotations={QueryEditor:Pt},this.variables=new la(this),this.logContextProvider=new ia(this)}getSupplementaryRequest(n,a,i){switch(n){case J.cF.LogsVolume:const o=i?.type===J.cF.LogsVolume?i:{type:n};return this.getLogsVolumeDataProvider(a,o);case J.cF.LogsSample:const c=i?.type===J.cF.LogsSample?i:{type:n};return this.getLogsSampleDataProvider(a,c);default:return}}getSupportedSupplementaryQueryTypes(){return[J.cF.LogsVolume,J.cF.LogsSample]}getSupplementaryQuery(n,a){const i=(0,Q.vV)(a);let o=(0,Je.Lv)(i.expr),c=!1;switch(n.type){case J.cF.LogsVolume:if(c=!!(o&&(0,Q.sI)(o)&&i.queryType===b.U3.Range),!c)return;const f=`${o} | drop __error__`,v=n.field||"level";return(0,Q.FV)(this.interpolateString(f,Sr.a))===!1&&(o=f),{...i,refId:`${Yr}${i.refId}`,queryType:b.U3.Range,supportingQueryType:b.Q$.LogsVolume,expr:`sum by (${v}) (count_over_time(${o}[$__auto]))`,legendFormat:`{{ ${v} }}`};case J.cF.LogsSample:return c=!!(o&&!(0,Q.sI)(o)),c?{...i,queryType:b.U3.Range,refId:`${Ia}${i.refId}`,expr:(0,Q.OT)(o),maxLines:Number.isNaN(Number(n.limit))?this.maxLines:Number(n.limit)}:void 0;default:return}}getLogsVolumeDataProvider(n,a){const i=(0,w.cloneDeep)(n),o=i.targets.map(c=>this.getSupplementaryQuery(a,c)).filter(c=>!!c);if(o.length)return{...i,targets:o}}getLogsSampleDataProvider(n,a){const i=(0,w.cloneDeep)(n),o=i.targets.map(c=>this.getSupplementaryQuery({type:J.cF.LogsSample,limit:100},c)).filter(c=>!!c);if(o.length)return{...i,targets:o}}query(n){const a=n.targets.map(Q.vV).map(f=>({...f,maxLines:f.maxLines??this.maxLines})),i={...n,targets:a},o=i.targets.filter(f=>f.queryType===b.U3.Stream);if(re.$.featureToggles.lokiExperimentalStreaming&&o.length>0&&i.rangeRaw?.to==="now"){const f={...i,targets:o};return(0,I.h)(...o.map(v=>ma(this.applyTemplateVariables(v,n.scopedVars,n.filters),this,f)))}if(i.liveStreaming)return this.runLiveQueryThroughBackend(i);if(re.$.featureToggles.lokiQuerySplitting&&(0,Q.gy)(i.targets))return Ja(this,i);const c=new Date;return this.runQuery(i).pipe((0,he.M)(f=>(0,fa.Ex)(f,i,c,{predefinedOperations:this.predefinedOperations})))}runQuery(n){return super.query(n).pipe((0,ye.T)(a=>pa(a,n.targets,this.instanceSettings.jsonData.derivedFields??[])))}runLiveQueryThroughBackend(n){const a=n.targets.filter(o=>o.expr!==""&&(0,Q.sI)(o.expr));if(a.length===0)return(0,A.of)({data:[],state:D.Gu.Done});const i=a.map(o=>{const c=this.applyTemplateVariables(o,n.scopedVars,n.filters),f=c.maxLines||this.maxLines;return this.runLiveQuery(c,f)});return(0,I.h)(...i)}createLiveTarget(n,a){const i=n.expr,o=this.instanceSettings.url,c=Ee.kM.serializeParams({query:i});return{query:i,url:Da(`${o}/loki/api/v1/tail?${c}`),refId:n.refId,size:a}}interpolateVariablesInQueries(n,a,i){let o=n;return n&&n.length&&(o=n.map(c=>({...c,datasource:this.getRef(),expr:this.addAdHocFilters(this.templateSrv.replace(c.expr,a,this.interpolateQueryExpr),i)}))),o}getQueryDisplayText(n){return n.expr}getTimeRangeParams(n){return{start:n.from.valueOf()*Na,end:n.to.valueOf()*Na}}async importFromAbstractQueries(n){await this.languageProvider.start();const a=this.languageProvider.labelKeys;return a&&a.length&&(n=n.map(i=>(i.labelMatchers=i.labelMatchers.filter(o=>a.includes(o.name)),i))),n.map(i=>this.languageProvider.importFromAbstractQuery(i))}async exportToAbstractQueries(n){return n.map(a=>this.languageProvider.exportToAbstractQuery(a))}async metadataRequest(n,a,i){if(n.startsWith("/"))throw new Error(`invalid metadata request url: ${n}`);return(await this.getResource(n,a,i)).data||[]}async statsMetadataRequest(n,a,i){if(n.startsWith("/"))throw new Error(`invalid metadata request url: ${n}`);return await this.getResource(n,a,i)}async getQueryStats(n,a){if((0,Q.FV)(this.interpolateString(n.expr,Sr.a)))return;const i=(0,Q.pk)(n.expr);let o={streams:0,chunks:0,bytes:0,entries:0};for(const c in i){const{start:f,end:v}=this.getStatsTimeRange(n,Number(c),a);if(f===void 0||v===void 0)return{streams:0,chunks:0,bytes:0,entries:0,message:"Query size estimate not available."};try{const O=await this.statsMetadataRequest("index/stats",{query:i[c],start:f,end:v},{showErrorAlert:!1,requestId:`${rn}${n.refId}`});o={streams:o.streams+O.streams,chunks:o.chunks+O.chunks,bytes:o.bytes+O.bytes,entries:o.entries+O.entries}}catch{break}}return o}getStatsTimeRange(n,a,i){let o,c;const O=(0,Q.QH)(n.expr,[pe.dw]).map(R=>n.expr.substring(R.from,R.to));return(0,Q.sI)(n.expr)?n.queryType===b.U3.Instant?{start:void 0,end:void 0}:this.getTimeRangeParams(i):n.queryType===b.U3.Instant?O[a]?(c=this.getTimeRangeParams(i).end,o=c-ce.intervalToMs(O[a])*1e6,{start:o,end:c}):/(\$__auto|\$__range)/.test(n.expr)?this.getTimeRangeParams(i):{start:void 0,end:void 0}:this.getTimeRangeParams(i)}async getStats(n,a){if(!n.expr)return null;const i=await this.getQueryStats(n,a);return i?Object.values(i).every(o=>o===0)?null:i:null}async metricFindQuery(n,a){if(!n)return Promise.resolve([]);let i;return typeof n=="string"?i=this.parseStringToVariableQuery(this.interpolateString(n,a?.scopedVars)):i={...n,label:this.interpolateString(n.label||"",a?.scopedVars),stream:this.interpolateString(n.stream||"",a?.scopedVars)},i?await this.processMetricFindQuery(i,a?.range):Promise.resolve([])}async processMetricFindQuery(n,a){if(n.type===b.ie.LabelNames)return(await this.languageProvider.fetchLabels({timeRange:a})).map(c=>({text:c}));if(!n.label)return[];if(n.stream){const o=await this.languageProvider.fetchSeriesLabels(n.stream,{timeRange:a});return o[n.label]?o[n.label].map(c=>({text:c})):[]}return(await this.languageProvider.fetchLabelValues(n.label,{timeRange:a})).map(o=>({text:o}))}parseStringToVariableQuery(n){const a="LokiVariableQueryEditor-VariableQuery";if(n.match(It))return{type:b.ie.LabelNames,refId:a};const o=n.match(xr);if(o)return{type:b.ie.LabelValues,label:o[2],stream:o[1],refId:a}}async getDataSamples(n,a){if(!(0,Q.sI)(n.expr)||(0,Q.FV)(this.interpolateString(n.expr,Sr.a)))return[];const i={expr:n.expr,queryType:b.U3.Range,refId:ga,maxLines:n.maxLines||ar,supportingQueryType:b.Q$.DataSample},o=nr(i,a,S.Jk.Unknown,ga,!0);return await(0,r.s)(this.query(o).pipe((0,M.n)(c=>(0,A.of)(c.data))))}async getTagKeys(n){return(await this.languageProvider.fetchLabels({timeRange:n?.timeRange})).map(i=>({text:i}))}async getTagValues(n){return(await this.languageProvider.fetchLabelValues(n.key,{timeRange:n.timeRange})).map(i=>({text:i}))}interpolateQueryExpr(n,a){return!a.multi&&!a.includeAll?gr(n):typeof n=="string"?sr(n):(0,w.map)(n,sr).join("|")}toggleQueryFilter(n,a){let i=n.expr??"";const o=(0,Qe.Ed)(a.options.key,a.frame,0);switch(a.type){case"FILTER_FOR":{if(a.options?.key&&a.options?.value){const c=(0,Qe.Bb)(a.options.value);i=(0,Je.je)(i,a.options.key,"=",c)?(0,Je.FN)(i,a.options.key,"=",c):(0,Je.tE)(i,a.options.key,"=",c,o)}break}case"FILTER_OUT":{if(a.options?.key&&a.options?.value){const c=(0,Qe.Bb)(a.options.value);(0,Je.je)(i,a.options.key,"=",c)&&(i=(0,Je.FN)(i,a.options.key,"=",c)),i=(0,Je.tE)(i,a.options.key,"!=",c,o)}break}default:break}return{...n,expr:i}}queryHasFilter(n,a){let i=n.expr??"";return(0,Je.je)(i,a.key,"=",a.value)}modifyQuery(n,a){let i=n.expr??"";switch(a.type){case"ADD_FILTER":{if(a.options?.key&&a.options?.value){const o=(0,Qe.Ed)(a.options.key,a.frame,0),c=(0,Qe.Bb)(a.options.value);i=(0,Je.tE)(i,a.options.key,"=",c,o)}break}case"ADD_FILTER_OUT":{if(a.options?.key&&a.options?.value){const o=(0,Qe.Ed)(a.options.key,a.frame,0),c=(0,Qe.Bb)(a.options.value);i=(0,Je.tE)(i,a.options.key,"!=",c,o)}break}case"ADD_LOGFMT_PARSER":{i=(0,Je.aH)(i,"logfmt");break}case"ADD_JSON_PARSER":{i=(0,Je.aH)(i,"json");break}case"ADD_UNPACK_PARSER":{i=(0,Je.aH)(i,"unpack");break}case"ADD_NO_PIPELINE_ERROR":{i=(0,Je.yI)(i);break}case"ADD_LEVEL_LABEL_FORMAT":{a.options?.originalLabel&&a.options?.renameTo&&(i=(0,Je.o9)(i,{renameTo:a.options.renameTo,originalLabel:a.options.originalLabel}));break}case"ADD_LABEL_FILTER":{const o=(0,Je.cH)(n.expr),c=(0,Je.lN)(n.expr),f=(0,Je.lq)([...o,...c]),v=(0,Je.i6)("","","=");i=(0,Je.cQ)(i,[f],v);break}case"ADD_STRING_FILTER":case"ADD_LINE_FILTER":{i=(0,Je.OS)(i,a.options?.value);break}case"ADD_STRING_FILTER_OUT":case"ADD_LINE_FILTER_OUT":{i=(0,Je.OS)(i,a.options?.value,"!=");break}default:break}return{...n,expr:i}}getSupportedQueryModifications(){return["ADD_FILTER","ADD_FILTER_OUT","ADD_LOGFMT_PARSER","ADD_JSON_PARSER","ADD_UNPACK_PARSER","ADD_NO_PIPELINE_ERROR","ADD_LEVEL_LABEL_FORMAT","ADD_LABEL_FILTER","ADD_STRING_FILTER","ADD_STRING_FILTER_OUT"]}getLogRowContextUi(n,a,i){return this.logContextProvider.getLogRowContextUi(n,a,(0,Q.sc)(i))}async annotationQuery(n){const{expr:a,maxLines:i,instant:o,tagKeys:c="",titleFormat:f="",textFormat:v=""}=n.annotation;if(!a)return[];const O=`${Rt}${n.annotation.name}`,R={refId:O,expr:a,maxLines:i,instant:o,queryType:o?b.U3.Instant:b.U3.Range},U=nr(R,n.range,S.Jk.Dashboard,O),{data:z}=await(0,r.s)(this.query(U)),Y=[],ae=c.split(",").filter(Te=>Te!=="");for(const Te of z)new Ke.R(Te).forEach(Be=>{const{labels:Le}=Be,ze=Object.entries(Le).map(([je,st])=>[je,st.trim()]).filter(([je,st])=>!(st===""||ae.length&&!ae.includes(je))).map(([je,st])=>st),nt=Array.from(new Set(ze));Y.push({time:new Date(Be.Time).valueOf(),title:(0,we.j)(f,Le),text:(0,we.j)(v,Le)||Be.Line,tags:nt})});return Y}addAdHocFilters(n,a){if(!a)return n;let i=(0,Aa.qk)(n);return i=a.reduce((o,c)=>{const{key:f,operator:v}=c;let{value:O}=c;return(0,Qe.N4)(v)?O=gr(O):O=(0,Qe.Bb)(O,v),(0,Je.tE)(o,f,v,O)},i),(0,Aa.If)(i)}filterQuery(n){return!(n.hide||n.expr==="")}applyTemplateVariables(n,a,i){const{__auto:o,__interval:c,__interval_ms:f,__range:v,__range_s:O,__range_ms:R,...U}=a||{},z=this.addAdHocFilters(n.expr,i),Y={...U,__interval:{value:"$__interval"},__interval_ms:{value:"$__interval_ms"}};return{...n,legendFormat:this.templateSrv.replace(n.legendFormat,U),expr:this.templateSrv.replace(z,Y,this.interpolateQueryExpr)}}interpolateString(n,a){return this.templateSrv.replace(n,a,this.interpolateQueryExpr)}getVariables(){return this.templateSrv.getVariables().map(n=>`$${n.name}`)}getQueryHints(n,a){return Qr(n.expr,a)}getDefaultQuery(n){const a={refId:"A",expr:""};return n===S.Jk.UnifiedAlerting?{...a,queryType:b.U3.Instant}:{...a,queryType:b.U3.Range}}}function gr(m){return typeof m=="string"?m.replace(/'/g,"\\\\'"):m}function sr(m){return typeof m=="string"?gr(m.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&")):m}},12798:(dt,Ve,d)=>{"use strict";d.d(Ve,{Ch:()=>M,FN:()=>D,Lv:()=>re,OS:()=>X,aH:()=>pe,cH:()=>Pe,cQ:()=>rt,i6:()=>Ne,je:()=>ce,lN:()=>Ae,lq:()=>ue,o9:()=>L,tE:()=>Ke,yB:()=>be,yI:()=>Ie});var w=d(2543),Re=d.n(w),I=d(36195),A=d(97535),r=d(56587),ye=d(43548),j=d(60706),he=d(43269);class M{constructor(P,b,H){this.from=P,this.to=b,this.type=H}static fromNode(P){return new M(P.from,P.to,P.type)}contains(P){return this.from<=P.from&&this.to>=P.to}getExpression(P){return P.substring(this.from,this.to)}}function ce(x,P,b,H){return S(x,P,b,H).length>0}function D(x,P,b,H){const de=S(x,P,b,H);for(const ee of de)x=ee.parent?.type.id===I.bY?J(x,ee):Ee(x,ee);return x}function J(x,P){const b=P.parent?.parent;return!b||b.type.id!==I.t3?x:(x.substring(0,b.from)+x.substring(b.to)).trim()}function Ee(x,P){let b=P;do b=b.parent;while(b&&b.type.id!==I.MD);const H=P.getChild(I.gw);if(!b||!H)return x;const de=x.substring(H.from,H.to),ee=x.substring(0,b.from),Me=x.substring(b.to),_e=(0,j.u_)(x.substring(b.from,b.to));return _e.query.labels=_e.query.labels.filter(at=>at.label!==de),ee+ye.y.renderQuery(_e.query)+Me}function S(x,P,b,H){const de=I.K3.parse(x),ee=[];return de.iterate({enter:({type:Me,node:_e})=>{Me.id===I.g$&&ee.push(_e)}}),ee.filter(Me=>{const _e=Me.getChild(I.gw),at=_e?.nextSibling,et=Me.getChild(I.Qf);if(!_e||!at||!et||x.substring(_e.from,_e.to)!==P)return!1;const Ot=x.substring(et.from,et.to);return!((0,j.w4)(Ot)!==(0,A.qv)(H)||x.substring(at.from,at.to)!==b)})}function Ke(x,P,b,H,de){if(!P||!H)throw new Error("Need label to add to query.");const ee=be(x);if(!ee.length)return x;const Me=Pe(x),_e=Ae(x),at=Q(x),et=ee.every(Ot=>at.some(Gt=>Gt.from>=Ot.from&&Gt.to<=Ot.to)),Ye=Ne(P,H,b);if(de===he.HD.Parsed||de===he.HD.StructuredMetadata){const Ot=we(x,[...ee,..._e,...Me]);return rt(x,Ot,Ye)}else{if(de===he.HD.Indexed)return Fe(x,ee,Ye);if(Me.length===0||et===!1)return Fe(x,ee,Ye);{const Ot=we(x,[...Me,..._e]);return rt(x,Ot,Ye)}}}function we(x,P){const b=K((0,r.TQ)(x,[I.GN])),H=[...P];return b.map(ee=>ue(H.filter(Me=>ee.contains(Me))))}function pe(x,P){const b=Ue(x);if(b.length)return Ze(x,b,P);{const H=be(x);return H.length?Ze(x,H,P):x}}function Ie(x){const P=Pe(x);if(!P.length)return x;const b=Ne("__error__","","=");return rt(x,P,b)}function L(x,P){const b=_(x);return F(x,b,P)}function re(x){const P=Z(x);if(!P.length)return x;let b="",H=0;for(let de of P)b=b+x.substring(H,de.from),H=de.to;return b=b+x.substring(H),b}function be(x){const P=I.K3.parse(x),b=[];return P.iterate({enter:({type:H,node:de})=>{if(H.id===I.MD)return b.push(M.fromNode(de)),!1}}),b}function Pe(x){const P=I.K3.parse(x),b=[],H=[I.iT,I.eF,I.Zj,I.Tz];return P.iterate({enter:({type:de,node:ee})=>{if(H.includes(de.id))return b.push(M.fromNode(ee)),!1}}),b}function Ae(x){const P=I.K3.parse(x),b=[];return P.iterate({enter:({type:H,node:de})=>{if(H.id===I.bY)return b.push(M.fromNode(de)),!1}}),b}function Ue(x){const P=I.K3.parse(x),b=[];return P.iterate({enter:({type:H,node:de})=>{if(H.id===I.CX)return b.push(M.fromNode(de)),!1}}),b}function _(x){const P=I.K3.parse(x),b=[];return P.iterate({enter:({type:H,node:de})=>{if(H.id===I.UK)return b.push(M.fromNode(de)),!1;if(H.id===I.xo){const ee=[],Me=de.getChild(I.MD);Me&&ee.push(M.fromNode(Me));const _e=de.getChild(I.AL);_e&&ee.push(M.fromNode(_e));const at=de.getChild(I.HV);at&&ee.push(M.fromNode(at));const et=(0,w.sortBy)(ee,Ye=>Ye.to);return b.push(new M(et[0].from,et[et.length-1].to)),!1}}}),b}function Ne(x,P,b){return{label:x,op:b,value:P}}function Fe(x,P,b){let H="",de=0;for(let ee=0;ee<P.length;ee++){const Me=P[ee],_e=ee===P.length-1,at=x.substring(de,Me.from),et=_e?x.substring(Me.to):"",Ye=(0,j.u_)(x.substring(Me.from,Me.to));ie(Ye.query.labels,b)||Ye.query.labels.push(b);const Ot=ye.y.renderQuery(Ye.query);H+=at+Ot+et,de=Me.to}return H}function rt(x,P,b){let H="",de=0;for(let ee=0;ee<P.length;ee++){const Me=P[ee],_e=ee===P.length-1,at=x.substring(de,Me.to),et=_e?x.substring(Me.to):"";let Ye="";!Number.isNaN(Number(b.value))&&(b.op==="<"||b.op===">")?Ye=` | ${b.label}${b.op}${Number(b.value)}`:Ye=` | ${b.label}${b.op}\`${(0,A.qv)(b.value)}\``,H+=at+Ye+et,de=Me.to}return H}function Ze(x,P,b){let H="",de=0;for(let ee=0;ee<P.length;ee++){const Me=P[ee],_e=ee===P.length-1,at=x.substring(de,Me.to),et=_e?x.substring(Me.to):"";H+=at+` | ${b}`+et,de=Me.to}return H}function F(x,P,b){let H="",de=0;for(let ee=0;ee<P.length;ee++){const Me=P[ee],_e=ee===P.length-1,at=x.substring(de,Me.to),et=_e?x.substring(Me.to):"",Ye=` | label_format ${b.renameTo}=${b.originalLabel}`;H+=at+Ye+et,de=Me.to}return H}function X(x,P="",b="|="){const H=be(x);if(!H.length)return x;const de=H[0].to;return x.slice(0,de)+` ${b} \`${P}\``+x.slice(de)}function Z(x){const P=I.K3.parse(x),b=[];return P.iterate({enter:({type:H,from:de,to:ee})=>{if(H.id===I.uk)return b.push(new M(de,ee,H)),!1}}),b}function ie(x,P){return x.find(b=>b.label===P.label&&b.value===P.value)}function ue(x){return x.length?x.reduce((P,b)=>P.to>b.to?P:b):new M(0,0)}function K(x){return x.filter(P=>x.every(b=>P.contains(b)===!1||P===b))}function Qe(x,P){if(x.type.id===P)return[M.fromNode(x)];const b=[];let H=0,de=x.childAfter(H);for(;de;)b.push(...Qe(de,P)),H=de.to,de=x.childAfter(H);return b}function Q(x){const P=I.K3.parse(x),b=[];return P.iterate({enter:({node:H})=>{H.type.id===I.MD&&b.push(...Qe(H,I.g$))}}),b}},26798:(dt,Ve,d)=>{"use strict";d.r(Ve),d.d(Ve,{plugin:()=>$o});var w=d(40187),Re=d(69129),I=d(3591),A=d(2543),r=d(96540),ye=d(14110),j=d(97535);const he=['{job="default/prometheus"}'],M=["job","app","k8s_app"],ce=5,D=[{title:"Log pipeline",expression:'{job="mysql"} |= "metrics" | logfmt | duration > 10s',label:'This query targets the MySQL job, keeps logs that contain the substring "metrics", and then parses and filters the logs further.'},{title:"Count over time",expression:'count_over_time({job="mysql"}[5m])',label:"This query counts all the log lines within the last five minutes for the MySQL job."},{title:"Rate",expression:'rate(({job="mysql"} |= "error" != "timeout")[10s])',label:"This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job."},{title:"Aggregate, count, and group",expression:'sum(count_over_time({job="mysql"}[5m])) by (level)',label:"Get the count of logs during the last five minutes, grouping by level."}];class J extends r.PureComponent{constructor(){super(...arguments),this.state={userExamples:[]},this.checkUserLabels=async()=>{const t=this.props.datasource?.languageProvider;if(t.started){const s=t.getLabelKeys()||[],l=M.find(u=>s.includes(u));if(l){const u=await t.fetchLabelValues(l),p=(0,A.shuffle)(u).slice(0,ce).map(y=>`{${l}="${(0,j.Qn)(y)}"}`);this.setState({userExamples:p})}}else this.scheduleUserLabelChecking()}}componentDidMount(){this.scheduleUserLabelChecking(),(0,ye.rR)("grafana_loki_cheatsheet_opened",{})}componentWillUnmount(){clearTimeout(this.userLabelTimer)}scheduleUserLabelChecking(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)}renderExpression(t){const{onClickExample:s}=this.props,l=u=>{s(u),(0,ye.rR)("grafana_loki_cheatsheet_example_clicked",{})};return r.createElement("button",{type:"button",className:"cheat-sheet-item__example",key:t,onClick:()=>l({refId:"A",expr:t})},r.createElement("code",null,t))}render(){const{userExamples:t}=this.state,s=t.length>0;return r.createElement("div",null,r.createElement("h2",null,"Loki Cheat Sheet"),r.createElement("div",{className:"cheat-sheet-item"},r.createElement("div",{className:"cheat-sheet-item__title"},"See your logs"),r.createElement("div",{className:"cheat-sheet-item__label"},"Start by selecting a log stream from the Label browser, or alternatively you can write a stream selector into the query field."),s?r.createElement("div",null,r.createElement("div",{className:"cheat-sheet-item__label"},"Here are some example streams from your logs:"),t.map(l=>this.renderExpression(l))):r.createElement("div",null,r.createElement("div",{className:"cheat-sheet-item__label"},"Here is an example of a log stream:"),this.renderExpression(he[0]))),r.createElement("div",{className:"cheat-sheet-item"},r.createElement("div",{className:"cheat-sheet-item__title"},"Combine stream selectors"),this.renderExpression('{app="cassandra",namespace="prod"}'),r.createElement("div",{className:"cheat-sheet-item__label"},"Returns all log lines from streams that have both labels.")),r.createElement("div",{className:"cheat-sheet-item"},r.createElement("div",{className:"cheat-sheet-item__title"},"Filtering for search terms."),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),r.createElement("div",{className:"cheat-sheet-item__label"},r.createElement("a",{href:"https://grafana.com/docs/loki/latest/logql/#log-pipeline",target:"logql"},"LogQL")," ","supports exact and regular expression filters.")),D.map(l=>r.createElement("div",{className:"cheat-sheet-item",key:l.expression},r.createElement("div",{className:"cheat-sheet-item__title"},l.title),this.renderExpression(l.expression),r.createElement("div",{className:"cheat-sheet-item__label"},l.label))))}}var Ee=d(41987),S=d(84596),Ke=d(39070),we=d(13544),pe=d(42952),Ie=d(6191),L=d(32196),re=d(40845),be=d(15292),Pe=d(46819),Ae=Object.defineProperty,Ue=Object.defineProperties,_=Object.getOwnPropertyDescriptors,Ne=Object.getOwnPropertySymbols,Fe=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable,Ze=(e,t,s)=>t in e?Ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,F=(e,t)=>{for(var s in t||(t={}))Fe.call(t,s)&&Ze(e,s,t[s]);if(Ne)for(var s of Ne(t))rt.call(t,s)&&Ze(e,s,t[s]);return e},X=(e,t)=>Ue(e,_(t)),Z=(e,t)=>{var s={};for(var l in e)Fe.call(e,l)&&t.indexOf(l)<0&&(s[l]=e[l]);if(e!=null&&Ne)for(var l of Ne(e))t.indexOf(l)<0&&rt.call(e,l)&&(s[l]=e[l]);return s};function ie(e){var t=e,{label:s}=t,l=Z(t,["label"]);const u=s.replace(" ","-"),p=(0,r.useRef)((0,A.uniqueId)(`switch-${u}`)),y=(0,re.of)(ue);return r.createElement(Pe.B,{gap:1},r.createElement("label",{htmlFor:p.current,className:y.switchLabel},s),r.createElement(be.d,X(F({},l),{id:p.current})))}const ue=e=>({switchLabel:(0,L.css)({color:e.colors.text.secondary,cursor:"pointer",fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.primary}})});var K=d(31347),Qe=d(94354);const Q=[{label:"Builder",value:pe.f.Builder},{label:"Code",value:pe.f.Code}];function x({mode:e,onChange:t}){return r.createElement("div",{"data-testid":"QueryEditorModeToggle"},r.createElement(Qe.z,{options:Q,size:"sm",value:e,onChange:t}))}var P=d(71087),b=d(32264),H=d(96374),de=d(67061),ee=d(55852),Me=d(68402);class _e{get(t){return window.localStorage[t]}set(t,s){window.localStorage[t]=s}getBool(t,s){return s!==void 0&&!this.exists(t)?s:window.localStorage[t]==="true"}getObject(t,s){let l=s;if(this.exists(t)){const u=window.localStorage[t];try{l=JSON.parse(u)}catch(p){console.error(`Error parsing store object: ${t}. Returning default: ${s}. [${p}]`)}}return l}setObject(t,s){let l;try{l=JSON.stringify(s)}catch(u){throw new Error(`Could not stringify object: ${t}. [${u}]`)}try{this.set(t,l)}catch(u){const p=new Error(`Could not save item in localStorage: ${t}. [${u}]`);throw u instanceof Error&&(p.name=u.name),p}return!0}exists(t){return window.localStorage[t]!==void 0}delete(t){window.localStorage.removeItem(t)}}const at=new _e,et=e=>{const{children:t,storageKey:s,defaultValue:l}=e,[u,p]=(0,r.useState)({value:at.getObject(e.storageKey,e.defaultValue)});(0,r.useEffect)(()=>{const g=E=>{E.key===s&&p({value:at.getObject(e.storageKey,e.defaultValue)})};return window.addEventListener("storage",g),()=>{window.removeEventListener("storage",g)}});const y=g=>{try{at.setObject(s,g)}catch(E){console.error(E)}p({value:g})},h=()=>{try{at.delete(s)}catch(g){console.log(g)}p({value:l})};return r.createElement(r.Fragment,null,t(u.value,y,h))};var Ye=d(37390),Ot=d(39558),Gt=d(97222),Ba=d(9830),lr=d(60029),ea=d(54438),cr=d(10354),ta=d(66864);const kr=1e3,ra=1e4,mt=4,aa="{}";function Xt(e){const t=[];for(const s of e)if(s.selected&&s.values&&s.values.length>0){const l=s.values.filter(u=>u.selected).map(u=>u.name);l.length>1?t.push(`${s.name}=~"${l.map(j.Cs).join("|")}"`):l.length===1&&t.push(`${s.name}="${(0,j.Qn)(l[0])}"`)}return["{",t.join(","),"}"].join("")}function Wa(e,t,s){return e.map(l=>{const u=t[l.name];if(u){let p;if(l.name===s&&l.values)p=l.values;else{const y=new Set(l.values?.filter(h=>h.selected).map(h=>h.name)||[]);p=u.map(h=>({name:h,selected:y.has(h)}))}return{...l,loading:!1,values:p,facets:p.length}}return{...l,loading:!1,hidden:!u,values:void 0,facets:0}})}const Va=e=>({wrapper:(0,L.css)`
    background-color: ${e.colors.background.secondary};
    width: 100%;
  `,wrapperPadding:(0,L.css)`
    padding: ${e.spacing(2)};
  `,list:(0,L.css)`
    margin-top: ${e.spacing(1)};
    display: flex;
    flex-wrap: wrap;
    max-height: 200px;
    overflow: auto;
  `,section:(0,L.css)`
    & + & {
      margin: ${e.spacing(2,0)};
    }

    position: relative;
  `,footerSectionStyles:(0,L.css)`
    padding: ${e.spacing(1)};
    background-color: ${e.colors.background.primary};
    position: sticky;
    bottom: -${e.spacing(3)}; /* offset the padding on modal */
    left: 0;
  `,selector:(0,L.css)`
    font-family: ${e.typography.fontFamilyMonospace};
    margin-bottom: ${e.spacing(1)};
    width: 100%;
  `,status:(0,L.css)`
    margin-bottom: ${e.spacing(1)};
    color: ${e.colors.text.secondary};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: opacity 100ms linear;
    opacity: 0;
    font-size: ${e.typography.bodySmall.fontSize};
    height: calc(${e.typography.bodySmall.fontSize} + 10px);
  `,statusShowing:(0,L.css)`
    opacity: 1;
  `,error:(0,L.css)`
    color: ${e.colors.error.main};
  `,valueList:(0,L.css)`
    margin-right: ${e.spacing(1)};
    resize: horizontal;
  `,valueListWrapper:(0,L.css)`
    border-left: 1px solid ${e.colors.border.medium};
    margin: ${e.spacing(1,0)};
    padding: ${e.spacing(1,0,1,1)};
  `,valueListArea:(0,L.css)`
    display: flex;
    flex-wrap: wrap;
    margin-top: ${e.spacing(1)};
  `,valueTitle:(0,L.css)`
    margin-left: -${e.spacing(.5)};
    margin-bottom: ${e.spacing(1)};
  `,validationStatus:(0,L.css)`
    padding: ${e.spacing(.5)};
    margin-bottom: ${e.spacing(1)};
    color: ${e.colors.text.maxContrast};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  `});class Ur extends r.Component{constructor(){super(...arguments),this.state={labels:[],searchTerm:"",status:"Ready",error:"",validationStatus:""},this.onChangeSearch=t=>{this.setState({searchTerm:t.target.value})},this.onClickRunLogsQuery=()=>{(0,ye.rR)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsButton"});const t=Xt(this.state.labels);this.props.onChange(t)},this.onClickRunMetricsQuery=()=>{(0,ye.rR)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsRateButton"});const s=`rate(${Xt(this.state.labels)}[$__auto])`;this.props.onChange(s)},this.onClickClear=()=>{this.setState(t=>({labels:t.labels.map(l=>({...l,values:void 0,selected:!1,loading:!1,hidden:!1,facets:void 0})),searchTerm:"",status:"",error:"",validationStatus:""})),this.props.deleteLastUsedLabels()},this.onClickLabel=(t,s,l)=>{const u=this.state.labels.find(h=>h.name===t);if(!u)return;const p=!u.selected;let y={selected:p};if(u.values&&!p){const h=u.values.map(g=>({...g,selected:!1}));y={...y,facets:0,values:h}}this.setState({searchTerm:""}),this.updateLabelState(t,y,"",()=>this.doFacettingForLabel(t))},this.onClickValue=(t,s,l)=>{const u=this.state.labels.find(y=>y.name===t);if(!u||!u.values)return;this.setState({searchTerm:""});const p=u.values.map(y=>({...y,selected:y.name===s?!y.selected:y.selected}));this.updateLabelState(t,{values:p},"",()=>this.doFacetting(t))},this.onClickValidate=()=>{const t=Xt(this.state.labels);this.validateSelector(t)},this.doFacetting=t=>{const s=Xt(this.state.labels);if(s===aa){const l=this.state.labels.map(u=>({...u,facets:0,values:void 0,hidden:!1}));this.setState({labels:l},()=>{this.state.labels.forEach(u=>u.selected&&this.fetchValues(u.name,s))})}else this.fetchSeries(s,t)}}updateLabelState(t,s,l="",u){this.setState(p=>{const y=p.labels.map(g=>g.name===t?{...g,...s}:g),h=l?"":p.error;return{labels:y,status:l,error:h,validationStatus:""}},u)}componentDidMount(){const{languageProvider:t,autoSelect:s=mt,lastUsedLabels:l,timeRange:u}=this.props;if(t){const p=l;t.start(u).then(()=>{let y=t.getLabelKeys();if(y.length>kr){const g=`Too many labels found (showing only ${kr} of ${y.length})`;y=y.slice(0,kr),this.setState({error:g})}const h=y.map((g,E,T)=>({name:g,selected:T.length<=s&&p.length===0||p.includes(g),loading:!1}));this.setState({labels:h},()=>{this.state.labels.forEach(g=>{g.selected&&this.fetchValues(g.name,aa)})})})}}doFacettingForLabel(t){const s=this.state.labels.find(u=>u.name===t);if(!s)return;const l=this.state.labels.filter(u=>u.selected).map(u=>u.name);this.props.storeLastUsedLabels(l),s.selected?s.values||this.fetchValues(t,Xt(this.state.labels)):this.doFacetting()}async fetchValues(t,s){const{languageProvider:l,timeRange:u}=this.props;this.updateLabelState(t,{loading:!0},`Fetching values for ${t}`);try{let p=await l.fetchLabelValues(t,{timeRange:u});if(s!==Xt(this.state.labels)){this.updateLabelState(t,{loading:!1},"");return}if(p.length>ra){const h=`Too many values for ${t} (showing only ${ra} of ${p.length})`;p=p.slice(0,ra),this.setState({error:h})}const y=p.map(h=>({name:h}));this.updateLabelState(t,{values:y,loading:!1})}catch(p){console.error(p)}}async fetchSeries(t,s){const{languageProvider:l,timeRange:u}=this.props;s&&this.updateLabelState(s,{loading:!0},`Loading labels for ${t}`);try{const p=await l.fetchSeriesLabels(t,{timeRange:u});if(t!==Xt(this.state.labels)){s&&this.updateLabelState(s,{loading:!1});return}if(Object.keys(p).length===0){this.setState({error:`Empty results, no matching label for ${t}`});return}const y=Wa(this.state.labels,p,s);this.setState({labels:y,error:""}),s&&this.updateLabelState(s,{loading:!1})}catch(p){console.error(p)}}async validateSelector(t){const{languageProvider:s,timeRange:l}=this.props;this.setState({validationStatus:`Validating selector ${t}`,error:""});const u=await s.fetchSeries(t,{timeRange:l});this.setState({validationStatus:`Selector is valid (${u.length} streams found)`})}render(){const{theme:t}=this.props,{labels:s,searchTerm:l,status:u,error:p,validationStatus:y}=this.state;if(s.length===0)return r.createElement(Ot._,{text:"Loading labels..."});const h=Va(t),g=Xt(this.state.labels),E=g===aa;let T=s.filter($=>$.selected&&$.values);return l?T=T.map($=>{const B=$.values.filter(k=>{if(k.selected)return k.highlightParts=void 0,!0;const ve=(0,Ba.I)(k.name.toLowerCase(),l.toLowerCase());return ve.found?(k.highlightParts=ve.ranges,k.order=ve.distance,!0):!1});return{...$,values:(0,A.sortBy)(B,k=>k.selected?-1/0:k.order)}}):T=this.state.labels.filter($=>$.selected&&$.values).map($=>({...$,values:$?.values?$.values.map(B=>({...B,highlightParts:void 0})):[]})),r.createElement(r.Fragment,null,r.createElement("div",{className:h.wrapper},r.createElement("div",{className:(0,L.cx)(h.section,h.wrapperPadding)},r.createElement(lr.J,{description:"Which labels would you like to consider for your search?"},"1. Select labels to search in"),r.createElement("div",{className:h.list},s.map($=>r.createElement(ea.J,{key:$.name,name:$.name,loading:$.loading,active:$.selected,hidden:$.hidden,facets:$.facets,onClick:this.onClickLabel})))),r.createElement("div",{className:(0,L.cx)(h.section,h.wrapperPadding)},r.createElement(lr.J,{description:"Choose the label values that you would like to use for the query. Use the search field to find values across selected labels."},"2. Find values for the selected labels"),r.createElement("div",null,r.createElement(cr.p,{onChange:this.onChangeSearch,"aria-label":"Filter expression for values",value:l,placeholder:"Enter a label value"})),r.createElement("div",{className:h.valueListArea},T.map($=>r.createElement("div",{role:"list",key:$.name,className:h.valueListWrapper},r.createElement("div",{className:h.valueTitle,"aria-label":`Values for ${$.name}`},r.createElement(ea.J,{name:$.name,loading:$.loading,active:$.selected,hidden:$.hidden,facets:$.facets||$.values?.length,onClick:this.onClickLabel})),r.createElement(Gt.Y1,{height:200,itemCount:$.values?.length||0,itemSize:28,itemKey:B=>$.values?.[B].name??B,width:200,className:h.valueList},({index:B,style:k})=>{const ve=$.values?.[B];return ve?r.createElement("div",{style:k},r.createElement(ea.J,{name:$.name,value:ve?.name,active:ve?.selected,highlightParts:ve?.highlightParts,onClick:this.onClickValue,searchTerm:l})):null})))))),r.createElement("div",{className:h.footerSectionStyles},r.createElement(lr.J,null,"3. Resulting selector"),r.createElement("pre",{"aria-label":"selector",className:h.selector},g),y&&r.createElement("div",{className:h.validationStatus},y),r.createElement("div",{className:(0,L.cx)(h.status,(u||p)&&h.statusShowing)},r.createElement("span",{className:p?h.error:""},p||u)),r.createElement(ta.Gy,null,r.createElement(ee.$n,{"aria-label":"Use selector as logs button",disabled:E,onClick:this.onClickRunLogsQuery},"Show logs"),r.createElement(ee.$n,{"aria-label":"Use selector as metrics button",variant:"secondary",disabled:E,onClick:this.onClickRunMetricsQuery},"Show logs rate"),r.createElement(ee.$n,{"aria-label":"Validate submit button",variant:"secondary",disabled:E,onClick:this.onClickValidate},"Validate selector"),r.createElement(ee.$n,{"aria-label":"Selector clear button",variant:"secondary",onClick:this.onClickClear},"Clear"))))}}const Br=(0,re.cV)(Ur),Ea=e=>{const{isOpen:t,onClose:s,datasource:l,app:u,timeRange:p}=e,[y,h]=(0,r.useState)(!1),[g,E]=(0,r.useState)(!1),T="grafana.datasources.loki.browser.labels",$=(0,re.of)(xa);(0,r.useEffect)(()=>{t&&l.languageProvider.fetchLabels({timeRange:p}).then(V=>{h(!0),E(V.length>0)})},[l,t,p]);const B=V=>{const{query:ne,onChange:le,onRunQuery:se}=e,fe={...ne,expr:V};le(fe),se()},k=V=>{B(V),s()},ve=()=>{(0,ye.rR)("grafana_loki_label_browser_closed",{app:u,closeType:"modalClose"}),s()};return r.createElement(Ye.a,{isOpen:t,title:"Label browser",onDismiss:ve,className:$.modal},!y&&r.createElement(Ot._,{text:"Loading labels..."}),y&&!g&&r.createElement("p",null,"No labels found."),y&&g&&r.createElement(et,{storageKey:T,defaultValue:[]},(V,ne,le)=>r.createElement(Br,{languageProvider:l.languageProvider,onChange:k,lastUsedLabels:V,storeLastUsedLabels:ne,deleteLastUsedLabels:le,app:u,timeRange:p})))},xa=e=>({modal:(0,L.css)`
      width: 85vw;
      ${e.breakpoints.down("md")} {
        width: 100%;
      }
    `});var ja=d(30038),pt=d(43548),Ht=d(60706),fn=d(43127),Pa=d(9e4),Yt=d(81580),La=d(97801),_a=d(7650),Sa=d(44600),Zt=d(50877),lt=d(14186),kt=d(88323),Lt=d(81392),ge=d(3721),Wr=Object.defineProperty,yr=Object.defineProperties,ur=Object.getOwnPropertyDescriptors,Ft=Object.getOwnPropertySymbols,Vr=Object.prototype.hasOwnProperty,yt=Object.prototype.propertyIsEnumerable,na=(e,t,s)=>t in e?Wr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,gt=(e,t)=>{for(var s in t||(t={}))Vr.call(t,s)&&na(e,s,t[s]);if(Ft)for(var s of Ft(t))yt.call(t,s)&&na(e,s,t[s]);return e},br=(e,t)=>yr(e,ur(t));const za="You have conflicting label filters";function Ka({item:e,items:t,defaultOp:s,onChange:l,onDelete:u,onGetLabelNames:p,onGetLabelValues:y,invalidLabel:h,invalidValue:g,multiValueSeparator:E="|"}){var T;const[$,B]=(0,r.useState)({}),[k,ve]=(0,r.useState)(!1),[V,ne]=(0,r.useState)(!1),le=(te=e.op)=>{var Se;return(Se=Ut.find(me=>me.label===te))==null?void 0:Se.isMultiValue},se=te=>te?te.indexOf(E)>0?te.split(E):[te]:[],fe=()=>{const te=$.labelValues?[...$.labelValues]:[],Se=se(e?.value).map(Zt.z);return(0,A.uniqBy)([...Se,...te],"value")},oe=Er(e,t),{current:$e}=(0,r.useRef)((0,Sa.A)());return r.createElement("div",{"data-testid":"visual-query-builder-dimensions-filter-item"},r.createElement(lt.I,{error:za,invalid:oe?!0:void 0},r.createElement(Lt.M,null,r.createElement(kt.l6,{placeholder:"Select label","data-testid":we.Tp.components.QueryBuilder.labelSelect,inputId:`visual-query-builder-dimensions-filter-item-key-${$e}`,width:"auto",value:e.label?(0,Zt.z)(e.label):null,allowCustomValue:!0,onOpenMenu:async()=>{B({isLoadingLabelNames:!0});const te=await p(e);ve(!0),B({labelNames:te,isLoadingLabelNames:void 0})},onCloseMenu:()=>{ve(!1)},isOpen:k,isLoading:$.isLoadingLabelNames,options:$.labelNames,onChange:te=>{var Se;te.value&&l(br(gt({},e),{op:(Se=e.op)!=null?Se:s,label:te.value}))},invalid:oe||h}),r.createElement(kt.l6,{"data-testid":we.Tp.components.QueryBuilder.matchOperatorSelect,value:(0,Zt.z)((T=e.op)!=null?T:s),options:Ut,width:"auto",onChange:te=>{te.value&&l(br(gt({},e),{op:te.value,value:le(te.value)?e.value:se(e?.value)[0]}))},invalid:oe}),r.createElement(kt.l6,{placeholder:"Select value","data-testid":we.Tp.components.QueryBuilder.valueSelect,inputId:`visual-query-builder-dimensions-filter-item-value-${$e}`,width:"auto",value:le()?se(e?.value).map(Zt.z):se(e?.value).map(Zt.z)[0],allowCustomValue:!0,onOpenMenu:async()=>{B({isLoadingLabelValues:!0});const te=await y(e);B(br(gt({},$),{labelValues:te,isLoadingLabelValues:void 0})),ne(!0)},onCloseMenu:()=>{ne(!1)},isOpen:V,isMulti:le(),isLoading:$.isLoadingLabelValues,options:fe(),onChange:te=>{var Se,me;if(te.value)l(br(gt({},e),{value:te.value,op:(Se=e.op)!=null?Se:s}));else{const Ce=te.map(We=>{if(We.value)return We.value}).filter(We=>We!==void 0).join(E);l(br(gt({},e),{value:Ce,op:(me=e.op)!=null?me:s}))}},invalid:oe||g}),r.createElement(ge.Z,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:u}))))}const Ut=[{label:"=",value:"=",description:"Equals",isMultiValue:!1},{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0}];function Er(e,t){if(!e.label||!e.op||!e.value||t.length<2)return!1;const s=e.op.toString().startsWith("!");return t.filter(p=>p.label===e.label&&p.value===e.value&&p.op!==e.op).some(p=>{var y,h;return!!(s&&((y=p?.op)==null?void 0:y.toString().startsWith("!"))===!1||s===!1&&((h=p?.op)!=null&&h.toString().startsWith("!")))})}const jr="Select at least 1 label filter (label and value)";function Bt({labelsFilters:e,onChange:t,onGetLabelNames:s,onGetLabelValues:l,labelFilterRequired:u,multiValueSeparator:p}){const y="=",[h,g]=(0,r.useState)([{op:y}]);(0,r.useEffect)(()=>{e.length>0?g(e):g([{op:y}])},[e]);const E=$=>{g($);const B=$.filter(k=>k.label!==void 0&&k.value!==void 0);(0,A.isEqual)(B,e)||t(B)},T=h.some($=>$.label&&$.value);return r.createElement(La.B,null,r.createElement(Yt.c,{label:"Label filters",error:jr,invalid:u&&!T},r.createElement(_a.o,{items:h,onChange:E,renderItem:($,B,k)=>r.createElement(Ka,{item:$,items:h,defaultOp:y,onChange:B,onDelete:k,onGetLabelNames:s,onGetLabelValues:l,invalidLabel:u&&!$.label,invalidValue:u&&!$.value,multiValueSeparator:p})})))}var _r=d(36663);function zr({title:e,stepNumber:t,markdown:s,children:l}){const u=(0,re.of)(Qa);return r.createElement("div",{className:u.box},t!==void 0&&r.createElement("div",{className:u.stepNumber},t),r.createElement("div",{className:u.boxInner},e&&r.createElement("div",{className:u.header},r.createElement("span",null,e)),r.createElement("div",{className:u.body},s&&r.createElement("div",{dangerouslySetInnerHTML:{__html:(0,_r.G)(s)}}),l)))}const Qa=e=>({box:(0,L.css)({background:e.colors.background.secondary,padding:e.spacing(1),borderRadius:e.shape.radius.default,position:"relative"}),boxInner:(0,L.css)({marginLeft:e.spacing(4)}),stepNumber:(0,L.css)({fontWeight:e.typography.fontWeightMedium,background:e.colors.secondary.main,width:"20px",height:"20px",borderRadius:e.shape.radius.circle,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"10px",left:"11px",fontSize:e.typography.bodySmall.fontSize}),header:(0,L.css)({paddingBottom:e.spacing(.5),display:"flex",alignItems:"center",fontFamily:e.typography.fontFamilyMonospace}),body:(0,L.css)({color:e.colors.text.secondary,"p:last-child":{margin:0},a:{color:e.colors.text.link,textDecoration:"underline"}})});var Jt=d(92762);function sa({children:e}){const t=(0,re.of)($a);return r.createElement("div",{className:t.root},r.createElement(Pe.B,{gap:1},e))}const $a=e=>({root:(0,L.css)({padding:e.spacing(1,1,0,1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.radius.default})});var Je=d(55244),qt=d(1604),Ga=d(3988),dr=d(56034),Dt=d(14578);function _t(e,t){if(e==null)return{};var s={},l=Object.keys(e),u,p;for(p=0;p<l.length;p++)u=l[p],!(t.indexOf(u)>=0)&&(s[u]=e[u]);return s}function St(){return St=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(e[l]=s[l])}return e},St.apply(this,arguments)}var ia=d(40961);function bt(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Et(e){var t=bt(e).Element;return e instanceof t||e instanceof Element}function ht(e){var t=bt(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function Wt(e){if(typeof ShadowRoot>"u")return!1;var t=bt(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}var It=Math.max,xr=Math.min,Vt=Math.round;function oa(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function wa(){return!/^((?!chrome|android).)*safari/i.test(oa())}function pr(e,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var l=e.getBoundingClientRect(),u=1,p=1;t&&ht(e)&&(u=e.offsetWidth>0&&Vt(l.width)/e.offsetWidth||1,p=e.offsetHeight>0&&Vt(l.height)/e.offsetHeight||1);var y=Et(e)?bt(e):window,h=y.visualViewport,g=!wa()&&s,E=(l.left+(g&&h?h.offsetLeft:0))/u,T=(l.top+(g&&h?h.offsetTop:0))/p,$=l.width/u,B=l.height/p;return{width:$,height:B,top:T,right:E+$,bottom:T+B,left:E,x:E,y:T}}function la(e){var t=bt(e),s=t.pageXOffset,l=t.pageYOffset;return{scrollLeft:s,scrollTop:l}}function ca(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function Ta(e){return e===bt(e)||!ht(e)?la(e):ca(e)}function $t(e){return e?(e.nodeName||"").toLowerCase():null}function ut(e){return((Et(e)?e.ownerDocument:e.document)||window.document).documentElement}function zt(e){return pr(ut(e)).left+la(e).scrollLeft}function xt(e){return bt(e).getComputedStyle(e)}function ua(e){var t=xt(e),s=t.overflow,l=t.overflowX,u=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+u+l)}function Kr(e){var t=e.getBoundingClientRect(),s=Vt(t.width)/e.offsetWidth||1,l=Vt(t.height)/e.offsetHeight||1;return s!==1||l!==1}function Pr(e,t,s){s===void 0&&(s=!1);var l=ht(t),u=ht(t)&&Kr(t),p=ut(t),y=pr(e,u,s),h={scrollLeft:0,scrollTop:0},g={x:0,y:0};return(l||!l&&!s)&&(($t(t)!=="body"||ua(p))&&(h=Ta(t)),ht(t)?(g=pr(t,!0),g.x+=t.clientLeft,g.y+=t.clientTop):p&&(g.x=zt(p))),{x:y.left+h.scrollLeft-g.x,y:y.top+h.scrollTop-g.y,width:y.width,height:y.height}}function Gr(e){var t=pr(e),s=e.offsetWidth,l=e.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-l)<=1&&(l=t.height),{x:e.offsetLeft,y:e.offsetTop,width:s,height:l}}function Lr(e){return $t(e)==="html"?e:e.assignedSlot||e.parentNode||(Wt(e)?e.host:null)||ut(e)}function da(e){return["html","body","#document"].indexOf($t(e))>=0?e.ownerDocument.body:ht(e)&&ua(e)?e:da(Lr(e))}function fr(e,t){var s;t===void 0&&(t=[]);var l=da(e),u=l===((s=e.ownerDocument)==null?void 0:s.body),p=bt(l),y=u?[p].concat(p.visualViewport||[],ua(l)?l:[]):l,h=t.concat(y);return u?h:h.concat(fr(Lr(y)))}function Ra(e){return["table","td","th"].indexOf($t(e))>=0}function pa(e){return!ht(e)||xt(e).position==="fixed"?null:e.offsetParent}function Ct(e){var t=/firefox/i.test(oa()),s=/Trident/i.test(oa());if(s&&ht(e)){var l=xt(e);if(l.position==="fixed")return null}var u=Lr(e);for(Wt(u)&&(u=u.host);ht(u)&&["html","body"].indexOf($t(u))<0;){var p=xt(u);if(p.transform!=="none"||p.perspective!=="none"||p.contain==="paint"||["transform","perspective"].indexOf(p.willChange)!==-1||t&&p.willChange==="filter"||t&&p.filter&&p.filter!=="none")return u;u=u.parentNode}return null}function Nt(e){for(var t=bt(e),s=pa(e);s&&Ra(s)&&xt(s).position==="static";)s=pa(s);return s&&($t(s)==="html"||$t(s)==="body"&&xt(s).position==="static")?t:s||Ct(e)||t}var ct="top",wt="bottom",Tt="right",Pt="left",Sr="auto",Qr=[ct,wt,Tt,Pt],er="start",$r="end",Ha="clippingParents",wr="viewport",Tr="popper",Ya="reference",Fa=Qr.reduce(function(e,t){return e.concat([t+"-"+er,t+"-"+$r])},[]),fa=[].concat(Qr,[Sr]).reduce(function(e,t){return e.concat([t,t+"-"+er,t+"-"+$r])},[]),Ca="beforeRead",Za="read",Rr="afterRead",tr="beforeMain",Fr="main",mr="afterMain",Cr="beforeWrite",Ja="write",qa="afterWrite",Aa=[Ca,Za,Rr,tr,Fr,mr,Cr,Ja,qa];function rr(e){var t=new Map,s=new Set,l=[];e.forEach(function(p){t.set(p.name,p)});function u(p){s.add(p.name);var y=[].concat(p.requires||[],p.requiresIfExists||[]);y.forEach(function(h){if(!s.has(h)){var g=t.get(h);g&&u(g)}}),l.push(p)}return e.forEach(function(p){s.has(p.name)||u(p)}),l}function en(e){var t=rr(e);return Aa.reduce(function(s,l){return s.concat(t.filter(function(u){return u.phase===l}))},[])}function Ar(e){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(e())})})),t}}function Hr(e){var t=e.reduce(function(s,l){var u=s[l.name];return s[l.name]=u?Object.assign({},u,l,{options:Object.assign({},u.options,l.options),data:Object.assign({},u.data,l.data)}):l,s},{});return Object.keys(t).map(function(s){return t[s]})}var Dr={placement:"bottom",modifiers:[],strategy:"absolute"};function ma(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return!t.some(function(l){return!(l&&typeof l.getBoundingClientRect=="function")})}function Da(e){e===void 0&&(e={});var t=e,s=t.defaultModifiers,l=s===void 0?[]:s,u=t.defaultOptions,p=u===void 0?Dr:u;return function(h,g,E){E===void 0&&(E=p);var T={placement:"bottom",orderedModifiers:[],options:Object.assign({},Dr,p),modifiersData:{},elements:{reference:h,popper:g},attributes:{},styles:{}},$=[],B=!1,k={state:T,setOptions:function(le){var se=typeof le=="function"?le(T.options):le;V(),T.options=Object.assign({},p,T.options,se),T.scrollParents={reference:Et(h)?fr(h):h.contextElement?fr(h.contextElement):[],popper:fr(g)};var fe=en(Hr([].concat(l,T.options.modifiers)));return T.orderedModifiers=fe.filter(function(oe){return oe.enabled}),ve(),k.update()},forceUpdate:function(){if(!B){var le=T.elements,se=le.reference,fe=le.popper;if(ma(se,fe)){T.rects={reference:Pr(se,Nt(fe),T.options.strategy==="fixed"),popper:Gr(fe)},T.reset=!1,T.placement=T.options.placement,T.orderedModifiers.forEach(function(We){return T.modifiersData[We.name]=Object.assign({},We.data)});for(var oe=0;oe<T.orderedModifiers.length;oe++){if(T.reset===!0){T.reset=!1,oe=-1;continue}var $e=T.orderedModifiers[oe],te=$e.fn,Se=$e.options,me=Se===void 0?{}:Se,Ce=$e.name;typeof te=="function"&&(T=te({state:T,options:me,name:Ce,instance:k})||T)}}}},update:Ar(function(){return new Promise(function(ne){k.forceUpdate(),ne(T)})}),destroy:function(){V(),B=!0}};if(!ma(h,g))return k;k.setOptions(E).then(function(ne){!B&&E.onFirstUpdate&&E.onFirstUpdate(ne)});function ve(){T.orderedModifiers.forEach(function(ne){var le=ne.name,se=ne.options,fe=se===void 0?{}:se,oe=ne.effect;if(typeof oe=="function"){var $e=oe({state:T,name:le,instance:k,options:fe}),te=function(){};$.push($e||te)}})}function V(){$.forEach(function(ne){return ne()}),$=[]}return k}}var tn=null,ar={passive:!0};function mn(e){var t=e.state,s=e.instance,l=e.options,u=l.scroll,p=u===void 0?!0:u,y=l.resize,h=y===void 0?!0:y,g=bt(t.elements.popper),E=[].concat(t.scrollParents.reference,t.scrollParents.popper);return p&&E.forEach(function(T){T.addEventListener("scroll",s.update,ar)}),h&&g.addEventListener("resize",s.update,ar),function(){p&&E.forEach(function(T){T.removeEventListener("scroll",s.update,ar)}),h&&g.removeEventListener("resize",s.update,ar)}}const ga={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:mn,data:{}};function Rt(e){return e.split("-")[0]}function jt(e){return e.split("-")[1]}function Yr(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Ia(e){var t=e.reference,s=e.element,l=e.placement,u=l?Rt(l):null,p=l?jt(l):null,y=t.x+t.width/2-s.width/2,h=t.y+t.height/2-s.height/2,g;switch(u){case ct:g={x:y,y:t.y-s.height};break;case wt:g={x:y,y:t.y+t.height};break;case Tt:g={x:t.x+t.width,y:h};break;case Pt:g={x:t.x-s.width,y:h};break;default:g={x:t.x,y:t.y}}var E=u?Yr(u):null;if(E!=null){var T=E==="y"?"height":"width";switch(p){case er:g[E]=g[E]-(t[T]/2-s[T]/2);break;case $r:g[E]=g[E]+(t[T]/2-s[T]/2);break;default:}}return g}function rn(e){var t=e.state,s=e.name;t.modifiersData[s]=Ia({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const Na={name:"popperOffsets",enabled:!0,phase:"read",fn:rn,data:{}};var nr={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ha(e,t){var s=e.x,l=e.y,u=t.devicePixelRatio||1;return{x:Vt(s*u)/u||0,y:Vt(l*u)/u||0}}function gr(e){var t,s=e.popper,l=e.popperRect,u=e.placement,p=e.variation,y=e.offsets,h=e.position,g=e.gpuAcceleration,E=e.adaptive,T=e.roundOffsets,$=e.isFixed,B=y.x,k=B===void 0?0:B,ve=y.y,V=ve===void 0?0:ve,ne=typeof T=="function"?T({x:k,y:V}):{x:k,y:V};k=ne.x,V=ne.y;var le=y.hasOwnProperty("x"),se=y.hasOwnProperty("y"),fe=Pt,oe=ct,$e=window;if(E){var te=Nt(s),Se="clientHeight",me="clientWidth";if(te===bt(s)&&(te=ut(s),xt(te).position!=="static"&&h==="absolute"&&(Se="scrollHeight",me="scrollWidth")),te=te,u===ct||(u===Pt||u===Tt)&&p===$r){oe=wt;var Ce=$&&te===$e&&$e.visualViewport?$e.visualViewport.height:te[Se];V-=Ce-l.height,V*=g?1:-1}if(u===Pt||(u===ct||u===wt)&&p===$r){fe=Tt;var We=$&&te===$e&&$e.visualViewport?$e.visualViewport.width:te[me];k-=We-l.width,k*=g?1:-1}}var tt=Object.assign({position:h},E&&nr),Qt=T===!0?ha({x:k,y:V},bt(s)):{x:k,y:V};if(k=Qt.x,V=Qt.y,g){var ft;return Object.assign({},tt,(ft={},ft[oe]=se?"0":"",ft[fe]=le?"0":"",ft.transform=($e.devicePixelRatio||1)<=1?"translate("+k+"px, "+V+"px)":"translate3d("+k+"px, "+V+"px, 0)",ft))}return Object.assign({},tt,(t={},t[oe]=se?V+"px":"",t[fe]=le?k+"px":"",t.transform="",t))}function sr(e){var t=e.state,s=e.options,l=s.gpuAcceleration,u=l===void 0?!0:l,p=s.adaptive,y=p===void 0?!0:p,h=s.roundOffsets,g=h===void 0?!0:h,E={placement:Rt(t.placement),variation:jt(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:u,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,gr(Object.assign({},E,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:y,roundOffsets:g})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,gr(Object.assign({},E,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:g})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const m={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:sr,data:{}};function n(e){var t=e.state;Object.keys(t.elements).forEach(function(s){var l=t.styles[s]||{},u=t.attributes[s]||{},p=t.elements[s];!ht(p)||!$t(p)||(Object.assign(p.style,l),Object.keys(u).forEach(function(y){var h=u[y];h===!1?p.removeAttribute(y):p.setAttribute(y,h===!0?"":h)}))})}function a(e){var t=e.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(l){var u=t.elements[l],p=t.attributes[l]||{},y=Object.keys(t.styles.hasOwnProperty(l)?t.styles[l]:s[l]),h=y.reduce(function(g,E){return g[E]="",g},{});!ht(u)||!$t(u)||(Object.assign(u.style,h),Object.keys(p).forEach(function(g){u.removeAttribute(g)}))})}}const i={name:"applyStyles",enabled:!0,phase:"write",fn:n,effect:a,requires:["computeStyles"]};function o(e,t,s){var l=Rt(e),u=[Pt,ct].indexOf(l)>=0?-1:1,p=typeof s=="function"?s(Object.assign({},t,{placement:e})):s,y=p[0],h=p[1];return y=y||0,h=(h||0)*u,[Pt,Tt].indexOf(l)>=0?{x:h,y}:{x:y,y:h}}function c(e){var t=e.state,s=e.options,l=e.name,u=s.offset,p=u===void 0?[0,0]:u,y=fa.reduce(function(T,$){return T[$]=o($,t.rects,p),T},{}),h=y[t.placement],g=h.x,E=h.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=g,t.modifiersData.popperOffsets.y+=E),t.modifiersData[l]=y}const f={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:c};var v={left:"right",right:"left",bottom:"top",top:"bottom"};function O(e){return e.replace(/left|right|bottom|top/g,function(t){return v[t]})}var R={start:"end",end:"start"};function U(e){return e.replace(/start|end/g,function(t){return R[t]})}function z(e,t){var s=bt(e),l=ut(e),u=s.visualViewport,p=l.clientWidth,y=l.clientHeight,h=0,g=0;if(u){p=u.width,y=u.height;var E=wa();(E||!E&&t==="fixed")&&(h=u.offsetLeft,g=u.offsetTop)}return{width:p,height:y,x:h+zt(e),y:g}}function Y(e){var t,s=ut(e),l=la(e),u=(t=e.ownerDocument)==null?void 0:t.body,p=It(s.scrollWidth,s.clientWidth,u?u.scrollWidth:0,u?u.clientWidth:0),y=It(s.scrollHeight,s.clientHeight,u?u.scrollHeight:0,u?u.clientHeight:0),h=-l.scrollLeft+zt(e),g=-l.scrollTop;return xt(u||s).direction==="rtl"&&(h+=It(s.clientWidth,u?u.clientWidth:0)-p),{width:p,height:y,x:h,y:g}}function ae(e,t){var s=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(s&&Wt(s)){var l=t;do{if(l&&e.isSameNode(l))return!0;l=l.parentNode||l.host}while(l)}return!1}function Te(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function xe(e,t){var s=pr(e,!1,t==="fixed");return s.top=s.top+e.clientTop,s.left=s.left+e.clientLeft,s.bottom=s.top+e.clientHeight,s.right=s.left+e.clientWidth,s.width=e.clientWidth,s.height=e.clientHeight,s.x=s.left,s.y=s.top,s}function Be(e,t,s){return t===wr?Te(z(e,s)):Et(t)?xe(t,s):Te(Y(ut(e)))}function Le(e){var t=fr(Lr(e)),s=["absolute","fixed"].indexOf(xt(e).position)>=0,l=s&&ht(e)?Nt(e):e;return Et(l)?t.filter(function(u){return Et(u)&&ae(u,l)&&$t(u)!=="body"}):[]}function ze(e,t,s,l){var u=t==="clippingParents"?Le(e):[].concat(t),p=[].concat(u,[s]),y=p[0],h=p.reduce(function(g,E){var T=Be(e,E,l);return g.top=It(T.top,g.top),g.right=xr(T.right,g.right),g.bottom=xr(T.bottom,g.bottom),g.left=It(T.left,g.left),g},Be(e,y,l));return h.width=h.right-h.left,h.height=h.bottom-h.top,h.x=h.left,h.y=h.top,h}function nt(){return{top:0,right:0,bottom:0,left:0}}function je(e){return Object.assign({},nt(),e)}function st(e,t){return t.reduce(function(s,l){return s[l]=e,s},{})}function vt(e,t){t===void 0&&(t={});var s=t,l=s.placement,u=l===void 0?e.placement:l,p=s.strategy,y=p===void 0?e.strategy:p,h=s.boundary,g=h===void 0?Ha:h,E=s.rootBoundary,T=E===void 0?wr:E,$=s.elementContext,B=$===void 0?Tr:$,k=s.altBoundary,ve=k===void 0?!1:k,V=s.padding,ne=V===void 0?0:V,le=je(typeof ne!="number"?ne:st(ne,Qr)),se=B===Tr?Ya:Tr,fe=e.rects.popper,oe=e.elements[ve?se:B],$e=ze(Et(oe)?oe:oe.contextElement||ut(e.elements.popper),g,T,y),te=pr(e.elements.reference),Se=Ia({reference:te,element:fe,strategy:"absolute",placement:u}),me=Te(Object.assign({},fe,Se)),Ce=B===Tr?me:te,We={top:$e.top-Ce.top+le.top,bottom:Ce.bottom-$e.bottom+le.bottom,left:$e.left-Ce.left+le.left,right:Ce.right-$e.right+le.right},tt=e.modifiersData.offset;if(B===Tr&&tt){var Qt=tt[u];Object.keys(We).forEach(function(ft){var Mt=[Tt,wt].indexOf(ft)>=0?1:-1,qe=[ct,wt].indexOf(ft)>=0?"y":"x";We[ft]+=Qt[qe]*Mt})}return We}function At(e,t){t===void 0&&(t={});var s=t,l=s.placement,u=s.boundary,p=s.rootBoundary,y=s.padding,h=s.flipVariations,g=s.allowedAutoPlacements,E=g===void 0?fa:g,T=jt(l),$=T?h?Fa:Fa.filter(function(ve){return jt(ve)===T}):Qr,B=$.filter(function(ve){return E.indexOf(ve)>=0});B.length===0&&(B=$);var k=B.reduce(function(ve,V){return ve[V]=vt(e,{placement:V,boundary:u,rootBoundary:p,padding:y})[Rt(V)],ve},{});return Object.keys(k).sort(function(ve,V){return k[ve]-k[V]})}function Ir(e){if(Rt(e)===Sr)return[];var t=O(e);return[U(e),t,U(t)]}function Nr(e){var t=e.state,s=e.options,l=e.name;if(!t.modifiersData[l]._skip){for(var u=s.mainAxis,p=u===void 0?!0:u,y=s.altAxis,h=y===void 0?!0:y,g=s.fallbackPlacements,E=s.padding,T=s.boundary,$=s.rootBoundary,B=s.altBoundary,k=s.flipVariations,ve=k===void 0?!0:k,V=s.allowedAutoPlacements,ne=t.options.placement,le=Rt(ne),se=le===ne,fe=g||(se||!ve?[O(ne)]:Ir(ne)),oe=[ne].concat(fe).reduce(function(ba,Xr){return ba.concat(Rt(Xr)===Sr?At(t,{placement:Xr,boundary:T,rootBoundary:$,padding:E,flipVariations:ve,allowedAutoPlacements:V}):Xr)},[]),$e=t.rects.reference,te=t.rects.popper,Se=new Map,me=!0,Ce=oe[0],We=0;We<oe.length;We++){var tt=oe[We],Qt=Rt(tt),ft=jt(tt)===er,Mt=[ct,wt].indexOf(Qt)>=0,qe=Mt?"width":"height",De=vt(t,{placement:tt,boundary:T,rootBoundary:$,altBoundary:B,padding:E}),it=Mt?ft?Tt:Pt:ft?wt:ct;$e[qe]>te[qe]&&(it=O(it));var Kt=O(it),or=[];if(p&&or.push(De[Qt]<=0),h&&or.push(De[it]<=0,De[Kt]<=0),or.every(function(ba){return ba})){Ce=tt,me=!1;break}Se.set(tt,or)}if(me)for(var Zr=ve?3:1,ya=function(Xr){var Ua=oe.find(function(dn){var Jr=Se.get(dn);if(Jr)return Jr.slice(0,Xr).every(function(wn){return wn})});if(Ua)return Ce=Ua,"break"},Or=Zr;Or>0;Or--){var un=ya(Or);if(un==="break")break}t.placement!==Ce&&(t.modifiersData[l]._skip=!0,t.placement=Ce,t.reset=!0)}}const ir={name:"flip",enabled:!0,phase:"main",fn:Nr,requiresIfExists:["offset"],data:{_skip:!1}};function Ma(e){return e==="x"?"y":"x"}function N(e,t,s){return It(e,xr(t,s))}function W(e,t,s){var l=N(e,t,s);return l>s?s:l}function q(e){var t=e.state,s=e.options,l=e.name,u=s.mainAxis,p=u===void 0?!0:u,y=s.altAxis,h=y===void 0?!1:y,g=s.boundary,E=s.rootBoundary,T=s.altBoundary,$=s.padding,B=s.tether,k=B===void 0?!0:B,ve=s.tetherOffset,V=ve===void 0?0:ve,ne=vt(t,{boundary:g,rootBoundary:E,padding:$,altBoundary:T}),le=Rt(t.placement),se=jt(t.placement),fe=!se,oe=Yr(le),$e=Ma(oe),te=t.modifiersData.popperOffsets,Se=t.rects.reference,me=t.rects.popper,Ce=typeof V=="function"?V(Object.assign({},t.rects,{placement:t.placement})):V,We=typeof Ce=="number"?{mainAxis:Ce,altAxis:Ce}:Object.assign({mainAxis:0,altAxis:0},Ce),tt=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,Qt={x:0,y:0};if(te){if(p){var ft,Mt=oe==="y"?ct:Pt,qe=oe==="y"?wt:Tt,De=oe==="y"?"height":"width",it=te[oe],Kt=it+ne[Mt],or=it-ne[qe],Zr=k?-me[De]/2:0,ya=se===er?Se[De]:me[De],Or=se===er?-me[De]:-Se[De],un=t.elements.arrow,ba=k&&un?Gr(un):{width:0,height:0},Xr=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:nt(),Ua=Xr[Mt],dn=Xr[qe],Jr=N(0,Se[De],ba[De]),wn=fe?Se[De]/2-Zr-Jr-Ua-We.mainAxis:ya-Jr-Ua-We.mainAxis,wo=fe?-Se[De]/2+Zr+Jr+dn+We.mainAxis:Or+Jr+dn+We.mainAxis,Tn=t.elements.arrow&&Nt(t.elements.arrow),To=Tn?oe==="y"?Tn.clientTop||0:Tn.clientLeft||0:0,us=(ft=tt?.[oe])!=null?ft:0,Ro=it+wn-us-To,Fo=it+wo-us,ds=N(k?xr(Kt,Ro):Kt,it,k?It(or,Fo):or);te[oe]=ds,Qt[oe]=ds-it}if(h){var ps,Co=oe==="x"?ct:Pt,Ao=oe==="x"?wt:Tt,qr=te[$e],pn=$e==="y"?"height":"width",fs=qr+ne[Co],ms=qr-ne[Ao],Rn=[ct,Pt].indexOf(le)!==-1,gs=(ps=tt?.[$e])!=null?ps:0,hs=Rn?fs:qr-Se[pn]-me[pn]-gs+We.altAxis,vs=Rn?qr+Se[pn]+me[pn]-gs-We.altAxis:ms,Os=k&&Rn?W(hs,qr,vs):N(k?hs:fs,qr,k?vs:ms);te[$e]=Os,Qt[$e]=Os-qr}t.modifiersData[l]=Qt}}const C={name:"preventOverflow",enabled:!0,phase:"main",fn:q,requiresIfExists:["offset"]};var G=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,je(typeof t!="number"?t:st(t,Qr))};function Oe(e){var t,s=e.state,l=e.name,u=e.options,p=s.elements.arrow,y=s.modifiersData.popperOffsets,h=Rt(s.placement),g=Yr(h),E=[Pt,Tt].indexOf(h)>=0,T=E?"height":"width";if(!(!p||!y)){var $=G(u.padding,s),B=Gr(p),k=g==="y"?ct:Pt,ve=g==="y"?wt:Tt,V=s.rects.reference[T]+s.rects.reference[g]-y[g]-s.rects.popper[T],ne=y[g]-s.rects.reference[g],le=Nt(p),se=le?g==="y"?le.clientHeight||0:le.clientWidth||0:0,fe=V/2-ne/2,oe=$[k],$e=se-B[T]-$[ve],te=se/2-B[T]/2+fe,Se=N(oe,te,$e),me=g;s.modifiersData[l]=(t={},t[me]=Se,t.centerOffset=Se-te,t)}}function Xe(e){var t=e.state,s=e.options,l=s.element,u=l===void 0?"[data-popper-arrow]":l;u!=null&&(typeof u=="string"&&(u=t.elements.popper.querySelector(u),!u)||ae(t.elements.popper,u)&&(t.elements.arrow=u))}const ke={name:"arrow",enabled:!0,phase:"main",fn:Oe,effect:Xe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function He(e,t,s){return s===void 0&&(s={x:0,y:0}),{top:e.top-t.height-s.y,right:e.right-t.width+s.x,bottom:e.bottom-t.height+s.y,left:e.left-t.width-s.x}}function Ge(e){return[ct,Tt,wt,Pt].some(function(t){return e[t]>=0})}function ot(e){var t=e.state,s=e.name,l=t.rects.reference,u=t.rects.popper,p=t.modifiersData.preventOverflow,y=vt(t,{elementContext:"reference"}),h=vt(t,{altBoundary:!0}),g=He(y,l),E=He(h,u,p),T=Ge(g),$=Ge(E);t.modifiersData[s]={referenceClippingOffsets:g,popperEscapeOffsets:E,isReferenceHidden:T,hasPopperEscaped:$},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":T,"data-popper-escaped":$})}var vr=[ga,Na,m,i,f,ir,C,ke,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:ot}],va=Da({defaultModifiers:vr}),Xa=d(30115),gn=d.n(Xa),Do=function(t){return Array.isArray(t)?t[0]:t},ys=function(t){if(typeof t=="function"){for(var s=arguments.length,l=new Array(s>1?s-1:0),u=1;u<s;u++)l[u-1]=arguments[u];return t.apply(void 0,l)}},Io=function(t,s){if(typeof t=="function")return ys(t,s);t!=null&&(t.current=s)},Fn=function(t){return t.reduce(function(s,l){var u=l[0],p=l[1];return s[u]=p,s},{})},Cn=typeof window<"u"&&window.document&&window.document.createElement?r.useLayoutEffect:r.useEffect,bs=[],Es=function(t,s,l){l===void 0&&(l={});var u=r.useRef(null),p={onFirstUpdate:l.onFirstUpdate,placement:l.placement||"bottom",strategy:l.strategy||"absolute",modifiers:l.modifiers||bs},y=r.useState({styles:{popper:{position:p.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),h=y[0],g=y[1],E=r.useMemo(function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(k){var ve=k.state,V=Object.keys(ve.elements);ia.flushSync(function(){g({styles:Fn(V.map(function(ne){return[ne,ve.styles[ne]||{}]})),attributes:Fn(V.map(function(ne){return[ne,ve.attributes[ne]]}))})})},requires:["computeStyles"]}},[]),T=r.useMemo(function(){var B={onFirstUpdate:p.onFirstUpdate,placement:p.placement,strategy:p.strategy,modifiers:[].concat(p.modifiers,[E,{name:"applyStyles",enabled:!1}])};return gn()(u.current,B)?u.current||B:(u.current=B,B)},[p.onFirstUpdate,p.placement,p.strategy,p.modifiers,E]),$=r.useRef();return Cn(function(){$.current&&$.current.setOptions(T)},[T]),Cn(function(){if(!(t==null||s==null)){var B=l.createPopper||va,k=B(t,s,T);return $.current=k,function(){k.destroy(),$.current=null}}},[t,s,l.createPopper]),{state:$.current?$.current.state:null,styles:h.styles,attributes:h.attributes,update:$.current?$.current.update:null,forceUpdate:$.current?$.current.forceUpdate:null}};function An(e){var t=r.useRef(e);return t.current=e,r.useCallback(function(){return t.current},[])}var xs=function(){};function Ps(e){var t=e.initial,s=e.value,l=e.onChange,u=l===void 0?xs:l;if(t===void 0&&s===void 0)throw new TypeError('Either "value" or "initial" variable must be set. Now both are undefined');var p=r.useState(t),y=p[0],h=p[1],g=An(y),E=r.useCallback(function($){var B=g(),k=typeof $=="function"?$(B):$;typeof k.persist=="function"&&k.persist(),h(k),typeof u=="function"&&u(k)},[g,u]),T=s!==void 0;return[T?s:y,T?u:E]}function Dn(e,t){return e===void 0&&(e=0),t===void 0&&(t=0),function(){return{width:0,height:0,top:t,right:e,bottom:t,left:e,x:0,y:0,toJSON:function(){return null}}}}var Ls=["styles","attributes"],In={getBoundingClientRect:Dn()},Nn={closeOnOutsideClick:!0,closeOnTriggerHidden:!1,defaultVisible:!1,delayHide:0,delayShow:0,followCursor:!1,interactive:!1,mutationObserverOptions:{attributes:!0,childList:!0,subtree:!0},offset:[0,6],trigger:"hover"};function Ss(e,t){var s,l,u;e===void 0&&(e={}),t===void 0&&(t={});var p=Object.keys(Nn).reduce(function(qe,De){var it;return St({},qe,(it={},it[De]=qe[De]!==void 0?qe[De]:Nn[De],it))},e),y=r.useMemo(function(){return[{name:"offset",options:{offset:p.offset}}]},Array.isArray(p.offset)?p.offset:[]),h=St({},t,{placement:t.placement||p.placement,modifiers:t.modifiers||y}),g=r.useState(null),E=g[0],T=g[1],$=r.useState(null),B=$[0],k=$[1],ve=Ps({initial:p.defaultVisible,value:p.visible,onChange:p.onVisibleChange}),V=ve[0],ne=ve[1],le=r.useRef();r.useEffect(function(){return function(){return clearTimeout(le.current)}},[]);var se=Es(p.followCursor?In:E,B,h),fe=se.styles,oe=se.attributes,$e=_t(se,Ls),te=$e.update,Se=An({visible:V,triggerRef:E,tooltipRef:B,finalConfig:p}),me=r.useCallback(function(qe){return Array.isArray(p.trigger)?p.trigger.includes(qe):p.trigger===qe},Array.isArray(p.trigger)?p.trigger:[p.trigger]),Ce=r.useCallback(function(){clearTimeout(le.current),le.current=window.setTimeout(function(){return ne(!1)},p.delayHide)},[p.delayHide,ne]),We=r.useCallback(function(){clearTimeout(le.current),le.current=window.setTimeout(function(){return ne(!0)},p.delayShow)},[p.delayShow,ne]),tt=r.useCallback(function(){Se().visible?Ce():We()},[Se,Ce,We]);r.useEffect(function(){if(Se().finalConfig.closeOnOutsideClick){var qe=function(it){var Kt,or=Se(),Zr=or.tooltipRef,ya=or.triggerRef,Or=(it.composedPath==null||(Kt=it.composedPath())==null?void 0:Kt[0])||it.target;Or instanceof Node&&Zr!=null&&ya!=null&&!Zr.contains(Or)&&!ya.contains(Or)&&Ce()};return document.addEventListener("mousedown",qe),function(){return document.removeEventListener("mousedown",qe)}}},[Se,Ce]),r.useEffect(function(){if(!(E==null||!me("click")))return E.addEventListener("click",tt),function(){return E.removeEventListener("click",tt)}},[E,me,tt]),r.useEffect(function(){if(!(E==null||!me("double-click")))return E.addEventListener("dblclick",tt),function(){return E.removeEventListener("dblclick",tt)}},[E,me,tt]),r.useEffect(function(){if(!(E==null||!me("right-click"))){var qe=function(it){it.preventDefault(),tt()};return E.addEventListener("contextmenu",qe),function(){return E.removeEventListener("contextmenu",qe)}}},[E,me,tt]),r.useEffect(function(){if(!(E==null||!me("focus")))return E.addEventListener("focus",We),E.addEventListener("blur",Ce),function(){E.removeEventListener("focus",We),E.removeEventListener("blur",Ce)}},[E,me,We,Ce]),r.useEffect(function(){if(!(E==null||!me("hover")))return E.addEventListener("mouseenter",We),E.addEventListener("mouseleave",Ce),function(){E.removeEventListener("mouseenter",We),E.removeEventListener("mouseleave",Ce)}},[E,me,We,Ce]),r.useEffect(function(){if(!(B==null||!me("hover")||!Se().finalConfig.interactive))return B.addEventListener("mouseenter",We),B.addEventListener("mouseleave",Ce),function(){B.removeEventListener("mouseenter",We),B.removeEventListener("mouseleave",Ce)}},[B,me,We,Ce,Se]);var Qt=$e==null||(s=$e.state)==null||(l=s.modifiersData)==null||(u=l.hide)==null?void 0:u.isReferenceHidden;r.useEffect(function(){p.closeOnTriggerHidden&&Qt&&Ce()},[p.closeOnTriggerHidden,Ce,Qt]),r.useEffect(function(){if(!p.followCursor||E==null)return;function qe(De){var it=De.clientX,Kt=De.clientY;In.getBoundingClientRect=Dn(it,Kt),te?.()}return E.addEventListener("mousemove",qe),function(){return E.removeEventListener("mousemove",qe)}},[p.followCursor,E,te]),r.useEffect(function(){if(!(B==null||te==null||p.mutationObserverOptions==null)){var qe=new MutationObserver(te);return qe.observe(B,p.mutationObserverOptions),function(){return qe.disconnect()}}},[p.mutationObserverOptions,B,te]);var ft=function(De){return De===void 0&&(De={}),St({},De,{style:St({},De.style,fe.popper)},oe.popper,{"data-popper-interactive":p.interactive})},Mt=function(De){return De===void 0&&(De={}),St({},De,oe.arrow,{style:St({},De.style,fe.arrow),"data-popper-arrow":!0})};return St({getArrowProps:Mt,getTooltipProps:ft,setTooltipRef:k,setTriggerRef:T,tooltipRef:B,triggerRef:E,visible:V},$e)}var Qs=d(17464),$s=Object.defineProperty,ws=Object.defineProperties,Ts=Object.getOwnPropertyDescriptors,Mn=Object.getOwnPropertySymbols,Rs=Object.prototype.hasOwnProperty,Fs=Object.prototype.propertyIsEnumerable,Xn=(e,t,s)=>t in e?$s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Cs=(e,t)=>{for(var s in t||(t={}))Rs.call(t,s)&&Xn(e,s,t[s]);if(Mn)for(var s of Mn(t))Fs.call(t,s)&&Xn(e,s,t[s]);return e},As=(e,t)=>ws(e,Ts(t));const kn=r.memo(({definition:e,operation:t,innerQueryPlaceholder:s})=>{const l=(0,re.of)(Ds),[u,p]=(0,r.useState)(!1),{getTooltipProps:y,setTooltipRef:h,setTriggerRef:g,visible:E}=Ss({placement:"top",visible:u,offset:[0,16],onVisibleChange:p,interactive:!0,trigger:["click"]});return r.createElement(r.Fragment,null,r.createElement(ee.$n,{title:"Click to show description",ref:g,icon:"info-circle",size:"sm",variant:"secondary",fill:"text"}),E&&r.createElement(Qs.ZL,null,r.createElement("div",As(Cs({ref:h},y()),{className:l.docBox}),r.createElement("div",{className:l.docBoxHeader},r.createElement("span",null,e.renderer(t,e,s)),r.createElement(K.Z,{grow:1}),r.createElement(ee.$n,{icon:"times",onClick:()=>p(!1),fill:"text",variant:"secondary",title:"Remove operation"})),r.createElement("div",{className:l.docBoxBody,dangerouslySetInnerHTML:{__html:Is(e,t)}}))))});kn.displayName="OperationDocs";const Ds=e=>({docBox:(0,L.css)({overflow:"hidden",background:e.colors.background.primary,border:`1px solid ${e.colors.border.strong}`,boxShadow:e.shadows.z3,maxWidth:"600px",padding:e.spacing(1),borderRadius:e.shape.radius.default,zIndex:e.zIndex.tooltip}),docBoxHeader:(0,L.css)({fontSize:e.typography.h5.fontSize,fontFamily:e.typography.fontFamilyMonospace,paddingBottom:e.spacing(1),display:"flex",alignItems:"center"}),docBoxBody:(0,L.css)({marginBottom:e.spacing(-1),color:e.colors.text.secondary}),signature:(0,L.css)({fontSize:e.typography.bodySmall.fontSize,fontFamily:e.typography.fontFamilyMonospace}),dropdown:(0,L.css)({opacity:0,color:e.colors.text.secondary})});function Is(e,t){var s;return(0,_r.G)(e.explainHandler?e.explainHandler(t,e):(s=e.documentation)!=null?s:"no docs")}var Ns=Object.defineProperty,Ms=Object.defineProperties,Xs=Object.getOwnPropertyDescriptors,Un=Object.getOwnPropertySymbols,ks=Object.prototype.hasOwnProperty,Us=Object.prototype.propertyIsEnumerable,Bn=(e,t,s)=>t in e?Ns(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,hn=(e,t)=>{for(var s in t||(t={}))ks.call(t,s)&&Bn(e,s,t[s]);if(Un)for(var s of Un(t))Us.call(t,s)&&Bn(e,s,t[s]);return e},Wn=(e,t)=>Ms(e,Xs(t));const Vn=r.memo(({operation:e,definition:t,index:s,onChange:l,onRemove:u,queryModeller:p,dragHandleProps:y})=>{var h;const g=(0,re.of)(Bs),[E,T]=(0,r.useState)({}),$=()=>{if(E.isOpen)T(Wn(hn({},E),{isOpen:!1}));else{const B=p.getAlternativeOperations(t.alternativesKey).map(k=>({label:k.name,value:k}));T({isOpen:!0,alternatives:B})}};return r.createElement("div",{className:g.header},!E.isOpen&&r.createElement(r.Fragment,null,r.createElement("div",hn({},y),(h=t.name)!=null?h:t.id),r.createElement(K.Z,{grow:1}),r.createElement("div",{className:`${g.operationHeaderButtons} operation-header-show-on-hover`},r.createElement(ee.$n,{icon:"angle-down",size:"sm",onClick:$,fill:"text",variant:"secondary",title:"Click to view alternative operations"}),r.createElement(kn,{definition:t,operation:e,innerQueryPlaceholder:p.innerQueryPlaceholder}),r.createElement(ee.$n,{icon:"times",size:"sm",onClick:()=>u(s),fill:"text",variant:"secondary",title:"Remove operation"}))),E.isOpen&&r.createElement("div",{className:g.selectWrapper},r.createElement(kt.l6,{autoFocus:!0,openMenuOnFocus:!0,placeholder:"Replace with",options:E.alternatives,isOpen:!0,onCloseMenu:$,onChange:B=>{if(B.value){const k=p.getOperationDefinition(B.value.id),ve=[...k.defaultParams];for(let ne=0;ne<Math.min(e.params.length,ve.length);ne++)k.params[ne].type===t.params[ne].type&&(ve[ne]=e.params[ne]);const V=Wn(hn({},e),{params:ve,id:B.value.id});l(s,t.changeTypeHandler?t.changeTypeHandler(V,k):V)}}})))});Vn.displayName="OperationHeader";const Bs=e=>({header:(0,L.css)({borderBottom:`1px solid ${e.colors.border.medium}`,padding:e.spacing(.5,.5,.5,1),display:"flex",alignItems:"center"}),operationHeaderButtons:(0,L.css)({opacity:1}),selectWrapper:(0,L.css)({paddingRight:e.spacing(2)})});var Oa=d(51440),Ws=d(10880);function Vs(e){if(e.editor)return e.editor;if(e.options)return zs;switch(e.type){case"boolean":return _s;case"number":case"string":default:return js}}function js(e){var t;return r.createElement(Oa.D,{id:an(e.operationId,e.index),defaultValue:(t=e.value)==null?void 0:t.toString(),minWidth:e.paramDef.minWidth,placeholder:e.paramDef.placeholder,title:e.paramDef.description,maxWidth:(e.paramDef.minWidth||20)*3,onCommitChange:s=>{e.onChange(e.index,s.currentTarget.value),e.paramDef.runQueryOnEnter&&s.type==="keydown"&&e.onRunQuery()}})}function _s(e){return r.createElement(Ws.S,{id:an(e.operationId,e.index),value:!!e.value,onChange:t=>e.onChange(e.index,t.currentTarget.checked)})}function zs({paramDef:e,value:t,index:s,operationId:l,onChange:u}){var p,y;const h=(0,re.of)(Ks);let g=e.options;(p=g[0])!=null&&p.label||(g=e.options.map(T=>({label:T.toString(),value:T})));let E=(y=g.find(T=>T.value===t))!=null?y:(0,Zt.z)(t);return!t&&e.optional?r.createElement("div",{className:h.optionalParam},r.createElement(ee.$n,{size:"sm",variant:"secondary",title:`Add ${e.name}`,icon:"plus",onClick:()=>u(s,g[0].value)},e.name)):r.createElement(Pe.B,{gap:.5,direction:"row",alignItems:"center"},r.createElement(kt.l6,{id:an(l,s),value:E,options:g,placeholder:e.placeholder,allowCustomValue:!0,onChange:T=>u(s,T.value),width:e.minWidth||"auto"}),e.optional&&r.createElement(ee.$n,{"data-testid":`operations.${s}.remove-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${e.name}`,onClick:()=>u(s,"")}))}const Ks=e=>({optionalParam:(0,L.css)({marginTop:e.spacing(1)})});function an(e,t){return`operations.${e}.param.${t}`}var Gs=Object.defineProperty,Hs=Object.defineProperties,Ys=Object.getOwnPropertyDescriptors,jn=Object.getOwnPropertySymbols,Zs=Object.prototype.hasOwnProperty,Js=Object.prototype.propertyIsEnumerable,_n=(e,t,s)=>t in e?Gs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,nn=(e,t)=>{for(var s in t||(t={}))Zs.call(t,s)&&_n(e,s,t[s]);if(jn)for(var s of jn(t))Js.call(t,s)&&_n(e,s,t[s]);return e},sn=(e,t)=>Hs(e,Ys(t));function qs({provided:e,flash:t,isConflicting:s,highlight:l,index:u,queryModeller:p,onChange:y,onRemove:h,operation:g,definition:E,query:T,timeRange:$,onRunQuery:B,datasource:k}){const ve=(0,re.$j)(),V=ei(ve,s),ne=ti(t),{current:le}=(0,r.useRef)((0,Sa.A)()),se=(te,Se)=>{const me=sn(nn({},g),{params:[...g.params]});me.params[te]=Se,vn(E,me,u,te,y)},fe=()=>{const te=sn(nn({},g),{params:[...g.params,""]});vn(E,te,u,g.params.length,y)},oe=te=>{const Se=sn(nn({},g),{params:[...g.params.slice(0,te),...g.params.slice(te+1)]});vn(E,Se,u,te,y)};let $e;if(E.params.length>0){const te=E.params[E.params.length-1];te.restParam&&($e=ri(te,fe,u,g.params.length,V))}return r.createElement("div",sn(nn({className:(0,L.cx)(V.card,(ne||l)&&V.cardHighlight,s&&V.cardError),ref:e.innerRef},e.draggableProps),{"data-testid":`operations.${u}.wrapper`}),r.createElement(Vn,{operation:g,dragHandleProps:e.dragHandleProps,definition:E,index:u,onChange:y,onRemove:h,queryModeller:p}),r.createElement("div",{className:V.body},g.params.map((te,Se)=>{const me=E.params[Math.min(E.params.length-1,Se)],Ce=Vs(me);return r.createElement("div",{className:V.paramRow,key:`${Se}-1`},!me.hideName&&r.createElement("div",{className:V.paramName},r.createElement("label",{htmlFor:an(le,Se)},me.name),me.description&&r.createElement(dr.m,{placement:"top",content:me.description,theme:"info"},r.createElement(Dt.I,{name:"info-circle",size:"sm",className:V.infoIcon}))),r.createElement("div",{className:V.paramValue},r.createElement(Pe.B,{gap:.5,direction:"row",alignItems:"center",wrap:!1},r.createElement(Ce,{index:Se,paramDef:me,value:g.params[Se],operation:g,operationId:le,onChange:se,onRunQuery:B,query:T,datasource:k,timeRange:$,queryModeller:p}),me.restParam&&(g.params.length>E.params.length||me.optional)&&r.createElement(ee.$n,{"data-testid":`operations.${u}.remove-rest-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${me.name}`,onClick:()=>oe(Se)}))))})),$e,u<T.operations.length-1&&r.createElement("div",{className:V.arrow},r.createElement("div",{className:V.arrowLine}),r.createElement("div",{className:V.arrowArrow})))}const ei=(e,t)=>({cardWrapper:(0,L.css)({alignItems:"stretch"}),error:(0,L.css)({marginBottom:e.spacing(1)}),card:(0,L.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.medium}`,cursor:"grab",borderRadius:e.shape.radius.default,position:"relative",transition:"all 0.5s ease-in 0s",height:t?"auto":"100%"}),cardError:(0,L.css)({boxShadow:`0px 0px 4px 0px ${e.colors.warning.main}`,border:`1px solid ${e.colors.warning.main}`}),cardHighlight:(0,L.css)({boxShadow:`0px 0px 4px 0px ${e.colors.primary.border}`,border:`1px solid ${e.colors.primary.border}`}),infoIcon:(0,L.css)({marginLeft:e.spacing(.5),color:e.colors.text.secondary,":hover":{color:e.colors.text.primary}}),body:(0,L.css)({margin:e.spacing(1,1,.5,1),display:"table"}),paramRow:(0,L.css)({label:"paramRow",display:"table-row",verticalAlign:"middle"}),paramName:(0,L.css)({display:"table-cell",padding:e.spacing(0,1,0,0),fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,verticalAlign:"middle",height:"32px"}),paramValue:(0,L.css)({label:"paramValue",display:"table-cell",verticalAlign:"middle"}),restParam:(0,L.css)({padding:e.spacing(0,1,1,1)}),arrow:(0,L.css)({position:"absolute",top:"0",right:"-18px",display:"flex"}),arrowLine:(0,L.css)({height:"2px",width:"8px",backgroundColor:e.colors.border.strong,position:"relative",top:"14px"}),arrowArrow:(0,L.css)({width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:`7px solid ${e.colors.border.strong}`,position:"relative",top:"10px"})});function ti(e){const[t,s]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let l;return e?l=setTimeout(()=>{s(!1)},1e3):s(!0),()=>clearTimeout(l)},[e]),t&&e}function vn(e,t,s,l,u){e.paramChangedHandler?u(s,e.paramChangedHandler(l,t,e)):u(s,t)}function ri(e,t,s,l,u){return r.createElement("div",{className:u.restParam,key:`${l}-2`},r.createElement(ee.$n,{size:"sm",icon:"plus",title:`Add ${e.name}`.trimEnd(),variant:"secondary",onClick:t,"data-testid":`operations.${s}.add-rest-param`},e.name))}function ai({operation:e,index:t,onRemove:s,onChange:l,onRunQuery:u,queryModeller:p,query:y,datasource:h,flash:g,highlight:E,timeRange:T,isConflictingOperation:$}){const B=p.getOperationDefinition(e.id),k=(0,re.$j)(),ve=$?$(e,y.operations):!1,V=ni(k);if(!B)return r.createElement("span",null,"Operation ",e.id," not found");const ne=le=>{if(!le)return ve?!0:void 0};return r.createElement(Je.sx,{draggableId:`operation-${t}`,index:t},(le,se)=>r.createElement(lt.I,{error:"You have conflicting label filters",invalid:ne(se.isDragging),className:(0,L.cx)(V.error,V.cardWrapper)},r.createElement(qs,{provided:le,flash:g,highlight:E,isConflicting:ve,index:t,operation:e,definition:B,onChange:l,onRemove:s,queryModeller:p,query:y,timeRange:T,onRunQuery:u,datasource:h})))}const ni=(e,t)=>({cardWrapper:(0,L.css)({alignItems:"stretch"}),error:(0,L.css)({marginBottom:e.spacing(1)})});var si=Object.defineProperty,ii=Object.defineProperties,oi=Object.getOwnPropertyDescriptors,zn=Object.getOwnPropertySymbols,li=Object.prototype.hasOwnProperty,ci=Object.prototype.propertyIsEnumerable,Kn=(e,t,s)=>t in e?si(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,on=(e,t)=>{for(var s in t||(t={}))li.call(t,s)&&Kn(e,s,t[s]);if(zn)for(var s of zn(t))ci.call(t,s)&&Kn(e,s,t[s]);return e},On=(e,t)=>ii(e,oi(t));function ui({query:e,datasource:t,queryModeller:s,onChange:l,onRunQuery:u,highlightedOp:p,timeRange:y,isConflictingOperation:h}){const g=(0,re.of)(fi),{operations:E}=e,T=di(E),[$,B]=(0,r.useState)(!1),k=(fe,oe)=>{const $e=[...E];$e.splice(fe,1,oe),l(On(on({},e),{operations:$e}))},ve=fe=>{const oe=[...E.slice(0,fe),...E.slice(fe+1)];l(On(on({},e),{operations:oe}))},V=s.getCategories().map(fe=>({value:fe,label:fe,items:s.getOperationsForCategory(fe).map(oe=>({value:oe.id,label:oe.name,isLeaf:!0}))})),ne=fe=>{const oe=s.getOperationDefinition(fe);oe&&(l(oe.addOperationHandler(oe,e,s)),B(!1))},le=fe=>{if(!fe.destination)return;const oe=[...E],$e=oe[fe.source.index];oe.splice(fe.source.index,1),oe.splice(fe.destination.index,0,$e),l(On(on({},e),{operations:oe}))},se=()=>{B(!1)};return r.createElement(Pe.B,{gap:1,direction:"column"},r.createElement(Pe.B,{gap:1},E.length>0&&r.createElement(Je.JY,{onDragEnd:le},r.createElement(Je.gL,{droppableId:"sortable-field-mappings",direction:"horizontal"},fe=>r.createElement("div",on({className:g.operationList,ref:fe.innerRef},fe.droppableProps),E.map((oe,$e)=>r.createElement(ai,{key:oe.id+JSON.stringify(oe.params)+$e,queryModeller:s,index:$e,operation:oe,query:e,datasource:t,onChange:k,onRemove:ve,onRunQuery:u,flash:T[$e],highlight:p===oe,timeRange:y,isConflictingOperation:h})),fe.placeholder))),r.createElement("div",{className:g.addButton},$?r.createElement(Ga.v,{options:V,onSelect:ne,onBlur:se,autoFocus:!0,alwaysOpen:!0,hideActiveLevelLabel:!0,placeholder:"Search"}):r.createElement(ee.$n,{icon:"plus",variant:"secondary",onClick:()=>B(!0),title:"Add operation"},"Operations"))))}function di(e){const t=(0,qt.A)(),s=(0,S.A)(e);if(!t())return e.map(()=>!1);if(!s)return e.map(()=>!0);let l=[];if(s.length-1===e.length&&e.every(u=>s.includes(u)))return e.map(()=>!1);if(s.length+1===e.length&&s.every(u=>e.includes(u))){const u=e.find(p=>!s.includes(p));l=e.map(p=>p===u)}else l=e.map((u,p)=>{var y;return!pi(u.id,(y=s[p])==null?void 0:y.id)});return l}function pi(e,t){return e===t||`__${e}_by`===t||e===`__${t}_by`}const fi=e=>({heading:(0,L.css)({label:"heading",fontSize:12,fontWeight:e.typography.fontWeightMedium,marginBottom:0}),operationList:(0,L.css)({label:"operationList",display:"flex",flexWrap:"wrap",gap:e.spacing(2)}),addButton:(0,L.css)({label:"addButton",width:126,paddingBottom:e.spacing(1)})}),Gn=({datasource:e,query:t,onChange:s,data:l,queryModeller:u,buildVisualQueryFromString:p,buildDataQueryFromQueryString:y,buildQueryStringFromDataQuery:h})=>{const[g,E]=(0,r.useState)([]),T=(0,re.of)(mi);return(0,r.useEffect)(()=>{var $;const B=y(u.renderQuery(t)),k=($=e.getQueryHints)==null?void 0:$.call(e,B,l?.series||[]).filter(ve=>{var V;return(V=ve.fix)==null?void 0:V.action});E(k??[])},[e,t,l,u,y]),r.createElement(r.Fragment,null,g.length>0&&r.createElement("div",{className:T.container},g.map($=>{var B,k,ve,V;return r.createElement(dr.m,{content:`${$.label} ${(B=$.fix)==null?void 0:B.label}`,key:$.type},r.createElement(ee.$n,{onClick:()=>{var ne,le,se;if((0,ye.rR)("grafana_query_builder_hints_clicked",{hint:$.type,datasourceType:e.type}),(ne=$?.fix)!=null&&ne.action){const fe=y(u.renderQuery(t)),oe=(le=e.modifyQuery)==null?void 0:le.call(e,fe,$.fix.action);if(oe){const $e=p((se=h(oe))!=null?se:"");return s($e.query)}}},fill:"outline",size:"sm",className:T.hint},"hint: ",((k=$.fix)==null?void 0:k.title)||((V=(ve=$.fix)==null?void 0:ve.action)==null?void 0:V.type.toLowerCase().replace("_"," "))))})))};Gn.displayName="QueryBuilderHints";const mi=e=>({container:(0,L.css)`
      display: flex;
      align-items: start;
    `,hint:(0,L.css)`
      margin-right: ${e.spacing(1)};
    `});function Hn({query:e,queryModeller:t,stepNumber:s,language:l,onMouseEnter:u,onMouseLeave:p}){return r.createElement(r.Fragment,null,e.operations.map((y,h)=>{var g;const E=t.getOperationDefinition(y.id);if(!E)return`Operation ${y.id} not found`;const T=E.renderer(y,E,t.innerQueryPlaceholder),$=E.explainHandler?E.explainHandler(y,E):(g=E.documentation)!=null?g:"no docs";return r.createElement("div",{key:h,onMouseEnter:()=>u?.(y,h),onMouseLeave:()=>p?.(y,h)},r.createElement(zr,{stepNumber:h+s,title:r.createElement(Jt.Z,{query:T,language:l}),markdown:$}))}))}var ln=d(71713),gi=d(11216),yn=d(54623);const Yn="Fetch all log lines matching label filters.",Zn=r.memo(({query:e})=>{const t=(0,Ht.u_)(e||"").query,s={grammar:ln.vB,name:"lokiql"};return r.createElement(de.B,{gap:0,direction:"column"},r.createElement(zr,{stepNumber:1,title:r.createElement(Jt.Z,{query:`${pt.y.renderLabels(t.labels)}`,language:s})},Yn),r.createElement(Hn,{stepNumber:2,queryModeller:pt.y,query:t,language:s}))});Zn.displayName="LokiQueryBuilderExplained";var Jn=d(29158),hi=d(58592);const qn=r.memo(({nestedQuery:e,index:t,datasource:s,onChange:l,onRemove:u,onRunQuery:p,showExplain:y})=>{const h=(0,re.of)(Oi);return r.createElement("div",{className:h.card},r.createElement("div",{className:h.header},r.createElement("div",{className:h.name},"Operator"),r.createElement(kt.l6,{"aria-label":"Select operator",width:"auto",options:vi,value:(0,Zt.z)(e.operator),onChange:g=>{l(t,{...e,operator:g.value})}}),r.createElement("div",{className:h.name},"Vector matches"),r.createElement("div",{className:h.vectorMatchWrapper},r.createElement(kt.l6,{width:"auto",value:e.vectorMatchesType||"on",allowCustomValue:!0,options:[{value:"on",label:"on"},{value:"ignoring",label:"ignoring"}],onChange:g=>{l(t,{...e,vectorMatchesType:g.value})}}),r.createElement(Oa.D,{className:h.vectorMatchInput,minWidth:20,defaultValue:e.vectorMatches,onCommitChange:g=>{l(t,{...e,vectorMatches:g.currentTarget.value,vectorMatchesType:e.vectorMatchesType||"on"})}})),r.createElement(K.Z,{grow:1}),r.createElement(Jn.K,{name:"times",size:"sm",onClick:()=>u(t),tooltip:"Remove nested query"})),r.createElement("div",{className:h.body},r.createElement(P.D,null,r.createElement(bn,{showExplain:y,query:e.query,datasource:s,onRunQuery:p,onChange:g=>{l(t,{...e,query:g})}}))))}),vi=hi.C.map(e=>({label:e.sign,value:e.sign}));qn.displayName="NestedQuery";const Oi=e=>({card:(0,L.css)({label:"card",display:"flex",flexDirection:"column",gap:e.spacing(.5)}),header:(0,L.css)({label:"header",padding:e.spacing(.5,.5,.5,1),gap:e.spacing(1),display:"flex",alignItems:"center"}),name:(0,L.css)({label:"name",whiteSpace:"nowrap"}),body:(0,L.css)({label:"body",paddingLeft:e.spacing(2)}),vectorMatchInput:(0,L.css)({label:"vectorMatchInput",marginLeft:-1}),vectorMatchWrapper:(0,L.css)({label:"vectorMatchWrapper",display:"flex"})});function yi({query:e,datasource:t,onChange:s,onRunQuery:l,showExplain:u}){const p=e.binaryQueries??[],y=(g,E)=>{const T=[...p];T.splice(g,1,E),s({...e,binaryQueries:T})},h=g=>{const E=[...p.slice(0,g),...p.slice(g+1)];s({...e,binaryQueries:E})};return r.createElement(de.B,{direction:"column",gap:1},p.map((g,E)=>r.createElement(qn,{key:E.toString(),nestedQuery:g,index:E,onChange:y,datasource:t,onRemove:h,onRunQuery:l,showExplain:u})))}const es=5*60*1e3,bn=r.memo(({datasource:e,query:t,onChange:s,onRunQuery:l,showExplain:u,timeRange:p})=>{const[y,h]=(0,r.useState)(),[g,E]=(0,r.useState)(void 0),T=(0,S.A)(t),$=(0,S.A)(p),B=se=>{s({...t,labels:se})},k=async se=>{const fe=await se;return[...e.getVariables(),...fe].map(oe=>({label:oe,value:oe}))},ve=async se=>{const fe=t.labels.filter(Ce=>Ce!==se),oe=fe.find(Ce=>Ce.op==="="||Ce.op==="=~"&&new RegExp(Ce.value).test("")===!1);if(fe.length===0||!oe)return await e.languageProvider.fetchLabels({timeRange:p});const $e=pt.y.renderLabels(fe),te=await e.languageProvider.fetchSeriesLabels($e,{timeRange:p}),Se=fe.map(Ce=>Ce.label);return Object.keys(te).filter(Ce=>!Se.includes(Ce)).sort()},V=async se=>{if(!se.label)return[];let fe;const oe=t.labels.filter(te=>te!==se),$e=oe.find(te=>te.op==="="||te.op==="=~"&&new RegExp(te.value).test("")===!1);if(oe.length===0||!$e)fe=await e.languageProvider.fetchLabelValues(se.label,{timeRange:p});else{const te=pt.y.renderLabels(oe);fe=(await e.languageProvider.fetchSeriesLabels(te,{timeRange:p}))[e.interpolateString(se.label)]}return fe?fe.map(te=>(0,j.Bb)(te,se.op)):[]},ne=(0,r.useMemo)(()=>{const{labels:se,operations:fe}=t;return!se.length&&fe.length?!(fe.length===1&&fe[0].id===yn.EF.LineContains&&fe[0].params[0]===""):!1},[t]);(0,r.useEffect)(()=>{const se=async()=>{const $e={expr:pt.y.renderQuery(t),refId:"data-samples"},te=p??(0,fn.E2)(),me={series:await e.getDataSamples($e,te),state:Ke.Gu.Done,timeRange:te};h(me)},fe=$&&p&&(Math.abs(p.to.valueOf()-$.to.valueOf())>es||Math.abs(p.from.valueOf()-$.from.valueOf())>es),oe=!(0,A.isEqual)(T,t);b.$.featureToggles.lokiQueryHints&&(fe||oe)&&se().catch(console.error)},[e,t,p,T,$]);const le={grammar:ln.Ay,name:"logql"};return r.createElement("div",{"data-testid":Pn.editor},r.createElement(Pa.U,null,r.createElement(Bt,{onGetLabelNames:se=>k(ve(se)),onGetLabelValues:se=>k(V(se)),labelsFilters:t.labels,onChange:B,labelFilterRequired:ne})),u&&r.createElement(zr,{stepNumber:1,title:r.createElement(Jt.Z,{query:`${pt.y.renderLabels(t.labels)}`,language:le})},Yn),r.createElement(sa,null,r.createElement(ui,{queryModeller:pt.y,query:t,onChange:s,onRunQuery:l,datasource:e,highlightedOp:g,isConflictingOperation:(se,fe)=>se.id===yn.EF.LabelFilter&&(0,gi.hh)(se,fe)}),r.createElement(Gn,{datasource:e,query:t,onChange:s,data:y,queryModeller:pt.y,buildVisualQueryFromString:Ht.u_,buildDataQueryFromQueryString:se=>({expr:se,refId:"hints"}),buildQueryStringFromDataQuery:se=>se.expr})),u&&r.createElement(Hn,{stepNumber:2,queryModeller:pt.y,query:t,language:le,onMouseEnter:se=>{E(se)},onMouseLeave:()=>{E(void 0)}}),t.binaryQueries&&t.binaryQueries.length>0&&r.createElement(yi,{query:t,datasource:e,onChange:s,onRunQuery:l,showExplain:u}))});bn.displayName="LokiQueryBuilder";function bi({query:e}){return r.createElement(Pa.U,null,r.createElement(La.B,null,r.createElement(Jt.Z,{query:e,language:{grammar:ln.vB,name:"lokiql"}})))}function Ei(e){const{query:t,onChange:s,onRunQuery:l,datasource:u,showExplain:p,timeRange:y}=e,[h,g]=(0,r.useReducer)(ts.reducer,{expr:t.expr,visQuery:t.expr===""?{labels:[],operations:[{id:"__line_contains",params:[""]}]}:void 0});(0,r.useEffect)(()=>{g(Li(t.expr))},[t.expr]);const E=T=>{const $=pt.y.renderQuery(T);g(Pi({visQuery:T,expr:$})),s({...e.query,expr:$})};return h.visQuery?r.createElement(r.Fragment,null,r.createElement(bn,{query:h.visQuery,datasource:u,onChange:E,onRunQuery:l,showExplain:p,"data-testid":Pn.editor,timeRange:y}),t.expr!==""&&r.createElement(bi,{query:t.expr})):null}const xi={expr:""},ts=(0,ja.Z0)({name:"loki-builder-container",initialState:xi,reducers:{visualQueryChange:(e,t)=>{e.expr=t.payload.expr,e.visQuery=t.payload.visQuery},exprChanged:(e,t)=>{if(!e.visQuery||e.expr!==t.payload){e.expr=t.payload;const s=(0,Ht.u_)(t.payload);e.visQuery=s.query}}}}),{visualQueryChange:Pi,exprChanged:Li}=ts.actions;var rs=d(70416),Si=d(42941),Qi=d(83195),as=d(82762);function $i({title:e,children:t,collapsedInfo:s,queryStats:l}){const[u,p]=(0,Si.A)(!1),y=(0,re.of)(wi);return r.createElement("div",{className:y.wrapper},r.createElement(as.S,{className:y.collapse,collapsible:!0,isOpen:u,onToggle:p,label:r.createElement(Pe.B,{gap:0},r.createElement("h6",{className:y.title},e),!u&&r.createElement("div",{className:y.description},s.map((h,g)=>r.createElement("span",{key:g},h))))},r.createElement("div",{className:y.body},t)),l&&b.$.featureToggles.lokiQuerySplitting&&r.createElement(dr.m,{content:"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part."},r.createElement(Dt.I,{tabIndex:0,name:"info-circle",className:y.tooltip,size:"sm"})),l&&r.createElement("p",{className:y.stats},Ti(l)))}const wi=e=>({collapse:(0,L.css)({backgroundColor:"unset",border:"unset",marginBottom:0,"> button":{padding:e.spacing(0,1)}}),wrapper:(0,L.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,L.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,L.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,L.css)({display:"flex",gap:e.spacing(2),flexWrap:"wrap"}),stats:(0,L.css)({margin:"0px",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize}),tooltip:(0,L.css)({marginRight:e.spacing(.25)})}),Ti=e=>e.message?e.message:`This query will process approximately ${Ri(e)}.`,Ri=e=>{const{text:t,suffix:s}=(0,Qi.j_)("bytes")(e.bytes,1);return t+s};var Fi=d(42418),ka=d(60016),En=d(56587);const ns=r.memo(({app:e,query:t,onChange:s,onRunQuery:l,maxLines:u,queryStats:p})=>{const[y,h]=(0,r.useState)(!0),g=le=>{s({...t,queryType:le}),l()},E=le=>{(0,ye.rR)("grafana_loki_resolution_clicked",{app:e,resolution:le.value}),s({...t,resolution:le.value}),l()},T=le=>{const se=le.currentTarget.value;if(!(0,rs.di)(se)){h(!1);return}h(!0),s({...t,splitDuration:se}),l()},$=le=>{s({...t,legendFormat:le.currentTarget.value}),l()};function B(le){const se=(0,ka.wU)(le.currentTarget.value);t.maxLines!==se&&(s({...t,maxLines:se}),l())}function k(le){s({...t,step:(0,A.trim)(le.currentTarget.value)}),l()}const ve=(0,En.Io)(t),V=(0,En.sI)(t.expr),ne=(0,r.useMemo)(()=>!!(!t.step||(0,rs.V3)(t.step)||!isNaN(Number(t.step))),[t.step]);return r.createElement(Pa.U,null,r.createElement($i,{title:"Options",collapsedInfo:Ci(t,ve,u,V,ne),queryStats:p},r.createElement(Yt.c,{label:"Legend",tooltip:"Series name override or template. Ex. {{hostname}} will be replaced with label value for hostname."},r.createElement(Oa.D,{placeholder:"{{label}}",type:"string",minWidth:14,defaultValue:t.legendFormat,onCommitChange:$})),r.createElement(Yt.c,{label:"Type"},r.createElement(Qe.z,{options:ka.TO,value:ve,onChange:g})),V&&r.createElement(Yt.c,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query."},r.createElement(Oa.D,{className:"width-4",placeholder:u.toString(),type:"number",min:0,defaultValue:t.maxLines?.toString()??"",onCommitChange:B})),!V&&r.createElement(r.Fragment,null,r.createElement(Yt.c,{label:"Step",tooltip:"Use the step parameter when making metric queries to Loki. If not filled, Grafana's calculated interval will be used. Example valid values: 1s, 5m, 10h, 1d.",invalid:!ne,error:"Invalid step. Example valid values: 1s, 5m, 10h, 1d."},r.createElement(Oa.D,{className:"width-6",placeholder:"auto",type:"string",defaultValue:t.step??"",onCommitChange:k})),t.resolution!==void 0&&t.resolution>1&&r.createElement(r.Fragment,null,r.createElement(Yt.c,{label:"Resolution",tooltip:"Changes the step parameter of Loki metrics range queries. With a resolution of 1/1, each pixel corresponds to one data point. 1/10 retrieves one data point per 10 pixels. Lower resolutions perform better."},r.createElement(kt.l6,{isSearchable:!1,onChange:E,options:ka.iB,value:t.resolution||1,"aria-label":"Select resolution"})),r.createElement(Fi.F,{severity:"warning",title:"The 'Resolution' is deprecated. Use 'Step' editor instead to change step parameter."}))),b.$.featureToggles.lokiQuerySplittingConfig&&b.$.featureToggles.lokiQuerySplitting&&r.createElement(Yt.c,{label:"Split Duration",tooltip:"Defines the duration of a single query when query splitting is enabled."},r.createElement(Oa.D,{minWidth:14,type:"string",min:0,defaultValue:t.splitDuration??"1d",onCommitChange:T,invalid:!y}))))});function Ci(e,t,s,l,u){const p=ka.TO.find(g=>g.value===t),y=ka.iB.find(g=>g.value===(e.resolution??1)),h=[];return e.legendFormat&&h.push(`Legend: ${e.legendFormat}`),h.push(`Type: ${p?.label}`),l&&h.push(`Line limit: ${e.maxLines??s}`),l||(e.step&&h.push(`Step: ${u?e.step:"Invalid value"}`),e.resolution&&h.push(`Resolution: ${y?.label}`)),h}ns.displayName="LokiQueryBuilderOptions";var ss=d(95881);function Ai({query:e,datasource:t,range:s,onRunQuery:l,onChange:u,data:p,app:y,showExplain:h,history:g}){const E=(0,re.of)(Di),T=b.$.featureToggles.lokiFormatQuery,$=async()=>u({...e,expr:(0,En.hZ)(e.expr,t)});return r.createElement("div",{className:E.wrapper},r.createElement(ss.W,{datasource:t,query:e,range:s,onRunQuery:l,onChange:u,history:g,data:p,app:y,"data-testid":Pn.editor,ExtraFieldElement:r.createElement(r.Fragment,null,T&&r.createElement("div",{className:E.buttonGroup},r.createElement("div",null,r.createElement(ta.Gy,{spacing:"sm"},r.createElement(Jn.K,{onClick:$,name:"brackets-curly",size:"xs",tooltip:"Format query"}),r.createElement(dr.m,{content:"Use ctrl/cmd + z to undo"},r.createElement(Dt.I,{className:E.hint,name:"keyboard"}))))))}),h&&r.createElement(Zn,{query:e.expr}))}const Di=e=>({wrapper:(0,L.css)`
      max-width: 100%;
      .gf-form {
        margin-bottom: 0.5;
      }
    `,buttonGroup:(0,L.css)`
      border: 1px solid ${e.colors.border.medium};
      border-top: none;
      padding: ${e.spacing(.5,.5,.5,.5)};
      margin-bottom: ${e.spacing(.5)};
      display: flex;
      flex-grow: 1;
      justify-content: end;
      font-size: ${e.typography.bodySmall.fontSize};
    `,hint:(0,L.css)`
      color: ${e.colors.text.disabled};
      white-space: nowrap;
      cursor: help;
    `});var Ii=d(77789),xn=d(10860);const Ni=e=>{const{pattern:t,onPatternSelect:s,hasNewQueryOption:l,hasPreviousQuery:u,selectedPatternName:p,setSelectedPatternName:y}=e,h=(0,re.of)(Mi),g={grammar:ln.Ay,name:"logql"};return r.createElement(xn.Z,{className:h.card},r.createElement(xn.Z.Heading,null,t.name),r.createElement("div",{className:h.rawQueryContainer},r.createElement(Jt.Z,{query:pt.y.renderQuery({labels:[],operations:t.operations}),language:g,className:h.rawQuery})),r.createElement(xn.Z.Actions,null,p!==t.name?r.createElement(ee.$n,{size:"sm",onClick:()=>{u?y(t.name):s(t)}},"Use this query"):r.createElement(r.Fragment,null,r.createElement("div",{className:h.spacing},`If you would like to use this query, ${l?"you can either replace your current query or create a new query":"your current query will be replaced"}.`),r.createElement(ee.$n,{size:"sm",fill:"outline",onClick:()=>y(null)},"Back"),r.createElement(ee.$n,{size:"sm",onClick:()=>{s(t)}},"Replace query"),l&&r.createElement(ee.$n,{size:"sm",onClick:()=>{s(t,!0)}},"Create new query"))))},Mi=e=>({card:(0,L.css)`
      width: 49.5%;
      display: flex;
      flex-direction: column;
    `,rawQueryContainer:(0,L.css)`
      flex-grow: 1;
    `,rawQuery:(0,L.css)`
      background-color: ${e.colors.background.primary};
      padding: ${e.spacing(1)};
      margin-top: ${e.spacing(1)};
    `,spacing:(0,L.css)`
      margin-bottom: ${e.spacing(1)};
    `}),Xi=e=>{const{isOpen:t,onClose:s,onChange:l,onAddQuery:u,query:p,queries:y,app:h}=e,[g,E]=(0,r.useState)([]),[T,$]=(0,r.useState)(null),B=(0,re.of)(ki),k=!!u,ve=(0,r.useMemo)(()=>(0,Ht.u_)(p.expr).query.operations.length>0,[p.expr]),V=(ne,le=!1)=>{const se=(0,Ht.u_)(le?"":p.expr);(0,ye.rR)("grafana_loki_query_patterns_selected",{version:"v2",app:h??"",editorMode:p.editorMode,selectedPattern:ne.name,preSelectedOperationsCount:se.query.operations.length,preSelectedLabelsCount:se.query.labels.length,createNewQuery:k&&le}),se.query.operations=ne.operations,k&&le?u({...p,refId:(0,Ii.M)(y??[p]),expr:pt.y.renderQuery(se.query)}):l({...p,expr:pt.y.renderQuery(se.query)}),$(null),s()};return r.createElement(Ye.a,{isOpen:t,title:"Kick start your query",onDismiss:s,className:B.modal},r.createElement("div",{className:B.spacing},"Kick start your query by selecting one of these queries. You can then continue to complete your query."),Object.values(yn.IQ).map(ne=>r.createElement(as.S,{key:ne,label:`${(0,A.capitalize)(ne)} query starters`,isOpen:g.includes(ne),collapsible:!0,onToggle:()=>E(le=>le.includes(ne)?le.filter(se=>se!==ne):[...le,ne])},r.createElement("div",{className:B.cardsContainer},pt.y.getQueryPatterns().filter(le=>le.type===ne).map(le=>r.createElement(Ni,{key:le.name,pattern:le,hasNewQueryOption:k,hasPreviousQuery:ve,onPatternSelect:V,selectedPatternName:T,setSelectedPatternName:$}))))),r.createElement(ee.$n,{variant:"secondary",onClick:s},"Close"))},ki=e=>({cardsContainer:(0,L.css)`
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
    `,spacing:(0,L.css)`
      margin-bottom: ${e.spacing(1)};
    `,modal:(0,L.css)`
      width: 85vw;
      ${e.breakpoints.down("md")} {
        width: 100%;
      }
    `});var Ui=d(43269);const is="LokiQueryEditorModeDefault";function Bi(e,t,s){e.expr===""&&window.localStorage.setItem(is,t),s({...e,editorMode:t})}function Wi(e){if(e!=null&&e!=="")return pe.f.Code;switch(window.localStorage.getItem(is)){case"code":return pe.f.Code;case"builder":default:return pe.f.Builder}}function Vi(e){let t=e;return e.editorMode||(t={...e,editorMode:Wi(e.expr)}),e.expr==null&&(t={...t,expr:""}),e.queryType==null&&(t={...t,queryType:Ui.U3.Range}),t}var ji=d(47232);function os(e,t){return!e||!t?!1:(0,ji.Ar)(e)?e.isSame(t):e===t}function _i(e,t,s,l,u,p){return t===void 0||e.trim()!==t.trim()||u!==p?!0:!(os(s?.raw.from,l?.raw.from)&&os(s?.raw.to,l?.raw.to))}const Pn={editor:"loki-editor"},ls="LokiQueryEditorExplainDefault",cs=r.memo(e=>{const t=(0,r.useId)(),{onChange:s,onRunQuery:l,onAddQuery:u,data:p,app:y,queries:h,datasource:g,range:E}=e,[T,$]=(0,r.useState)(!1),[B,k]=(0,r.useState)(!1),[ve,V]=(0,r.useState)(!1),[ne,le]=(0,r.useState)(!1),[se,fe]=(0,r.useState)(null),[oe,$e]=(0,r.useState)(window.localStorage.getItem(ls)==="true"),te=g.predefinedOperations,Se=(0,S.A)(E),me=Vi(e.query);b.$.featureToggles.lokiPredefinedOperations&&!me.expr&&te&&(me.expr=`{} ${te}`);const Ce=(0,S.A)(me.expr),We=(0,S.A)(me.queryType),tt=me.editorMode,Qt=De=>{window.localStorage.setItem(ls,De.currentTarget.checked?"true":"false"),$e(De.currentTarget.checked)},ft=(0,r.useCallback)(De=>{if((0,ye.rR)("grafana_loki_editor_mode_clicked",{newEditor:De,previousEditor:me.editorMode??"",newQuery:!me.expr,app:y??""}),De===pe.f.Builder&&(0,Ht.u_)(me.expr||"").errors.length){$(!0);return}Bi(me,De,s)},[s,me,y]);(0,r.useEffect)(()=>{V(!1)},[p]);const Mt=De=>{(0,A.isEqual)(De,e.query)||V(!0),s(De)},qe=()=>{(0,ye.rR)("grafana_loki_label_browser_opened",{app:y}),le(De=>!De)};return(0,r.useEffect)(()=>{_i(me.expr,Ce,E,Se,me.queryType,We)&&E&&(async()=>{const Kt=await g.getStats({...me,refId:`${t}_${me.refId}`},E);fe(Kt)})()},[g,E,Se,me,Ce,We,fe,t]),r.createElement(r.Fragment,null,r.createElement(H.u,{isOpen:T,title:"Query parsing",body:"There were errors while trying to parse the query. Continuing to visual builder may lose some parts of the query.",confirmText:"Continue",onConfirm:()=>{s({...me,editorMode:pe.f.Builder}),$(!1)},onDismiss:()=>$(!1)}),r.createElement(Xi,{isOpen:B,onClose:()=>k(!1),query:me,queries:h,app:y,onChange:s,onAddQuery:u}),r.createElement(Ea,{isOpen:ne,datasource:g,query:me,app:y,onClose:()=>le(!1),onChange:Mt,onRunQuery:l,timeRange:E}),r.createElement(Ie.X,null,r.createElement(de.B,{gap:1},r.createElement(ee.$n,{"data-testid":we.Tp.components.QueryBuilder.queryPatterns,variant:"secondary",size:"sm",onClick:()=>{k(it=>!it);const De=(0,Ht.u_)(me.expr||"");(0,ye.rR)("grafana_loki_query_patterns_opened",{version:"v2",app:y??"",editorMode:me.editorMode,preSelectedOperationsCount:De.query.operations.length,preSelectedLabelsCount:De.query.labels.length})}},"Kick start your query"),r.createElement(ee.$n,{variant:"secondary",size:"sm",onClick:qe,"data-testid":"label-browser-button"},"Label browser")),r.createElement(ie,{label:"Explain query",value:oe,onChange:Qt}),r.createElement(K.Z,{grow:1}),y!==Ee.Jk.Explore&&y!==Ee.Jk.Correlations&&r.createElement(ee.$n,{variant:ve?"primary":"secondary",size:"sm",onClick:l,icon:p?.state===Ke.Gu.Loading?"spinner":void 0,disabled:p?.state===Ke.Gu.Loading},h&&h.length>1?"Run queries":"Run query"),r.createElement(x,{mode:tt,onChange:ft})),r.createElement(Me.$,{v:.5}),r.createElement(P.D,null,tt===pe.f.Code&&r.createElement(Ai,{...e,query:me,onChange:Mt,showExplain:oe}),tt===pe.f.Builder&&r.createElement(Ei,{datasource:e.datasource,query:me,onChange:Mt,onRunQuery:e.onRunQuery,showExplain:oe,timeRange:E}),r.createElement(ns,{query:me,onChange:s,onRunQuery:l,app:y,maxLines:g.maxLines,queryStats:se})))});cs.displayName="LokiQueryEditor";function zi(e){const{query:t,data:s,datasource:l,onChange:u,onRunQuery:p,history:y}=e;return r.createElement(ss.W,{datasource:l,query:t,onChange:u,onRunQuery:p,history:y,data:s,placeholder:"Enter a Loki query","data-testid":Ki.editor})}const Ki={editor:"loki-editor-cloud-alerting"};function Gi(e){const{app:t}=e;switch(t){case Ee.Jk.CloudAlerting:return r.createElement(zi,{...e});default:return r.createElement(cs,{...e})}}const Hi=(0,r.memo)(Gi),No={editor:"loki-editor"};var Yi=d(68704),Zi=d(77657),Ji=d(17466),qi=d(66025),eo=d(91062),to=d(32346),Ln=d(25994),ro=d(17081),Sn=d(29020),Qn=d(35931);function ao({options:e,onOptionsChange:t}){return r.createElement(Sn.I,{title:"Alerting",description:r.createElement(Qn.H,{description:"Manage alert rules for the Loki data source.",suffix:"loki/configure-loki-data-source/#alerting",feature:"alerting"})},r.createElement(lt.I,{labelWidth:29,label:"Manage alert rules in Alerting UI",disabled:e.readOnly,tooltip:"Manage alert rules for this data source. To manage other alerting resources, add an Alertmanager data source."},r.createElement(be.K,{value:e.jsonData.manageAlerts!==!1,onChange:s=>t({...e,jsonData:{...e.jsonData,manageAlerts:s.currentTarget.checked}})})))}var no=d(6709),so=d(91890),io=d(72574),oo=d(21744);const lo=e=>{const{derivedFields:t,className:s}=e,[l,u]=(0,r.useState)("");let p=[];return l&&t&&(p=uo(t,l)),r.createElement("div",{className:s},r.createElement(lt.I,{label:"Debug log message",labelWidth:24,grow:!0},r.createElement(oo.f,{type:"text","aria-label":"Loki query",placeholder:"Paste an example log line here to test the regular expressions of your derived fields",value:l,onChange:y=>u(y.currentTarget.value)})),!!p.length&&r.createElement(co,{fields:p}))},co=({fields:e})=>r.createElement("table",{className:"filter-table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"Name"),r.createElement("th",null,"Value"),r.createElement("th",null,"Url"))),r.createElement("tbody",null,e.map(t=>{let s=t.value;return t.error&&t.error instanceof Error?s=t.error.message:t.href&&(s=r.createElement("a",{href:t.href},s)),r.createElement("tr",{key:`${t.name}=${t.value}`},r.createElement("td",null,t.name),r.createElement("td",null,s),r.createElement("td",null,t.href?r.createElement("a",{href:t.href},t.href):""))})));function uo(e,t){return e.filter(s=>s.name&&s.matcherRegex).map(s=>{try{const l=t.match(s.matcherRegex);let u;const p=l&&l[1];return p&&(u=(0,io.w)().replace(s.url,{__value:{value:{raw:p},text:"Raw value"}})),{name:s.name,value:p||"<no match>",href:u}}catch(l){return{name:s.name,error:l}}})}var po=d(55882),Mr=d(88575),fo=d(64078);const mo=e=>({row:(0,L.css)`
    display: flex;
    align-items: baseline;
  `,nameField:(0,L.css)`
    flex: 2;
    margin-right: ${e.spacing(.5)};
  `,regexField:(0,L.css)`
    flex: 3;
    margin-right: ${e.spacing(.5)};
  `,urlField:(0,L.css)`
    flex: 1;
    margin-right: ${e.spacing(.5)};
  `,urlDisplayLabelField:(0,L.css)`
    flex: 1;
  `,internalLink:(0,L.css)`
    margin-right: ${e.spacing(1)};
  `,dataSource:(0,L.css)``,nameMatcherField:(0,L.css)({width:e.spacing(20),marginRight:e.spacing(.5)})}),go=e=>{const{value:t,onChange:s,onDelete:l,suggestions:u,className:p,validateName:y}=e,h=(0,re.of)(mo),[g,E]=(0,r.useState)(!!t.datasourceUid),T=(0,S.A)(t.datasourceUid),[$,B]=(0,r.useState)(t.matcherType??"regex");(0,r.useEffect)(()=>{!T&&t.datasourceUid&&!g&&E(!0),T&&!t.datasourceUid&&g&&E(!1)},[T,t.datasourceUid,g]);const k=V=>ne=>{s({...t,[V]:ne.currentTarget.value})},ve=!y(t.name);return r.createElement("div",{className:p,"data-testid":"derived-field"},r.createElement("div",{className:"gf-form"},r.createElement(Mr.D,{className:h.nameField,label:"Name",invalid:ve,error:"The name is already in use"},r.createElement(cr.p,{value:t.name,onChange:k("name"),placeholder:"Field name",invalid:ve})),r.createElement(Mr.D,{className:h.nameMatcherField,label:r.createElement(cn,{label:"Type",content:"Derived fields can be created from labels or by applying a regular expression to the log message."})},r.createElement(kt.l6,{options:[{label:"Regex in log line",value:"regex"},{label:"Label",value:"label"}],value:$,onChange:V=>{(V.value==="label"||V.value==="regex")&&(B(V.value),s({...t,matcherType:V.value}))}})),r.createElement(Mr.D,{className:h.regexField,label:r.createElement(r.Fragment,null,$==="regex"&&r.createElement(cn,{label:"Regex",content:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),$==="label"&&r.createElement(cn,{label:"Label",content:"Use to derive the field from a label."}))},r.createElement(cr.p,{value:t.matcherRegex,onChange:k("matcherRegex")})),r.createElement(Mr.D,{label:""},r.createElement(ee.$n,{variant:"destructive",title:"Remove field",icon:"times",onClick:V=>{V.preventDefault(),l()}}))),r.createElement("div",{className:"gf-form"},r.createElement(Mr.D,{label:g?"Query":"URL",className:h.urlField},r.createElement(fo.l,{placeholder:g?"${__value.raw}":"http://example.com/${__value.raw}",value:t.url||"",onChange:V=>s({...t,url:V}),suggestions:u})),r.createElement(Mr.D,{className:h.urlDisplayLabelField,label:r.createElement(cn,{label:"URL Label",content:"Use to override the button label when this derived field is found in a log."})},r.createElement(cr.p,{value:t.urlDisplayLabel,onChange:k("urlDisplayLabel")}))),r.createElement("div",{className:"gf-form"},r.createElement(Mr.D,{label:"Internal link",className:h.internalLink},r.createElement(be.d,{value:g,onChange:V=>{const{checked:ne}=V.currentTarget;ne||s({...t,datasourceUid:void 0}),E(ne)}})),g&&r.createElement(Mr.D,{label:"",className:h.dataSource},r.createElement(po.s,{tracing:!0,onChange:V=>s({...t,datasourceUid:V.uid}),current:t.datasourceUid,noDefault:!0}))))},cn=({content:e,label:t})=>r.createElement(lr.J,null,t,r.createElement(dr.m,{placement:"top",content:e,theme:"info"},r.createElement(Dt.I,{tabIndex:0,name:"info-circle",size:"sm",style:{marginLeft:"10px"}}))),ho=e=>({addButton:(0,L.css)`
    margin-right: 10px;
  `,derivedField:(0,L.css)`
    margin-bottom: ${e.spacing(1)};
  `,container:(0,L.css)`
    margin-bottom: ${e.spacing(4)};
  `,debugSection:(0,L.css)`
    margin-top: ${e.spacing(4)};
  `}),vo=({fields:e=[],onChange:t})=>{const s=(0,re.$j)(),l=ho(s),[u,p]=(0,r.useState)(!1),y=(0,r.useCallback)(h=>e.filter(g=>g.name&&g.name===h).length<=1,[e]);return r.createElement(Sn.I,{title:"Derived fields",description:r.createElement(Qn.H,{description:"Derived fields can be used to extract new fields from a log message and create a link from its value.",suffix:"loki/configure-loki-data-source/#derived-fields",feature:"derived fields"})},r.createElement("div",{className:l.container},e.map((h,g)=>r.createElement(go,{className:l.derivedField,key:g,value:h,onChange:E=>{const T=[...e];T.splice(g,1,E),t(T)},onDelete:()=>{const E=[...e];E.splice(g,1),t(E)},validateName:y,suggestions:[{value:no.c.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:so.$0.Value}]})),r.createElement("div",null,r.createElement(ee.$n,{variant:"secondary",className:l.addButton,icon:"plus",onClick:h=>{h.preventDefault();const g={name:"",matcherRegex:"",urlDisplayLabel:"",url:"",matcherType:"regex"},E=[...e,g];t(E)}},"Add"),e.length>0&&r.createElement(ee.$n,{variant:"secondary",type:"button",onClick:()=>p(!u)},u?"Hide example log message":"Show example log message")),u&&r.createElement("div",{className:l.debugSection},r.createElement(lo,{className:(0,L.css)`
                margin-bottom: 10px;
              `,derivedFields:e}))))};var Oo=d(39268),yo=d(39938);const bo=e=>{const{maxLines:t,onMaxLinedChange:s,predefinedOperations:l,onPredefinedOperationsChange:u}=e;return r.createElement(Sn.I,{title:"Queries",description:r.createElement(Qn.H,{description:"Additional options to customize your querying experience.",suffix:"loki/configure-loki-data-source/#queries",feature:"query settings"})},r.createElement(lt.I,{label:"Maximum lines",htmlFor:"loki_config_maxLines",labelWidth:22,tooltip:r.createElement(r.Fragment,null,"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results.")},r.createElement(cr.p,{type:"number",id:"loki_config_maxLines",value:t,onChange:p=>s(p.currentTarget.value),width:16,placeholder:"1000",spellCheck:!1})),b.$.featureToggles.lokiPredefinedOperations&&r.createElement(Oo.C,null,r.createElement(lt.I,{label:"Predefined operations",htmlFor:"loki_config_predefinedOperations",labelWidth:22,tooltip:r.createElement(r.Fragment,null,'Predefined operations are used as an initial state for your queries. They are useful, if you want to unpack, parse or format all log lines. Currently we support only log operations starting with |. For example: | unpack | line_format "{{.message}}".')},r.createElement(cr.p,{type:"string",id:"loki_config_predefinedOperations",value:l,onChange:p=>u(p.currentTarget.value),width:40,placeholder:"| unpack | line_format",spellCheck:!1})),r.createElement(lt.I,null,r.createElement(yo.E,{text:"Experimental",color:"orange",icon:"exclamation-triangle",tooltip:"Predefined operations is an experimental feature that may change in the future."}))))},$n=e=>(t,s)=>({...t,jsonData:{...t.jsonData,[e]:s}}),Eo=$n("maxLines"),xo=$n("predefinedOperations"),Po=$n("derivedFields"),Lo=e=>{const{options:t,onOptionsChange:s}=e,l=(0,r.useCallback)(u=>{(0,ye.rR)("grafana_loki_predefined_operations_changed",{value:u}),s(xo(t,u))},[t,s]);return r.createElement(r.Fragment,null,r.createElement(Yi.I,{dataSourceName:"Loki",docsLink:"https://grafana.com/docs/grafana/latest/datasources/loki/configure-loki-data-source/",hasRequiredFields:!1}),r.createElement(Ln.c,{spacing:4}),r.createElement(Zi.u,{config:t,onChange:s,urlPlaceholder:"http://localhost:3100"}),r.createElement(Ln.c,{spacing:4}),r.createElement(Ji.N,{...(0,qi.pe)({config:t,onChange:s})}),r.createElement(Ln.c,{spacing:4}),r.createElement(eo.A,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!0},r.createElement(de.B,{gap:5,direction:"column"},r.createElement(to.g,{config:t,onChange:s}),b.$.secureSocksDSProxyEnabled&&r.createElement(ro.Y,{options:t,onOptionsChange:s}),r.createElement(ao,{options:t,onOptionsChange:s}),r.createElement(bo,{maxLines:t.jsonData.maxLines||"",onMaxLinedChange:u=>s(Eo(t,u)),predefinedOperations:t.jsonData.predefinedOperations||"",onPredefinedOperationsChange:l}),r.createElement(vo,{fields:t.jsonData.derivedFields,onChange:u=>s(Po(t,u))}))))};var So=d(27724),Qo=d(79007);const $o=new w.tD(So.VQ).setQueryEditor(Hi).setConfigEditor(Lo).setQueryEditorHelp(J);(0,I.J7)().subscribe(Re.gc,Qo.jg)},56587:(dt,Ve,d)=>{"use strict";d.d(Ve,{$F:()=>Ke,Cg:()=>X,FV:()=>be,H0:()=>M,Io:()=>J,MX:()=>Ae,OT:()=>Fe,QH:()=>Ie,Rn:()=>F,TQ:()=>L,_i:()=>Ne,aw:()=>Ue,d_:()=>_,g5:()=>rt,gy:()=>ie,hZ:()=>Qe,pS:()=>Ze,pk:()=>Z,sI:()=>Pe,sc:()=>K,vV:()=>D});var w=d(2543),Re=d.n(w),I=d(36195),A=d(14110),r=d(20065),ye=d(12798),j=d(56245),he=d(43269);function M(Q=""){const x=[],P=Ie(Q,[I.PN]);for(const b of P){const H=b.getChild(I.dJ)?.getChild(I.Sg),de=b.getChild(I.dJ)?.getChild(I.q5),ee=ce(b);if(!(!H&&!de||!ee.length))for(const Me of ee){const _e=Q.substring(Me.from,Me.to).trim(),at=_e[0]==="`",et=_e.substring(1,_e.length-1);if(!et)continue;let Ye="";de?Ye=at?et:et.replace(/\\\\/g,"\\"):Ye=(0,w.escapeRegExp)(et),Ye&&x.push(Ye)}}return x}function ce(Q){const x=[];let P=Q;do{const b=P.getChild(I.Qf);b&&!P.getChild(I.w7)&&x.push(b),P=P.getChild(I.ih)}while(P!=null);return x}function D(Q){const x=J(Q),{instant:P,range:b,...H}=Q;return{...H,queryType:x}}function J(Q){const{queryType:x}=Q;return x===he.U3.Range||x===he.U3.Instant||x===he.U3.Stream?x:Q.instant===!0?he.U3.Instant:he.U3.Range}const Ee=["String","Identifier","LineComment","Number"],S=["__error__","__interval","__interval_ms","__auto"];function Ke(Q){let x=Q;return I.K3.parse(Q).iterate({enter:({name:b,from:H,to:de})=>{const ee=Q.substring(H,de);Ee.includes(b)&&!S.includes(ee)&&(x=x.replace(ee,b))}}),x}function we(Q){const x=[];return parser.parse(Q).iterate({enter:({name:b})=>{x.push(b)}}),x}function pe(Q,x){let P=!1;return I.K3.parse(Q).iterate({enter:({type:H})=>{if(H.id===x)return P=!0,!1}}),P}function Ie(Q,x){const P=[];return I.K3.parse(Q).iterate({enter:H=>{(x===void 0||x.includes(H.type.id))&&P.push(H.node)}}),P}function L(Q,x){const P=[];return I.K3.parse(Q).iterate({enter:H=>{(x===void 0||x.includes(H.type.id))&&P.push(ye.Ch.fromNode(H.node))}}),P}function re(Q,x){const P=Ie(Q,[x]);return P.length>0?P[0]:void 0}function be(Q){return pe(Q,j.Ql)}function Pe(Q){return!pe(Q,I.Yw)}function Ae(Q){const P=Ie(Q,[I.iT,I.eF,I.c$]).length;return{queryWithParser:P>0,parserCount:P}}function Ue(Q){const x=Ie(Q,[I.iT,I.LM,I.c$]);return x.length>0?Q.substring(x[0].from,x[0].to).trim():void 0}function _(Q){const x=Ie(Q,[I.bY]);for(const P of x){const b=P.getChild(I.g$)?.getChild(I.gw);if(b&&Q.substring(b.from,b.to)==="__error__")return!0}return!1}function Ne(Q){return pe(Q,I.J_)}function Fe(Q){if(Pe(Q))return Q;const x=re(Q,I.MD);if(!x)return"";const P=Q.substring(x.from,x.to),b=re(Q,I.AL),H=b?Q.substring(b.from,b.to):"";return`${P} ${H}`.trim()}function rt(Q,x){if(Pe(Q))return Q;const P=Ie(Q,[I.Yw]).reverse().find(b=>b.from<=x&&b.to>=x);return P?Fe(Q.substring(P.from,P.to)):""}function Ze(Q){return pe(Q,I.bY)}function F(Q){return pe(Q,I.PN)}function X(Q){const x=Ie(Q,[I.Q6]);for(const P of x)if(Q.substring(P.from,P.to).match(/\[\$__range(_s|_ms)?/))return!0;return!1}function Z(Q){return(0,ye.yB)(Q).map(b=>Q.slice(b.from,b.to))}function ie(Q){return Q.filter(P=>!P.hide).filter(P=>!P.refId.includes("do-not-chunk")).filter(P=>P.expr).length>0}const ue=Q=>Q?Q.expr!==void 0:!1,K=Q=>{if(!(!Q||!ue(Q)))return Q};function Qe(Q,x){const P=be(x.interpolateString(Q,r.a));if((0,A.rR)("grafana_loki_format_query_clicked",{is_invalid:P,query_type:Pe(Q)?"logs":"metric"}),P)return Q;let b=(0,j.qk)(Q);const H=[],de=I.K3.parse(b);if(de.topNode.firstChild?.firstChild?.type.id===I.Yw){const Me=/\[__V_[0-2]__\w+__V__\]/g;H.push(...b.matchAll(Me)),b=b.replace(Me,"[0s]")}let ee=(0,I.x0)(b);return de.topNode.firstChild?.firstChild?.type.id===I.Yw&&H.forEach(Me=>{ee=ee.replace("[0s]",Me[0])}),(0,j.If)(ee)}},43548:(dt,Ve,d)=>{"use strict";d.d(Ve,{y:()=>j});var w=d(83077),Re=d(42952);class I{constructor(M,ce){this.categories=[],this.operationsRegistry=new w.O(()=>M),this.innerQueryPlaceholder=ce||"<query>"}setOperationCategories(M){this.categories=M}getOperationsForCategory(M){return this.operationsRegistry.list().filter(ce=>ce.category===M&&!ce.hideFromList)}getAlternativeOperations(M){return this.operationsRegistry.list().filter(ce=>ce.alternativesKey&&ce.alternativesKey===M)}getCategories(){return this.categories}getOperationDefinition(M){return this.operationsRegistry.getIfExists(M)}hasBinaryOp(M){return M.operations.find(ce=>{const D=this.getOperationDefinition(ce.id);return D?.category===Re.T})!==void 0}}var A=d(83657),r=d(54623);class ye extends I{constructor(){super(A.sp,"<expr>"),this.setOperationCategories([r.Ln.Aggregations,r.Ln.RangeFunctions,r.Ln.Formats,r.Ln.BinaryOps,r.Ln.LabelFilters,r.Ln.LineFilters])}renderOperations(M,ce){for(const D of ce){const J=this.operationsRegistry.getIfExists(D.id);if(!J){console.error(`Could not find operation ${D.id} in the registry`);continue}M=J.renderer(D,J,M)}return M}renderBinaryQueries(M,ce){if(ce)for(const D of ce)M=`${this.renderBinaryQuery(M,D)}`;return M}renderBinaryQuery(M,ce){let D=M+` ${ce.operator} `;return ce.vectorMatches&&(D+=`${ce.vectorMatchesType}(${ce.vectorMatches}) `),D+this.renderQuery(ce.query,!0)}renderLabels(M){if(M.length===0)return"{}";let ce="{";for(const D of M)ce!=="{"&&(ce+=", "),ce+=`${D.label}${D.op}"${D.value}"`;return ce+"}"}renderQuery(M,ce){let D=this.renderLabels(M.labels);return D=this.renderOperations(D,M.operations),!ce&&this.hasBinaryOp(M)&&M.binaryQueries?.length&&(D=`(${D})`),D=this.renderBinaryQueries(D,M.binaryQueries),D}getQueryPatterns(){return[{name:"Parse log lines with logfmt parser",type:r.IQ.Log,operations:[{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log lines with JSON parser",type:r.IQ.Log,operations:[{id:r.EF.Json,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log line and parse with logfmt parser",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log lines and parse with json parser",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Json,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log line with logfmt parser and use label filter",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.LabelFilter,params:["label","=","value"]}]},{name:"Parse log lines with nested json",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Json,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.LineFormat,params:["{{.message}}"]},{id:r.EF.Json,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Reformat log lines",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.LineFormat,params:["{{.message}}"]}]},{name:"Rename lvl label to level",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.LabelFormat,params:["lvl","level"]}]},{name:"Query on value inside a log line",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.Unwrap,params:[""]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.SumOverTime,params:["$__auto"]},{id:r.EF.Sum,params:[]}]},{name:"Total requests per label of streams",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.CountOverTime,params:["$__auto"]},{id:r.EF.Sum,params:[]}]},{name:"Total requests per parsed label or label of streams",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.CountOverTime,params:["$__auto"]},{id:r.EF.Sum,params:[]}]},{name:"Bytes used by a log stream",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.BytesOverTime,params:["$__auto"]}]},{name:"Count of log lines per stream",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.CountOverTime,params:["$__auto"]}]},{name:"Top N results by label or parsed label",type:r.IQ.Metric,operations:[{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.CountOverTime,params:["$__auto"]},{id:r.EF.Sum,params:[]},{id:r.EF.TopK,params:[10]}]},{name:"Extracted quantile",type:r.IQ.Metric,operations:[{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.Unwrap,params:["latency"]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.QuantileOverTime,params:["$__auto",.5]},{id:r.EF.Sum,params:[]}]}]}}const j=new ye},58592:(dt,Ve,d)=>{"use strict";d.d(Ve,{C:()=>I,I:()=>A});var w=d(11216),Re=d(54623);const I=[{id:Re.EF.Addition,name:"Add scalar",sign:"+"},{id:Re.EF.Subtraction,name:"Subtract scalar",sign:"-"},{id:Re.EF.MultiplyBy,name:"Multiply by scalar",sign:"*"},{id:Re.EF.DivideBy,name:"Divide by scalar",sign:"/"},{id:Re.EF.Modulo,name:"Modulo by scalar",sign:"%"},{id:Re.EF.Exponent,name:"Exponent",sign:"^"},{id:Re.EF.EqualTo,name:"Equal to",sign:"==",comparison:!0},{id:Re.EF.NotEqualTo,name:"Not equal to",sign:"!=",comparison:!0},{id:Re.EF.GreaterThan,name:"Greater than",sign:">",comparison:!0},{id:Re.EF.LessThan,name:"Less than",sign:"<",comparison:!0},{id:Re.EF.GreaterOrEqual,name:"Greater or equal to",sign:">=",comparison:!0},{id:Re.EF.LessOrEqual,name:"Less or equal to",sign:"<=",comparison:!0}],A=I.map(ye=>{const j=[{name:"Value",type:"number"}],he=[2];return ye.comparison&&(j.push({name:"Bool",type:"boolean",description:"If checked comparison will return 0 or 1 for the value rather than filtering."}),he.push(!1)),{id:ye.id,name:ye.name,params:j,defaultParams:he,alternativesKey:"binary scalar operations",category:Re.Ln.BinaryOps,renderer:r(ye.sign),addOperationHandler:w.iZ}});function r(ye){return function(he,M,ce){let D=he.params[0],J="";return he.params.length===2&&(J=he.params[1]?" bool":""),`${ce} ${ye}${J} ${D}`}}},83657:(dt,Ve,d)=>{"use strict";d.d(Ve,{VI:()=>L,y6:()=>pe,mD:()=>Ie,sp:()=>we});var w=d(58592),Re=d(96540),I=d(50877),A=d(43127),r=d(32264),ye=d(88323),j=d(20065),he=d(27724),M=d(56587),ce=d(75723),D=d(11216);function J({onChange:re,index:be,operationId:Pe,value:Ae,query:Ue,datasource:_,timeRange:Ne,queryModeller:Fe}){const[rt,Ze]=(0,Re.useState)({});return Re.createElement(ye.l6,{inputId:(0,D.OS)(Pe,be),onOpenMenu:async()=>{if(_ instanceof he.VQ&&r.$.featureToggles.lokiQueryHints){Ze({isLoading:!0});const F=await Ee(Ue,_,Fe,Ne);Ze({options:F,isLoading:void 0})}},isLoading:rt.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:rt.options,value:Ae?(0,I.z)(Ae.toString()):null,onChange:F=>{F.value&&re(be,F.value)}})}async function Ee(re,be,Pe,Ae=(0,A.E2)()){const Ue=Pe.renderQuery(re),_=(0,M.OT)(Ue);if((0,M.FV)(be.interpolateString(_,j.a)))return[];const Ne=await be.getDataSamples({expr:_,refId:"unwrap_samples"},Ae);return(0,ce.aN)(Ne[0]).map(Ze=>({label:Ze,value:Ze}))}var S=d(54623);function Ke(){const re=[S.EF.Sum,S.EF.Min,S.EF.Max,S.EF.Avg,S.EF.Stddev,S.EF.Stdvar,S.EF.Count].flatMap(_=>(0,D.G3)(_,{addOperationHandler:D.af,orderRank:S.h5.Last})),be=[S.EF.TopK,S.EF.BottomK].flatMap(_=>(0,D.jC)(_,{params:[{name:"K-value",type:"number"}],defaultParams:[5]},{addOperationHandler:D.af,orderRank:S.h5.Last})),Pe=[(0,D.fu)(S.EF.Rate),(0,D.fu)(S.EF.RateCounter),(0,D.fu)(S.EF.CountOverTime),(0,D.fu)(S.EF.SumOverTime),(0,D.fu)(S.EF.BytesRate),(0,D.fu)(S.EF.BytesOverTime),(0,D.fu)(S.EF.AbsentOverTime)],Ae=[...(0,D.yD)(S.EF.AvgOverTime),...(0,D.yD)(S.EF.MaxOverTime),...(0,D.yD)(S.EF.MinOverTime),...(0,D.yD)(S.EF.FirstOverTime),...(0,D.yD)(S.EF.LastOverTime),...(0,D.yD)(S.EF.StdvarOverTime),...(0,D.yD)(S.EF.StddevOverTime),...(0,D.yD)(S.EF.QuantileOverTime)];return[...re,...be,...Pe,...Ae,{id:S.EF.Json,name:"Json",params:[{name:"Expression",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'server="servers[0]"',description:"Using expressions with your json parser will extract only the specified json fields to labels. You can specify one or more expressions in this way. All expressions must be quoted."}],defaultParams:[],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:D.EP,addOperationHandler:D.af,explainHandler:()=>"This will extract keys and values from a [json](https://grafana.com/docs/loki/latest/logql/log_queries/#json) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:S.EF.Logfmt,name:"Logfmt",params:[{name:"Strict",type:"boolean",optional:!0,description:"With strict parsing enabled, the logfmt parser immediately stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair."},{name:"Keep empty",type:"boolean",optional:!0,description:"The logfmt parser retains standalone keys (keys without a value) as labels with its value set to empty string. "},{name:"Expression",type:"string",optional:!0,restParam:!0,minWidth:18,placeholder:"field_name",description:"Using expressions with your logfmt parser will extract and rename (if provided) only the specified fields to labels. You can specify one or more expressions in this way."}],defaultParams:[!1,!1],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:D.EP,addOperationHandler:D.af,explainHandler:()=>"This will extract all keys and values from a [logfmt](https://grafana.com/docs/loki/latest/logql/log_queries/#logfmt) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:S.EF.Regexp,name:"Regexp",params:[{name:"String",type:"string",hideName:!0,placeholder:"<re>",description:"The regexp expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:(_,Ne,Fe)=>`${Fe} | regexp \`${_.params[0]}\``,addOperationHandler:D.af,explainHandler:()=>'The [regexp parser](https://grafana.com/docs/loki/latest/logql/log_queries/#regular-expression) takes a single parameter | regexp "<re>" which is the regular expression using the Golang RE2 syntax. The regular expression must contain a least one named sub-match (e.g (?P<name>re)), each sub-match will extract a different label. The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.'},{id:S.EF.Pattern,name:"Pattern",params:[{name:"String",type:"string",hideName:!0,placeholder:"<pattern-expression>",description:"The expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:(_,Ne,Fe)=>`${Fe} | pattern \`${_.params[0]}\``,addOperationHandler:D.af,explainHandler:()=>"The [pattern parser](https://grafana.com/docs/loki/latest/logql/log_queries/#pattern) allows the explicit extraction of fields from log lines by defining a pattern expression (| pattern `<pattern-expression>`). The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:S.EF.Unpack,name:"Unpack",params:[],defaultParams:[],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:D.EP,addOperationHandler:D.af,explainHandler:()=>"This will extract all keys and values from a JSON log line, [unpacking](https://grafana.com/docs/loki/latest/logql/log_queries/#unpack) all embedded labels in the pack stage. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:S.EF.LineFormat,name:"Line format",params:[{name:"String",type:"string",hideName:!0,placeholder:"{{.status_code}}",description:"A line template that can refer to stream labels and extracted labels.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:(_,Ne,Fe)=>`${Fe} | line_format \`${_.params[0]}\``,addOperationHandler:D.af,explainHandler:()=>`This will replace log line using a specified template. The template can refer to stream labels and extracted labels.

Example: \`{{.status_code}} - {{.message}}\`

[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#line-format-expression) for more.
        `},{id:S.EF.LabelFormat,name:"Label format",params:[{name:"Label",type:"string"},{name:"Rename to",type:"string"}],defaultParams:["",""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:(_,Ne,Fe)=>`${Fe} | label_format ${_.params[1]}=${_.params[0]}`,addOperationHandler:D.af,explainHandler:()=>'This will change name of label to desired new label. In the example below, label "error_level" will be renamed to "level".\n\nExample: ``error_level=`level` ``\n\n[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#labels-format-expression) for more.\n        '},{id:S.EF.LineContains,name:"Line contains",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:20,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,D.UF)("|="),addOperationHandler:D.af,explainHandler:_=>`Return log lines that contain string \`${_.params?.join("`, or `")}\`.`},{id:S.EF.LineContainsNot,name:"Line does not contain",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:26,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,D.UF)("!="),addOperationHandler:D.af,explainHandler:_=>`Return log lines that does not contain string \`${_.params?.join("`, or `")}\`.`},{id:S.EF.LineContainsCaseInsensitive,name:"Line contains case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:33,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,D.UF)("|~",!0),addOperationHandler:D.af,explainHandler:_=>`Return log lines that match regex \`(?i)${_.params?.join("`, or `(?i)")}\`.`},{id:S.EF.LineContainsNotCaseInsensitive,name:"Line does not contain case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:40,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,D.UF)("!~",!0),addOperationHandler:D.af,explainHandler:_=>`Return log lines that does not match regex \`(?i)${_.params?.join("`, or `(?i)")}\`.`},{id:S.EF.LineMatchesRegex,name:"Line contains regex match",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to match",description:"Find log lines that match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,D.UF)("|~"),addOperationHandler:D.af,explainHandler:_=>`Return log lines that match a \`RE2\` regex pattern. \`${_.params?.join("`, or `")}\`.`},{id:S.EF.LineMatchesRegexNot,name:"Line does not match regex",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to exclude",description:"Find log lines that does not match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,D.UF)("!~"),addOperationHandler:D.af,explainHandler:_=>`Return log lines that doesn't match a \`RE2\` regex pattern. \`${_.params?.join("`, or `")}\`.`},{id:S.EF.LineFilterIpMatches,name:"IP line filter expression",params:[{name:"Operator",type:"string",minWidth:16,options:[S.NS.contains,S.NS.doesNotContain]},{name:"Pattern",type:"string",placeholder:"<pattern>",minWidth:16,runQueryOnEnter:!0}],defaultParams:["|=",""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(_,Ne,Fe)=>`${Fe} ${_.params[0]} ip(\`${_.params[1]}\`)`,addOperationHandler:D.af,explainHandler:_=>`Return log lines using IP matching of \`${_.params[1]}\``},{id:S.EF.LabelFilter,name:"Label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[S.NS.equals,S.NS.doesNotEqual,S.NS.matchesRegex,S.NS.doesNotMatchRegex,S.NS.greaterThan,S.NS.lessThan,S.NS.greaterThanOrEqual,S.NS.lessThanOrEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],alternativesKey:"label filter",category:S.Ln.LabelFilters,orderRank:S.h5.PipeOperations,renderer:D.sn,addOperationHandler:D.af,explainHandler:()=>"Label expression filter allows filtering using original and extracted labels."},{id:S.EF.LabelFilterIpMatches,name:"IP label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[S.NS.equals,S.NS.doesNotEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],alternativesKey:"label filter",category:S.Ln.LabelFilters,orderRank:S.h5.PipeOperations,renderer:(_,Ne,Fe)=>`${Fe} | ${_.params[0]} ${_.params[1]} ip(\`${_.params[2]}\`)`,addOperationHandler:D.af,explainHandler:_=>`Return log lines using IP matching of \`${_.params[2]}\` for \`${_.params[0]}\` label`},{id:S.EF.LabelFilterNoErrors,name:"No pipeline errors",params:[],defaultParams:[],alternativesKey:"label filter",category:S.Ln.LabelFilters,orderRank:S.h5.NoErrors,renderer:(_,Ne,Fe)=>`${Fe} | __error__=\`\``,addOperationHandler:D.af,explainHandler:()=>"Filter out all formatting and parsing errors."},{id:S.EF.Unwrap,name:"Unwrap",params:[{name:"Identifier",type:"string",hideName:!0,minWidth:16,placeholder:"Label key",editor:J},{name:"Conversion function",hideName:!0,type:"string",options:["duration","duration_seconds","bytes"],optional:!0}],defaultParams:["",""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Unwrap,renderer:(_,Ne,Fe)=>`${Fe} | unwrap ${_.params[1]?`${_.params[1]}(${_.params[0]})`:_.params[0]}`,addOperationHandler:D.af,explainHandler:_=>{let Ne=String(_.params[0]).length>0?_.params[0]:"<label>";return`Use the extracted label \`${Ne}\` as sample values instead of log lines for the subsequent range aggregation.${_.params[1]?` Conversion function \`${_.params[1]}\` wrapping \`${Ne}\` will attempt to convert this label from a specific format (e.g. 3k, 500ms).`:""}`}},{id:S.EF.Decolorize,name:"Decolorize",params:[],defaultParams:[],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:(_,Ne,Fe)=>`${Fe} | decolorize`,addOperationHandler:D.af,explainHandler:()=>"This will remove ANSI color codes from log lines."},{id:S.EF.Drop,name:"Drop",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to drop."}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:D.EP,addOperationHandler:D.af,explainHandler:()=>"The drop expression will drop the given labels in the pipeline."},{id:S.EF.Keep,name:"Keep",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to keep."}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:D.EP,addOperationHandler:D.af,explainHandler:()=>"The keep expression will keep only the specified labels in the pipeline and drop all the other labels."},...w.I,{id:S.EF.NestedQuery,name:"Binary operation with query",params:[],defaultParams:[],category:S.Ln.BinaryOps,renderer:(_,Ne,Fe)=>Fe,addOperationHandler:D.VR}]}const we=Ke();function pe(re){return(we.find(Ae=>Ae.id===re)?.explainHandler?.({id:"",params:["<value>"]})||"").replace(/\[(.*)\]\(.*\)/g,"$1")}function Ie(re){return we.find(be=>be.id===re)}function L(re,be){return!(be.length<re.params.filter(Pe=>!Pe.optional).length)}},60706:(dt,Ve,d)=>{"use strict";d.d(Ve,{u_:()=>ye,w4:()=>Ue});var w=d(36195),Re=d(58592),I=d(83657),A=d(56245),r=d(54623);function ye(F){const X=(0,A.qk)(F),ie=w.K3.parse(X).topNode,K={query:{labels:[],operations:[]},errors:[]};try{j(X,ie,K)}catch(Qe){console.error(Qe),Qe instanceof Error&&K.errors.push({text:Qe.message})}return Fe(K.query)&&(K.errors=[]),K}function j(F,X,Z){const ie=Z.query;switch(X.type.id){case w.g$:{ie.labels.push(he(F,X));const ue=X.getChild(A.Ql);ue&&Z.errors.push((0,A.xz)(F,ue));break}case w.PN:{const{operation:ue,error:K}=M(F,X);ue&&ie.operations.push(ue),K&&Z.errors.push(Ne(F,X,K));break}case w.iT:{ie.operations.push(ce(F,X));break}case w.bY:{const{operation:ue,error:K}=Ee(F,X);ue&&ie.operations.push(ue),K&&Z.errors.push(Ne(F,X,K));break}case w.eF:{ie.operations.push(D(F,X));break}case w.Zj:case w.Tz:{const{operation:ue,error:K}=J(F,X);ue&&ie.operations.push(ue),K&&Z.errors.push(Ne(F,X,K));break}case w.pH:{ie.operations.push(S(F,X));break}case w.e_:{ie.operations.push(Ke(F,X));break}case w.HV:{const{operation:ue,error:K}=pe(F,X,Z);ue&&ie.operations.push(ue),K&&Z.errors.push(Ne(F,X,K));break}case w.Zg:{ie.operations.push(we());break}case w.h1:{ie.operations.push(Ie(F,X,Z));break}case w.Rh:{ie.operations.push(L(F,X,Z));break}case w.MK:{be(F,X,Z);break}case A.Ql:{if(Ae(X))break;Z.errors.push((0,A.xz)(F,X));break}case w.i8:{ie.operations.push(rt(F,X,Z));break}case w.UP:{ie.operations.push(Ze(F,X,Z));break}default:{let ue=X.firstChild;for(;ue;)j(F,ue,Z),ue=ue.nextSibling}}}function he(F,X){const Z=X.getChild(w.gw),ie=(0,A.AA)(F,Z),ue=(0,A.AA)(F,Z?.nextSibling);let K=(0,A.AA)(F,X.getChild(w.Qf));return K=K.substring(1,K.length-1),{label:ie,op:ue,value:K}}function M(F,X){const Z=(0,A.AA)(F,X.getChild(w.dJ)),ie=Ue((0,A.AA)(F,X.getChild(w.Qf)));if(X.getChild(w.w7)?.getChild(w.Ip))return{operation:{id:r.EF.LineFilterIpMatches,params:[Z,ie]}};const K=[ie];let Qe=X.getChild(w.ih);for(;Qe;)K.push(Ue((0,A.AA)(F,Qe.getChild(w.Qf)))),Qe=Qe.getChild(w.ih);return{operation:{id:{"|=":r.EF.LineContains,"!=":r.EF.LineContainsNot,"|~":r.EF.LineMatchesRegex,"!~":r.EF.LineMatchesRegexNot}[Z],params:K}}}function ce(F,X){const Z=X.firstChild,ie=(0,A.AA)(F,Z),ue=Ue((0,A.AA)(F,X.getChild(w.Qf)));let K=ue?[ue]:[];const Qe=(0,I.mD)(ie);return Qe&&!(0,I.VI)(Qe,K)&&(K=Qe?.defaultParams||[]),{id:ie,params:K}}function D(F,X){const Z=X.getChild(w.LM),ie=(0,A.AA)(F,Z),ue=[...(0,A.R1)(F,X,w.Gn)];return{id:ie,params:ue}}function J(F,X){const Z=[],ie=[];let ue;const K=X.from;return X.toTree().iterate({enter:Q=>{Q.type.id===w.ov?Z.push(F.substring(Q.from+K,Q.to+K)):Q.type.id===w.Gn?ie.push(F.substring(Q.from+K,Q.to+K)):Q.type.id===A.Ql&&(ue=`Unexpected string "${F.substring(Q.from+K,Q.to+K)}"`)}}),{operation:{id:r.EF.Logfmt,params:[Z.includes("--strict"),Z.includes("--keep-empty"),...ie]},error:ue}}function Ee(F,X){if(X.getChild(w.Or)||X.getChild(w.KD)||X.getChild("Comma"))return{error:'Label filter with comma, "and", "or" not supported in query builder'};if(X.firstChild.type.id===w.GA){const x=X.firstChild,P=x?.getChild(w.gw),b=P?.nextSibling,H=x?.getChild(w.Qf),de=Ue((0,A.AA)(F,H));return{operation:{id:r.EF.LabelFilterIpMatches,params:[(0,A.AA)(F,P),(0,A.AA)(F,b),de]}}}const Z=r.EF.LabelFilter;if(X.firstChild.type.id===w.Jq){const P=X.firstChild.firstChild.firstChild,b=P.nextSibling,H=b.nextSibling,de=Ue((0,A.AA)(F,H));return{operation:{id:Z,params:[(0,A.AA)(F,P),(0,A.AA)(F,b),de]}}}const ue=X.firstChild.firstChild,K=ue.nextSibling,Qe=K.nextSibling,Q=[(0,A.AA)(F,ue),(0,A.AA)(F,K),Ue((0,A.AA)(F,Qe))];return Q.join("")==="__error__="?{operation:{id:r.EF.LabelFilterNoErrors,params:[]}}:{operation:{id:Z,params:Q}}}function S(F,X){const Z=r.EF.LineFormat,ie=Ue((0,A.AA)(F,X.getChild(w.Qf)));return{id:Z,params:[ie]}}function Ke(F,X){const Z=r.EF.LabelFormat,ie=X.getChild(w.gw),K=ie.nextSibling.nextSibling;return{id:Z,params:[(0,A.AA)(F,K),Ue((0,A.AA)(F,ie))]}}function we(){return{id:r.EF.Decolorize,params:[]}}function pe(F,X,Z){const ie=X.getChild(w.HV),ue=X.getChild(w.bY),K=X.getChild(w.sK);if(ie&&j(F,ie,Z),ue&&j(F,ue,Z),K){if(K.nextSibling?.type.id===w.yW){const Qe=K.nextSibling,Q=Qe.nextSibling;return{operation:{id:r.EF.Unwrap,params:[(0,A.AA)(F,Q),(0,A.AA)(F,Qe)]}}}return{operation:{id:r.EF.Unwrap,params:[(0,A.AA)(F,K?.nextSibling),""]}}}return{}}function Ie(F,X,Z){const ie=X.getChild(w.lo),ue=(0,A.AA)(F,ie),K=X.getChild(w.wN),Qe=X.getChild(w.xo),Q=K!=null?[(0,A.AA)(F,K)]:[],x=Qe?.getChild(w.Q6),P=x?(0,A.AA)(F,x):null,b=X.getChild(w.aU);P&&Q.unshift(P.substring(1,P.length-1)),b&&Q.push(...(0,A.R1)(F,b,w.gw));const H={id:ue,params:Q};return Qe&&j(F,Qe,Z),H}function L(F,X,Z){const ie=X.getChild(w.ZQ);let ue=(0,A.AA)(F,ie);const K=X.getChild(w.aU),Qe=[],Q=X.getChild(w.wN);Q&&Qe.push(Number((0,A.AA)(F,Q))),K&&(K.getChild(w.By)&&ue&&(ue=`__${ue}_by`),K.getChild(w.xB)&&(ue=`__${ue}_without`),Qe.push(...(0,A.R1)(F,K,w.gw)));const x=X.getChild(w.Yw),P={id:ue,params:Qe};return x&&(x.firstChild?.type.id===w.MK&&Z.errors.push({text:"Query parsing is ambiguous.",from:x.firstChild.from,to:x.firstChild?.to}),j(F,x,Z)),P}const re=Re.C.reduce((F,X)=>(F[X.sign]={id:X.id,comparison:X.comparison},F),{});function be(F,X,Z){const ie=Z.query,ue=X.firstChild,K=(0,A.AA)(F,ue.nextSibling),Qe=Pe(F,X.getChild(w.o5)),Q=X.lastChild,x=re[K],P=_(ue,"MetricExpr.LiteralExpr.Number"),b=_(Q,"MetricExpr.LiteralExpr.Number"),H=Q.getChild(w.MK);if(P||j(F,ue,Z),b)ie.operations.push((0,A.rq)(x,F,Q,!!Qe?.isBool));else if(H){const de=(0,A.z9)(Q);de?.type.id===w.wN&&ie.operations.push((0,A.rq)(x,F,de,!!Qe?.isBool)),j(F,Q,Z)}else{ie.binaryQueries=ie.binaryQueries||[];const de={operator:K,query:{labels:[],operations:[]}};Qe?.isMatcher&&(de.vectorMatchesType=Qe.matchType,de.vectorMatches=Qe.matches),ie.binaryQueries.push(de),j(F,Q,{query:de.query,errors:Z.errors})}}function Pe(F,X){if(!X)return;const Z=X.getChild(w.wT),ie=X.getChild(w.x);if(!Z&&ie)return{isBool:!0,isMatcher:!1};{if(!Z)return;const ue=(0,A.AA)(F,Z.getChild(w.x$)?.getChild(w.qJ));return{isMatcher:!0,isBool:!!ie,matches:ue,matchType:Z.getChild(w.On)?"on":"ignoring"}}}function Ae(F){return F?.parent?.type.id===w.Q6}function Ue(F){return F[0]==='"'&&F[F.length-1]==='"'?F.substring(1,F.length-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"):F.replace(/`/g,"")}function _(F,X){let Z=F;const ie=X.split(".");for(const ue of ie)if(Z=Z.getChild(ue),!Z)return null;return Z}function Ne(F,X,Z){const ie=(0,A.xz)(F,X);return ie.text=`${Z}: ${ie.text}`,ie}function Fe(F){return F.labels.length===0&&F.operations.length===0}function rt(F,X,Z){const ie=[];let ue=X.getChild(w.LQ);for(;ue;){const K=(0,A.AA)(F,ue.getChild(w.yj));K&&ie.push(K),ue=ue?.getChild(w.LQ)}return ie.reverse(),{id:r.EF.Drop,params:ie}}function Ze(F,X,Z){const ie=[];let ue=X.getChild(w.J3);for(;ue;){const K=(0,A.AA)(F,ue.getChild(w.UM));K&&ie.push(K),ue=ue?.getChild(w.J3)}return ie.reverse(),{id:r.EF.Keep,params:ie}}},56245:(dt,Ve,d)=>{"use strict";d.d(Ve,{AA:()=>he,If:()=>j,Ql:()=>w,R1:()=>ce,SY:()=>A,qk:()=>r,rq:()=>M,xz:()=>I,z9:()=>Re});const w=0;function Re(J){return J.firstChild?Re(J.firstChild):J}function I(J,Ee){return{text:he(J,Ee),from:Ee.from,to:Ee.to,parentType:Ee.parent?.name}}const A=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function r(J){return J.replace(A,(Ee,S,Ke,we,pe,Ie,L)=>{const re=we||L;let be=S,Pe="0";return Ke&&(be=Ke,Pe="1"),pe&&(be=pe,Pe="2"),`__V_${Pe}__`+be+"__V__"+(re?"__F__"+re+"__F__":"")})}const ye=[(J,Ee)=>`$${J}`,(J,Ee)=>`[[${J}${Ee?`:${Ee}`:""}]]`,(J,Ee)=>`\${${J}${Ee?`:${Ee}`:""}}`];function j(J){return J.replace(/__V_(\d)__(.+?)__V__(?:__F__(\w+)__F__)?/g,(Ee,S,Ke,we)=>ye[parseInt(S,10)](Ke,we))}function he(J,Ee){return Ee?j(J.substring(Ee.from,Ee.to)):""}function M(J,Ee,S,Ke){const we=[parseFloat(he(Ee,S))];return J.comparison&&we.push(Ke),{id:J.id,params:we}}function ce(J,Ee,S){if(Ee.type.id===S||Ee.name===S)return[he(J,Ee)];const Ke=[];let we=0,pe=Ee.childAfter(we);for(;pe;)Ke.push(...ce(J,pe,S)),we=pe.to,pe=Ee.childAfter(we);return Ke}const D=J=>J.split(" ").map(S=>`${S}.*`).join("")},75723:(dt,Ve,d)=>{"use strict";d.d(Ve,{Ac:()=>ce,nE:()=>M,db:()=>S,fV:()=>J,sz:()=>Ke,YB:()=>D,aN:()=>Ee});var w=d(11261),Re=d(70416),I=d(97535);function A(we){let pe;try{pe=JSON.parse(we)}catch{}return typeof pe=="object"}const r=/(?:^|\s)([\w\(\)\[\]\{\}]+)=(""|(?:".*?[^\\]"|[^"\s]\S*))/;function ye(we){return r.test(we)}function j(we){let pe;try{return pe=JSON.parse(we),pe.hasOwnProperty("_entry")}catch{return!1}}var he=d(43269);function M(we){return(we.fields.find(Ie=>Ie.name==="labels")?.values??[]).some(Ie=>Ie.__error__!==void 0)}function ce(we){return(we.fields.find(Ie=>Ie.name==="labels")?.values??[]).some(Ie=>Ie.level!==void 0)}function D(we){const pe=we.fields.find(Pe=>Pe.type===w.PU.string);if(pe==null)return{hasJSON:!1,hasLogfmt:!1,hasPack:!1};const Ie=pe.values;let L=!1,re=!1,be=!1;return Ie.forEach(Pe=>{A(Pe)&&(L=!0,be=j(Pe)),ye(Pe)&&(re=!0)}),{hasLogfmt:re,hasJSON:L,hasPack:be}}function J(we,pe=he.HD.Indexed){const Ie=we?.fields?.find(be=>be.name==="labels")?.values??[],L=we?.fields?.find(be=>be.name==="labelTypes")?.values??[];if(!Ie?.length)return[];if(!L?.length){if(pe===he.HD.Indexed){const{keys:be}=(0,I.P7)(Ie);return be}return[]}let re=new Set;for(let be=0;be<Ie.length;be++){const Pe=Ie[be],Ae=L[be],Ue=Object.keys(Pe).filter(_=>Ae[_]===pe);re=new Set([...re,...Ue])}return Array.from(re)}function Ee(we){const pe=we?.fields?.find(L=>L.name==="labels")?.values??[];return pe?.length?Object.keys(pe[0]).filter(L=>{const re=pe[0][L];return re?!isNaN(Number(re))||(0,Re.pp)(re)||(0,I.tY)(re):!1}).filter(L=>pe.every(re=>re[L])):[]}function S(we){const pe=we.fields.find(L=>L.name==="labels"&&L.type===w.PU.other);return pe==null?!1:pe.values.some(L=>L.__error__)}function Ke(we){const pe=we.fields.find(re=>re.name==="labels"&&re.type===w.PU.other);if(pe==null)return null;const Ie=pe.values.slice(0,2);let L=null;for(let re of Ie){const be=Object.keys(re).find(Pe=>Pe==="lvl"||Pe.includes("level"));if(be){L=be;break}}return L}},79007:(dt,Ve,d)=>{"use strict";d.d(Ve,{Ex:()=>pe,jg:()=>ce,uJ:()=>Ie});var w=d(41987),Re=d(42952),I=d(14110),A=d(32264),r=d(27724),ye=d(51814),j=d(56587),he=d(56245),M=d(43269);const ce=({payload:{dashboardId:L,orgId:re,grafanaVersion:be,queries:Pe}})=>{try{const Ae=Pe[ye.id]?.filter(K=>!K.hide)?.map(K=>(0,j.vV)(K));if(!Ae?.length)return;const Ue=Ae.filter(K=>(0,j.sI)(K.expr)),_=Ae.filter(K=>!(0,j.sI)(K.expr)),Ne=Ae.filter(K=>K.queryType===M.U3.Instant),Fe=Ae.filter(K=>K.queryType===M.U3.Range),rt=Ae.filter(K=>K.editorMode===Re.f.Builder),Ze=Ae.filter(K=>K.editorMode===Re.f.Code),F=Ae.filter(D),X=Ae.filter(J),Z=Ae.filter(Ee),ie=Ae.filter(S),ue={grafana_version:be,dashboard_id:L,org_id:re,queries_count:Ae.length,logs_queries_count:Ue.length,metric_queries_count:_.length,instant_queries_count:Ne.length,range_queries_count:Fe.length,builder_mode_queries_count:rt.length,code_mode_queries_count:Ze.length,queries_with_template_variables_count:F.length,queries_with_changed_resolution_count:X.length,queries_with_changed_line_limit_count:Z.length,queries_with_changed_legend_count:ie.length};(0,I.rR)("grafana_loki_dashboard_loaded",ue)}catch(Ae){console.error("error in loki tracking handler",Ae)}},D=L=>he.SY.test(L.expr),J=L=>L.resolution?L.resolution!==1:!1,Ee=L=>L.maxLines!==null&&L.maxLines!==void 0,S=L=>L.legendFormat?L.legendFormat!=="":!1,Ke=L=>{const re=[r.Gf,r.M1,r.mL];return!!(L===r.lb||re.some(be=>L.startsWith(be)))},we=L=>{let re=0;for(const be of L.data){const Pe=be.meta?.custom?.lokiQueryStatKey;Pe&&(re+=be.meta?.stats?.find(Ae=>Ae.displayName===Pe)?.value??0)}return re};function pe(L,re,be,Pe={},Ae={}){const{app:Ue,targets:_}=re;if(Ue===w.Jk.Dashboard||Ue===w.Jk.PanelViewer)return;let Ne=we(L);for(const Fe of _){if(Ke(Fe.refId))return;(0,I.rR)("grafana_loki_query_executed",{app:Ue,grafana_version:A.$.buildInfo.version,editor_mode:Fe.editorMode,has_data:L.data.some(rt=>rt.length>0),has_error:L.error!==void 0,legend:Fe.legendFormat,line_limit:Fe.maxLines,obfuscated_query:(0,j.$F)(Fe.expr),query_type:(0,j.sI)(Fe.expr)?"logs":"metric",query_vector_type:Fe.queryType,resolution:Fe.resolution,simultaneously_executed_query_count:_.filter(rt=>!rt.hide).length,simultaneously_hidden_query_count:_.filter(rt=>rt.hide).length,time_range_from:re?.range?.from?.toISOString(),time_range_to:re?.range?.to?.toISOString(),time_taken:Date.now()-be.getTime(),bytes_processed:Ne,is_split:!1,predefined_operations_applied:Pe.predefinedOperations?Fe.expr.includes(Pe.predefinedOperations):"n/a",...Ae})}}function Ie(L,re,be,Pe,Ae={}){const Ue={split_query_group_count:re.length,split_query_largest_partition_size:Math.max(...re.map(({partition:_})=>_.length)),split_query_total_request_count:re.reduce((_,{partition:Ne})=>_+Ne.length,0),is_split:!0,simultaneously_executed_query_count:be.targets.filter(_=>!_.hide).length,simultaneously_hidden_query_count:be.targets.filter(_=>_.hide).length};for(const _ of re){const Ne=_.partition.length;pe(L,_.request,Pe,Ae,{...Ue,split_query_partition_size:Ne})}}},30115:dt=>{var Ve=typeof Element<"u",d=typeof Map=="function",w=typeof Set=="function",Re=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function I(A,r){if(A===r)return!0;if(A&&r&&typeof A=="object"&&typeof r=="object"){if(A.constructor!==r.constructor)return!1;var ye,j,he;if(Array.isArray(A)){if(ye=A.length,ye!=r.length)return!1;for(j=ye;j--!==0;)if(!I(A[j],r[j]))return!1;return!0}var M;if(d&&A instanceof Map&&r instanceof Map){if(A.size!==r.size)return!1;for(M=A.entries();!(j=M.next()).done;)if(!r.has(j.value[0]))return!1;for(M=A.entries();!(j=M.next()).done;)if(!I(j.value[1],r.get(j.value[0])))return!1;return!0}if(w&&A instanceof Set&&r instanceof Set){if(A.size!==r.size)return!1;for(M=A.entries();!(j=M.next()).done;)if(!r.has(j.value[0]))return!1;return!0}if(Re&&ArrayBuffer.isView(A)&&ArrayBuffer.isView(r)){if(ye=A.length,ye!=r.length)return!1;for(j=ye;j--!==0;)if(A[j]!==r[j])return!1;return!0}if(A.constructor===RegExp)return A.source===r.source&&A.flags===r.flags;if(A.valueOf!==Object.prototype.valueOf)return A.valueOf()===r.valueOf();if(A.toString!==Object.prototype.toString)return A.toString()===r.toString();if(he=Object.keys(A),ye=he.length,ye!==Object.keys(r).length)return!1;for(j=ye;j--!==0;)if(!Object.prototype.hasOwnProperty.call(r,he[j]))return!1;if(Ve&&A instanceof Element)return!1;for(j=ye;j--!==0;)if(!((he[j]==="_owner"||he[j]==="__v"||he[j]==="__o")&&A.$$typeof)&&!I(A[he[j]],r[he[j]]))return!1;return!0}return A!==A&&r!==r}dt.exports=function(r,ye){try{return I(r,ye)}catch(j){if((j.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw j}}},8227:(dt,Ve,d)=>{"use strict";d.d(Ve,{A:()=>I});const w=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Re(A){return typeof A=="string"&&w.test(A)}const I=Re},36195:(dt,Ve,d)=>{"use strict";d.d(Ve,{AL:()=>Ut,By:()=>Ur,CX:()=>jr,GA:()=>ht,GN:()=>Wr,Gn:()=>ia,HV:()=>mr,I4:()=>St,Ip:()=>sa,J3:()=>Ra,J_:()=>xt,Jq:()=>Wt,K0:()=>ge,K3:()=>ee,KD:()=>Ea,LM:()=>Me,LQ:()=>Lr,MD:()=>ur,MK:()=>Dr,Nl:()=>nr,On:()=>kr,Or:()=>xa,PN:()=>Bt,Q6:()=>tr,Qf:()=>gt,Rh:()=>Ar,Sg:()=>zr,Tz:()=>bt,UK:()=>yr,UM:()=>pa,UP:()=>fr,Yw:()=>Ct,ZQ:()=>Hr,Zg:()=>Xt,Zj:()=>qt,aU:()=>rr,bY:()=>Et,c$:()=>_e,dJ:()=>_r,dw:()=>Vt,eF:()=>_t,e_:()=>Kr,g$:()=>Vr,gw:()=>yt,h1:()=>Nt,i8:()=>Gr,iT:()=>Dt,ih:()=>$a,lo:()=>ct,o5:()=>ma,ov:()=>dr,pH:()=>zt,q5:()=>Qa,qJ:()=>ar,sK:()=>Ot,sq:()=>Ft,t3:()=>Er,uk:()=>Lt,w7:()=>Jt,wN:()=>ut,wT:()=>Da,x:()=>ta,x$:()=>tn,x0:()=>Ma,xB:()=>Br,xo:()=>Rr,yW:()=>Cr,yj:()=>da});var w=d(48820);const Re=1,I=2,A=3,r=4,ye=5,j=6,he=7,M=8,ce=9,D=10,J=11,Ee=12,S=13,Ke=14,we=15,pe=16,Ie=17,L=18,re=19,be=20,Pe=21,Ae=22,Ue=23,_=24,Ne=25,Fe=26,rt=27,Ze=28,F=29,X=30,Z=31,ie=32,ue=33,K=34,Qe=35,Q=93,x={json:Re,logfmt:I,unpack:A,pattern:r,regexp:ye,label_format:he,line_format:M,label_replace:ce,vector:D,offset:J,bool:Ee,on:S,ignoring:Ke,group_left:we,group_right:pe,unwrap:j,decolorize:Ie,drop:L,keep:re},P=N=>x[N.toLowerCase()]||-1,b={by:be,without:Pe,and:Ae,or:Ue,unless:_,sum:Ne,avg:Fe,count:rt,max:Ze,min:F,stddev:X,stdvar:Z,bottomk:ie,topk:ue,sort:K,sort_desc:Qe},H=N=>b[N.toLowerCase()]||-1,de={__proto__:null,ip:291,count_over_time:297,rate:299,rate_counter:301,bytes_over_time:303,bytes_rate:305,avg_over_time:307,sum_over_time:309,min_over_time:311,max_over_time:313,stddev_over_time:315,stdvar_over_time:317,quantile_over_time:319,first_over_time:321,last_over_time:323,absent_over_time:325,bytes:331,duration:333,duration_seconds:335},ee=w.U1.deserialize({version:14,states:"EtOYQPOOO#cQPO'#DUO$rQPO'#DTOYQPO'#DTOOQO'#E_'#E_O%PQPO'#E^OOQO'#Ez'#EzO%UQPO'#EyQ%aQPOOOOQO'#FY'#FYO&bQPO'#FYO&gQPO'#FZO&lQPO'#F[OOQO'#E]'#E]OOQO'#DS'#DSOOQO'#E`'#E`OOQO'#Ea'#EaOOQO'#Eb'#EbOOQO'#Ec'#EcOOQO'#Ed'#EdOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkOOQO'#El'#ElOOQO'#Em'#EmOOQO'#En'#EnO&qQPO'#DWOOQO'#DV'#DVO'PQPO,59pOOQO'#Dc'#DcO'XQPO'#DbO'aQPO'#DaO(zQPO'#D`O*eQPO'#D`OOQO'#D_'#D_O,gQPO,59oO-uQPO,59oO-|QPO,5:wO.TQPO,5:xO.`QPO'#EwO0kQPO,5;eO0rQPO,5;eO0wQPO,5;gO0wQPO,5;gO0wQPO,5;gO0wQPO,5;gO0wQPO,5;gO0wQPO,5;gOOQO,5;t,5;tOYQPO,5;uO3ZQPO,5;vO3`QPO,59rO#cQPO,59qOOQO1G/[1G/[OOQO'#Df'#DfO3eQPO,59|O5OQPO,59|OOQO'#Dg'#DgO5TQPO,59{OOQO,59{,59{O5]QPO'#DWO5zQPO'#DjO7kQPO'#DmO9XQPO'#DmOOQO'#Dm'#DmOOQO'#Dt'#DtOOQO'#Dr'#DrO+TQPO'#DrO9^QPO,59zO:wQPO'#EQO:|QPO'#EROOQO'#EU'#EUO;RQPO'#EVO;WQPO'#EYOOQO,59z,59zOOQO,59y,59yOOQO1G/Z1G/ZOOQO1G0c1G0cO;]QPO'#EoO.WQPO'#EoO;qQPO1G0dO;vQPO1G0dO;{QPO,5;cO<TQPO1G1PO=`QPO1G1PO=gQPO1G1PO=nQPO'#E}O?|QPO'#E|O@WQPO'#E|OYQPO1G1ROYQPO1G1ROYQPO1G1ROYQPO1G1ROYQPO1G1ROYQPO1G1RO@bQPO1G1aO@iQPO1G1bOOQO1G/^1G/^OOQO1G/]1G/]O5TQPO1G/hO@nQPO1G/hO@sQPO'#DhOB^QPO'#DhOOQO1G/g1G/gOBcQPO,59rOBtQPO,5:aOOQO'#Dk'#DkOCPQPO,5:UODpQPO'#DpOOQO'#Do'#DoOF^QPO,5:]OGwQPO,5:YOOQO,5:X,5:XOIbQPO,5:^O+TQPO,5:^O+TQPO,5:^OOQO,5:l,5:lOIpQPO'#ETOOQO'#ES'#ESOIuQPO,5:mOK`QPO'#EXOOQO'#EX'#EXOOQO'#EW'#EWOMPQPO,5:qONjQPO'#E[OOQO'#E['#E[OOQO'#EZ'#EZO!!ZQPO,5:tO!#tQPO'#D`O;]QPO,5;ZO!#{QPO'#EpO!$QQPO,5;ZO!$kQPO,5;ZO!$uQPO,5;ZO!$|QPO,5;ZO!%RQPO7+&OO.WQPO7+&OOOQO'#Ex'#ExO!&cQPO1G0}OOQO1G0}1G0}O!&kQPO7+&kOYQPO7+&kO!'{QPO7+&kO!(SQPO7+&kO!(ZQQO'#FOOOQO,5;i,5;iO!*iQPO,5;hO!*pQPO,5;hO!,RQPO7+&mO!,YQPO7+&mOOQO7+&m7+&mO!,gQPO7+&mO!,nQPO7+&mO!-sQPO7+&mO!.TQPO7+&{OOQO7+&|7+&|OOQO7+%S7+%SO!.YQPO7+%SO5TQPO,5:SO!._QPO,5:SO!.dQPO1G/yOOQO1G/{1G/{OOQO1G0S1G0SOOQO1G0U1G0UOOQO,5:V,5:VO!.iQPO1G/wO!0SQPO,5:[O!0XQPO,5:ZOOQO1G/x1G/xO!0^QPO1G/xO!1wQPO,5:oO:|QPO,5:nO;RQPO,5:rO;WQPO,5:uO!2PQPO,5;^O!$QQPO1G0uO!2_QPO1G0uO!2gQPO,5;[O+TQPO,5;^O!2lQPO1G0uO!2sQPO'#EqO!2xQPO1G0uO!2lQPO1G0uO!3QQPO1G0uO!3XQPO1G0uO;lQPO1G0uOOQO1G0u1G0uOOQO<<Ij<<IjO!3dQPO<<IjO!3iQPO,5;dOOQO7+&i7+&iOOQO<<JV<<JVO!3nQPO<<JVOYQPO<<JVOOQO'#FQ'#FQO!3uQPO,5;jOOQO'#FP'#FPOOQO,5;j,5;jOOQO1G1S1G1SO!3}QPO1G1SO!6WQPO<<JgOOQO<<Hn<<HnOOQO1G/n1G/nO!6]QPO1G/nO!6bQPO7+%eOOQO1G/v1G/vOOQO1G/u1G/uOOQO1G0Z1G0ZOOQO1G0Y1G0YOOQO1G0^1G0^OOQO1G0a1G0aOOQO'#Es'#EsOOQO1G0x1G0xO!6gQPO1G0xOOQO'#Et'#EtOOQO'#Eu'#EuOOQO'#Ev'#EvOOQO7+&a7+&aOOQO1G0v1G0vO!6lQPO1G0xO!7QQPO7+&aOOQO,5;],5;]O!7YQPO7+&aO;lQPO7+&aO!7aQPO7+&aO!7lQPOAN?UOOQO1G1O1G1OO!8|QPOAN?qO!:^QPOAN?qO!:eQQO1G1UOOQO1G1U1G1UOOQO7+&n7+&nO!:mQPOAN@ROOQO7+%Y7+%YO!:rQPO<<IPO!:wQPO7+&dO!:|QPO<<I{O!;UQPO<<I{O!;^QPO'#ErO!;cQPO<<I{OOQOG24pG24pOOQOG25]G25]OOQO1G1V1G1VOOQO7+&p7+&pO!;kQPOG25mOOQOAN>kAN>kO!;pQPO<<JOOOQOAN?gAN?gO!;uQPOAN?gO!;}QPOLD+XOOQOAN?jAN?jOOQO,5:m,5:mO!<SQPO!$'NsO!<XQPO!)9D_O!<^QPO!.K9yOOQO!4//e!4//eO:|QPO'#ERO!<cQPO'#D`O!=ZQPO,59oO!=eQPO'#DTOYQPO1G1ROYQPO1G1ROYQPO1G1ROYQPO1G1ROYQPO1G1ROYQPO1G1RO0wQPO,5;gO0wQPO,5;gO0wQPO,5;gO0wQPO,5;gO0wQPO,5;gO0wQPO,5;gO!>pQPO7+&mO!>wQPO7+&mO!?UQPO7+&mO!@^QPO7+&mO!@eQPO7+&mO!?]QPO'#E{",stateData:"!@r~O$ROStOS~OXZOY[OiUOjUOkUOlUOmUOnUOoUOpUOqUOrUOsUO!sXO#vYO#wYO$SPO$WRO$Y_O$Z`O$[aO$]bO$^cO$_dO$`eO$afO$bgO$chO$diO$ejO$fkO$glO$hmO~O{nO~O!OqO!QqO!WqO!XqOfwXgwXhwX!jwX!lwX!mwX!nwX!owX#vwX#wwX#xwX#ywX#zwX#{wX~O!]uO$PwX$XwX~P#hO$WzO~Od{Oe{O$W|O~Of!POg!OOh!PO!O!TO!j!TO!l!TO!m!TO!n!TO!o!TO#v!QO#w!QO#x!RO#y!RO#z!RO#{!SO~O!s!UO~O$W!VO~O$W!WO~O|!XO!O!XO!P!XO!Q!XO~O$T!YO$U!ZO~O}!]O$V!_O~Og!`Of!TXh!TX!O!TX!Q!TX!W!TX!X!TX!]!TX!j!TX!l!TX!m!TX!n!TX!o!TX#v!TX#w!TX#x!TX#y!TX#z!TX#{!TX$P!TX$X!TX$i!TX$T!TX~O!OqO!QqO!WqO!XqOf!SXg!SXh!SX!]!SX!j!SX!l!SX!m!SX!n!SX!o!SX#v!SX#w!SX#x!SX#y!SX#z!SX#{!SX$P!SX$X!SX$i!SX$T!SX~OP!dOQ!cOR!fOS!eOT!eOV!lOW!kOa!mOb!nOc!oO{!bO$W!iO~O!OqO!QqO!WqO!XqOfwagwahwa!jwa!lwa!mwa!nwa!owa#vwa#wwa#xwa#ywa#zwa#{wa~O!]uO$Pwa$Xwa~P+]OfvXgvXhvX!OvX!jvX!lvX!mvX!nvX!ovX#vvX#wvX#xvX#yvX#zvX#{vX~O$X!rO~P,tO$X!sO~P,tO!s!wO$SPO$W!uO~O$W!xO~OXZOY[OiUOjUOkUOlUOmUOnUOoUOpUOqUOrUOsUO#vYO#wYO$SPO$WRO$Y_O$Z`O$[aO$]bO$^cO$_dO$`eO$afO$bgO$chO$diO$ejO$fkO$glO$hmO~O!s!zO~P.eO$W!{O~O[#OO]!|O^!|OX#pPY#pPi#pPj#pPk#pPl#pPm#pPn#pPo#pPp#pPq#pPr#pPs#pP!s#pP#v#pP#w#pP$S#pP$W#pP$Y#pP$Z#pP$[#pP$]#pP$^#pP$_#pP$`#pP$a#pP$b#pP$c#pP$d#pP$e#pP$f#pP$g#pP$h#pP~O!s#WO~O}#XO~Og#ZOf!Uah!Ua!O!Ua!Q!Ua!W!Ua!X!Ua!]!Ua!j!Ua!l!Ua!m!Ua!n!Ua!o!Ua#v!Ua#w!Ua#x!Ua#y!Ua#z!Ua#{!Ua$P!Ua$X!Ua$i!Ua$T!Ua~O$W#[O~O}#]O$V!_O~O|#`O!O#`O!P!XO!Q!XO!j#aO!l#aO!m#aO!n#aO!o#aO~O{#dO!`#bOf!^Xg!^Xh!^X!O!^X!Q!^X!W!^X!X!^X!]!^X!j!^X!l!^X!m!^X!n!^X!o!^X#v!^X#w!^X#x!^X#y!^X#z!^X#{!^X$P!^X$X!^X$i!^X$T!^X~O{#dOf!aXg!aXh!aX!O!aX!Q!aX!W!aX!X!aX!]!aX!j!aX!l!aX!m!aX!n!aX!o!aX#v!aX#w!aX#x!aX#y!aX#z!aX#{!aX$P!aX$X!aX$i!aX$T!aX~O}#hO~Of#jOg#kO$T#jOh!Sa!O!Sa!Q!Sa!W!Sa!X!Sa!]!Sa!j!Sa!l!Sa!m!Sa!n!Sa!o!Sa#v!Sa#w!Sa#x!Sa#y!Sa#z!Sa#{!Sa$P!Sa$X!Sa$i!Sa~O}#lO~O{#mO~O{#pO~O{#tO~O!OqO!QqO!WqO!XqO!]#xO$i#zO~O$X$PO~O$T$QO~O{$RO$X$TO~O$X$UO~P,tOf#|Xg#|Xh#|X!O#|X!j#|X!l#|X!m#|X!n#|X!o#|X#v#|X#w#|X#x#|X#y#|X#z#|X#{#|X$X#|X~O$T$VO~P<[O!s$XO~P.eO$W$YO~OX#pXY#pXi#pXj#pXk#pXl#pXm#pXn#pXo#pXp#pXq#pXr#pXs#pX!s#pX#v#pX#w#pX$S#pX$W#pX$Y#pX$Z#pX$[#pX$]#pX$^#pX$_#pX$`#pX$a#pX$b#pX$c#pX$d#pX$e#pX$f#pX$g#pX$h#pX~O_$[O`$[O~P=sO]!|O^!|O~P=sO$T$dO~P,tO$X$eO~O}$gO~Og$hOf![Xh![X!O![X!Q![X!W![X!X![X!]![X!j![X!l![X!m![X!n![X!o![X#v![X#w![X#x![X#y![X#z![X#{![X$P![X$X![X$i![X$T![X~O$W$iO~O}#XO!k$kO!q$lO!s$mO$V!_O~O!k$kO!q$lO!s$mO~O{#dO!`$nOf!^ag!^ah!^a!O!^a!Q!^a!W!^a!X!^a!]!^a!j!^a!l!^a!m!^a!n!^a!o!^a#v!^a#w!^a#x!^a#y!^a#z!^a#{!^a$P!^a$X!^a$i!^a$T!^a~O|$pOf!dXg!dXh!dX!O!dX!Q!dX!W!dX!X!dX!]!dX!j!dX!l!dX!m!dX!n!dX!o!dX#v!dX#w!dX#x!dX#y!dX#z!dX#{!dX$P!dX$T!dX$X!dX$i!dX~O$T$qOf!eag!eah!ea!O!ea!Q!ea!W!ea!X!ea!]!ea!j!ea!l!ea!m!ea!n!ea!o!ea#v!ea#w!ea#x!ea#y!ea#z!ea#{!ea$P!ea$X!ea$i!ea~O$T$qOf!bag!bah!ba!O!ba!Q!ba!W!ba!X!ba!]!ba!j!ba!l!ba!m!ba!n!ba!o!ba#v!ba#w!ba#x!ba#y!ba#z!ba#{!ba$P!ba$X!ba$i!ba~Of#jOg#kO$T#jO$X$rO~O|$tO~O$T$uOf!uag!uah!ua!O!ua!Q!ua!W!ua!X!ua!]!ua!j!ua!l!ua!m!ua!n!ua!o!ua#v!ua#w!ua#x!ua#y!ua#z!ua#{!ua$P!ua$X!ua$i!ua~O|!XO!O!XO!P!XO!Q!XOf!{Xg!{Xh!{X!W!{X!X!{X!]!{X!j!{X!l!{X!m!{X!n!{X!o!{X#v!{X#w!{X#x!{X#y!{X#z!{X#{!{X$P!{X$T!{X$X!{X$i!{X~O$T$vOf!yag!yah!ya!O!ya!Q!ya!W!ya!X!ya!]!ya!j!ya!l!ya!m!ya!n!ya!o!ya#v!ya#w!ya#x!ya#y!ya#z!ya#{!ya$P!ya$X!ya$i!ya~O|!XO!O!XO!P!XO!Q!XOf#OXg#OXh#OX!W#OX!X#OX!]#OX!j#OX!l#OX!m#OX!n#OX!o#OX#v#OX#w#OX#x#OX#y#OX#z#OX#{#OX$P#OX$T#OX$X#OX$i#OX~O$T$wOf!|ag!|ah!|a!O!|a!Q!|a!W!|a!X!|a!]!|a!j!|a!l!|a!m!|a!n!|a!o!|a#v!|a#w!|a#x!|a#y!|a#z!|a#{!|a$P!|a$X!|a$i!|a~OU$xO~P*eO!k${O~O!]$|O$i#zO~O!OqO!QqO!WqO!XqO!]#xO~OZ%OO$X#ca~P!$YO$X%TO~P;]O$X%UO~Od{Oe{Of#Qqg#Qqh#Qq!O#Qq!j#Qq!l#Qq!m#Qq!n#Qq!o#Qq#v#Qq#w#Qq#x#Qq#y#Qq#z#Qq#{#Qq$P#Qq$X#Qq$T#Qq~O$T%XO$X%YO~Od{Oe{Of#mqg#mqh#mq!O#mq!j#mq!l#mq!m#mq!n#mq!o#mq#v#mq#w#mq#x#mq#y#mq#z#mq#{#mq$P#mq$X#mq$T#mq~O$X%ZO~P,tO$T%]O~P<[O#u%^O$X%aO~OX#paY#pai#paj#pak#pal#pam#pan#pao#pap#paq#par#pas#pa!s#pa#v#pa#w#pa$S#pa$Y#pa$Z#pa$[#pa$]#pa$^#pa$_#pa$`#pa$a#pa$b#pa$c#pa$d#pa$e#pa$f#pa$g#pa$h#pa~O$W$YO~P!(cO_%cO`%cO$W#pa~P!(cOf!POh!PO!O!TO!j!TO!l!TO!m!TO!n!TO!o!TO#v!QO#w!QO#x#oq#y#oq#z#oq#{#oq$P#oq$X#oq~Og#oq~P!*}Of#oqg#oqh#oq~P!+TOg!OO~P!*}O$P#oq$X#oq~P%aOf#oqg#oqh#oq!O#oq!j#oq!l#oq!m#oq!n#oq!o#oq#x#oq#y#oq#z#oq#{#oq~O#v!QO#w!QO$P#oq$X#oq~P!,xO}%dO~O$X%eO~O}%gO~O$W%hO~O$T$qOf!eig!eih!ei!O!ei!Q!ei!W!ei!X!ei!]!ei!j!ei!l!ei!m!ei!n!ei!o!ei#v!ei#w!ei#x!ei#y!ei#z!ei#{!ei$P!ei$X!ei$i!ei~O}%iO~O{#dO~Of#jO$T#jOg!fih!fi!O!fi!Q!fi!W!fi!X!fi!]!fi!j!fi!l!fi!m!fi!n!fi!o!fi#v!fi#w!fi#x!fi#y!fi#z!fi#{!fi$P!fi$X!fi$i!fi~O{%kO}%kO~O{%pO$k%rO$l%sO$m%tO~OZ%OO$X#ci~O$j%vO~O$X#ci~P!$YO!k%yO~O!]$|O$X#ci~O$X%{O~P;]O!]$|O$X%{O$i#zO~O$X%}O~O{&OO~O$X&PO~P,tO$T&RO$X&SO~O$W$YOX#piY#pii#pij#pik#pil#pim#pin#pio#pip#piq#pir#pis#pi!s#pi#v#pi#w#pi$S#pi$Y#pi$Z#pi$[#pi$]#pi$^#pi$_#pi$`#pi$a#pi$b#pi$c#pi$d#pi$e#pi$f#pi$g#pi$h#pi~O$T&UO~O$X&VO~O}&WO~O$W&XO~Of#jOg#kO$T#jO!]#fi$i#fi$X#fi~O!]$|O$X#cq~O$X#cq~P!$YOZ%OO!]&[O$X#cq~Od{Oe{Of#Q!Rg#Q!Rh#Q!R!O#Q!R!j#Q!R!l#Q!R!m#Q!R!n#Q!R!o#Q!R#v#Q!R#w#Q!R#x#Q!R#y#Q!R#z#Q!R#{#Q!R$P#Q!R$X#Q!R$T#Q!R~Od{Oe{Of#m!Rg#m!Rh#m!R!O#m!R!j#m!R!l#m!R!m#m!R!n#m!R!o#m!R#v#m!R#w#m!R#x#m!R#y#m!R#z#m!R#{#m!R$P#m!R$X#m!R$T#m!R~O$X&_O~P,tO#u%^O$X&aO~O}&bO~O$X&cO~O{&dO~O!]$|O$X#cy~OZ%OO$X#cy~OU$xO~O!]&[O$X#cy~O$T&gO~O$X&hO~O!]$|O$X#c!R~O}&jO~O$T&kO~O}&lO~O$X&mO~OP!dOQ!cOR!fOS!eOT!eOV&nOW!kOa!mOb!nOc!oO{!bO$W!iO~O!]&oO$Twa~P+]O!]&oO$TwX~P#hOf&yOh&yO!O&}O!j&}O!l&}O!m&}O!n&}O!o&}O#v&zO#w&zO#x#oq#y#oq#z#oq#{#oq$T#oq~Og#oq~P!=oOf#oqg#oqh#oq~P!=uOg&xO~P!=oOf&yOg&xOh&yO!O&}O!j&}O!l&}O!m&}O!n&}O!o&}O#v&zO#w&zO#x&{O#y&{O#z&{O#{&|O~O$T#oq~P!?]O#v&zO#w&zO$T#oq~P!,xO",goto:"1P$PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$Q%P%h&W&ZPPPPPP&r'U'f't(VPP(f(n(wP)Q)VP)Q)Q)Y)c)Q)k)|)|*VPPPPPP*VP)|P)Q)Q*`*f)Q)Q*m*p)Q*v*y+P+r,X,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n-T-^-q-}.g.j.j.j.m.|+r/P+r/f0[0m0v0yPPPPPPP+r+r+r[WOR|!{$V%]Q$^#PQ$_#QS$`#R&tQ$a#SQ$b#TQ$c#UQ'O&rQ'P&sQ'Q&uQ'R&vQ'S&wR'T!Vt^O|!V!{#P#Q#R#S#T#U$V%]&r&s&t&u&v&wRxRjQOR|!V!{#P#Q#R#S#T#U$V%]S!tz$QQ#}!u]&q&r&s&t&u&v&wRpPQoP^!hu!i#j#k#x$|&oQ#Y!YS#q!n$vT#u!o$wQwQQ#y!tQ$}#|Q%R#}Q%z%QR&p&q[vQ!t#|#}%Q&q]!qw#y$}%R%z&pitQw!t#y#|#}$}%Q%R%z&p&qhsQw!t#y#|#}$}%Q%R%z&p&qR!atkrQtw!t#y#|#}$}%Q%R%z&p&qQ!^rV#^!`#Z$hW![r!`#Z$hR$j#`Q#_!`Q$f#ZR%f$hV!pu#x&oR#c!cQ#f!cQ#g!dR$o#cU#e!c!d#cR%j$qU!ju#x&oQ#i!iQ$r#jQ$s#kR%w$|_!hu!i#j#k#x$|&o_!gu!i#j#k#x$|&oQ#o!lR&i&nS#n!l&nR%l$uR#s!nQ#r!nR%m$vR#w!oQ#v!oR%n$wj^O#P#Q#R#S#T#U&r&s&t&u&v&wQyRQ!y|Q#V!VQ$W!{Q%[$VR&Q%]w]OR|!V!{#P#Q#R#S#T#U$V%]&r&s&t&u&v&wwTOR|!V!{#P#Q#R#S#T#U$V%]&r&s&t&u&v&wwSOR|!V!{#P#Q#R#S#T#U$V%]&r&s&t&u&v&wQ!vzQ$O!uR%W$QS#|!t#}W$z#y#{%R%SQ%u$yQ%|%TR&Z%{Q%Q#|Q%u$zQ&]%|R&e&ZQ#{!tS$y#y%RQ%P#|Q%S#}S%x$}%QS&Y%z%|R&f&]R%q$xR%o$xQ}VQ%V$PQ%Z$UQ&^%}R&_&PR$S!xwVOR|!V!{#P#Q#R#S#T#U$V%]&r&s&t&u&v&wQ#P!OQ#Q!PQ#R!QQ#S!RQ#T!SQ#U!TQ&r&xQ&s&yQ&t&zQ&u&{Q&v&|R&w&}h!}!O!P!Q!R!S!T&x&y&z&{&|&}R$]#OQ$Z!|Q%b$[R&T%cR%_$YQ%`$YR&`&R",nodeNames:"\u26A0 Json Logfmt Unpack Pattern Regexp Unwrap LabelFormat LineFormat LabelReplace Vector Offset Bool On Ignoring GroupLeft GroupRight Decolorize Drop Keep By Without And Or Unless Sum Avg Count Max Min Stddev Stdvar Bottomk Topk Sort Sort_Desc LineComment LogQL Expr LogExpr Selector Matchers Matcher Identifier Eq String Neq Re Nre PipelineExpr PipelineStage LineFilters LineFilter Filter PipeExact PipeMatch FilterOp Ip OrFilter Pipe LogfmtParser LogfmtParserFlags ParserFlag LabelParser JsonExpressionParser LabelExtractionExpressionList LabelExtractionExpression LogfmtExpressionParser LabelFilter IpLabelFilter UnitFilter DurationFilter Gtr Duration Gte Lss Lte Eql BytesFilter Bytes NumberFilter Number LineFormatExpr LabelFormatExpr LabelsFormat LabelFormatMatcher DecolorizeExpr DropLabelsExpr DropLabels DropLabel KeepLabelsExpr KeepLabels KeepLabel MetricExpr RangeAggregationExpr RangeOp CountOverTime Rate RateCounter BytesOverTime BytesRate AvgOverTime SumOverTime MinOverTime MaxOverTime StddevOverTime StdvarOverTime QuantileOverTime FirstOverTime LastOverTime AbsentOverTime LogRangeExpr Range OffsetExpr UnwrapExpr ConvOp BytesConv DurationConv DurationSecondsConv Grouping Labels VectorAggregationExpr VectorOp BinOpExpr BinOpModifier OnOrIgnoringModifier GroupingLabels GroupingLabelList GroupingLabel LabelName Add Sub Mul Div Mod Pow LiteralExpr LabelReplaceExpr VectorExpr",maxTerm:167,skippedNodes:[0,36],repeatNodeCount:0,tokenData:"5b~RvX^#ipq#iqr$^rs$qst%cuv%nxy%syz%xz{%}{|&S|}&X}!O&^!O!P(l!P!Q)l!Q!R)q!R![+X![!]2X!^!_2m!_!`2z!`!a3a!c!}3n!}#O4U#P#Q4Z#Q#R4`#R#S3n#S#T4e#T#o3n#o#p4q#p#q4v#q#r5]#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~#nY$R~X^#ipq#i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~$aQ!_!`$g#r#s$l~$lO!O~~$qO!Q~~$tUOY$qZr$qrs%Ws#O$q#O#P%]#P~$q~%]O}~~%`PO~$q~%hQt~OY%cZ~%c~%sO#z~~%xO$W~~%}O$X~~&SO#x~~&XO#v~~&^O$T~~&cP#w~}!O&f~&iQ#_#`&o#g#h'|~&rP#X#Y&u~&xP#X#Y&{~'OP#d#e'R~'UP}!O'X~'[P#X#Y'_~'bP#a#b'e~'hP#d#e'k~'nP#h#i'q~'tP#m#n'w~'|O!`~~(PP#h#i(S~(VP#f#g(Y~(]P#]#^(`~(cP#V#W(f~(iP#h#i'w~(oP!Q![(r~(wR!s~!Q![(r!g!h)Q#X#Y)Q~)TR{|)^}!O)^!Q![)d~)aP!Q![)d~)iP!s~!Q![)d~)qO#y~~)ve!s~!O!P(r!Q![+X!g!h,l!i!j-Z!m!n-Z!o!p-Z!r!s-Z!v!w-Z#U#V-O#W#X-d#X#Y/f#Z#[/x#[#]-{#_#`/x#a#b0R#d#e/x#g#h/T#h#i/x#k#l0d#l#m1m#m#n1O~+^d!s~!O!P(r!Q![+X!g!h,l!i!j-Z!m!n-Z!o!p-Z!r!s-Z!v!w-Z#U#V-O#W#X-d#X#Y/f#Z#[/x#[#]-{#_#`/x#a#b0R#d#e/x#g#h/T#h#i/x#k#l0d#m#n1O~,oT{|)^}!O)^!Q![)d!d!e-O#]#^-T~-TO!q~~-WP#U#V-O~-^Q!d!e-O#]#^-T~-iP!k~!Q![-l~-oS!Q![-l#[#]-{#a#b.a#g#h/T~.QP!k~!Q![.T~.WR!Q![.T#a#b.a#g#h/T~.fQ!k~!Q![.l#g#h/O~.oR!Q![.l#a#b.x#g#h/T~.{P#g#h/O~/TO!k~~/YP!k~!Q![/]~/`Q!Q![/]#a#b.x~/iT{|)^}!O)^!Q![)d#U#V-O#]#^-T~/{Q#U#V-O#]#^-T~0WS!k~!Q![.l#U#V-O#]#^-T#g#h/O~0iP!k~!Q![0l~0oT!Q![0l#W#X-d#[#]-{#a#b.a#g#h/T~1TP!k~!Q![1W~1ZU!Q![1W#W#X-d#[#]-{#a#b.a#g#h/T#k#l0d~1pR!Q![1y!c!i1y#T#Z1y~2OR!s~!Q![1y!c!i1y#T#Z1yP2^T{P!Q![2X![!]2X!c!}2X#R#S2X#T#o2X~2rP!m~!_!`2u~2zO!n~~3PQ|~!_!`3V#r#s3[~3[O!o~~3aO!P~~3fP!j~!_!`3i~3nO!l~R3uT{P#uQ!Q![3n![!]2X!c!}3n#R#S3n#T#o3n~4ZO$i~~4`O$j~~4eO#{~~4hRO#S4e#S#T%W#T~4e~4vO$S~~4{Q!]~!_!`5R#r#s5W~5WO!W~~5]O!X~~5bO$U~",tokenizers:[0,1],topRules:{LogQL:[0,37]},specialized:[{term:43,get:(N,W)=>P(N)<<1},{term:43,get:(N,W)=>H(N)<<1|1},{term:43,get:N=>de[N]||-1}],tokenPrec:0}),Me=1,_e=2,at=3,et=4,Ye=5,Ot=6,Gt=7,Ba=8,lr=9,ea=10,cr=11,ta=12,kr=13,ra=14,mt=15,aa=16,Xt=17,Wa=18,Va=19,Ur=20,Br=21,Ea=22,xa=23,ja=24,pt=25,Ht=26,fn=27,Pa=28,Yt=29,La=30,_a=31,Sa=32,Zt=33,lt=34,kt=35,Lt=36,ge=37,Wr=38,yr=39,ur=40,Ft=41,Vr=42,yt=43,na=44,gt=45,br=46,za=47,Ka=48,Ut=49,Er=50,jr=51,Bt=52,_r=53,zr=54,Qa=55,Jt=56,sa=57,$a=58,Je=59,qt=60,Ga=61,dr=62,Dt=63,_t=64,St=65,ia=66,bt=67,Et=68,ht=69,Wt=70,It=71,xr=72,Vt=73,oa=74,wa=75,pr=76,la=77,ca=78,Ta=79,$t=80,ut=81,zt=82,xt=83,ua=84,Kr=85,Pr=86,Gr=87,Lr=88,da=89,fr=90,Ra=91,pa=92,Ct=93,Nt=94,ct=95,wt=96,Tt=97,Pt=98,Sr=99,Qr=100,er=101,$r=102,Ha=103,wr=104,Tr=105,Ya=106,Fa=107,fa=108,Ca=109,Za=110,Rr=111,tr=112,Fr=113,mr=114,Cr=115,Ja=116,qa=117,Aa=118,rr=119,en=120,Ar=121,Hr=122,Dr=123,ma=124,Da=125,tn=126,ar=127,mn=128,ga=129,Rt=130,jt=131,Yr=132,Ia=133,rn=134,Na=135,nr=136,ha=137,gr=138;function sr(N,W){const q=[];return ee.parse(N).iterate({enter:G=>{(W===void 0||W===G.type.id)&&q.push(G.node)}}),q[0]}function m(N){return!sr(N,Q)}function n(N){return"  ".repeat(N)}function a(N,W){return N.split(`
`).map(C=>n(W)+C).join(`
`)}function i(N){return N.split(`
`).map(q=>q.trimEnd()).join(`
`)}function o(N,W){const q=N.firstChild?.type.id===W;let C=!1;return N.firstChild&&q&&(C=!0,N=N.firstChild),{addBrackets:C,newNode:N}}function c(N,W){const q=[];let C=N.firstChild;for(;C;)W.includes(C.type.id)&&q.push(C),q.push(...c(C,W)),C=C.nextSibling;return q}function f(N,W,q){return W===N?` ${q}`:`
${n(1)}${q}`}function v(N,W){let q=N.length-1;for(;q>=0&&W.includes(N[q]);)q--;return N.substring(0,q+1)}const O=(N,W)=>{const{addBrackets:q,newNode:C}=o(N,yr);N=C;const G=ee.parse(W.substring(N.from,N.to));let Oe="";return G.iterate({enter:Xe=>{const ke=Xe.node;switch(ke.type.id){case ur:Oe+=R(ke,W);break;case Ut:ke.parent?.type.id!==Ut&&(Oe+=U(ke,W));break}}}),q?"("+Oe+")":Oe};function R(N,W){const q=W.substring(N.from,N.to),C=ee.parse(q),G=[];let Oe="";return C.iterate({enter:Xe=>{const ke=Xe.node;ke.type.id===Vr&&G.push(ke)}}),G.sort((Xe,ke)=>{const He=Xe.getChild(yt),Ge=ke.getChild(yt),ot=He&&W.substring(He.from,He.to),hr=Ge&&W.substring(Ge.from,Ge.to);return!ot||!hr?0:ot<hr?-1:ot>hr?1:0}),G.forEach(Xe=>{const ke=Xe.getChild(yt),He=ke?ke.nextSibling:null,Ge=Xe.getChild(gt),ot=ke?W.substring(ke.from,ke.to):null,hr=He?W.substring(He.from,He.to):null,vr=Ge?W.substring(Ge.from,Ge.to):null;Oe+=`${ot}${hr}${vr}, `}),"{"+v(Oe,", ")+"}"}function U(N,W){const q=[Bt,Dt,qt,Et,_t,zt,xt,Pr];let C,G="";return c(N,q).forEach(Oe=>{switch(Oe.type.id){case Bt:G+=f(Bt,C,z(Oe,W)),C=Bt;break;case Dt:G+=f(Dt,C,Y(Oe,W)),C=Dt;break;case qt:G+=f(qt,C,Y(Oe,W)),C=qt;break;case _t:G+=f(_t,C,ae(Oe,W)),C=_t;break;case Et:G+=f(Et,C,Te(Oe,W)),C=Et;break;case zt:G+=f(zt,C,xe(Oe,W)),C=zt;break;case xt:G+=f(xt,C,Be(Oe,W)),C=xt;break;case Pr:G+=f(Pr,C,Le()),C=Pr;break}}),G}function z(N,W){const q=N.getChild(_r),C=N.getChild(Jt),G=N.getChild(gt),Oe=q&&W.substring(q.from,q.to),Xe=G&&W.substring(G.from,G.to);return C?`${Oe} ip(${Xe})`:`${Oe} ${Xe}`}function Y(N,W){if(N.getChild(gt)){const G=N.getChild(Ye)||N.getChild(et),Oe=N.getChild(gt),Xe=G&&W.substring(G.from,G.to),ke=Oe&&W.substring(Oe.from,Oe.to);return`| ${Xe}${ke}`}return`| ${W.substring(N.from,N.to)}`}function ae(N,W){const q=c(N,[ia]);let C="";return q.forEach(G=>{const Oe=G.getChild(yt),Xe=G.getChild(gt),ke=Oe&&W.substring(Oe.from,Oe.to),He=Xe&&W.substring(Xe.from,Xe.to);C+=`${ke}=${He}, `}),`| json ${v(C,", ")}`}function Te(N,W){const q=N.getChild(Vr)||N.getChild(ht)||N.getChild($t)||N.getChild(Wt)?.getChild(It)||N.getChild(Wt)?.getChild(ca);if(!q)return"";const C=q.type.id,G=q.getChild(yt),Oe=G&&G.nextSibling;let Xe;C===It?Xe=q.getChild(Vt):C===ca?Xe=q.getChild(Ta):C===$t?Xe=q.getChild(ut):Xe=q.getChild(gt);const ke=G&&W.substring(G.from,G.to),He=Oe&&W.substring(Oe.from,Oe.to),Ge=Xe&&W.substring(Xe.from,Xe.to);return C===ht?`| ${ke}${He}ip(${Ge})`:`| ${ke}${He}${Ge}`}function xe(N,W){const q=N.getChild(gt);return`| line_format ${q&&W.substring(q.from,q.to)}`}function Be(N,W){const q=c(N,[Kr]);let C="| label_format ";return q.forEach(G=>{let Oe,Xe;G.getChildren(yt).length===2?[Oe,Xe]=G.getChildren(yt):(Oe=G.getChild(yt),Xe=G.getChild(gt));const ke=Oe&&W.substring(Oe.from,Oe.to),He=Xe&&W.substring(Xe.from,Xe.to);C+=`${ke}=${He}, `}),v(C,", ")}function Le(){return"| decolorize"}const ze=(N,W)=>{const{addBrackets:q,newNode:C}=o(N,Ct);N=C;let G="";const Oe=N.firstChild;switch(Oe&&Oe.type.id){case Nt:G=nt(N,W);break;case Ar:G=vt(N,W);break;case Dr:G=At(N,W);break;case nr:G=Ir(N,W);break;case ha:G=Nr(N,W);break;case gr:G=ir(N,W);break}return q?"("+G+")":G};function nt(N,W){let q="";return c(N,[ct,ut,Rr,rr]).forEach(C=>{if(C.parent?.type.id===Nt)switch(C.type.id){case ct:q+=`${W.substring(C.from,C.to)}(
`;break;case ut:q+=`${n(1)+W.substring(C.from,C.to)},
`;break;case Rr:q+=je(C,W);break;case rr:q+=st(C,W);break}}),q}function je(N,W){const q=[];let C="",G="",Oe="",Xe="",ke="";c(N,[ur,tr,Fr,mr,Ut]).forEach(Ge=>{if(Ge.parent?.type.id===Rr)switch(q.push(Ge),Ge.type.id){case ur:{let ot=W.substring(Ge.from,Ge.to);C+=R({...Ge,from:0,to:ot.length},ot);break}case Ut:G+=U(Ge,W);break;case tr:Oe+=W.substring(Ge.from,Ge.to);break;case Fr:{const ot=Ge.getChild(Vt);Xe+=` offset ${ot?W.substring(ot.from,ot.to):""}`;break}case mr:c(Ge,[yt,Cr,Et]).forEach((ot,hr,vr)=>{switch(ot.type.id){case yt:{if(ot.parent?.type.id!==mr||vr.find(Xa=>Xa.type.id===Cr))return;ke+=`| unwrap ${W.substring(ot.from,ot.to)} `;return}case Cr:{const va=vr.find(gn=>gn.type.id===yt),Xa=va?W.substring(va.from,va.to):"";ke+=`| unwrap ${W.substring(ot.from,ot.to)}(${Xa}) `;return}case Et:ke+=Te(ot,W);return}});break}});let He="";return q.forEach((Ge,ot,hr)=>{const vr=hr[ot-1];Ge.type.id===ur&&(He+=n(1)+C),Ge.type.id===Ut&&(He+=a(G,1)),Ge.type.id===tr&&(He+=`
`+n(1)+Oe),Ge.type.id===Fr&&(He+=Xe),Ge.type.id===mr&&(vr?.type.id!==Fr&&vr?.type.id!==tr?He+=`
`+n(1)+ke:He+=" "+ke)}),He+=`
)`}function st(N,W){let q="";const C=c(N,[yt]).map(G=>W.substring(G.from,G.to));return c(N,[Ur,Br]).forEach(G=>{if(G.parent?.type.id===rr)switch(G.type.id){case Ur:q=` by (${C.join(", ")}) `;break;case Br:q=` without (${C.join(", ")}) `;break}}),q}function vt(N,W){let q="";return c(N,[Hr,ut,Ct,rr]).forEach((C,G,Oe)=>{if(C.parent?.type.id===Ar)switch(C.type.id){case Hr:q+=`${W.substring(C.from,C.to)}`;break;case ut:q+=`(
`,q+=`${n(1)+W.substring(C.from,C.to)},
`;break;case Ct:{const Xe=Oe.find(Ge=>Ge.type.id===ut&&Ge.parent?.type.id===Ar);q+=Xe?"":`(
`;const ke=W.substring(C.from,C.to),He=sr(ke,Ct);q+=a(ze(He,ke),1),q+=`
)`;break}case rr:q+=st(C,W);break}}),q}function At(N,W){let q;const[C,G]=c(N,[Wr]).map((Oe,Xe)=>{Xe===0&&(q=W.substring(Oe.nextSibling?.from??0,Oe.nextSibling?.to));const ke=W.substring(Oe.from,Oe.to);let He;return m(ke)?(He=sr(ke,yr),O(He,ke)):(He=sr(ke,Ct),ze(He,ke))});return C+`
`+q+`
`+G}function Ir(N,W){N=N.getChild(nr)??N;const q=N.getChild(Rt),C=N.getChild(jt),G=N.getChild(ut);return G?q?`+${W.substring(G.from,G.to)}`:C?`-${W.substring(G.from,G.to)}`:W.substring(G.from,G.to):""}function Nr(N,W){let q=`label_replace(
`;return c(N,[Ct,gt]).forEach(C=>{if(C.parent?.type.id===ha)if(C.type.id===Ct){const G=W.substring(C.from,C.to),Oe=sr(G,Ct);q+=a(ze(Oe,G),1)+`,
`}else q+=n(1)+W.substring(C.from,C.to)+`,
`}),v(q,`,
`)+`
)`}function ir(N,W){N=N.getChild(gr)??N;const q=N.getChild(ut);return q?`vector(${W.substring(q.from,q.to)})`:""}const Ma=N=>{const W=ee.parse(N);let q="";return W.iterate({enter:C=>{const G=C.node;if(!(G.parent?.type.id!==Wr||G.parent?.parent?.type.id===Dr))switch(G.type.id){case Ct:return q=ze(G,N),!1;case yr:return q=O(G,N),!1}}}),i(q)}}}]);

//# sourceMappingURL=4417.012eb5b7fb3398350095.js.map