{"version":3,"file":"9711.d6e977bd60f0e5ba673d.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/components/notification-policies/Matchers.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/notificaton-preview/route.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/notificaton-preview/NotificationPolicyMatchers.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/notificaton-preview/NotificationRouteDetailsModal.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/notificaton-preview/NotificationRoute.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/notificaton-preview/useAlertmanagerNotificationRoutingPreview.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/notificaton-preview/NotificationPreviewByAlertManager.tsx","webpack://grafana/./public/app/features/alerting/unified/createRouteGroupsMatcherWorker.ts","webpack://grafana/./public/app/features/alerting/unified/useRouteGroupsMatcher.ts"],"sourcesContent":["import { css } from '@emotion/css';\nimport { take, takeRight, uniqueId } from 'lodash';\nimport React, { FC } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { getTagColorsFromName, useStyles2, Stack } from '@grafana/ui';\nimport { ObjectMatcher } from 'app/plugins/datasource/alertmanager/types';\n\nimport { MatcherFormatter, matcherFormatter } from '../../utils/matchers';\nimport { HoverCard } from '../HoverCard';\n\ntype MatchersProps = { matchers: ObjectMatcher[]; formatter?: MatcherFormatter };\n\n// renders the first N number of matchers\nconst Matchers: FC<MatchersProps> = ({ matchers, formatter = 'default' }) => {\n  const styles = useStyles2(getStyles);\n\n  const NUM_MATCHERS = 5;\n\n  const firstFew = take(matchers, NUM_MATCHERS);\n  const rest = takeRight(matchers, matchers.length - NUM_MATCHERS);\n  const hasMoreMatchers = rest.length > 0;\n\n  return (\n    <span data-testid=\"label-matchers\">\n      <Stack direction=\"row\" gap={1} alignItems=\"center\" wrap={'wrap'}>\n        {firstFew.map((matcher) => (\n          <MatcherBadge key={uniqueId()} matcher={matcher} formatter={formatter} />\n        ))}\n        {/* TODO hover state to show all matchers we're not showing */}\n        {hasMoreMatchers && (\n          <HoverCard\n            arrow\n            placement=\"top\"\n            content={\n              <>\n                {rest.map((matcher) => (\n                  <MatcherBadge key={uniqueId()} matcher={matcher} />\n                ))}\n              </>\n            }\n          >\n            <span>\n              <div className={styles.metadata}>{`and ${rest.length} more`}</div>\n            </span>\n          </HoverCard>\n        )}\n      </Stack>\n    </span>\n  );\n};\n\ninterface MatcherBadgeProps {\n  matcher: ObjectMatcher;\n  formatter?: MatcherFormatter;\n}\n\nconst MatcherBadge: FC<MatcherBadgeProps> = ({ matcher, formatter = 'default' }) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.matcher(matcher[0]).wrapper}>\n      <Stack direction=\"row\" gap={0} alignItems=\"baseline\">\n        {matcherFormatter[formatter](matcher)}\n      </Stack>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  matcher: (label: string) => {\n    const { color, borderColor } = getTagColorsFromName(label);\n\n    return {\n      wrapper: css`\n        color: #fff;\n        background: ${color};\n        padding: ${theme.spacing(0.33)} ${theme.spacing(0.66)};\n        font-size: ${theme.typography.bodySmall.fontSize};\n\n        border: solid 1px ${borderColor};\n        border-radius: ${theme.shape.borderRadius(2)};\n      `,\n    };\n  },\n  metadata: css`\n    color: ${theme.colors.text.secondary};\n\n    font-size: ${theme.typography.bodySmall.fontSize};\n    font-weight: ${theme.typography.bodySmall.fontWeight};\n  `,\n});\n\nexport { Matchers };\n","import { RouteWithID } from '../../../../../../plugins/datasource/alertmanager/types';\n\nexport interface RouteWithPath extends RouteWithID {\n  path: string[]; // path from root route to this route\n}\n\nexport function isDefaultPolicy(route: RouteWithPath) {\n  return route.path?.length === 0;\n}\n\n// we traverse the whole tree and we create a map with <id , RouteWithPath>\nexport function getRoutesByIdMap(rootRoute: RouteWithID): Map<string, RouteWithPath> {\n  const map = new Map<string, RouteWithPath>();\n\n  function addRoutesToMap(route: RouteWithID, path: string[] = []) {\n    map.set(route.id, { ...route, path: path });\n    route.routes?.forEach((r) => addRoutesToMap(r, [...path, route.id]));\n  }\n\n  addRoutesToMap(rootRoute, []);\n  return map;\n}\n\nexport function hasEmptyMatchers(route: RouteWithID) {\n  return route.object_matchers?.length === 0;\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nimport { MatcherFormatter } from '../../../utils/matchers';\nimport { Matchers } from '../../notification-policies/Matchers';\n\nimport { hasEmptyMatchers, isDefaultPolicy, RouteWithPath } from './route';\n\ninterface Props {\n  route: RouteWithPath;\n  matcherFormatter: MatcherFormatter;\n}\n\nexport function NotificationPolicyMatchers({ route, matcherFormatter }: Props) {\n  const styles = useStyles2(getStyles);\n  if (isDefaultPolicy(route)) {\n    return <div className={styles.defaultPolicy}>Default policy</div>;\n  } else if (hasEmptyMatchers(route)) {\n    return <div className={styles.textMuted}>No matchers</div>;\n  } else {\n    return <Matchers matchers={route.object_matchers ?? []} formatter={matcherFormatter} />;\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  defaultPolicy: css`\n    padding: ${theme.spacing(0.5)};\n    background: ${theme.colors.background.secondary};\n    width: fit-content;\n  `,\n  textMuted: css`\n    color: ${theme.colors.text.secondary};\n  `,\n});\n","import { css, cx } from '@emotion/css';\nimport { compact } from 'lodash';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Icon, Modal, Stack, useStyles2 } from '@grafana/ui';\n\nimport { Receiver } from '../../../../../../plugins/datasource/alertmanager/types';\nimport { AlertmanagerAction } from '../../../hooks/useAbilities';\nimport { AlertmanagerProvider } from '../../../state/AlertmanagerContext';\nimport { getAmMatcherFormatter } from '../../../utils/alertmanager';\nimport { MatcherFormatter } from '../../../utils/matchers';\nimport { makeAMLink } from '../../../utils/misc';\nimport { Authorize } from '../../Authorize';\nimport { Matchers } from '../../notification-policies/Matchers';\n\nimport { hasEmptyMatchers, isDefaultPolicy, RouteWithPath } from './route';\n\ninterface Props {\n  routesByIdMap: Map<string, RouteWithPath>;\n  route: RouteWithPath;\n  matcherFormatter: MatcherFormatter;\n}\n\nfunction PolicyPath({ route, routesByIdMap, matcherFormatter }: Props) {\n  const styles = useStyles2(getStyles);\n  const routePathIds = route.path?.slice(1) ?? [];\n  const routePathObjects = [...compact(routePathIds.map((id) => routesByIdMap.get(id))), route];\n\n  return (\n    <div className={styles.policyPathWrapper}>\n      <div className={styles.defaultPolicy}>Default policy</div>\n      {routePathObjects.map((pathRoute, index) => {\n        return (\n          <div key={pathRoute.id}>\n            <div className={styles.policyInPath(index, index === routePathObjects.length - 1)}>\n              {hasEmptyMatchers(pathRoute) ? (\n                <div className={styles.textMuted}>No matchers</div>\n              ) : (\n                <Matchers matchers={pathRoute.object_matchers ?? []} formatter={matcherFormatter} />\n              )}\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\ninterface NotificationRouteDetailsModalProps {\n  onClose: () => void;\n  route: RouteWithPath;\n  receiver: Receiver;\n  routesByIdMap: Map<string, RouteWithPath>;\n  alertManagerSourceName: string;\n}\n\nexport function NotificationRouteDetailsModal({\n  onClose,\n  route,\n  receiver,\n  routesByIdMap,\n  alertManagerSourceName,\n}: NotificationRouteDetailsModalProps) {\n  const styles = useStyles2(getStyles);\n  const isDefault = isDefaultPolicy(route);\n\n  return (\n    <AlertmanagerProvider accessType=\"notification\" alertmanagerSourceName={alertManagerSourceName}>\n      <Modal\n        className={styles.detailsModal}\n        isOpen={true}\n        title=\"Routing details\"\n        onDismiss={onClose}\n        onClickBackdrop={onClose}\n      >\n        <Stack gap={0} direction=\"column\">\n          <div className={cx(styles.textMuted, styles.marginBottom(2))}>\n            Your alert instances are routed as follows.\n          </div>\n          <div>Notification policy path</div>\n          {isDefault && <div className={styles.textMuted}>Default policy</div>}\n          <div className={styles.separator(1)} />\n          {!isDefault && (\n            <>\n              <PolicyPath\n                route={route}\n                routesByIdMap={routesByIdMap}\n                matcherFormatter={getAmMatcherFormatter(alertManagerSourceName)}\n              />\n            </>\n          )}\n          <div className={styles.separator(4)} />\n          <div className={styles.contactPoint}>\n            <Stack gap={1} direction=\"row\" alignItems=\"center\">\n              Contact point:\n              <span className={styles.textMuted}>{receiver.name}</span>\n            </Stack>\n            <Authorize actions={[AlertmanagerAction.UpdateContactPoint]}>\n              <Stack gap={1} direction=\"row\" alignItems=\"center\">\n                <a\n                  href={makeAMLink(\n                    `/alerting/notifications/receivers/${encodeURIComponent(receiver.name)}/edit`,\n                    alertManagerSourceName\n                  )}\n                  className={styles.link}\n                  target=\"_blank\"\n                  rel=\"noreferrer\"\n                >\n                  See details <Icon name=\"external-link-alt\" />\n                </a>\n              </Stack>\n            </Authorize>\n          </div>\n          <div className={styles.button}>\n            <Button variant=\"primary\" type=\"button\" onClick={onClose}>\n              Close\n            </Button>\n          </div>\n        </Stack>\n      </Modal>\n    </AlertmanagerProvider>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  textMuted: css`\n    color: ${theme.colors.text.secondary};\n  `,\n  link: css`\n    display: block;\n    color: ${theme.colors.text.link};\n  `,\n  button: css`\n    justify-content: flex-end;\n    display: flex;\n  `,\n  detailsModal: css`\n    max-width: 560px;\n  `,\n  defaultPolicy: css`\n    padding: ${theme.spacing(0.5)};\n    background: ${theme.colors.background.secondary};\n    width: fit-content;\n  `,\n  contactPoint: css`\n    display: flex;\n    flex-direction: row;\n    gap: ${theme.spacing(1)};\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: ${theme.spacing(1)};\n  `,\n  policyPathWrapper: css`\n    display: flex;\n    flex-direction: column;\n    margin-top: ${theme.spacing(1)};\n  `,\n  separator: (units: number) => css`\n    margin-top: ${theme.spacing(units)};\n  `,\n  marginBottom: (units: number) => css`\n    margin-bottom: ${theme.spacing(theme.spacing(units))};\n  `,\n  policyInPath: (index = 0, higlight = false) => css`\n    margin-left: ${30 + index * 30}px;\n    padding: ${theme.spacing(1)};\n    margin-top: ${theme.spacing(1)};\n    border: solid 1px ${theme.colors.border.weak};\n    background: ${theme.colors.background.secondary};\n    width: fit-content;\n    position: relative;\n\n    ${\n      higlight &&\n      css`\n        border: solid 1px ${theme.colors.info.border};\n      `\n    },\n    &:before {\n      content: '';\n      position: absolute;\n      height: calc(100% - 10px);\n      width: ${theme.spacing(1)};\n      border-left: solid 1px ${theme.colors.border.weak};\n      border-bottom: solid 1px ${theme.colors.border.weak};\n      margin-top: ${theme.spacing(-2)};\n      margin-left: -17px;\n    }\n  }  `,\n});\n","import { css, cx } from '@emotion/css';\nimport { uniqueId } from 'lodash';\nimport pluralize from 'pluralize';\nimport React, { useState } from 'react';\nimport { useToggle } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, getTagColorIndexFromName, TagList, useStyles2 } from '@grafana/ui';\n\nimport { Receiver } from '../../../../../../plugins/datasource/alertmanager/types';\nimport { Stack } from '../../../../../../plugins/datasource/parca/QueryEditor/Stack';\nimport { getAmMatcherFormatter } from '../../../utils/alertmanager';\nimport { AlertInstanceMatch } from '../../../utils/notification-policies';\nimport { CollapseToggle } from '../../CollapseToggle';\nimport { MetaText } from '../../MetaText';\nimport { Spacer } from '../../Spacer';\n\nimport { NotificationPolicyMatchers } from './NotificationPolicyMatchers';\nimport { NotificationRouteDetailsModal } from './NotificationRouteDetailsModal';\nimport { RouteWithPath } from './route';\n\nfunction NotificationRouteHeader({\n  route,\n  receiver,\n  routesByIdMap,\n  instancesCount,\n  alertManagerSourceName,\n  expandRoute,\n  onExpandRouteClick,\n}: {\n  route: RouteWithPath;\n  receiver: Receiver;\n  routesByIdMap: Map<string, RouteWithPath>;\n  instancesCount: number;\n  alertManagerSourceName: string;\n  expandRoute: boolean;\n  onExpandRouteClick: (expand: boolean) => void;\n}) {\n  const styles = useStyles2(getStyles);\n  const [showDetails, setShowDetails] = useState(false);\n\n  const onClickDetails = () => {\n    setShowDetails(true);\n  };\n\n  // @TODO: re-use component ContactPointsHoverDetails from Policy once we have it for cloud AMs.\n\n  return (\n    <div className={styles.routeHeader}>\n      <CollapseToggle\n        isCollapsed={!expandRoute}\n        onToggle={(isCollapsed) => onExpandRouteClick(!isCollapsed)}\n        aria-label=\"Expand policy route\"\n      />\n\n      <Stack flexGrow={1} gap={1}>\n        {/* TODO: fix keyboard a11y */}\n        {/* eslint-disable-next-line jsx-a11y/click-events-have-key-events, jsx-a11y/no-static-element-interactions */}\n        <div onClick={() => onExpandRouteClick(!expandRoute)} className={styles.expandable}>\n          <Stack gap={1} direction=\"row\" alignItems=\"center\">\n            Notification policy\n            <NotificationPolicyMatchers\n              route={route}\n              matcherFormatter={getAmMatcherFormatter(alertManagerSourceName)}\n            />\n          </Stack>\n        </div>\n        <Spacer />\n        <Stack gap={2} direction=\"row\" alignItems=\"center\">\n          <MetaText icon=\"layers-alt\" data-testid=\"matching-instances\">\n            {instancesCount ?? '-'}\n            <span>{pluralize('instance', instancesCount)}</span>\n          </MetaText>\n          <Stack gap={1} direction=\"row\" alignItems=\"center\">\n            <div>\n              <span className={styles.textMuted}>@ Delivered to</span> {receiver.name}\n            </div>\n\n            <div className={styles.verticalBar} />\n\n            <Button type=\"button\" onClick={onClickDetails} variant=\"secondary\" fill=\"outline\" size=\"sm\">\n              See details\n            </Button>\n          </Stack>\n        </Stack>\n      </Stack>\n      {showDetails && (\n        <NotificationRouteDetailsModal\n          onClose={() => setShowDetails(false)}\n          route={route}\n          receiver={receiver}\n          routesByIdMap={routesByIdMap}\n          alertManagerSourceName={alertManagerSourceName}\n        />\n      )}\n    </div>\n  );\n}\n\ninterface NotificationRouteProps {\n  route: RouteWithPath;\n  receiver: Receiver;\n  instanceMatches: AlertInstanceMatch[];\n  routesByIdMap: Map<string, RouteWithPath>;\n  alertManagerSourceName: string;\n}\n\nexport function NotificationRoute({\n  route,\n  instanceMatches,\n  receiver,\n  routesByIdMap,\n  alertManagerSourceName,\n}: NotificationRouteProps) {\n  const styles = useStyles2(getStyles);\n  const [expandRoute, setExpandRoute] = useToggle(false);\n  // @TODO: The color index might be updated at some point in the future.Maybe we should roll our own tag component,\n  // one that supports a custom function to define the color and allow manual color overrides\n  const GREY_COLOR_INDEX = 9;\n\n  return (\n    <div data-testid=\"matching-policy-route\">\n      <NotificationRouteHeader\n        route={route}\n        receiver={receiver}\n        routesByIdMap={routesByIdMap}\n        instancesCount={instanceMatches.length}\n        alertManagerSourceName={alertManagerSourceName}\n        expandRoute={expandRoute}\n        onExpandRouteClick={setExpandRoute}\n      />\n      {expandRoute && (\n        <Stack gap={1} direction=\"column\">\n          <div className={styles.routeInstances} data-testid=\"route-matching-instance\">\n            {instanceMatches.map((instanceMatch) => {\n              const matchArray = Array.from(instanceMatch.labelsMatch);\n              let matchResult = matchArray.map(([label, matchResult]) => ({\n                label: `${label[0]}=${label[1]}`,\n                match: matchResult.match,\n                colorIndex: matchResult.match ? getTagColorIndexFromName(label[0]) : GREY_COLOR_INDEX,\n              }));\n\n              const matchingLabels = matchResult.filter((mr) => mr.match);\n              const nonMatchingLabels = matchResult.filter((mr) => !mr.match);\n\n              return (\n                <div className={styles.tagListCard} key={uniqueId()}>\n                  {matchArray.length > 0 ? (\n                    <>\n                      {matchingLabels.length > 0 ? (\n                        <TagList\n                          tags={matchingLabels.map((mr) => mr.label)}\n                          className={styles.labelList}\n                          getColorIndex={(_, index) => matchingLabels[index].colorIndex}\n                        />\n                      ) : (\n                        <div className={cx(styles.textMuted, styles.textItalic)}>No matching labels</div>\n                      )}\n                      <div className={styles.labelSeparator} />\n                      <TagList\n                        tags={nonMatchingLabels.map((mr) => mr.label)}\n                        className={styles.labelList}\n                        getColorIndex={(_, index) => nonMatchingLabels[index].colorIndex}\n                      />\n                    </>\n                  ) : (\n                    <div className={styles.textMuted}>No labels</div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </Stack>\n      )}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  textMuted: css`\n    color: ${theme.colors.text.secondary};\n  `,\n  textItalic: css`\n    font-style: italic;\n  `,\n  expandable: css`\n    cursor: pointer;\n  `,\n  routeHeader: css`\n    display: flex;\n    flex-direction: row;\n    gap: ${theme.spacing(1)};\n    align-items: center;\n    border-bottom: 1px solid ${theme.colors.border.weak};\n    &:hover {\n      background-color: ${theme.components.table.rowHoverBackground};\n    }\n    padding: ${theme.spacing(0.5, 0.5, 0.5, 0)};\n  `,\n  labelList: css`\n    flex: 0 1 auto;\n    justify-content: flex-start;\n  `,\n  labelSeparator: css`\n    width: 1px;\n    background-color: ${theme.colors.border.weak};\n  `,\n  tagListCard: css`\n    display: flex;\n    flex-direction: row;\n    gap: ${theme.spacing(2)};\n\n    position: relative;\n    background: ${theme.colors.background.secondary};\n    padding: ${theme.spacing(1)};\n\n    border-radius: ${theme.shape.borderRadius(2)};\n    border: solid 1px ${theme.colors.border.weak};\n  `,\n  routeInstances: css`\n    padding: ${theme.spacing(1, 0, 1, 4)};\n    position: relative;\n\n    display: flex;\n    flex-direction: column;\n    gap: ${theme.spacing(1)};\n\n    &:before {\n      content: '';\n      position: absolute;\n      left: ${theme.spacing(2)};\n      height: calc(100% - ${theme.spacing(2)});\n      width: ${theme.spacing(4)};\n      border-left: solid 1px ${theme.colors.border.weak};\n    }\n  `,\n  verticalBar: css`\n    width: 1px;\n    height: 20px;\n    background-color: ${theme.colors.secondary.main};\n    margin-left: ${theme.spacing(1)};\n    margin-right: ${theme.spacing(1)};\n  `,\n});\n","import { useMemo } from 'react';\nimport { useAsync } from 'react-use';\n\nimport { Receiver } from '../../../../../../plugins/datasource/alertmanager/types';\nimport { Labels } from '../../../../../../types/unified-alerting-dto';\nimport { useAlertmanagerConfig } from '../../../hooks/useAlertmanagerConfig';\nimport { useRouteGroupsMatcher } from '../../../useRouteGroupsMatcher';\nimport { addUniqueIdentifierToRoute } from '../../../utils/amroutes';\nimport { GRAFANA_RULES_SOURCE_NAME } from '../../../utils/datasource';\nimport { AlertInstanceMatch, computeInheritedTree, normalizeRoute } from '../../../utils/notification-policies';\n\nimport { getRoutesByIdMap, RouteWithPath } from './route';\n\nexport const useAlertmanagerNotificationRoutingPreview = (\n  alertManagerSourceName: string,\n  potentialInstances: Labels[]\n) => {\n  const { currentData, isLoading: configLoading, error: configError } = useAlertmanagerConfig(alertManagerSourceName);\n  const config = currentData?.alertmanager_config;\n\n  const { matchInstancesToRoute } = useRouteGroupsMatcher();\n\n  // to create the list of matching contact points we need to first get the rootRoute\n  const { rootRoute, receivers } = useMemo(() => {\n    if (!config) {\n      return {\n        receivers: [],\n        rootRoute: undefined,\n      };\n    }\n\n    return {\n      rootRoute: config.route ? normalizeRoute(addUniqueIdentifierToRoute(config.route)) : undefined,\n      receivers: config.receivers ?? [],\n    };\n  }, [config]);\n\n  // create maps for routes to be get by id, this map also contains the path to the route\n  // ⚠️ don't forget to compute the inherited tree before using this map\n  const routesByIdMap: Map<string, RouteWithPath> = rootRoute\n    ? getRoutesByIdMap(computeInheritedTree(rootRoute))\n    : new Map();\n\n  // create map for receivers to be get by name\n  const receiversByName =\n    receivers.reduce((map, receiver) => {\n      return map.set(receiver.name, receiver);\n    }, new Map<string, Receiver>()) ?? new Map<string, Receiver>();\n\n  // match labels in the tree => map of notification policies and the alert instances (list of labels) in each one\n  const {\n    value: matchingMap = new Map<string, AlertInstanceMatch[]>(),\n    loading: matchingLoading,\n    error: matchingError,\n  } = useAsync(async () => {\n    if (!rootRoute) {\n      return;\n    }\n    return await matchInstancesToRoute(rootRoute, potentialInstances, {\n      unquoteMatchers: alertManagerSourceName !== GRAFANA_RULES_SOURCE_NAME,\n    });\n  }, [rootRoute, potentialInstances]);\n\n  return {\n    routesByIdMap,\n    receiversByName,\n    matchingMap,\n    loading: configLoading || matchingLoading,\n    error: configError ?? matchingError,\n  };\n};\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Alert, LoadingPlaceholder, useStyles2, withErrorBoundary } from '@grafana/ui';\n\nimport { Stack } from '../../../../../../plugins/datasource/parca/QueryEditor/Stack';\nimport { Labels } from '../../../../../../types/unified-alerting-dto';\nimport { AlertManagerDataSource } from '../../../utils/datasource';\n\nimport { NotificationRoute } from './NotificationRoute';\nimport { useAlertmanagerNotificationRoutingPreview } from './useAlertmanagerNotificationRoutingPreview';\n\nfunction NotificationPreviewByAlertManager({\n  alertManagerSource,\n  potentialInstances,\n  onlyOneAM,\n}: {\n  alertManagerSource: AlertManagerDataSource;\n  potentialInstances: Labels[];\n  onlyOneAM: boolean;\n}) {\n  const styles = useStyles2(getStyles);\n\n  const { routesByIdMap, receiversByName, matchingMap, loading, error } = useAlertmanagerNotificationRoutingPreview(\n    alertManagerSource.name,\n    potentialInstances\n  );\n\n  if (error) {\n    return (\n      <Alert title=\"Cannot load Alertmanager configuration\" severity=\"error\">\n        {error.message}\n      </Alert>\n    );\n  }\n\n  if (loading) {\n    return <LoadingPlaceholder text=\"Loading routing preview...\" />;\n  }\n\n  const matchingPoliciesFound = matchingMap.size > 0;\n\n  return matchingPoliciesFound ? (\n    <div className={styles.alertManagerRow}>\n      {!onlyOneAM && (\n        <Stack direction=\"row\" alignItems=\"center\">\n          <div className={styles.firstAlertManagerLine}></div>\n          <div className={styles.alertManagerName}>\n            {' '}\n            Alert manager:\n            <img src={alertManagerSource.imgUrl} alt=\"\" className={styles.img} />\n            {alertManagerSource.name}\n          </div>\n          <div className={styles.secondAlertManagerLine}></div>\n        </Stack>\n      )}\n      <Stack gap={1} direction=\"column\">\n        {Array.from(matchingMap.entries()).map(([routeId, instanceMatches]) => {\n          const route = routesByIdMap.get(routeId);\n          const receiver = route?.receiver && receiversByName.get(route.receiver);\n\n          if (!route) {\n            return null;\n          }\n          if (!receiver) {\n            throw new Error('Receiver not found');\n          }\n          return (\n            <NotificationRoute\n              instanceMatches={instanceMatches}\n              route={route}\n              receiver={receiver}\n              key={routeId}\n              routesByIdMap={routesByIdMap}\n              alertManagerSourceName={alertManagerSource.name}\n            />\n          );\n        })}\n      </Stack>\n    </div>\n  ) : null;\n}\n\n// export default because we want to load the component dynamically using React.lazy\n// Due to loading of the web worker we don't want to load this component when not necessary\nexport default withErrorBoundary(NotificationPreviewByAlertManager);\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  alertManagerRow: css`\n    display: flex;\n    flex-direction: column;\n    gap: ${theme.spacing(1)};\n    width: 100%;\n  `,\n  firstAlertManagerLine: css`\n    height: 1px;\n    width: ${theme.spacing(4)};\n    background-color: ${theme.colors.secondary.main};\n  `,\n  alertManagerName: css`\n    width: fit-content;\n  `,\n  secondAlertManagerLine: css`\n    height: 1px;\n    width: 100%;\n    flex: 1;\n    background-color: ${theme.colors.secondary.main};\n  `,\n  img: css`\n    margin-left: ${theme.spacing(2)};\n    width: ${theme.spacing(3)};\n    height: ${theme.spacing(3)};\n    margin-right: ${theme.spacing(1)};\n  `,\n});\n","import { CorsWorker as Worker } from 'app/core/utils/CorsWorker';\n\n// CorsWorker is needed as a workaround for CORS issue caused\n// by static assets served from an url different from origin\nexport const createWorker = () => new Worker(new URL('./routeGroupsMatcher.worker.ts', import.meta.url));\n","import * as comlink from 'comlink';\nimport { useCallback, useEffect } from 'react';\n\nimport { AlertmanagerGroup, RouteWithID } from '../../../plugins/datasource/alertmanager/types';\nimport { Labels } from '../../../types/unified-alerting-dto';\n\nimport { logError, logInfo } from './Analytics';\nimport { createWorker } from './createRouteGroupsMatcherWorker';\nimport type { MatchOptions, RouteGroupsMatcher } from './routeGroupsMatcher';\n\nlet routeMatcher: comlink.Remote<RouteGroupsMatcher> | undefined;\n\n// Load worker loads the worker if it's not loaded yet\n// and returns a function to dispose of the worker\n// We do it to enable feature toggling. If the feature is disabled we don't wont to load the worker code at all\n// An alternative way would be to move all this code to the hook below, but it will create and terminate the worker much more often\nfunction loadWorker() {\n  let worker: Worker | undefined;\n\n  if (routeMatcher === undefined) {\n    try {\n      worker = createWorker();\n      routeMatcher = comlink.wrap<RouteGroupsMatcher>(worker);\n    } catch (e: unknown) {\n      if (e instanceof Error) {\n        logError(e);\n      }\n    }\n  }\n\n  const disposeWorker = () => {\n    if (worker && routeMatcher) {\n      routeMatcher[comlink.releaseProxy]();\n      worker.terminate();\n\n      routeMatcher = undefined;\n      worker = undefined;\n    }\n  };\n\n  return { disposeWorker };\n}\n\nfunction validateWorker(matcher: typeof routeMatcher): asserts matcher is comlink.Remote<RouteGroupsMatcher> {\n  if (!routeMatcher) {\n    throw new Error('Route Matcher has not been initialized');\n  }\n}\n\nexport function useRouteGroupsMatcher() {\n  useEffect(() => {\n    const { disposeWorker } = loadWorker();\n    return disposeWorker;\n  }, []);\n\n  const getRouteGroupsMap = useCallback(\n    async (rootRoute: RouteWithID, alertGroups: AlertmanagerGroup[], options?: MatchOptions) => {\n      validateWorker(routeMatcher);\n\n      const startTime = performance.now();\n\n      const result = await routeMatcher.getRouteGroupsMap(rootRoute, alertGroups, options);\n\n      const timeSpent = performance.now() - startTime;\n\n      logInfo(`Route Groups Matched in  ${timeSpent} ms`, {\n        matchingTime: timeSpent.toString(),\n        alertGroupsCount: alertGroups.length.toString(),\n        // Counting all nested routes might be too time-consuming, so we only count the first level\n        topLevelRoutesCount: rootRoute.routes?.length.toString() ?? '0',\n      });\n\n      return result;\n    },\n    []\n  );\n\n  const matchInstancesToRoute = useCallback(\n    async (rootRoute: RouteWithID, instancesToMatch: Labels[], options?: MatchOptions) => {\n      validateWorker(routeMatcher);\n\n      const startTime = performance.now();\n\n      const result = await routeMatcher.matchInstancesToRoute(rootRoute, instancesToMatch, options);\n\n      const timeSpent = performance.now() - startTime;\n\n      logInfo(`Instances Matched in  ${timeSpent} ms`, {\n        matchingTime: timeSpent.toString(),\n        instancesToMatchCount: instancesToMatch.length.toString(),\n        // Counting all nested routes might be too time-consuming, so we only count the first level\n        topLevelRoutesCount: rootRoute.routes?.length.toString() ?? '0',\n      });\n\n      return result;\n    },\n    []\n  );\n\n  return { getRouteGroupsMap, matchInstancesToRoute };\n}\n"],"names":["Matchers","matchers","formatter","styles","getStyles","NUM_MATCHERS","firstFew","rest","hasMoreMatchers","matcher","MatcherBadge","theme","label","color","borderColor","isDefaultPolicy","route","getRoutesByIdMap","rootRoute","map","addRoutesToMap","path","r","hasEmptyMatchers","NotificationPolicyMatchers","matcherFormatter","PolicyPath","routesByIdMap","routePathIds","routePathObjects","id","pathRoute","index","NotificationRouteDetailsModal","onClose","receiver","alertManagerSourceName","isDefault","Modal","Authorize","Icon","Button","units","higlight","NotificationRouteHeader","instancesCount","expandRoute","onExpandRouteClick","showDetails","setShowDetails","onClickDetails","CollapseToggle","isCollapsed","Stack","Spacer","MetaText","NotificationRoute","instanceMatches","setExpandRoute","useToggle","GREY_COLOR_INDEX","instanceMatch","matchArray","matchResult","matchingLabels","mr","nonMatchingLabels","TagList","_","useAlertmanagerNotificationRoutingPreview","potentialInstances","currentData","configLoading","configError","useAlertmanagerConfig","config","matchInstancesToRoute","useRouteGroupsMatcher","receivers","receiversByName","matchingMap","matchingLoading","matchingError","useAsync","NotificationPreviewByAlertManager","alertManagerSource","onlyOneAM","loading","error","Alert","LoadingPlaceholder","routeId","createWorker","routeMatcher","loadWorker","worker","comlink","e","validateWorker","disposeWorker","getRouteGroupsMap","alertGroups","options","startTime","result","timeSpent","instancesToMatch"],"sourceRoot":""}