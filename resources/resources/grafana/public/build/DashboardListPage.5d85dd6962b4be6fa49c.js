"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[152],{77408:(oe,V,t)=>{t.r(V),t.d(V,{default:()=>zt});var n=t(32196),e=t(96540),I=t(70713),y=t(14110),A=t(40845),C=t(67647),b=t(17205),L=t(31678),O=t(71101),z=t(2543),H=t(12131),W=t(2619),T=t(33390),D=t(53477),w=t(6204),R=t(24439),f=t(64161),G=t(16757);const N={query:"",tag:[],starred:!1,layout:f.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search"},F={sort:null,starred:null,query:null,tag:null,layout:null},ee=()=>localStorage.getItem(D.YU)===f.P.List?f.P.List:f.P.Folders;class te extends W.Q{constructor(){super(...arguments),this.updateLocation=(0,z.debounce)(a=>H.Ny.partial(a,!0),300),this.doSearchWithDebounce=(0,z.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...F})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=a=>{this.setStateAndDoSearch({query:a})},this.onRemoveTag=a=>{this.setStateAndDoSearch({tag:this.state.tag.filter(o=>o!==a)})},this.onTagFilterChange=a=>{this.setStateAndDoSearch({tag:a})},this.onAddTag=a=>{this.state.tag&&this.state.tag.includes(a)||this.setStateAndDoSearch({tag:[...this.state.tag,a]})},this.onDatasourceChange=a=>{this.setStateAndDoSearch({datasource:a})},this.onPanelTypeChange=a=>{this.setStateAndDoSearch({panel_type:a})},this.onStarredFilterChange=a=>{const o=a.currentTarget.checked;this.setStateAndDoSearch({starred:o})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSortChange=a=>{a?localStorage.setItem(D.w7,a):localStorage.removeItem(D.w7),this.state.layout===f.P.Folders?this.setStateAndDoSearch({sort:a,layout:f.P.List}):this.setStateAndDoSearch({sort:a})},this.onLayoutChange=a=>{localStorage.setItem(D.YU,a),this.state.sort&&a===f.P.Folders?this.setStateAndDoSearch({layout:a,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:a,sort:this.state.prevSort})},this.onSetIncludePanels=a=>{this.setStateAndDoSearch({includePanels:a}),T.A.set(D.d7,a)},this.getTagOptions=()=>{const a=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,R.getGrafanaSearcher)().tags(a)},this.onSearchItemClicked=a=>{(0,w.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})},this.onReportSearchUsage=()=>{(0,w.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})}}initStateFromUrl(a,o=!0){const r=(0,G.N1)(H.Ny.getSearchObject());(r.query||r.datasource||r.panel_type)&&(r.layout=f.P.List);const l=ee(),i=localStorage.getItem(D.w7)??void 0,u=l===f.P.List?r.sort||i:null;k.setState({...N,...r,layout:l,sort:u??N.sort,prevSort:i,folderUid:a,eventTrackingNamespace:a?"manage_dashboards":"dashboard_search"}),o&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(a){const o=a.sort||this.state.sort||localStorage.getItem(D.w7)||void 0;this.setState({sort:o,...a}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.layout===f.P.List}getSearchQuery(){const a={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred};return a.sort?.length&&!a.sort.includes("name")&&(a.kind=["dashboard","folder"]),a.query?.length||(a.query="*",a.location||(a.kind=["dashboard","folder"])),!this.state.includePanels&&!a.kind&&(a.kind=["dashboard","folder"]),a.panel_type?.length&&(a.kind=["panel"]),a}doSearch(){const a={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels};(0,w.J$)(this.state.eventTrackingNamespace,a),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const o=(0,R.getGrafanaSearcher)(),r=Date.now();(this.state.starred?o.starred(this.lastQuery):o.search(this.lastQuery)).then(i=>{r>this.lastSearchTimestamp&&(this.setState({result:i,loading:!1}),this.lastSearchTimestamp=r)}).catch(i=>{(0,w.KZ)(this.state.eventTrackingNamespace,{...a,error:i?.message}),this.setState({loading:!1})})}}let k;function re(){if(!k){const a=localStorage.getItem(D.YU)??N.layout;let o=T.A.getBool(D.d7,!0);o&&(o=!1),k=new te({...N,layout:a,includePanels:o})}return k}function _(){const s=re();return[s.useState(),s]}var g=t(44836);function ge(s=!1){return s?(0,g.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,g.t)("search.search-input.placeholder","Search for dashboards and folders")}function le(){return(0,g.t)("search.dashboard-actions.new-dashboard","New dashboard")}function ae(){return(0,g.t)("search.dashboard-actions.new-folder","New folder")}function fe(){return(0,g.t)("search.dashboard-actions.import","Import")}function ie(){return(0,g.t)("search.dashboard-actions.new","New")}var Y=t(55314),ce=t(32264),Q=t(55852),Ee=t(56034),de=t(28138),he=t(28444),S=t(37690),ve=t(18241),Z=t(51887);function ye(){const s=(0,A.of)(ze),a=(0,L.useDispatch)(),o=(0,S.xK)(),[r]=(0,Y.uz)(),[l]=(0,Y.wt)(),[,i]=_(),u=(0,e.useMemo)(()=>!ce.$.featureToggles.nestedFolders&&Object.values(o.folder).some(c=>c),[o]),h=i.hasSearchFilters(),m=()=>{a((0,S.cT)({isSelected:!1,folderUID:void 0})),h&&i.doSearchWithDebounce()},E=async()=>{await r({selectedItems:o}),Ie("delete",o),m()},d=async c=>{await l({selectedItems:o,destinationUID:c}),Ie("move",o),m()},v=()=>{de.A.publish(new he.S8({component:Z.J,props:{selectedItems:o,onConfirm:d}}))},P=()=>{de.A.publish(new he.S8({component:ve.T,props:{selectedItems:o,onConfirm:E}}))},M=e.createElement(Q.$n,{onClick:v,variant:"secondary",disabled:u},e.createElement(g.x6,{i18nKey:"browse-dashboards.action.move-button"},"Move"));return e.createElement("div",{className:s.row,"data-testid":"manage-actions"},u?e.createElement(Ee.m,{content:(0,g.t)("browse-dashboards.action.cannot-move-folders","Folders cannot be moved")},M):M,e.createElement(Q.$n,{onClick:P,variant:"destructive"},e.createElement(g.x6,{i18nKey:"browse-dashboards.action.delete-button"},"Delete")))}const ze=s=>({row:(0,n.css)({display:"flex",flexDirection:"row",gap:s.spacing(1),marginBottom:s.spacing(2)})}),He={move:"grafana_manage_dashboards_item_moved",delete:"grafana_manage_dashboards_item_deleted"};function Ie(s,a){const o=Object.keys(a.dashboard).filter(l=>a.dashboard[l]),r=Object.keys(a.folder).filter(l=>a.folder[l]);(0,y.rR)(He[s],{item_counts:{folder:r.length,dashboard:o.length},source:"tree_actions"})}var Ae=t(66864),se=t(10880),Ge=t(94354),Qe=t(73725),je=t(99818);function Ye(){return[{value:f.P.Folders,icon:"folder",description:(0,g.t)("search.actions.view-as-folders","View by folders")},{value:f.P.List,icon:"list-ul",description:(0,g.t)("search.actions.view-as-list","View as list")}]}function Ze(s){const a=s.layout??f.P.Folders;return a===f.P.Folders&&(s.query||s.sort||s.starred||s.tag.length>0)?f.P.List:a}const Oe=({onLayoutChange:s,onSortChange:a,onStarredFilterChange:o=()=>{},onTagFilterChange:r,getTagOptions:l,getSortOptions:i,sortPlaceholder:u,onDatasourceChange:h,onPanelTypeChange:m,onSetIncludePanels:E,state:d,showStarredFilter:v,hideLayout:P})=>{const M=(0,A.of)(Je),c=Ze(d),p=d.tag.length||d.starred||d.query||d.datasource||d.panel_type?[f.P.Folders]:[];return e.createElement("div",{className:M.actionRow},e.createElement(Ae.Gy,{spacing:"md",width:"auto"},e.createElement(je.$,{isClearable:!1,tags:d.tag,tagOptions:l,onChange:r}),ce.$.featureToggles.panelTitleSearch&&e.createElement(se.S,{"data-testid":"include-panels",disabled:c===f.P.Folders,value:d.includePanels,onChange:()=>E(!d.includePanels),label:(0,g.t)("search.actions.include-panels","Include panels")}),v&&e.createElement("div",{className:M.checkboxWrapper},e.createElement(se.S,{label:(0,g.t)("search.actions.starred","Starred"),onChange:o,value:d.starred})),d.datasource&&e.createElement(Q.$n,{icon:"times",variant:"secondary",onClick:()=>h(void 0)},e.createElement(g.x6,{i18nKey:"search.actions.remove-datasource-filter"},"Datasource: ",{datasource:d.datasource})),d.panel_type&&e.createElement(Q.$n,{icon:"times",variant:"secondary",onClick:()=>m(void 0)},"Panel: ",d.panel_type)),e.createElement(Ae.Gy,{spacing:"md",width:"auto"},!P&&e.createElement(Ge.z,{options:Ye(),disabledOptions:p,onChange:s,value:c}),e.createElement(Qe.r,{onChange:K=>a(K?.value),value:d.sort,getSortOptions:i,placeholder:u||(0,g.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})))};Oe.displayName="ActionRow";const Je=s=>({actionRow:(0,n.css)`
      display: none;

      ${s.breakpoints.up("md")} {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: ${s.spacing(2)};
        width: 100%;
      }
    `,checkboxWrapper:(0,n.css)`
      label {
        line-height: 1.2;
      }
    `});function Xe(){const[s,a]=_();return e.createElement("div",null,e.createElement(Oe,{showStarredFilter:!0,state:s,getTagOptions:a.getTagOptions,getSortOptions:(0,R.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,R.getGrafanaSearcher)().sortPlaceholder,includePanels:s.includePanels??!1,onLayoutChange:a.onLayoutChange,onStarredFilterChange:a.onStarredFilterChange,onSortChange:a.onSortChange,onTagFilterChange:a.onTagFilterChange,onDatasourceChange:a.onDatasourceChange,onPanelTypeChange:a.onPanelTypeChange,onSetIncludePanels:a.onSetIncludePanels}))}var ke=t(76442),_e=t(7521),qe=t(92955),x=(s=>(s[s.Unselected=0]="Unselected",s[s.Selected=1]="Selected",s[s.Mixed=2]="Mixed",s))(x||{}),et=t(32885),tt=t(97222),at=t(10022),st=t(39070),ne=t(13544),pe=t(49952);function nt({row:{original:s},isSelected:a,onItemSelectionChange:o}){const r=s.item;if(!a)return e.createElement(Ce,null);if(r.kind==="ui")return r.uiKind==="pagination-placeholder"?e.createElement(se.S,{disabled:!0,value:!1}):e.createElement(Ce,null);if((0,pe.I)(r.uid))return e.createElement(Ce,null);const l=a(r);return e.createElement(se.S,{"data-testid":ne.Tp.pages.BrowseDashboards.table.checkbox(r.uid),"aria-label":(0,g.t)("browse-dashboards.dashboards-tree.select-checkbox","Select"),value:l===x.Selected,indeterminate:l===x.Mixed,onChange:i=>o?.(r,i.currentTarget.checked)})}function Ce(){const s=(0,A.of)(ot);return e.createElement("span",{className:s.checkboxSpacer})}const ot=s=>({checkboxSpacer:(0,n.css)({paddingLeft:s.spacing(2)})});function rt({isSelected:s,onAllSelectionChange:a}){const o=s?.("$all")??x.Unselected;return e.createElement(se.S,{value:o===x.Selected,indeterminate:o===x.Mixed,"aria-label":(0,g.t)("browse-dashboards.dashboards-tree.select-all-header-checkbox","Select all"),onChange:r=>{o===x.Mixed?a?.(!1):a?.(r.currentTarget.checked)}})}var lt=t(70255),Le=t(94753),it=t(29158),ct=t(62930),we=t(14578),dt=t(50720),Re=t(78318),ht=t(40957),Fe=t(18759);const be="md",xe="sm";function ut({row:{original:s},onFolderClick:a,treeID:o}){const r=(0,A.of)(mt),{item:l,level:i,isOpen:u}=s,h=(0,S.V6)(),m=u&&!h[l.uid],E=(0,ht.cu)(s.item,u);return l.kind==="ui"?e.createElement(e.Fragment,null,e.createElement(Fe.T,{level:i,spacing:{xs:1,md:3}}),e.createElement("span",{className:r.folderButtonSpacer}),l.uiKind==="empty-folder"?e.createElement("em",{className:r.emptyText},e.createElement(Le.E,{variant:"body",color:"secondary",truncate:!0},"No items")):e.createElement(lt.A,{width:200})):e.createElement(e.Fragment,null,e.createElement(Fe.T,{level:i,spacing:{xs:1,md:3}}),l.kind==="folder"?e.createElement(it.K,{size:be,className:r.chevron,onClick:()=>{a(l.uid,!u)},name:u?"angle-down":"angle-right","aria-label":u?(0,g.t)("browse-dashboards.dashboards-tree.collapse-folder-button","Collapse folder {{title}}",{title:l.title}):(0,g.t)("browse-dashboards.dashboards-tree.expand-folder-button","Expand folder {{title}}",{title:l.title})}):e.createElement("span",{className:r.folderButtonSpacer}),e.createElement("div",{className:r.iconNameContainer},m?e.createElement(ct.y,{size:xe}):e.createElement(we.I,{size:xe,name:E}),e.createElement(Le.E,{variant:"body",truncate:!0,id:o&&(0,pe.e)(o,l)},l.url?e.createElement(dt.N,{onClick:()=>{(0,y.rR)("manage_dashboards_result_clicked")},href:l.url,className:r.link},l.title):l.title)))}const mt=s=>({chevron:(0,n.css)({marginRight:s.spacing(1),width:(0,Re.cs)(be)}),emptyText:(0,n.css)({overflow:"hidden"}),folderButtonSpacer:(0,n.css)({paddingLeft:`calc(${(0,Re.cs)(be)}px + ${s.spacing(1)})`}),iconNameContainer:(0,n.css)({alignItems:"center",display:"flex",gap:s.spacing(1),overflow:"hidden"}),link:(0,n.css)({"&:hover":{textDecoration:"underline"}})});var Be=t(64149);function gt({row:{original:s}}){const a=(0,A.of)(ft),o=s.item;return o.kind==="ui"?o.uiKind==="pagination-placeholder"?e.createElement(Be.L.Skeleton,null):null:o.tags?e.createElement(Be.L,{className:a.tagList,tags:o.tags}):null}function ft(s){return{tagList:(0,n.css)({justifyContent:"flex-start",flexWrap:"nowrap"})}}var Et=t(37811);const Ne=36,Se=36,vt=0;function yt({items:s,width:a,height:o,isSelected:r,onFolderClick:l,onAllSelectionChange:i,onItemSelectionChange:u,isItemLoaded:h,requestLoadMore:m,canSelect:E=!1}){const d=(0,e.useId)(),v=(0,e.useRef)(null),P=(0,e.useRef)(null),M=(0,A.of)(Ke);(0,e.useEffect)(()=>{v.current&&v.current.resetloadMoreItemsCache(!0),P.current&&P.current.resetAfterIndex(0)},[s]);const c=(0,e.useMemo)(()=>{const U={id:"checkbox",width:0,Header:rt,Cell:nt},j={id:"name",width:3,Header:e.createElement("span",{style:{paddingLeft:24}},e.createElement(g.x6,{i18nKey:"browse-dashboards.dashboards-tree.name-column"},"Name")),Cell:Te=>e.createElement(ut,{...Te,onFolderClick:l})},X={id:"tags",width:2,Header:(0,g.t)("browse-dashboards.dashboards-tree.tags-column","Tags"),Cell:gt};return[E&&U,j,X].filter(st.zz)},[l,E]),p=(0,et.useTable)({columns:c,data:s},Et.A),{getTableProps:K,getTableBodyProps:J,headerGroups:B}=p,$=(0,e.useMemo)(()=>({table:p,isSelected:r,onAllSelectionChange:i,onItemSelectionChange:u,treeID:d}),[p,r,i,u,s,d]),me=(0,e.useCallback)(U=>h(U),[h]),Pe=(0,e.useCallback)((U,j)=>{const{parentUID:X}=s[U];m(X)},[m,s]),Ht=(0,e.useCallback)(U=>{const j=s[U];return j.item.kind==="ui"&&j.item.uiKind==="divider"?vt:Se},[s]);return e.createElement("div",{...K(),role:"table"},B.map(U=>{const{key:j,...X}=U.getHeaderGroupProps({style:{width:a}});return e.createElement("div",{key:j,...X,className:(0,n.cx)(M.row,M.headerRow)},U.headers.map(Me=>{const{key:Te,...Gt}=Me.getHeaderProps();return e.createElement("div",{key:Te,...Gt,role:"columnheader",className:M.cell},Me.render("Header",{isSelected:r,onAllSelectionChange:i}))}))}),e.createElement("div",{...J(),"data-testid":ne.Tp.pages.BrowseDashboards.table.body},e.createElement(at.A,{ref:v,itemCount:s.length,isItemLoaded:me,loadMoreItems:Pe},({onItemsRendered:U,ref:j})=>e.createElement(tt._m,{ref:X=>{j(X),P.current=X},height:o-Ne,width:a,itemCount:s.length,itemData:$,estimatedItemSize:Se,itemSize:Ht,onItemsRendered:U},pt))))}function pt({index:s,style:a,data:o}){const r=(0,A.of)(Ke),{table:l,isSelected:i,onItemSelectionChange:u,treeID:h}=o,{rows:m,prepareRow:E}=l,d=m[s];E(d);const v=d.original.item;return v.kind==="ui"&&v.uiKind==="divider"?e.createElement("div",{...d.getRowProps({style:a})},e.createElement("hr",{className:r.divider})):e.createElement("div",{...d.getRowProps({style:a}),className:(0,n.cx)(r.row,r.bodyRow),"aria-labelledby":(0,pe.e)(h,v),"data-testid":ne.Tp.pages.BrowseDashboards.table.row("title"in v?v.title:v.uid)},d.cells.map(P=>{const{key:M,...c}=P.getCellProps();return e.createElement("div",{key:M,...c,className:r.cell},P.render("Cell",{isSelected:i,onItemSelectionChange:u,treeID:h}))}))}const Ke=s=>({row:(0,n.css)({gap:s.spacing(1)}),divider:(0,n.css)({borderTop:`1px solid ${s.colors.border.weak}`,width:"100%",margin:0}),headerRow:(0,n.css)({backgroundColor:s.colors.background.secondary,height:Ne}),bodyRow:(0,n.css)({height:Se,"&:hover":{backgroundColor:s.colors.emphasize(s.colors.background.primary,.03)}}),cell:(0,n.css)({padding:s.spacing(1),overflow:"hidden",display:"flex",alignItems:"center"}),link:(0,n.css)({"&:hover":{textDecoration:"underline"}})});function Ct({folderUID:s,width:a,height:o,canSelect:r}){const l=(0,S.eC)(s),i=(0,L.useDispatch)(),u=(0,S.q0)(s),h=(0,S.Ms)(),m=(0,S.V6)(),E=(0,e.useCallback)((c,p)=>{i((0,S.wn)({folderUID:c,isOpen:p})),p&&i((0,S.Ii)({parentUID:c,pageSize:qe.md}))},[i]),d=(0,e.useCallback)((c,p)=>{i((0,S.t$)({item:c,isSelected:p}))},[i]),v=(0,e.useCallback)(c=>{if(c==="$all"){if(h.$all)return x.Selected;for(const J of Object.values(h))if(typeof J!="boolean"){for(const B in J)if(J[B])return x.Mixed}return x.Unselected}return h[c.kind][c.uid]?x.Selected:Ue(c,m,h)?x.Mixed:x.Unselected},[h,m]),P=(0,e.useCallback)(c=>{const p=u[c];if(!p)return!1;const K=p.item;return!(K.kind==="ui"&&K.uiKind==="pagination-placeholder")},[u]),M=(0,S.Zg)();return l==="fulfilled"&&u.length===0?e.createElement("div",{style:{width:a}},r?e.createElement(_e.A,{title:s?"This folder doesn't have any dashboards yet":"No dashboards yet. Create your first!",buttonIcon:"plus",buttonTitle:"Create Dashboard",buttonLink:s?`dashboard/new?folderUid=${s}`:"dashboard/new",proTip:s&&"Add/move dashboards to your folder at ->",proTipLink:s&&"dashboards",proTipLinkTitle:s&&"Browse dashboards",proTipTarget:""}):e.createElement(ke.c,{callToActionElement:e.createElement("span",null,"This folder is empty")})):e.createElement(yt,{canSelect:r,items:u,width:a,height:o,isSelected:v,onFolderClick:E,onAllSelectionChange:c=>i((0,S.cT)({isSelected:c,folderUID:s})),onItemSelectionChange:d,isItemLoaded:P,requestLoadMore:M})}function Ue(s,a,o){const r=a[s.uid];return r?r.items.some(l=>{const i=o[l.kind][l.uid];return i||Ue(l,a,o)}):!1}var bt=t(58476),St=t(38138),De=t(64539),Dt=t(83122),Pt=t(87978),Mt=t(49785),Tt=t(88575),It=t(10354),At=t(67061),Ot=t(71500);const We={folderName:""};function Lt({onCancel:s,onConfirm:a}){const{handleSubmit:o,register:r,formState:{errors:l}}=(0,Mt.mN)({defaultValues:We}),i=(0,g.t)("browse-dashboards.action.new-folder-name-required-phrase","Folder name is required."),u=async m=>{try{return await Ot.P.validateNewFolderName(m),!0}catch(E){if(E instanceof Error)return E.message;throw E}},h=(0,g.t)("browse-dashboards.new-folder-form.name-label","Folder name");return e.createElement("form",{name:"addFolder",onSubmit:o(m=>a(m.folderName)),"data-testid":ne.Tp.pages.BrowseDashboards.NewFolderForm.form},e.createElement(Tt.D,{label:h,invalid:!!l.folderName,error:l.folderName&&l.folderName.message},e.createElement(It.p,{"data-testid":ne.Tp.pages.BrowseDashboards.NewFolderForm.nameInput,id:"folder-name-input",defaultValue:We.folderName,...r("folderName",{required:i,validate:async m=>await u(m)})})),e.createElement(At.B,null,e.createElement(Q.$n,{variant:"secondary",fill:"outline",onClick:s},e.createElement(g.x6,{i18nKey:"browse-dashboards.new-folder-form.cancel-label"},"Cancel")),e.createElement(Q.$n,{type:"submit"},e.createElement(g.x6,{i18nKey:"browse-dashboards.new-folder-form.create-label"},"Create"))))}function wt({parentFolder:s,canCreateDashboard:a,canCreateFolder:o}){const[r,l]=(0,e.useState)(!1),i=(0,bt.zy)(),[u]=(0,Y.Vc)(),[h,m]=(0,e.useState)(!1),E=async v=>{try{await u({title:v,parentUid:s?.uid});const P=s?.parents?s.parents.length+1:0;(0,y.rR)("grafana_manage_dashboards_folder_created",{is_subfolder:!!s?.uid,folder_depth:P})}finally{m(!1)}},d=e.createElement(St.W,null,a&&e.createElement(De.D,{label:le(),onClick:()=>(0,y.rR)("grafana_menu_item_clicked",{url:ue("/dashboard/new",s?.uid),from:i.pathname}),url:ue("/dashboard/new",s?.uid)}),o&&e.createElement(De.D,{onClick:()=>m(!0),label:ae()}),a&&e.createElement(De.D,{label:fe(),onClick:()=>(0,y.rR)("grafana_menu_item_clicked",{url:ue("/dashboard/import",s?.uid),from:i.pathname}),url:ue("/dashboard/import",s?.uid)}));return e.createElement(e.Fragment,null,e.createElement(Dt.m,{overlay:d,onVisibleChange:l},e.createElement(Q.$n,null,ie(),e.createElement(we.I,{name:r?"angle-up":"angle-down"}))),h&&e.createElement(Pt._,{title:ae(),subtitle:s?.title?`Location: ${s.title}`:void 0,onClose:()=>m(!1),size:"sm"},e.createElement(Lt,{onConfirm:E,onCancel:()=>m(!1)})))}function ue(s,a){return a?s+"?folderUid="+a:s}var Rt=t(9134),Ft=t(78368),xt=t(14236),Bt=t(69529),Nt=t(97427),Kt=t(66359);const q=50,Ut={view:new Ft.R((0,xt.Vc)({fields:[{name:"uid",display:!0,values:Array(q).fill(null)},{name:"kind",display:!0,values:Array(q).fill("dashboard")},{name:"name",display:!0,values:Array(q).fill("")},{name:"location",display:!0,values:Array(q).fill("")},{name:"tags",display:!0,values:Array(q).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:q};function Wt({width:s,height:a,canSelect:o}){const r=(0,L.useDispatch)(),l=(0,L.useSelector)(c=>c.browseDashboards.selectedItems),i=(0,S.QE)(),{keyboardEvents:u}=(0,Nt.d)(),[h,m]=_(),E=h.result??Ut,d=(0,e.useCallback)((c,p)=>c?c==="*"&&p==="*"?i:c==="*"?!1:l[$e(c)][p]??!1:!1,[l,i]),v=(0,e.useCallback)(()=>{r((0,S.cT)({isSelected:!1,folderUID:void 0}))},[r]),P=(0,e.useCallback)((c,p)=>{const K=!d(c,p);r((0,S.t$)({item:{kind:$e(c),uid:p},isSelected:K}))},[d,r]);if(E.totalRows===0)return e.createElement("div",{style:{width:s}},e.createElement(Bt.p,{button:e.createElement(Q.$n,{variant:"secondary",onClick:m.onClearSearchAndFilters},e.createElement(g.x6,{i18nKey:"browse-dashboards.no-results.clear"},"Clear search and filters")),message:(0,g.t)("browse-dashboards.no-results.text","No results found for your query"),variant:"not-found"}));const M={response:E,selection:o?d:void 0,selectionToggle:o?P:void 0,clearSelection:v,width:s,height:a,onTagSelected:m.onAddTag,keyboardEvents:u,onDatasourceChange:h.datasource?m.onDatasourceChange:void 0,onClickItem:m.onSearchItemClicked};return e.createElement(Kt.P,{...M})}function $e(s){switch(s){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+s)}var $t=t(49904);const Ve=(0,e.memo)(({match:s})=>{const{uid:a}=s.params,o=(0,L.useDispatch)(),r=(0,A.of)(Vt),[l,i]=_(),u=i.hasSearchFilters();(0,e.useEffect)(()=>{i.initStateFromUrl(a),o((0,S.cT)({isSelected:!1,folderUID:void 0}))},[o,a,i]),(0,e.useEffect)(()=>{!u&&l.result&&i.setState({result:void 0,includePanels:void 0})},[u,l.result,i]);const{data:h}=(0,Y.kH)(a??Y.hT),[m]=(0,Y.iB)(),E=(0,e.useMemo)(()=>{if(!h)return;const B=(0,O.R4)(h),$=(0,O.Cg)(h.uid),me=B.children?.find(Pe=>Pe.id===$);return me&&(me.active=!0),B},[h]),d=(0,S.QE)(),{canEditFolders:v,canEditDashboards:P,canCreateDashboards:M,canCreateFolders:c}=(0,$t.N)(h),p=v&&a,K=v||P,J=async B=>{if(h){const $=await m({...h,title:B});if("error"in $)throw(0,y.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_with_error",error:$.error}),$.error;(0,y.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"success"})}else(0,y.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_no_folderDTO"})};return e.createElement(b.Y,{navId:"dashboards/browse",pageNav:E,onEditTitle:p?J:void 0,actions:e.createElement(e.Fragment,null,h&&e.createElement(Rt.m,{folder:h}),(M||c)&&e.createElement(wt,{parentFolder:h,canCreateDashboard:M,canCreateFolder:c}))},e.createElement(b.Y.Contents,{className:r.pageContents},e.createElement(C.Z,{placeholder:ge(l.includePanels),value:l.query,escapeRegex:!1,onChange:B=>i.onQueryChange(B)}),d?e.createElement(ye,null):e.createElement(Xe,null),e.createElement("div",{className:r.subView},e.createElement(I.Ay,null,({width:B,height:$})=>u?e.createElement(Wt,{canSelect:K,width:B,height:$}):e.createElement(Ct,{canSelect:K,width:B,height:$,folderUID:a})))))}),Vt=s=>({pageContents:(0,n.css)({display:"grid",gridTemplateRows:"auto auto 1fr",height:"100%",rowGap:s.spacing(1)}),subView:(0,n.css)({height:"100%"})});Ve.displayName="BrowseDashboardsPage";const zt=Ve},18241:(oe,V,t)=>{t.d(V,{T:()=>z});var n=t(96540),e=t(32264),I=t(96374),y=t(94753),A=t(68402),C=t(42418),b=t(44836),L=t(55314),O=t(43907);const z=({onConfirm:H,onDismiss:W,selectedItems:T,...D})=>{const{data:w}=(0,L.G2)(T),R=!e.$.featureToggles.nestedFolders&&w&&(w.alertRule||w.libraryPanel),[f,G]=(0,n.useState)(!1),N=async()=>{G(!0);try{await H(),G(!1),W()}catch{G(!1)}};return n.createElement(I.u,{body:n.createElement(n.Fragment,null,n.createElement(y.E,{element:"p"},n.createElement(b.x6,{i18nKey:"browse-dashboards.action.delete-modal-text"},"This action will delete the following content:")),n.createElement(O.x,{selectedItems:T}),n.createElement(A.$,{v:2})),description:n.createElement(n.Fragment,null,R?n.createElement(C.F,{severity:"warning",title:(0,b.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder")},n.createElement(b.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text"},"One or more folders contain library panels or alert rules. Delete these first in order to proceed.")):null),confirmationText:"Delete",confirmText:f?(0,b.t)("browse-dashboards.action.deleting","Deleting..."):(0,b.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:W,onConfirm:N,title:(0,b.t)("browse-dashboards.action.delete-modal-title","Delete"),...D})}},51887:(oe,V,t)=>{t.d(V,{J:()=>H});var n=t(96540),e=t(37390),I=t(42418),y=t(94753),A=t(68402),C=t(88575),b=t(55852),L=t(36607),O=t(44836),z=t(43907);const H=({onConfirm:W,onDismiss:T,selectedItems:D,...w})=>{const[R,f]=(0,n.useState)(),[G,N]=(0,n.useState)(!1),F=Object.keys(D.folder).filter(te=>D.folder[te]),ee=async()=>{if(R!==void 0){N(!0);try{await W(R),N(!1),T()}catch{N(!1)}}};return n.createElement(e.a,{title:(0,O.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:T,...w},F.length>0&&n.createElement(I.F,{severity:"info",title:(0,O.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),n.createElement(y.E,{element:"p"},n.createElement(O.x6,{i18nKey:"browse-dashboards.action.move-modal-text"},"This action will move the following content:")),n.createElement(z.x,{selectedItems:D}),n.createElement(A.$,{v:3}),n.createElement(C.D,{label:(0,O.t)("browse-dashboards.action.move-modal-field-label","Folder name")},n.createElement(L.d,{value:R,excludeUIDs:F,onChange:f})),n.createElement(e.a.ButtonRow,null,n.createElement(b.$n,{onClick:T,variant:"secondary",fill:"outline"},n.createElement(O.x6,{i18nKey:"browse-dashboards.action.cancel-button"},"Cancel")),n.createElement(b.$n,{disabled:R===void 0||G,onClick:ee,variant:"primary"},G?(0,O.t)("browse-dashboards.action.moving","Moving..."):(0,O.t)("browse-dashboards.action.move-button","Move"))))}},9134:(oe,V,t)=>{t.d(V,{m:()=>N});var n=t(96540),e=t(32264),I=t(14110),y=t(12131),A=t(38138),C=t(64539),b=t(83122),L=t(55852),O=t(14578),z=t(87978),H=t(5108),W=t(10096),T=t(44836),D=t(28444),w=t(55314),R=t(49904),f=t(18241),G=t(51887);function N({folder:F}){const[ee,te]=(0,n.useState)(!1),[k,re]=(0,n.useState)(!1),[_]=(0,w.aF)(),[g]=(0,w.Ko)(),{canEditFolders:ge,canDeleteFolders:le,canViewPermissions:ae,canSetPermissions:fe}=(0,R.N)(F),ie=e.$.featureToggles.nestedFolders&&ge,Y=async Z=>{await _({folder:F,destinationUID:Z}),(0,I.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},ce=async()=>{await g(F),(0,I.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:Z}=F,ye=Z&&Z.length?Z[Z.length-1].url:"/dashboards";y.Ny.push(ye)},Q=()=>{W.lE.publish(new D.S8({component:G.J,props:{selectedItems:{folder:{[F.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:Y}}))},Ee=()=>{W.lE.publish(new D.S8({component:f.T,props:{selectedItems:{folder:{[F.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:ce}}))},de=(0,T.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),he=(0,T.t)("browse-dashboards.folder-actions-button.move","Move"),S=(0,T.t)("browse-dashboards.folder-actions-button.delete","Delete"),ve=n.createElement(A.W,null,ae&&n.createElement(C.D,{onClick:()=>re(!0),label:de}),ie&&n.createElement(C.D,{onClick:Q,label:he}),le&&n.createElement(C.D,{destructive:!0,onClick:Ee,label:S}));return!ae&&!ie&&!le?null:n.createElement(n.Fragment,null,n.createElement(b.m,{overlay:ve,onVisibleChange:te},n.createElement(L.$n,{variant:"secondary"},n.createElement(T.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions"},"Folder actions"),n.createElement(O.I,{name:ee?"angle-up":"angle-down"}))),k&&n.createElement(z._,{title:(0,T.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:F.title,onClose:()=>re(!1),size:"md"},n.createElement(H.x,{resource:"folders",resourceId:F.uid,canSetPermissions:fe})))}},49904:(oe,V,t)=>{t.d(V,{N:()=>A});var n=t(32264),e=t(10096),I=t(31678);function y(C,b){return b?e.TP.hasPermissionInMetadata(C,b):e.TP.hasPermission(C)}function A(C){const b=y(I.AccessControlAction.DashboardsCreate,C),L=!!((!C||n.$.featureToggles.nestedFolders)&&y(I.AccessControlAction.FoldersCreate)),O=y(I.AccessControlAction.FoldersDelete,C),z=y(I.AccessControlAction.DashboardsWrite,C),H=y(I.AccessControlAction.FoldersWrite,C),W=y(I.AccessControlAction.FoldersPermissionsWrite,C),T=y(I.AccessControlAction.FoldersPermissionsRead,C);return{canCreateDashboards:b,canCreateFolders:L,canDeleteFolders:O,canEditDashboards:z,canEditFolders:H,canSetPermissions:W,canViewPermissions:T}}}}]);

//# sourceMappingURL=DashboardListPage.5d85dd6962b4be6fa49c.js.map