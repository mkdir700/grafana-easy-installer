"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1743,9856],{20972:(Ae,N,a)=>{a.r(N),a.d(N,{default:()=>Qe});var s=a(32196),e=a(96540),A=a(13544),$=a(32264),U=a(33378),p=a(40675),L=a(40845),z=a(63021),d=a(44836),Y=a(16233),Z=a(72254),F=a(17205),H=a(31678),ee=a(31083),te=a(63329),ae=a(67647),C=a(94354),x=a(55852),re=a(69529),le=a(10096),J=a(12942),M=a(67061),R=a(56034),f=a(14578),b=a(94753),K=a(78369),se=a(48840),W=a(19384),oe=a(46334),P=a(90613);const O=({units:t,icon:r})=>t?.length?t.length>1?e.createElement(R.m,{placement:"top",content:e.createElement(M.B,{direction:"column"},t?.map(l=>e.createElement("span",{key:l.name},l.name)))},e.createElement(Q,{icon:r},t.length)):e.createElement(Q,{icon:r},t[0].name):null,Q=(0,e.forwardRef)(({children:t,icon:r},l)=>e.createElement(P.a,{ref:l,display:"flex",alignItems:"center",marginRight:1},e.createElement(f.I,{name:r})," ",e.createElement(P.a,{marginLeft:1},t)));Q.displayName="TooltipContent";const G=({users:t,showPaging:r,totalPages:l,onChangePage:u,currentPage:h,fetchData:g})=>{const T=(0,e.useMemo)(()=>t.some(o=>o.licensedRole),[t]),E=(0,e.useMemo)(()=>t.some(o=>o.orgs),[t]),_=(0,e.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:o}})=>o&&e.createElement(J.e,{src:o,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:o}})=>o,sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:o}})=>o,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:o}})=>o,sortType:"string"},...E?[{id:"orgs",header:"Belongs to",cell:({cell:{value:o,row:I}})=>e.createElement(M.B,{alignItems:"center"},e.createElement(O,{units:o,icon:"building"}),I.original.isAdmin&&e.createElement(R.m,{placement:"top",content:"Grafana Admin"},e.createElement(f.I,{name:"shield"}))),sortType:(o,I)=>(o.original.orgs?.length||0)-(I.original.orgs?.length||0)}]:[],...T?[{id:"licensedRole",header:"Licensed role",cell:({cell:{value:o}})=>o==="None"?e.createElement(b.E,{color:"disabled"},"Not assigned"," ",e.createElement(R.m,{placement:"top",content:"A licensed role will be assigned when this user signs in"},e.createElement(f.I,{name:"question-circle"}))):o,sortType:"string"}]:[],{id:"lastSeenAtAge",header:"Last active",headerTooltip:{content:"Time since user was seen using Grafana",iconName:"question-circle"},cell:({cell:{value:o}})=>e.createElement(e.Fragment,null,o&&e.createElement(e.Fragment,null,o==="10 years"?e.createElement(b.E,{color:"disabled"},"Never"):o)),sortType:(o,I)=>new Date(o.original.lastSeenAt).getTime()-new Date(I.original.lastSeenAt).getTime()},{id:"authLabels",header:"Origin",cell:({cell:{value:o}})=>e.createElement(e.Fragment,null,Array.isArray(o)&&o.length>0&&e.createElement(oe.E,{label:o[0],removeIcon:!1,count:0}))},{id:"isDisabled",header:"",cell:({cell:{value:o}})=>e.createElement(e.Fragment,null,o&&e.createElement(K.v,{colorIndex:9,name:"Disabled"}))},{id:"edit",header:"",cell:({row:{original:o}})=>e.createElement("a",{href:`admin/users/edit/${o.id}`,"aria-label":`Edit team ${o.name}`},e.createElement(R.m,{content:"Edit user"},e.createElement(f.I,{name:"pen"})))}],[T,E]);return e.createElement(M.B,{direction:"column",gap:2},e.createElement(se.j,{columns:_,data:t,getRowId:o=>String(o.id),fetchData:g}),r&&e.createElement(M.B,{justifyContent:"flex-end"},e.createElement(W.d,{numberOfPages:l,currentPage:h,onNavigate:u})))};var y=a(57334);const V=[],pe=t=>{V.push(t)},ce=A.Tp.pages.UserListPage.UserListAdminPage,c={fetchUsers:y.hU,changeQuery:y.nM,changePage:y.yd,changeFilter:y.$u,changeSort:y.Vk},v=t=>({users:t.userListAdmin.users,query:t.userListAdmin.query,showPaging:t.userListAdmin.showPaging,totalPages:t.userListAdmin.totalPages,page:t.userListAdmin.page,filters:t.userListAdmin.filters,isLoading:t.userListAdmin.isLoading}),Ue=(0,te.connect)(v,c)(({fetchUsers:t,query:r,changeQuery:l,users:u,showPaging:h,changeFilter:g,filters:T,totalPages:E,page:_,changePage:o,changeSort:I,isLoading:Be})=>{const be=(0,L.of)(Le);return(0,e.useEffect)(()=>{t()},[t]),e.createElement(F.Y.Contents,null,e.createElement("div",{className:be.actionBar,"data-testid":ce.container},e.createElement("div",{className:be.row},e.createElement(ae.Z,{placeholder:"Search user by login, email, or name.",autoFocus:!0,value:r,onChange:l}),e.createElement(C.z,{options:[{label:"All users",value:!1},{label:"Active last 30 days",value:!0}],onChange:ve=>g({name:"activeLast30Days",value:ve}),value:T.find(ve=>ve.name==="activeLast30Days")?.value,className:be.filter}),V.map((ve,je)=>e.createElement(ve,{key:je,filters:T,onChange:g,className:be.filter})),le.TP.hasPermission(H.AccessControlAction.UsersCreate)&&e.createElement(x.z9,{href:"admin/users/create",variant:"primary"},"New user"))),!Be&&u.length===0?e.createElement(re.p,{message:(0,d.t)("users.empty-state.message","No users found"),variant:"not-found"}):e.createElement(G,{users:u,showPaging:h,totalPages:E,onChangePage:o,currentPage:_,fetchData:I}))});function $e(){return React.createElement(Page,{navId:"global-users"},React.createElement(Ue,null))}const Le=t=>({filter:(0,s.css)({margin:t.spacing(0,1),[t.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,s.css)({marginBottom:t.spacing(2),display:"flex",alignItems:"flex-start",gap:t.spacing(2),[t.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,s.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:t.spacing(.5),flexGrow:1,[t.breakpoints.down("sm")]:{flexWrap:"wrap",gap:t.spacing(2),width:"100%"}})}),Se=null;var De=a(39938),Te=a(23088);const ye=t=>{if(!t.includes(" "))return{browser:t,computer:""};const r=t.split(" ");return{browser:r[0],computer:r[1]}},de=(t,r)=>t.length>r?t.substring(0,r)+"...":t,Ie=({value:t})=>{const r=ye(t);return e.createElement(R.m,{theme:"info-alt",content:t,placement:"top-end",interactive:!0},e.createElement("span",null,de(r.browser,10),de(r.computer,10)))},n=({devices:t,showPaging:r,totalPages:l,onChangePage:u,currentPage:h,fetchData:g})=>{const T=(0,e.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:E}})=>E&&e.createElement(J.e,{src:E,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:E}})=>"Anonymous"},{id:"userAgent",header:"User Agent",cell:({cell:{value:E}})=>e.createElement(Ie,{value:E}),sortType:"string"},{id:"updatedAt",header:"Last active",cell:({cell:{value:E}})=>E,sortType:(E,_)=>new Date(E.original.updatedAt).getTime()-new Date(_.original.updatedAt).getTime()},{id:"clientIp",header:"Origin IP (address)",cell:({cell:{value:E}})=>E&&e.createElement(De.E,{text:E,color:"orange"})}],[]);return e.createElement(M.B,{direction:"column",gap:2},e.createElement(se.j,{columns:T,data:t,getRowId:E=>E.deviceId,fetchData:g}),r&&e.createElement(M.B,{justifyContent:"flex-end"},e.createElement(W.d,{numberOfPages:l,currentPage:h,onNavigate:u})),t.length===0&&e.createElement(Te.Z,null,e.createElement("span",null,"No anonymous users found.")))},i={fetchUsersAnonymousDevices:y.xq,changeAnonUserSort:y.A5,changeAnonPage:y.is,changeAnonQuery:y.Bc},m=t=>({devices:t.userListAnonymousDevices.devices,query:t.userListAnonymousDevices.query,showPaging:t.userListAnonymousDevices.showPaging,totalPages:t.userListAnonymousDevices.totalPages,page:t.userListAnonymousDevices.page,filters:t.userListAnonymousDevices.filters}),D=A.Tp.pages.UserListPage.UserListAdminPage,S=(0,te.connect)(m,i)(({devices:t,fetchUsersAnonymousDevices:r,query:l,changeAnonQuery:u,filters:h,showPaging:g,totalPages:T,page:E,changeAnonPage:_,changeAnonUserSort:o})=>{const I=(0,L.of)(k);return(0,e.useEffect)(()=>{r()},[r]),e.createElement(F.Y.Contents,null,e.createElement("div",{className:I.actionBar,"data-testid":D.container},e.createElement("div",{className:I.row},e.createElement(ae.Z,{placeholder:"Search devices by ip adress.",autoFocus:!0,value:l,onChange:u}),e.createElement(C.z,{options:[{label:"Active last 30 days",value:!0}],value:h.find(Be=>Be.name==="activeLast30Days")?.value,className:I.filter}))),e.createElement(n,{devices:t,showPaging:g,totalPages:T,onChangePage:_,currentPage:E,fetchData:o}))});function w(){return React.createElement(Page,{navId:"anonymous-users"},React.createElement(S,null))}const k=t=>({filter:(0,s.css)({margin:t.spacing(0,1),[t.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,s.css)({marginBottom:t.spacing(2),display:"flex",alignItems:"flex-start",gap:t.spacing(2),[t.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,s.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:t.spacing(.5),flexGrow:1,[t.breakpoints.down("sm")]:{flexWrap:"wrap",gap:t.spacing(2),width:"100%"}})}),q=null;var j=a(66864),me=a(72686),ge=a(37390),ue=a(39558),Pe=a(71678);const fe=A.Tp.pages.UserListPage.UsersListPublicDashboardsPage.DashboardsListModal,Ce=({email:t,onDismiss:r})=>{const l=(0,L.of)(Me),{data:u,isLoading:h}=(0,me.kd)(t);return e.createElement(ge.a,{className:l.modal,isOpen:!0,title:(0,d.t)("public-dashboard-users-access-list.modal.dashboard-modal-title","Public dashboards"),onDismiss:r},h?e.createElement("div",{className:l.loading},e.createElement(ue._,{text:(0,d.t)("public-dashboard-users-access-list.dashboard-modal.loading-text","Loading...")})):u?.map(g=>e.createElement("div",{key:g.dashboardUid,className:l.listItem,"data-testid":fe.listItem(g.dashboardUid)},e.createElement("p",{className:l.dashboardTitle},g.dashboardTitle),e.createElement("div",{className:l.urlsContainer},e.createElement("a",{rel:"noreferrer",target:"_blank",className:(0,s.cx)("external-link",l.url),href:(0,Z.mL)(g.publicDashboardAccessToken),onClick:r},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-link"},"Public dashboard URL")),e.createElement("span",{className:l.urlsDivider},"\u2022"),e.createElement("a",{className:(0,s.cx)("external-link",l.url),href:(0,Z.gN)(g.dashboardUid,g.slug),onClick:r},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-setting"},"Public dashboard settings"))),e.createElement("hr",{className:l.divider}))))},xe=({email:t})=>{const r=(0,d.t)("public-dashboard-users-access-list.dashboard-modal.open-dashboard-list-text","Open dashboards list");return e.createElement(Pe.$s,null,({showModal:l,hideModal:u})=>e.createElement(x.$n,{variant:"secondary",size:"sm",icon:"question-circle",title:r,"aria-label":r,onClick:()=>l(Ce,{email:t,onDismiss:u})}))},Me=t=>({modal:(0,s.css)`
    width: 590px;
  `,loading:(0,s.css)`
    display: flex;
    justify-content: center;
  `,listItem:(0,s.css)`
    display: flex;
    flex-direction: column;
    gap: ${t.spacing(.5)};
  `,divider:(0,s.css)`
    margin: ${t.spacing(1.5,0)};
    color: ${t.colors.text.secondary};
  `,urlsContainer:(0,s.css)`
    display: flex;
    gap: ${t.spacing(.5)};

    ${t.breakpoints.down("sm")} {
      flex-direction: column;
    }
  `,urlsDivider:(0,s.css)`
    color: ${t.colors.text.secondary};
    ${t.breakpoints.down("sm")} {
      display: none;
    }
  `,dashboardTitle:(0,s.css)`
    font-size: ${t.typography.body.fontSize};
    font-weight: ${t.typography.fontWeightBold};
    margin-bottom: 0;
  `,url:(0,s.css)`
    font-size: ${t.typography.body.fontSize};
  `}),Re=({user:t,hideModal:r})=>{const[l]=(0,me.g9)(),u=(0,L.of)(Oe),h=()=>{l({email:t.email}),r()};return e.createElement(ge.a,{className:u.modal,isOpen:!0,title:(0,d.t)("public-dashboard-users-access-list.delete-user-modal.revoke-access-title","Revoke access"),onDismiss:r},e.createElement("p",{className:u.description},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line1"},"Are you sure you want to revoke access for ",{email:t.email},"?")),e.createElement("p",{className:u.description},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0},"This action will immediately revoke ",{email:t.email},"'s access to all public dashboards.")),e.createElement(ge.a.ButtonRow,null,e.createElement(x.$n,{type:"button",variant:"secondary",onClick:r,fill:"outline"},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-cancel-button"},"Cancel")),e.createElement(x.$n,{type:"button",variant:"destructive",onClick:h},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-revoke-access-button"},"Revoke access"))))},Ee=({user:t})=>{const r=(0,d.t)("public-dashboard-users-access-list.delete-user-modal.delete-user-button-text","Delete user");return e.createElement(Pe.$s,null,({showModal:l,hideModal:u})=>e.createElement(x.$n,{size:"sm",variant:"destructive",onClick:()=>l(Re,{user:t,hideModal:u}),icon:"times","aria-label":r,title:r}))},Oe=t=>({modal:(0,s.css)`
    width: 500px;
  `,description:(0,s.css)`
    font-size: ${t.typography.body.fontSize};
    margin: 0;
  `}),Ke=A.Tp.pages.UserListPage.publicDashboards,We=()=>{const{data:t,isLoading:r}=(0,me.AK)();return e.createElement(F.Y.Contents,{isLoading:r},e.createElement("table",{className:"filter-table form-inline","data-testid":Ke.container},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.email-label"},"Email")),e.createElement("th",null,e.createElement("span",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.activated-label"},"Activated")),e.createElement(R.m,{placement:"top",content:(0,d.t)("public-dashboard-users-access-list.table-header.activated-tooltip","Earliest time user has been an active user to a dashboard")},e.createElement(f.I,{name:"question-circle"}))),e.createElement("th",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.last-active-label"},"Last active")),e.createElement("th",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.origin-label"},"Origin")),e.createElement("th",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.role-label"},"Role")),e.createElement("th",null))),e.createElement("tbody",null,t?.map(l=>e.createElement("tr",{key:l.email},e.createElement("td",{className:"max-width-10"},e.createElement("span",{className:"ellipsis",title:l.email},l.email)),e.createElement("td",{className:"max-width-10"},l.firstSeenAtAge),e.createElement("td",{className:"max-width-10"},l.lastSeenAtAge),e.createElement("td",{className:"max-width-10"},e.createElement(j.Gy,{spacing:"sm"},e.createElement("span",null,l.totalDashboards," dashboard(s)"),e.createElement(xe,{email:l.email}))),e.createElement("td",{className:"max-width-10"},e.createElement(K.v,{name:"Viewer",colorIndex:19})),e.createElement("td",{className:"text-right"},e.createElement(Ee,{user:l})))))))};var ze=(t=>(t.ADMIN="admin",t.ORG="org",t.PUBLIC_DASHBOARDS="public-dashboards",t.ANON="anon",t))(ze||{});const he=A.Tp.pages.UserListPage,Ne=({view:t,setView:r})=>e.createElement(p.o,{label:(0,d.t)("users-access-list.tabs.public-dashboard-users-tab-title","Public dashboard users"),active:t==="public-dashboards",onChangeTab:()=>r("public-dashboards"),"data-testid":he.tabs.publicDashboardsUsers}),Fe={admin:e.createElement(Ue,null),org:e.createElement(ee.UsersListPageContent,null),"public-dashboards":e.createElement(We,null),anon:e.createElement(S,null)};function Qe(){const t=(0,L.of)(Ge),r=Y.TP.hasPermission(H.AccessControlAction.UsersRead),l=Y.TP.hasPermission(H.AccessControlAction.OrgUsersRead),u=(0,Z.iR)()&&!!$.$.featureToggles.publicDashboardsEmailSharing&&(0,U.a)("publicDashboardsEmailSharing"),[h,g]=(0,e.useState)(()=>r?"admin":l?"org":null),T=l&&r;return e.createElement(F.Y,{navId:"global-users"},T?e.createElement(z.U,{className:t.tabsMargin},e.createElement(p.o,{label:"All users",active:h==="admin",onChangeTab:()=>g("admin"),"data-testid":he.tabs.allUsers}),e.createElement(p.o,{label:"Organization users",active:h==="org",onChangeTab:()=>g("org"),"data-testid":he.tabs.orgUsers}),$.$.anonymousEnabled&&e.createElement(p.o,{label:"Anonymous devices",active:h==="anon",onChangeTab:()=>g("anon"),"data-testid":he.tabs.anonUserDevices}),u&&e.createElement(Ne,{view:h,setView:g})):u&&e.createElement(z.U,{className:t.tabsMargin},e.createElement(p.o,{label:"Users",active:h==="org",onChangeTab:()=>g("org"),"data-testid":he.tabs.users}),e.createElement(Ne,{view:h,setView:g})),h?Fe[h]:e.createElement(ee.UsersListPageContent,null))}const Ge=t=>({tabsMargin:(0,s.css)({marginBottom:t.spacing(3)})})},69546:(Ae,N,a)=>{a.d(N,{b:()=>R});var s=a(96540),e=a(13544),A=a(12942),$=a(94753),U=a(90613),p=a(56034),L=a(14578),z=a(78369),d=a(55852),Y=a(67061),Z=a(48840),F=a(19384),H=a(96374),ee=a(89062),te=a(85927),ae=a(46334),C=a(10096),x=a(31678),re=a(5133);const le=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,J=f=>{const b=f?.isExternallySynced;return!C.TP.hasPermissionInMetadata(x.AccessControlAction.OrgUsersWrite,f)||b},M=e.Tp.pages.UserListPage.UsersListPage,R=({users:f,orgId:b,onRoleChange:K,onRemoveUser:se,fetchData:W,changePage:oe,page:P,totalPages:O,rolesLoading:Q})=>{const[G,y]=(0,s.useState)(null),[V,pe]=(0,s.useState)([]);(0,s.useEffect)(()=>{async function c(){try{if(C.TP.hasPermission(x.AccessControlAction.ActionRolesList)){let v=await(0,te.RL)(b);pe(v)}}catch{console.error("Error loading options")}}C.TP.licensedAccessControlEnabled()&&c()},[b]);const ce=(0,s.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:c}})=>c&&s.createElement(A.e,{src:c,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:c}})=>s.createElement("div",null,c),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:c}})=>c,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:c}})=>c,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:c}})=>s.createElement(s.Fragment,null,c&&s.createElement(s.Fragment,null,c==="10 years"?s.createElement($.E,{color:"disabled"},"Never"):c)),sortType:(c,v)=>new Date(c.original.lastSeenAt).getTime()-new Date(v.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:c},row:{original:v}})=>{const ie=J(v);return C.TP.licensedAccessControlEnabled()?s.createElement(ee.y,{userId:v.userId,roles:v.roles||[],isLoading:Q,orgId:b,roleOptions:V,basicRole:c,onBasicRoleChange:ne=>K(ne,v),basicRoleDisabled:ie,basicRoleDisabledMessage:le,width:40}):s.createElement(re.r,{"aria-label":"Role",value:c,disabled:ie,onChange:ne=>K(ne,v)})}},{id:"info",header:"",cell:({row:{original:c}})=>J(c)&&s.createElement(U.a,{display:"flex",alignItems:"center",marginLeft:1},s.createElement(p.m,{interactive:!0,content:s.createElement("div",null,"This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",s.createElement("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank"},"Grafana authentication docs"),"\xA0for details.")},s.createElement(L.I,{name:"question-circle"})))},{id:"authLabels",header:"Origin",cell:({cell:{value:c}})=>s.createElement(s.Fragment,null,Array.isArray(c)&&c.length>0&&s.createElement(ae.E,{label:c[0],removeIcon:!1,count:0}))},{id:"isDisabled",header:"",cell:({cell:{value:c}})=>s.createElement(s.Fragment,null,c&&s.createElement(z.v,{colorIndex:9,name:"Disabled"}))},{id:"delete",header:"",cell:({row:{original:c}})=>C.TP.hasPermissionInMetadata(x.AccessControlAction.OrgUsersRemove,c)&&s.createElement(d.$n,{size:"sm",variant:"destructive",onClick:()=>{y(c)},icon:"times","aria-label":`Delete user ${c.name}`})}],[Q,b,V,K]);return s.createElement(Y.B,{direction:"column",gap:2,"data-testid":M.container},s.createElement(Z.j,{columns:ce,data:f,getRowId:c=>String(c.userId),fetchData:W}),s.createElement(Y.B,{justifyContent:"flex-end"},s.createElement(F.d,{onNavigate:oe,currentPage:P,numberOfPages:O,hideWhenSinglePage:!0})),!!G&&s.createElement(H.u,{body:`Are you sure you want to delete user ${G?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{y(null)},isOpen:!0,onConfirm:()=>{G&&(se(G),y(null))}}))}},23088:(Ae,N,a)=>{a.d(N,{Z:()=>$});var s=a(32196),e=a(96540),A=a(40845);const $=({children:p})=>{const L=(0,A.of)(U);return e.createElement("div",{className:L.container},p)},U=p=>({container:(0,s.css)`
      background-color: ${p.colors.background.secondary};
      color: ${p.colors.text.secondary};
      padding: ${p.spacing(4)};
      text-align: center;
    `})},31083:(Ae,N,a)=>{a.r(N),a.d(N,{UsersListPageContent:()=>de,UsersListPageUnconnected:()=>ye,default:()=>Ie});var s=a(96540),e=a(63329),A=a(36663),$=a(17205),U=a(10096),p=a(69546),L=a(10534),z=a(55852),d=a(47259);const Y={revokeInvite:d.eb},Z=(0,e.connect)(null,Y);class F extends s.PureComponent{render(){const{invitee:i,revokeInvite:m}=this.props;return s.createElement("tr",null,s.createElement("td",null,i.email),s.createElement("td",null,i.name),s.createElement("td",{className:"text-right"},s.createElement(L.b,{icon:"copy",variant:"secondary",size:"sm",getText:()=>i.url},"Copy Invite"),"\xA0"),s.createElement("td",null,s.createElement(z.$n,{variant:"destructive",size:"sm",icon:"times",onClick:()=>m(i.code),"aria-label":"Revoke Invite"})))}}const H=Z(F);class ee extends s.PureComponent{render(){const{invitees:i}=this.props;return s.createElement("table",{className:"filter-table form-inline"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",null,"Email"),s.createElement("th",null,"Name"),s.createElement("th",null),s.createElement("th",{style:{width:"34px"}}))),s.createElement("tbody",{"data-testid":"InviteesTable-body"},i.map((m,D)=>s.createElement(H,{key:`${m.id}-${D}`,invitee:m}))))}}var te=a(1081),ae=a(40823);const{selectAll:C,selectById:x,selectTotal:re}=ae.Tp,le=(n,i)=>i,J=(0,te.Mz)([C,le],(n,i)=>{const m=new RegExp(i,"i");return n.filter(B=>m.test(B.name)||m.test(B.email))});var M=a(14186),R=a(67647),f=a(94354),b=a(2913),K=a(31678),se=a(2543),W=a(17172),oe=a(80714),P=a(87617);function O(){return async(n,i)=>{try{n((0,P.Cj)());const{perPage:m,page:D,searchQuery:B,sort:X}=i().users,S=await(0,W.AI)().get("/api/org/users/search",(0,oe.F)({perpage:m,page:D,query:B,sort:X}));if(U.TP.licensedAccessControlEnabled()&&U.TP.hasPermission(K.AccessControlAction.ActionUserRolesList)){n((0,P.dJ)());const w=U.TP.user.orgId,k=S?.orgUsers.map(j=>j.userId),q=await(0,W.AI)().post("/api/access-control/users/roles/search",{userIds:k,orgId:w});S.orgUsers.forEach(j=>{j.roles=q?q[j.userId]||[]:[]}),n((0,P.jE)())}n((0,P.Y_)(S))}catch{(0,P.g4)()}}}const Q=(0,se.debounce)(n=>n(O()),300);function G(n){return async i=>{await(0,W.AI)().patch(`/api/org/users/${n.userId}`,{role:n.role}),i(O())}}function y(n){return async i=>{await(0,W.AI)().delete(`/api/org/users/${n}`),i(O())}}function V(n){return async i=>{i((0,P.EC)(n)),i(O())}}function pe({sortBy:n}){const i=n.length?`${n[0].id}-${n[0].desc?"desc":"asc"}`:void 0;return async m=>{m((0,P.$u)(i)),m(O())}}function ce(n){return async i=>{i((0,P.t_)(n)),Q(i)}}const c=n=>{const i=new RegExp(n.searchQuery,"i");return n.users.filter(m=>i.test(m.login)||i.test(m.email)||i.test(m.name))},v=n=>n.searchQuery;function ie(n){return{searchQuery:v(n.users),pendingInvitesCount:re(n.invites),externalUserMngLinkName:n.users.externalUserMngLinkName,externalUserMngLinkUrl:n.users.externalUserMngLinkUrl}}const ne={changeSearchQuery:ce},Le=(0,e.connect)(ie,ne)(({externalUserMngLinkName:n,externalUserMngLinkUrl:i,searchQuery:m,pendingInvitesCount:D,changeSearchQuery:B,onShowInvites:X,showInvites:S})=>{const w=[{label:"Users",value:"users"},{label:`Pending Invites (${D})`,value:"invites"}],q=U.TP.hasPermission(K.AccessControlAction.OrgUsersAdd)&&!(b.Ay.disableLoginForm&&b.Ay.externalUserMngInfo);return s.createElement("div",{className:"page-action-bar","data-testid":"users-action-bar"},s.createElement(M.I,{grow:!0},s.createElement(R.Z,{value:m,onChange:B,placeholder:"Search user by login, email or name"})),D>0&&s.createElement("div",{style:{marginLeft:"1rem"}},s.createElement(f.z,{value:S?"invites":"users",options:w,onChange:X})),q&&s.createElement(z.z9,{href:"org/users/invite"},"Invite"),i&&s.createElement(z.z9,{href:i,target:"_blank",rel:"noopener"},n))});function Se(n){const i=v(n.users);return{users:c(n.users),searchQuery:v(n.users),page:n.users.page,totalPages:n.users.totalPages,perPage:n.users.perPage,invitees:J(n.invites,i),externalUserMngInfo:n.users.externalUserMngInfo,isLoading:n.users.isLoading,rolesLoading:n.users.rolesLoading}}const De={loadUsers:O,fetchInvitees:d.G7,changePage:V,changeSort:pe,updateUser:G,removeUser:y},Te=(0,e.connect)(Se,De),ye=({users:n,page:i,totalPages:m,invitees:D,externalUserMngInfo:B,isLoading:X,rolesLoading:S,loadUsers:w,fetchInvitees:k,changePage:q,updateUser:j,removeUser:me,changeSort:ge})=>{const[ue,Pe]=(0,s.useState)(!1),fe=B?(0,A.G)(B):"";(0,s.useEffect)(()=>{w(),k()},[k,w]);const Ce=(Ee,Oe)=>{j({...Oe,role:Ee})},xe=Ee=>me(Ee.userId),Me=()=>{Pe(!ue)},Re=()=>ue?s.createElement(ee,{invitees:D}):s.createElement(p.b,{users:n,orgId:U.TP.user.orgId,rolesLoading:S,onRoleChange:Ce,onRemoveUser:xe,fetchData:ge,changePage:q,page:i,totalPages:m});return s.createElement($.Y.Contents,{isLoading:!X},s.createElement(Le,{onShowInvites:Me,showInvites:ue}),fe&&s.createElement("div",{className:"grafana-info-box",dangerouslySetInnerHTML:{__html:fe}}),X&&Re())},de=Te(ye);function Ie(){return s.createElement($.Y,{navId:"users"},s.createElement(de,null))}}}]);

//# sourceMappingURL=UserListPage.04935e07125258fa4ba8.js.map