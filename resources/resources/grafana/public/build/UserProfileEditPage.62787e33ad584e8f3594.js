"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2472],{39745:(k,D,t)=>{t.d(D,{A:()=>Z,u:()=>r});var e=t(32196),a=t(96540),I=t(97594),A=t(41987),p=t(13544),$=t(14110),H=t(32264),W=t(84167),y=t(88575),N=t(88323),g=t(60029),o=t(20333),j=t(15648),Q=t(86460),l=t(55852),L=t(3911),O=t(59429),c=t(44836),M=t(74513),V=t(65615),x=t(2769);function n(){const b=M.Yj.map(s=>({value:s.code,label:s.name})).sort((s,T)=>s.value===M.wi?1:T.value===M.wi?-1:s.label.localeCompare(T.label));return[{value:"",label:(0,c.t)("common.locale.default","Default")},...b]}class r extends a.PureComponent{constructor(h){super(h),this.onSubmitForm=async s=>{if(s.preventDefault(),this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:Y,theme:G,timezone:J,weekStart:K,language:z,queryHistory:X}=this.state;await this.service.update({homeDashboardUID:Y,theme:G,timezone:J,weekStart:K,language:z,queryHistory:X}),window.location.reload()}},this.onThemeChanged=s=>{this.setState({theme:s.value}),s.value&&(0,x.K)(s.value,!0)},this.onTimeZoneChanged=s=>{typeof s=="string"&&this.setState({timezone:s})},this.onWeekStartChanged=s=>{this.setState({weekStart:s})},this.onHomeDashboardChanged=s=>{this.setState({homeDashboardUID:s})},this.onLanguageChanged=s=>{this.setState({language:s}),(0,$.rR)("grafana_preferences_language_changed",{toLanguage:s,preferenceType:this.props.preferenceType})},this.service=new V.W(h.resourceUri),this.state={theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""}},this.themeOptions=(0,I.k)(H.$.featureToggles.extraThemes).map(s=>({value:s.id,label:q(s)})),this.themeOptions.unshift({value:"",label:(0,c.t)("shared-preferences.theme.default-label","Default")})}async componentDidMount(){const h=await this.service.load();this.setState({homeDashboardUID:h.homeDashboardUID,theme:h.theme,timezone:h.timezone,weekStart:h.weekStart,language:h.language,queryHistory:h.queryHistory})}render(){const{theme:h,timezone:s,weekStart:T,homeDashboardUID:Y,language:G}=this.state,{disabled:J}=this.props,K=_(),z=n(),X=this.themeOptions.find(S=>S.value===h)??this.themeOptions[0];return a.createElement("form",{onSubmit:this.onSubmitForm,className:K.form},a.createElement(W.n,{label:a.createElement(c.x6,{i18nKey:"shared-preferences.title"},"Preferences"),disabled:J},a.createElement(y.D,{label:(0,c.t)("shared-preferences.fields.theme-label","Interface theme")},a.createElement(N.l6,{options:this.themeOptions,value:X,onChange:this.onThemeChanged,inputId:"shared-preferences-theme-select"})),a.createElement(y.D,{label:a.createElement(g.J,{htmlFor:"home-dashboard-select"},a.createElement("span",{className:K.labelText},a.createElement(c.x6,{i18nKey:"shared-preferences.fields.home-dashboard-label"},"Home Dashboard"))),"data-testid":"User preferences home dashboard drop down"},a.createElement(O.b,{value:Y,onChange:S=>this.onHomeDashboardChanged(S?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,c.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})),a.createElement(y.D,{label:(0,c.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":p.Tp.components.TimeZonePicker.containerV2},a.createElement(o.U,{includeInternal:!0,value:s,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})),a.createElement(y.D,{label:(0,c.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":p.Tp.components.WeekStartPicker.containerV2},a.createElement(j.l,{value:T||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})),a.createElement(y.D,{label:a.createElement(g.J,{htmlFor:"locale-select"},a.createElement("span",{className:K.labelText},a.createElement(c.x6,{i18nKey:"shared-preferences.fields.locale-label"},"Language")),a.createElement(Q.y,{featureState:A.Ay.beta})),"data-testid":"User preferences language drop down"},a.createElement(N.l6,{value:z.find(S=>S.value===G),onChange:S=>this.onLanguageChanged(S.value??""),options:z,placeholder:(0,c.t)("shared-preferences.fields.locale-placeholder","Choose language"),inputId:"locale-select"}))),a.createElement(l.$n,{type:"submit",variant:"primary","data-testid":p.Tp.components.UserProfile.preferencesSaveButton},a.createElement(c.x6,{i18nKey:"common.save"},"Save")))}}const Z=r,_=(0,L.N)(()=>({labelText:(0,e.css)({marginRight:"6px"}),form:(0,e.css)({width:"100%",maxWidth:"600px"})}));function q(b){switch(b.id){case"dark":return(0,c.t)("shared.preferences.theme.dark-label","Dark");case"light":return(0,c.t)("shared.preferences.theme.light-label","Light");case"system":return(0,c.t)("shared.preferences.theme.system-label","System preference");default:return b.name}}},48357:(k,D,t)=>{t.r(D),t.d(D,{UserProfileEditPage:()=>ae,default:()=>de});var e=t(96540),a=t(63329),I=t(4392),A=t(74135),p=t(13544),$=t(4402),H=t(66864),W=t(67061),y=t(63021),N=t(40675),g=t(40980),o=t(17205),j=t(39745),Q=t(83277),l=t(44836),L=t(39558),O=t(55852);class c extends e.PureComponent{render(){const{isLoading:v,orgs:E,user:f}=this.props;return v?e.createElement(L._,{text:"Loading organizations..."}):E.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},e.createElement(l.x6,{i18nKey:"user-orgs.title"},"Organizations")),e.createElement("table",{className:"filter-table form-inline","data-testid":p.Tp.components.UserProfile.orgsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(l.x6,{i18nKey:"user-orgs.name-column"},"Name")),e.createElement("th",null,e.createElement(l.x6,{i18nKey:"user-orgs.role-column"},"Role")),e.createElement("th",null))),e.createElement("tbody",null,E.map((d,m)=>e.createElement("tr",{key:m},e.createElement("td",null,d.name),e.createElement("td",null,d.role),e.createElement("td",{className:"text-right"},d.orgId===f?.orgId?e.createElement(O.$n,{variant:"secondary",size:"sm",disabled:!0},e.createElement(l.x6,{i18nKey:"user-orgs.current-org-button"},"Current")):e.createElement(O.$n,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(d)}},e.createElement(l.x6,{i18nKey:"user-orgs.select-org-button"},"Select organisation"))))))))}}const M=c;var V=t(84167),x=t(88575),n=t(10354),r=t(56034),Z=t(14578),_=t(72235),q=t(2913);const{disableLoginForm:b}=q.Ay,s=({user:u,isSavingUser:v,updateProfile:E})=>{const f=P=>{E(P)},d=(u&&u.isExternal)??!1,m=d&&u&&u.authLabels?u.authLabels[0]:"",U=m?` (Synced via ${m})`:"",C=b||d;return e.createElement(_.l,{onSubmit:f,validateOn:"onBlur"},({register:P,errors:F})=>e.createElement(e.Fragment,null,e.createElement(V.n,null,e.createElement(x.D,{label:(0,l.t)("user-profile.fields.name-label","Name")+U,invalid:!!F.name,error:e.createElement(l.x6,{i18nKey:"user-profile.fields.name-error"},"Name is required"),disabled:C},e.createElement(n.p,{...P("name",{required:!0}),id:"edit-user-profile-name",placeholder:(0,l.t)("user-profile.fields.name-label","Name"),defaultValue:u?.name??"",suffix:e.createElement(T,null)})),e.createElement(x.D,{label:(0,l.t)("user-profile.fields.email-label","Email")+U,invalid:!!F.email,error:e.createElement(l.x6,{i18nKey:"user-profile.fields.email-error"},"Email is required"),disabled:C},e.createElement(n.p,{...P("email",{required:!0}),id:"edit-user-profile-email",placeholder:(0,l.t)("user-profile.fields.email-label","Email"),defaultValue:u?.email??"",suffix:e.createElement(T,null)})),e.createElement(x.D,{label:(0,l.t)("user-profile.fields.username-label","Username")+U,disabled:C},e.createElement(n.p,{...P("login"),id:"edit-user-profile-username",defaultValue:u?.login??"",placeholder:(0,l.t)("user-profile.fields.username-label","Username")+U,suffix:e.createElement(T,null)}))),e.createElement(O.$n,{variant:"primary",disabled:v||C,"data-testid":p.Tp.components.UserProfile.profileSaveButton,type:"submit"},e.createElement(l.x6,{i18nKey:"common.save"},"Save"))))},T=()=>b?e.createElement(r.m,{content:"Login details locked because they are managed in another system."},e.createElement(Z.I,{name:"lock"})):null;var Y=t(32196),G=t(72635);class J extends e.PureComponent{render(){const{isLoading:v,sessions:E,revokeUserSession:f}=this.props,d=K();return v?e.createElement(L._,{text:e.createElement(l.x6,{i18nKey:"user-sessions.loading"},"Loading sessions...")}):e.createElement("div",{className:d.wrapper},E.length>0&&e.createElement(e.Fragment,null,e.createElement("h3",{className:"page-sub-heading"},"Sessions"),e.createElement("table",{className:"filter-table form-inline","data-testid":p.Tp.components.UserProfile.sessionsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(l.x6,{i18nKey:"user-session.seen-at-column"},"Last seen")),e.createElement("th",null,e.createElement(l.x6,{i18nKey:"user-session.created-at-column"},"Logged on")),e.createElement("th",null,e.createElement(l.x6,{i18nKey:"user-session.ip-column"},"IP address")),e.createElement("th",null,e.createElement(l.x6,{i18nKey:"user-session.browser-column"},"Browser & OS")),e.createElement("th",null))),e.createElement("tbody",null,E.map((m,U)=>e.createElement("tr",{key:U},m.isActive?e.createElement("td",null,"Now"):e.createElement("td",null,m.seenAt),e.createElement("td",null,(0,l.Xj)(m.createdAt,{dateStyle:"long"})),e.createElement("td",null,m.clientIp),e.createElement("td",null,m.browser," on ",m.os," ",m.osVersion),e.createElement("td",null,e.createElement(O.$n,{size:"sm",variant:"destructive",onClick:()=>f(m.id),"aria-label":(0,G.t)("user-session.revoke","Revoke user session")},e.createElement(Z.I,{name:"power"})))))))))}}const K=()=>({wrapper:(0,Y.css)({maxWidth:"100%"})}),z=J;class X extends e.PureComponent{render(){const{isLoading:v,teams:E}=this.props;return v?e.createElement(L._,{text:"Loading teams..."}):E.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},"Teams"),e.createElement("table",{className:"filter-table form-inline","aria-label":"User teams table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Name"),e.createElement("th",null,"Email"),e.createElement("th",null,"Members"))),e.createElement("tbody",null,E.map((f,d)=>e.createElement("tr",{key:d},e.createElement("td",{className:"width-4 text-center"},e.createElement("img",{className:"filter-table__avatar",src:f.avatarUrl,alt:""})),e.createElement("td",null,f.name),e.createElement("td",null,f.email),e.createElement("td",null,f.memberCount))))))}}const S=null;var w=t(84969);const ne="tab",ee="general";function ce(u){const v=u.user,{user:E,teams:f,orgs:d,sessions:m,teamsAreLoading:U,orgsAreLoading:C,sessionsAreLoading:P,isUpdating:F}=v;return{orgsAreLoading:C,sessionsAreLoading:P,teamsAreLoading:U,orgs:d,sessions:m,teams:f,isUpdating:F,user:E}}const me={initUserProfilePage:w.Qe,revokeUserSession:w._O,changeUserOrg:w.Aj,updateUserProfile:w.eg},ue=(0,a.connect)(ce,me);function ae({orgsAreLoading:u,sessionsAreLoading:v,teamsAreLoading:E,initUserProfilePage:f,orgs:d,sessions:m,teams:U,isUpdating:C,user:P,revokeUserSession:F,changeUserOrg:Ee,updateUserProfile:fe}){const[ge,he]=(0,Q.s)(),re=ge[ne],[te,pe]=(0,e.useState)(typeof re=="string"?re:ee);(0,I.A)(()=>f());const se=(0,e.useMemo)(()=>{const{extensions:i}=(0,$.Dp)({extensionPointId:A.S.UserProfileTab});return i},[]),le=se.reduce((i,B)=>{const{title:R}=B;return i[R]?i[R].push(B):i[R]=[B],i},{}),oe=i=>i.toLowerCase(),ve=se.length>0,Pe=[{id:ee,title:(0,l.t)("user-profile.tabs.general","General")},...Object.keys(le).map(i=>({id:oe(i),title:i}))],ie=()=>e.createElement(H.gW,{spacing:"md"},e.createElement(s,{updateProfile:fe,isSavingUser:C,user:P}),e.createElement(j.A,{resourceUri:"user",preferenceType:"user"}),e.createElement(W.B,{direction:"column",gap:6},e.createElement(X,{isLoading:E,teams:U}),e.createElement(M,{isLoading:u,setUserOrg:Ee,orgs:d,user:P}),e.createElement(z,{isLoading:v,revokeUserSession:F,sessions:m}))),Ue=()=>e.createElement("div",{"data-testid":p.Tp.components.UserProfile.extensionPointTabs},e.createElement(W.B,{direction:"column",gap:2},e.createElement(y.U,null,Pe.map(({id:i,title:B})=>e.createElement(N.o,{key:i,label:B,active:te===i,onChangeTab:()=>{pe(i),he({[ne]:i})},"data-testid":p.Tp.components.UserProfile.extensionPointTab(i)}))),e.createElement(g.J,null,te===ee&&e.createElement(ie,null),Object.entries(le).map(([i,B])=>{const R=oe(i);return te===R?e.createElement(e.Fragment,{key:R},B.map(({component:ye},Te)=>e.createElement(ye,{key:`${R}-${Te}`}))):null}))));return e.createElement(o.Y,{navId:"profile/settings"},e.createElement(o.Y.Contents,{isLoading:!P},ve?e.createElement(Ue,null):e.createElement(ie,null)))}const de=ue(ae)},84969:(k,D,t)=>{t.d(D,{ec:()=>j,Aj:()=>V,Qe:()=>Q,YW:()=>l,_O:()=>M,eg:()=>x});var e=t(32264),a=t(17172);async function I(n){try{await(0,a.AI)().put("/api/user/password",n)}catch(r){console.error(r)}}function A(){return(0,a.AI)().get("/api/user")}function p(){return(0,a.AI)().get("/api/user/teams")}function $(){return(0,a.AI)().get("/api/user/orgs")}function H(){return(0,a.AI)().get("/api/user/auth-tokens")}async function W(n){await(0,a.AI)().post("/api/user/revoke-auth-token",{authTokenId:n})}async function y(n){await(0,a.AI)().post("/api/user/using/"+n.orgId,{})}async function N(n){try{await(0,a.AI)().put("/api/user",n)}catch(r){console.error(r)}}const g={changePassword:I,revokeUserSession:W,loadUser:A,loadSessions:H,loadOrgs:$,loadTeams:p,setUserOrg:y,updateUserProfile:N};var o=t(81862);function j(n){return async function(r){r((0,o.Nm)({updating:!0})),await g.changePassword(n),r((0,o.Nm)({updating:!1}))}}function Q(){return async function(n){await n(l()),n(L()),n(O()),n(c())}}function l(){return async function(n){const r=await g.loadUser();n((0,o.HO)({user:r}))}}function L(){return async function(n){n((0,o.ri)());const r=await g.loadTeams();n((0,o.Q9)({teams:r}))}}function O(){return async function(n){n((0,o.Mj)());const r=await g.loadOrgs();n((0,o.ny)({orgs:r}))}}function c(){return async function(n){n((0,o.uh)());const r=await g.loadSessions();n((0,o.RS)({sessions:r}))}}function M(n){return async function(r){r((0,o.Nm)({updating:!0})),await g.revokeUserSession(n),r((0,o.g$)({tokenId:n}))}}function V(n){return async function(r){r((0,o.Nm)({updating:!0})),await g.setUserOrg(n),window.location.href=e.$.appSubUrl+"/profile"}}function x(n){return async function(r){r((0,o.Nm)({updating:!0})),await g.updateUserProfile(n),await r(l()),r((0,o.Nm)({updating:!1}))}}},4392:(k,D,t)=>{t.d(D,{A:()=>I});var e=t(94701),a=function(A){(0,e.A)(function(){A()})};const I=a}}]);

//# sourceMappingURL=UserProfileEditPage.62787e33ad584e8f3594.js.map