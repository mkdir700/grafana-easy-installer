"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1036],{31084:(b,C,e)=>{e.d(C,{Y:()=>D});var O=e(96540),t=e(41053),r=e(10096),M=e(31678),f=e(37425),g=e(85927);const D=({teamId:P,roleOptions:d,disabled:s,roles:l,onApplyRoles:u,pendingRoles:E,apply:v=!1,maxWidth:y,width:W,isLoading:h})=>{const[{loading:K,value:x=l||[]},I]=(0,t.A)(async()=>{try{if(l)return l;if(v&&E?.length)return E;if(r.TP.hasPermission(M.AccessControlAction.ActionTeamsRolesList)&&P>0)return await(0,g.xN)(P)}catch(p){console.error("Error loading options",p)}return[]},[P,E,l]);(0,O.useEffect)(()=>{I()},[I]);const c=async p=>{v?u&&u(p):(await(0,g.G3)(p,P),await I())},A=r.TP.hasPermission(M.AccessControlAction.ActionTeamsRolesAdd)&&r.TP.hasPermission(M.AccessControlAction.ActionTeamsRolesRemove);return O.createElement(f.n,{apply:v,onRolesChange:c,roleOptions:d,appliedRoles:x,isLoading:K||h,disabled:s,basicRoleDisabled:!0,canUpdateRoles:A,maxWidth:y,width:W})}},52576:(b,C,e)=>{e.r(C),e.d(C,{TeamList:()=>a,default:()=>z});var O=e(32196),t=e(96540),r=e(70255),M=e(63329),f=e(40845),g=e(12942),D=e(72109),P=e(67061),d=e(56034),s=e(55852),l=e(91605),u=e(14186),E=e(67647),v=e(69529),y=e(48840),W=e(19384),h=e(7521),K=e(17205),x=e(85927),I=e(44836),c=e(16233),A=e(31678),p=e(31084),L=e(33667);const n=new Array(3).fill(null).map((_,$)=>({id:$,memberCount:0,name:"",orgId:0,permission:0})),a=({teams:_,query:$,noTeams:N,hasFetched:T,loadTeams:j,deleteTeam:Q,changeQuery:Z,totalPages:w,page:F,rolesLoading:V,changePage:k,changeSort:q})=>{const[J,ee]=(0,t.useState)([]),S=(0,f.of)(U);(0,t.useEffect)(()=>{j(!0)},[j]),(0,t.useEffect)(()=>{c.TP.licensedAccessControlEnabled()&&c.TP.hasPermission(A.AccessControlAction.ActionRolesList)&&(0,x.RL)().then(i=>ee(i))},[]);const H=c.TP.hasPermission(A.AccessControlAction.ActionTeamsCreate),X=o(),te=(0,t.useMemo)(()=>[{id:"avatarUrl",header:"",disableGrow:!0,cell:({cell:{value:i}})=>T?i&&t.createElement(g.e,{src:i,alt:"User avatar"}):t.createElement(r.A,{containerClassName:S.blockSkeleton,width:24,height:24,circle:!0})},{id:"name",header:"Name",cell:({cell:{value:i},row:{original:R}})=>T?c.TP.hasPermissionInMetadata(A.AccessControlAction.ActionTeamsRead,R)?t.createElement(D.Y,{color:"primary",inline:!1,href:`/org/teams/edit/${R.id}`,title:"Edit team"},i):i:t.createElement(r.A,{width:100}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:i}})=>T?i:t.createElement(r.A,{width:60}),sortType:"string"},{id:"memberCount",header:"Members",disableGrow:!0,cell:({cell:{value:i}})=>T?i:t.createElement(r.A,{width:40}),sortType:"number"},...X?[{id:"role",header:"Role",cell:({cell:{value:i},row:{original:R}})=>T?c.TP.hasPermissionInMetadata(A.AccessControlAction.ActionTeamsRolesList,R)&&t.createElement(p.Y,{teamId:R.id,roles:R.roles||[],isLoading:V,roleOptions:J,width:40}):t.createElement(r.A,{width:320,height:32,containerClassName:S.blockSkeleton})}]:[],{id:"actions",header:"",disableGrow:!0,cell:({row:{original:i}})=>{if(!T)return t.createElement(P.B,{direction:"row",justifyContent:"flex-end",alignItems:"center"},t.createElement(r.A,{containerClassName:S.blockSkeleton,width:16,height:16}),t.createElement(r.A,{containerClassName:S.blockSkeleton,width:22,height:24}));const R=c.TP.hasPermissionInMetadata(A.AccessControlAction.ActionTeamsRead,i),Y=c.TP.hasPermissionInMetadata(A.AccessControlAction.ActionTeamsDelete,i);return t.createElement(P.B,{direction:"row",justifyContent:"flex-end",gap:2},R&&t.createElement(d.m,{content:"Edit team"},t.createElement(s.z9,{href:`org/teams/edit/${i.id}`,"aria-label":`Edit team ${i.name}`,icon:"pen",size:"sm",variant:"secondary"})),t.createElement(l.e,{"aria-label":`Delete team ${i.name}`,size:"sm",disabled:!Y,onConfirm:()=>Q(i.id)}))}}],[X,T,V,J,Q,S]);return t.createElement(K.Y,{navId:"teams",actions:t.createElement(s.z9,{href:H?"org/teams/new":"#",disabled:!H},"New Team")},t.createElement(K.Y.Contents,null,N?t.createElement(h.A,{title:"You haven't created any teams yet.",buttonIcon:"users-alt",buttonLink:"org/teams/new",buttonTitle:" New team",buttonDisabled:!c.TP.hasPermission(A.AccessControlAction.ActionTeamsCreate),proTip:"Assign folder and dashboard permissions to teams instead of users to ease administration.",proTipLink:"",proTipLinkTitle:"",proTipTarget:"_blank"}):t.createElement(t.Fragment,null,t.createElement("div",{className:"page-action-bar"},t.createElement(u.I,{grow:!0},t.createElement(E.Z,{placeholder:"Search teams",value:$,onChange:Z}))),T&&_.length===0?t.createElement(v.p,{variant:"not-found",message:(0,I.t)("teams.empty-state.message","No teams found")}):t.createElement(P.B,{direction:"column",gap:2},t.createElement(y.j,{columns:te,data:T?_:n,getRowId:i=>String(i.id),fetchData:q}),t.createElement(P.B,{justifyContent:"flex-end"},t.createElement(W.d,{hideWhenSinglePage:!0,currentPage:F,numberOfPages:w,onNavigate:k}))))))};function o(){return c.TP.licensedAccessControlEnabled()&&c.TP.hasPermission(A.AccessControlAction.ActionTeamsRolesList)&&c.TP.hasPermission(A.AccessControlAction.ActionRolesList)}function m(_){return{teams:_.teams.teams,query:_.teams.query,perPage:_.teams.perPage,page:_.teams.page,noTeams:_.teams.noTeams,totalPages:_.teams.totalPages,hasFetched:_.teams.hasFetched,rolesLoading:_.teams.rolesLoading}}const B={loadTeams:L.Bu,deleteTeam:L.To,changePage:L.yd,changeQuery:L.nM,changeSort:L.Vk},z=(0,M.connect)(m,B)(a),U=_=>({blockSkeleton:(0,O.css)({lineHeight:1,display:"flex"})})},33667:(b,C,e)=>{e.d(C,{Bu:()=>s,It:()=>A,To:()=>E,Vk:()=>W,aK:()=>c,eo:()=>u,n7:()=>I,nC:()=>p,nM:()=>v,yd:()=>y});var O=e(2543),t=e.n(O),r=e(17172),M=e(82467),f=e(10096),g=e(80714),D=e(31678),P=e(78319),d=e(34655);function s(n=!1){return async(a,o)=>{const{query:m,page:B,perPage:G,sort:z}=o().teams;if(!f.TP.hasPermission(D.AccessControlAction.ActionTeamsRead)){a((0,d.Q9)({teams:[],totalCount:0,page:1,perPage:G,noTeams:!0}));return}const U=await(0,r.AI)().get("/api/teams/search",(0,g.F)({query:m,page:B,perpage:G,sort:z}));let _=!1;if(n&&(_=U.teams.length===0),f.TP.licensedAccessControlEnabled()&&f.TP.hasPermission(D.AccessControlAction.ActionTeamsRolesList)){a((0,d.dJ)());const $=U?.teams.map(T=>T.id),N=await(0,r.AI)().post("/api/access-control/teams/roles/search",{teamIds:$});U.teams.forEach(T=>{T.roles=N?N[T.id]||[]:[]}),a((0,d.jE)())}a((0,d.Q9)({noTeams:_,...U}))}}const l=(0,O.debounce)(n=>n(s()),500);function u(n){return async a=>{const o=await(0,r.AI)().get(`/api/teams/${n}`,(0,g.F)());a((0,d.$T)(o)),a((0,M.Vz)((0,P.R)(o)))}}function E(n){return async a=>{await(0,r.AI)().delete(`/api/teams/${n}`),await f.TP.fetchUserPermissions(),a(s())}}function v(n){return async a=>{a((0,d.L5)(n)),l(a)}}function y(n){return async a=>{a((0,d.EC)(n)),a(s())}}function W({sortBy:n}){const a=n.length?`${n[0].id}-${n[0].desc?"desc":"asc"}`:void 0;return async o=>{o((0,d.$u)(a)),o(s())}}function h(){return async(n,a)=>{const o=a().team.team,m=await getBackendSrv().get(`/api/teams/${o.id}/members`);n(teamMembersLoaded(m))}}function K(n){return async(a,o)=>{const m=o().team.team;await getBackendSrv().post(`/api/teams/${m.id}/members`,{userId:n}),a(h())}}function x(n){return async(a,o)=>{const m=o().team.team;await getBackendSrv().delete(`/api/teams/${m.id}/members/${n}`),a(h())}}function I(n,a){return async(o,m)=>{const B=m().team.team;await(0,r.AI)().put(`/api/teams/${B.id}`,{name:n,email:a}),o(u(B.id))}}function c(){return async(n,a)=>{const o=a().team.team,m=await(0,r.AI)().get(`/api/teams/${o.id}/groups`);n((0,d.tC)(m))}}function A(n){return async(a,o)=>{const m=o().team.team;await(0,r.AI)().post(`/api/teams/${m.id}/groups`,{groupId:n}),a(c())}}function p(n){return async(a,o)=>{const m=o().team.team;await(0,r.AI)().delete(`/api/teams/${m.id}/groups?groupId=${encodeURIComponent(n)}`),a(c())}}function L(n){return async a=>{await getBackendSrv().put(`/api/teams/${n.teamId}/members/${n.userId}`,{permission:n.permission}),a(h())}}},78319:(b,C,e)=>{e.d(C,{R:()=>P,X:()=>d});var O=e(33378),t=e(76323),r=e(2913),M=e(16233),f=e(35538),g=e(31678);const D={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:g.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function P(s){const l={img:s.avatarUrl,id:"team-"+s.id,subTitle:"Manage members and settings",url:"",text:s.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${s.id}`,text:"Settings",url:`org/teams/edit/${s.id}/settings`}]};(s===D||M.TP.hasPermissionInMetadata(g.AccessControlAction.ActionTeamsPermissionsRead,s))&&l.children.unshift({active:!1,icon:"users-alt",id:`team-members-${s.id}`,text:"Members",url:`org/teams/edit/${s.id}/members`});const u={active:!1,icon:"sync",id:`team-groupsync-${s.id}`,text:"External group sync",url:`org/teams/edit/${s.id}/groupsync`},E=s===D;return(0,f.z5)()&&(u.tabSuffix=()=>(0,t.J)({experimentId:E?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,O.a)("teamsync")?(E||M.TP.hasPermissionInMetadata(g.AccessControlAction.ActionTeamsPermissionsRead,s))&&l.children.push(u):r.Ay.featureToggles.featureHighlights&&l.children.push({...u,tabSuffix:()=>(0,t.J)({experimentId:E?"":"feature-highlights-team-sync-badge"})}),l}function d(s){const l=P(D);let u;for(const E of l.children)if(E.id.indexOf(s)>0){E.active=!0,u=E;break}return{main:l,node:u}}}}]);

//# sourceMappingURL=TeamList.229b807b48b7d53be430.js.map