{"version":3,"file":"1121.b57702d5751a9d38a15d.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/api/stateHistoryApi.ts","webpack://grafana/./public/app/features/alerting/unified/components/rules/state-history/LogRecordViewer.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/state-history/LogTimelineViewer.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/state-history/useRuleHistoryRecords.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/state-history/LokiStateHistory.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/state-history/common.ts"],"sourcesContent":["import { DataFrameJSON } from '@grafana/data';\n\nimport { alertingApi } from './alertingApi';\n\nexport const stateHistoryApi = alertingApi.injectEndpoints({\n  endpoints: (build) => ({\n    getRuleHistory: build.query<DataFrameJSON, { ruleUid: string; from?: number; to?: number; limit?: number }>({\n      query: ({ ruleUid, from, to, limit = 100 }) => ({\n        url: '/api/v1/rules/history',\n        params: { ruleUID: ruleUid, from, to, limit },\n      }),\n    }),\n  }),\n});\n","import { css } from '@emotion/css';\nimport { formatDistanceToNowStrict } from 'date-fns';\nimport { groupBy, uniqueId } from 'lodash';\nimport React, { useEffect } from 'react';\n\nimport { dateTimeFormat, GrafanaTheme2 } from '@grafana/data';\nimport { Icon, TagList, useStyles2, Stack } from '@grafana/ui';\n\nimport { Label } from '../../Label';\nimport { AlertStateTag } from '../AlertStateTag';\n\nimport { LogRecord, omitLabels } from './common';\n\ninterface LogRecordViewerProps {\n  records: LogRecord[];\n  commonLabels: Array<[string, string]>;\n  onRecordsRendered?: (timestampRefs: Map<number, HTMLElement>) => void;\n  onLabelClick?: (label: string) => void;\n}\n\nfunction groupRecordsByTimestamp(records: LogRecord[]) {\n  // groupBy has been replaced by the reduce to avoid back and forth conversion of timestamp from number to string\n  const groupedLines = records.reduce((acc, current) => {\n    const tsGroup = acc.get(current.timestamp);\n    if (tsGroup) {\n      tsGroup.push(current);\n    } else {\n      acc.set(current.timestamp, [current]);\n    }\n\n    return acc;\n  }, new Map<number, LogRecord[]>());\n\n  return new Map([...groupedLines].sort((a, b) => b[0] - a[0]));\n}\n\nexport const LogRecordViewerByTimestamp = React.memo(\n  ({ records, commonLabels, onLabelClick, onRecordsRendered }: LogRecordViewerProps) => {\n    const styles = useStyles2(getStyles);\n\n    const groupedLines = groupRecordsByTimestamp(records);\n\n    const timestampRefs = new Map<number, HTMLElement>();\n    useEffect(() => {\n      onRecordsRendered && onRecordsRendered(timestampRefs);\n    });\n\n    return (\n      <ul className={styles.logsScrollable} aria-label=\"State history by timestamp\">\n        {Array.from(groupedLines.entries()).map(([key, records]) => {\n          return (\n            <li\n              id={key.toString(10)}\n              key={key}\n              data-testid={key}\n              ref={(element) => element && timestampRefs.set(key, element)}\n              className={styles.listItemWrapper}\n            >\n              <Timestamp time={key} />\n              <div className={styles.logsContainer}>\n                {records.map(({ line }) => (\n                  <React.Fragment key={uniqueId()}>\n                    <AlertStateTag state={line.previous} size=\"sm\" muted />\n                    <Icon name=\"arrow-right\" size=\"sm\" />\n                    <AlertStateTag state={line.current} />\n                    <Stack>{line.values && <AlertInstanceValues record={line.values} />}</Stack>\n                    <div>\n                      {line.labels && (\n                        <TagList\n                          tags={omitLabels(Object.entries(line.labels), commonLabels).map(\n                            ([key, value]) => `${key}=${value}`\n                          )}\n                          onClick={onLabelClick}\n                        />\n                      )}\n                    </div>\n                  </React.Fragment>\n                ))}\n              </div>\n            </li>\n          );\n        })}\n      </ul>\n    );\n  }\n);\nLogRecordViewerByTimestamp.displayName = 'LogRecordViewerByTimestamp';\n\nexport function LogRecordViewerByInstance({ records, commonLabels }: LogRecordViewerProps) {\n  const styles = useStyles2(getStyles);\n\n  const groupedLines = groupBy(records, (record: LogRecord) => {\n    return JSON.stringify(record.line.labels);\n  });\n\n  return (\n    <>\n      {Object.entries(groupedLines).map(([key, records]) => {\n        return (\n          <Stack direction=\"column\" key={key}>\n            <h4>\n              <TagList\n                tags={omitLabels(Object.entries(records[0].line.labels ?? {}), commonLabels).map(\n                  ([key, value]) => `${key}=${value}`\n                )}\n              />\n            </h4>\n            <div className={styles.logsContainer}>\n              {records.map(({ line, timestamp }) => (\n                <div key={uniqueId()}>\n                  <AlertStateTag state={line.previous} size=\"sm\" muted />\n                  <Icon name=\"arrow-right\" size=\"sm\" />\n                  <AlertStateTag state={line.current} />\n                  <Stack>{line.values && <AlertInstanceValues record={line.values} />}</Stack>\n                  <div>{dateTimeFormat(timestamp)}</div>\n                </div>\n              ))}\n            </div>\n          </Stack>\n        );\n      })}\n    </>\n  );\n}\n\ninterface TimestampProps {\n  time: number; // epoch timestamp\n}\n\nconst Timestamp = ({ time }: TimestampProps) => {\n  const dateTime = new Date(time);\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.timestampWrapper}>\n      <Stack alignItems=\"center\" gap={1}>\n        <Icon name=\"clock-nine\" size=\"sm\" />\n        <span className={styles.timestampText}>{dateTimeFormat(dateTime)}</span>\n        <small>({formatDistanceToNowStrict(dateTime)} ago)</small>\n      </Stack>\n    </div>\n  );\n};\n\nconst AlertInstanceValues = React.memo(({ record }: { record: Record<string, number> }) => {\n  const values = Object.entries(record);\n\n  return (\n    <>\n      {values.map(([key, value]) => (\n        <Label key={key} label={key} value={value} />\n      ))}\n    </>\n  );\n});\nAlertInstanceValues.displayName = 'AlertInstanceValues';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  logsContainer: css`\n    display: grid;\n    grid-template-columns: max-content max-content max-content auto max-content;\n    gap: ${theme.spacing(2, 1)};\n    align-items: center;\n  `,\n  logsScrollable: css`\n    height: 500px;\n    overflow: scroll;\n\n    flex: 1;\n  `,\n  timestampWrapper: css`\n    color: ${theme.colors.text.secondary};\n  `,\n  timestampText: css`\n    color: ${theme.colors.text.primary};\n    font-size: ${theme.typography.bodySmall.fontSize};\n    font-weight: ${theme.typography.fontWeightBold};\n  `,\n  listItemWrapper: css`\n    background: transparent;\n    outline: 1px solid transparent;\n\n    transition:\n      background 150ms,\n      outline 150ms;\n    padding: ${theme.spacing(1)} ${theme.spacing(1.5)};\n  `,\n});\n","import { noop } from 'lodash';\nimport React, { useEffect, useRef } from 'react';\nimport AutoSizer from 'react-virtualized-auto-sizer';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { DataFrame, InterpolateFunction, TimeRange } from '@grafana/data';\nimport { VisibilityMode } from '@grafana/schema';\nimport { LegendDisplayMode, UPlotConfigBuilder, useTheme2 } from '@grafana/ui';\nimport { TimelineChart } from 'app/core/components/TimelineChart/TimelineChart';\nimport { TimelineMode } from 'app/core/components/TimelineChart/utils';\n\ninterface LogTimelineViewerProps {\n  frames: DataFrame[];\n  timeRange: TimeRange;\n  onPointerMove?: (seriesIdx: number, pointerIdx: number) => void;\n}\n\n// noop\nconst replaceVariables: InterpolateFunction = (v) => v;\n\nexport const LogTimelineViewer = React.memo(({ frames, timeRange, onPointerMove = noop }: LogTimelineViewerProps) => {\n  const theme = useTheme2();\n  const { setupCursorTracking } = useCursorTimelinePosition(onPointerMove);\n\n  return (\n    <AutoSizer disableHeight>\n      {({ width }) => (\n        <TimelineChart\n          frames={frames}\n          timeRange={timeRange}\n          timeZone={'browser'}\n          mode={TimelineMode.Changes}\n          height={18 * frames.length + 50}\n          width={width}\n          showValue={VisibilityMode.Never}\n          theme={theme}\n          rowHeight={0.8}\n          legend={{\n            calcs: [],\n            displayMode: LegendDisplayMode.List,\n            placement: 'bottom',\n            showLegend: true,\n          }}\n          legendItems={[\n            { label: 'Normal', color: theme.colors.success.main, yAxis: 1 },\n            { label: 'Pending', color: theme.colors.warning.main, yAxis: 1 },\n            { label: 'Alerting', color: theme.colors.error.main, yAxis: 1 },\n            { label: 'NoData', color: theme.colors.info.main, yAxis: 1 },\n            { label: 'Mixed', color: theme.colors.text.secondary, yAxis: 1 },\n          ]}\n          replaceVariables={replaceVariables}\n        >\n          {(builder) => {\n            setupCursorTracking(builder);\n            return null;\n          }}\n        </TimelineChart>\n      )}\n    </AutoSizer>\n  );\n});\n\nfunction useCursorTimelinePosition(onPointerMove: (seriesIdx: number, pointIdx: number) => void) {\n  const pointerSubject = useRef(\n    new BehaviorSubject<{ seriesIdx: number; pointIdx: number }>({ seriesIdx: 0, pointIdx: 0 })\n  );\n\n  useEffect(() => {\n    const subscription = pointerSubject.current.subscribe(({ seriesIdx, pointIdx }) => {\n      onPointerMove && onPointerMove(seriesIdx, pointIdx);\n    });\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [onPointerMove]);\n\n  // Applies cursor tracking to the UPlot chart\n  const setupCursorTracking = (builder: UPlotConfigBuilder) => {\n    builder.setSync();\n    const interpolator = builder.getTooltipInterpolator();\n\n    // I found this in TooltipPlugin.tsx\n    if (interpolator) {\n      builder.addHook('setCursor', (u) => {\n        interpolator(\n          (seriesIdx) => {\n            if (seriesIdx) {\n              const currentPointer = pointerSubject.current.getValue();\n              pointerSubject.current.next({ ...currentPointer, seriesIdx });\n            }\n          },\n          (pointIdx) => {\n            if (pointIdx) {\n              const currentPointer = pointerSubject.current.getValue();\n              pointerSubject.current.next({ ...currentPointer, pointIdx });\n            }\n          },\n          () => {},\n          u\n        );\n      });\n    }\n  };\n\n  return { setupCursorTracking };\n}\n\nLogTimelineViewer.displayName = 'LogTimelineViewer';\n","import { groupBy } from 'lodash';\nimport { useMemo } from 'react';\n\nimport {\n  DataFrame,\n  DataFrameJSON,\n  Field as DataFrameField,\n  FieldType,\n  getDisplayProcessor,\n  GrafanaTheme2,\n} from '@grafana/data';\nimport { fieldIndexComparer } from '@grafana/data/src/field/fieldComparers';\nimport { MappingType, ThresholdsMode } from '@grafana/schema';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { labelsMatchMatchers, parseMatchers } from '../../../utils/alertmanager';\n\nimport { extractCommonLabels, Line, LogRecord, omitLabels } from './common';\n\nexport function useRuleHistoryRecords(stateHistory?: DataFrameJSON, filter?: string) {\n  const theme = useTheme2();\n\n  return useMemo(() => {\n    // merge timestamp with \"line\"\n    const tsValues = stateHistory?.data?.values[0] ?? [];\n    const timestamps: number[] = isNumbers(tsValues) ? tsValues : [];\n    const lines = stateHistory?.data?.values[1] ?? [];\n\n    const logRecords = timestamps.reduce((acc: LogRecord[], timestamp: number, index: number) => {\n      const line = lines[index];\n      // values property can be undefined for some instance states (e.g. NoData)\n      if (isLine(line)) {\n        acc.push({ timestamp, line });\n      }\n\n      return acc;\n    }, []);\n\n    // group all records by alert instance (unique set of labels)\n    const logRecordsByInstance = groupBy(logRecords, (record: LogRecord) => {\n      return JSON.stringify(record.line.labels);\n    });\n\n    // CommonLabels should not be affected by the filter\n    // find common labels so we can extract those from the instances\n    const groupLabels = Object.keys(logRecordsByInstance);\n    const groupLabelsArray: Array<Array<[string, string]>> = groupLabels.map((label) => {\n      return Object.entries(JSON.parse(label));\n    });\n\n    const commonLabels = extractCommonLabels(groupLabelsArray);\n\n    const filterMatchers = filter ? parseMatchers(filter) : [];\n    const filteredGroupedLines = Object.entries(logRecordsByInstance).filter(([key]) => {\n      const labels = JSON.parse(key);\n      return labelsMatchMatchers(labels, filterMatchers);\n    });\n\n    const dataFrames: DataFrame[] = filteredGroupedLines.map<DataFrame>(([key, records]) => {\n      return logRecordsToDataFrame(key, records, commonLabels, theme);\n    });\n\n    return {\n      historyRecords: logRecords.filter(({ line }) => line.labels && labelsMatchMatchers(line.labels, filterMatchers)),\n      dataFrames,\n      commonLabels,\n      totalRecordsCount: logRecords.length,\n    };\n  }, [stateHistory, filter, theme]);\n}\n\nexport function isNumbers(value: unknown[]): value is number[] {\n  return value.every((v) => typeof v === 'number');\n}\n\nexport function isLine(value: unknown): value is Line {\n  return typeof value === 'object' && value !== null && 'current' in value && 'previous' in value;\n}\n\n// Each alert instance is represented by a data frame\n// Each frame consists of two fields: timestamp and state change\nexport function logRecordsToDataFrame(\n  instanceLabels: string,\n  records: LogRecord[],\n  commonLabels: Array<[string, string]>,\n  theme: GrafanaTheme2\n): DataFrame {\n  const parsedInstanceLabels = Object.entries<string>(JSON.parse(instanceLabels));\n\n  // There is an artificial element at the end meaning Date.now()\n  // It exist to draw the state change from when it happened to the current time\n  const timeField: DataFrameField = {\n    name: 'time',\n    type: FieldType.time,\n    values: [...records.map((record) => record.timestamp), Date.now()],\n    config: { displayName: 'Time', custom: { fillOpacity: 100 } },\n  };\n\n  const timeIndex = timeField.values.map((_, index) => index);\n  timeIndex.sort(fieldIndexComparer(timeField));\n\n  const stateValues = [...records.map((record) => record.line.current), records.at(-1)?.line.current];\n\n  const frame: DataFrame = {\n    fields: [\n      {\n        ...timeField,\n        values: timeField.values.map((_, i) => timeField.values[timeIndex[i]]),\n      },\n      {\n        name: 'state',\n        type: FieldType.string,\n        values: stateValues.map((_, i) => stateValues[timeIndex[i]]),\n        config: {\n          displayName: omitLabels(parsedInstanceLabels, commonLabels)\n            .map(([key, label]) => `${key}=${label}`)\n            .join(', '),\n          color: { mode: 'thresholds' },\n          custom: { fillOpacity: 100 },\n          mappings: [\n            {\n              type: MappingType.ValueToText,\n              options: {\n                Alerting: {\n                  color: theme.colors.error.main,\n                },\n                Pending: {\n                  color: theme.colors.warning.main,\n                },\n                Normal: {\n                  color: theme.colors.success.main,\n                },\n                NoData: {\n                  color: theme.colors.info.main,\n                },\n              },\n            },\n          ],\n          thresholds: {\n            mode: ThresholdsMode.Absolute,\n            steps: [],\n          },\n        },\n      },\n    ],\n    length: timeField.values.length,\n    name: instanceLabels,\n  };\n\n  frame.fields.forEach((field) => {\n    field.display = getDisplayProcessor({ field, theme });\n  });\n\n  return frame;\n}\n","import { css } from '@emotion/css';\nimport { fromPairs, isEmpty, sortBy, take, uniq } from 'lodash';\nimport React, { useCallback, useMemo, useRef, useState } from 'react';\nimport { useForm } from 'react-hook-form';\n\nimport { DataFrame, dateTime, GrafanaTheme2, TimeRange } from '@grafana/data';\nimport { Alert, Button, Field, Icon, Input, Label, Tooltip, useStyles2, Stack } from '@grafana/ui';\n\nimport { stateHistoryApi } from '../../../api/stateHistoryApi';\nimport { combineMatcherStrings } from '../../../utils/alertmanager';\nimport { AlertLabels } from '../../AlertLabels';\nimport { HoverCard } from '../../HoverCard';\n\nimport { LogRecordViewerByTimestamp } from './LogRecordViewer';\nimport { LogTimelineViewer } from './LogTimelineViewer';\nimport { useRuleHistoryRecords } from './useRuleHistoryRecords';\n\ninterface Props {\n  ruleUID: string;\n}\n\nconst MAX_TIMELINE_SERIES = 12;\n\nconst LokiStateHistory = ({ ruleUID }: Props) => {\n  const styles = useStyles2(getStyles);\n  const [instancesFilter, setInstancesFilter] = useState('');\n  const logsRef = useRef<Map<number, HTMLElement>>(new Map<number, HTMLElement>());\n\n  const { getValues, setValue, register, handleSubmit } = useForm({ defaultValues: { query: '' } });\n\n  const { useGetRuleHistoryQuery } = stateHistoryApi;\n\n  // We prefer log count-based limit rather than time-based, but the API doesn't support it yet\n  const queryTimeRange = useMemo(() => getDefaultTimeRange(), []);\n\n  const {\n    currentData: stateHistory,\n    isLoading,\n    isError,\n    error,\n  } = useGetRuleHistoryQuery({\n    ruleUid: ruleUID,\n    from: queryTimeRange.from.unix(),\n    to: queryTimeRange.to.unix(),\n    limit: 250,\n  });\n\n  const { dataFrames, historyRecords, commonLabels, totalRecordsCount } = useRuleHistoryRecords(\n    stateHistory,\n    instancesFilter\n  );\n\n  const { frameSubset, frameSubsetTimestamps, frameTimeRange } = useFrameSubset(dataFrames);\n\n  const onLogRecordLabelClick = useCallback(\n    (label: string) => {\n      const matcherString = combineMatcherStrings(getValues('query'), label);\n      setInstancesFilter(matcherString);\n      setValue('query', matcherString);\n    },\n    [setInstancesFilter, setValue, getValues]\n  );\n\n  const onFilterCleared = useCallback(() => {\n    setInstancesFilter('');\n    setValue('query', '');\n  }, [setInstancesFilter, setValue]);\n\n  const refToHighlight = useRef<HTMLElement | undefined>(undefined);\n\n  const onTimelinePointerMove = useCallback(\n    (seriesIdx: number, pointIdx: number) => {\n      // remove the highlight from the previous refToHighlight\n      refToHighlight.current?.classList.remove(styles.highlightedLogRecord);\n\n      const timestamp = frameSubsetTimestamps[pointIdx];\n      const newTimestampRef = logsRef.current.get(timestamp);\n\n      // now we have the new ref, add the styles\n      newTimestampRef?.classList.add(styles.highlightedLogRecord);\n      // keeping this here (commented) in case we decide we want to go back to this\n      // newTimestampRef?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n\n      refToHighlight.current = newTimestampRef;\n    },\n    [frameSubsetTimestamps, styles.highlightedLogRecord]\n  );\n\n  if (isLoading) {\n    return <div>Loading...</div>;\n  }\n  if (isError) {\n    return (\n      <Alert title=\"Error fetching the state history\" severity=\"error\">\n        {error instanceof Error ? error.message : 'Unable to fetch alert state history'}\n      </Alert>\n    );\n  }\n\n  const hasMoreInstances = frameSubset.length < dataFrames.length;\n  const emptyStateMessage =\n    totalRecordsCount > 0\n      ? `No matches were found for the given filters among the ${totalRecordsCount} instances`\n      : 'No state transitions have occurred in the last 30 days';\n\n  return (\n    <div className={styles.fullSize}>\n      <form onSubmit={handleSubmit((data) => setInstancesFilter(data.query))}>\n        <SearchFieldInput\n          {...register('query')}\n          showClearFilterSuffix={!!instancesFilter}\n          onClearFilterClick={onFilterCleared}\n        />\n        <input type=\"submit\" hidden />\n      </form>\n      {!isEmpty(commonLabels) && (\n        <div className={styles.commonLabels}>\n          <Stack gap={1} alignItems=\"center\">\n            <strong>Common labels</strong>\n            <Tooltip content=\"Common labels are the ones attached to all of the alert instances\">\n              <Icon name=\"info-circle\" />\n            </Tooltip>\n            <AlertLabels labels={fromPairs(commonLabels)} size=\"sm\" />\n          </Stack>\n        </div>\n      )}\n      {isEmpty(frameSubset) ? (\n        <>\n          <div className={styles.emptyState}>\n            {emptyStateMessage}\n            {totalRecordsCount > 0 && (\n              <Button variant=\"secondary\" type=\"button\" onClick={onFilterCleared}>\n                Clear filters\n              </Button>\n            )}\n          </div>\n        </>\n      ) : (\n        <>\n          <div className={styles.graphWrapper}>\n            <LogTimelineViewer frames={frameSubset} timeRange={frameTimeRange} onPointerMove={onTimelinePointerMove} />\n          </div>\n          {hasMoreInstances && (\n            <div className={styles.moreInstancesWarning}>\n              <Stack direction=\"row\" alignItems=\"center\" gap={1}>\n                <Icon name=\"exclamation-triangle\" size=\"sm\" />\n                <small>{`Only showing ${frameSubset.length} out of ${dataFrames.length} instances. Click on the labels to narrow down the results`}</small>\n              </Stack>\n            </div>\n          )}\n          <LogRecordViewerByTimestamp\n            records={historyRecords}\n            commonLabels={commonLabels}\n            onRecordsRendered={(recordRefs) => (logsRef.current = recordRefs)}\n            onLabelClick={onLogRecordLabelClick}\n          />\n        </>\n      )}\n    </div>\n  );\n};\n\nfunction useFrameSubset(frames: DataFrame[]) {\n  return useMemo(() => {\n    const frameSubset = take(frames, MAX_TIMELINE_SERIES);\n    const frameSubsetTimestamps = sortBy(uniq(frameSubset.flatMap((frame) => frame.fields[0].values)));\n\n    const minTs = Math.min(...frameSubsetTimestamps);\n    const maxTs = Math.max(...frameSubsetTimestamps);\n\n    const rangeStart = dateTime(minTs);\n    const rangeStop = dateTime(maxTs);\n\n    const frameTimeRange: TimeRange = {\n      from: rangeStart,\n      to: rangeStop,\n      raw: {\n        from: rangeStart,\n        to: rangeStop,\n      },\n    };\n\n    return { frameSubset, frameSubsetTimestamps, frameTimeRange };\n  }, [frames]);\n}\n\ninterface SearchFieldInputProps extends Omit<React.ComponentProps<typeof Input>, 'prefix' | 'suffix' | 'placeholder'> {\n  showClearFilterSuffix: boolean;\n  onClearFilterClick: () => void;\n}\n\nconst SearchFieldInput = React.forwardRef<HTMLInputElement, SearchFieldInputProps>(\n  ({ showClearFilterSuffix, onClearFilterClick, ...rest }: SearchFieldInputProps, ref) => {\n    return (\n      <Field\n        label={\n          <Label htmlFor=\"instancesSearchInput\">\n            <Stack gap={0.5}>\n              <span>Filter instances</span>\n              <HoverCard\n                content={\n                  <>\n                    Use label matcher expression (like <code>{'{foo=bar}'}</code>) or click on an instance label to\n                    filter instances\n                  </>\n                }\n              >\n                <Icon name=\"info-circle\" size=\"sm\" />\n              </HoverCard>\n            </Stack>\n          </Label>\n        }\n      >\n        <Input\n          id=\"instancesSearchInput\"\n          prefix={<Icon name=\"search\" />}\n          suffix={\n            showClearFilterSuffix && (\n              <Button fill=\"text\" icon=\"times\" size=\"sm\" onClick={onClearFilterClick}>\n                Clear\n              </Button>\n            )\n          }\n          placeholder=\"Filter instances\"\n          ref={ref}\n          {...rest}\n        />\n      </Field>\n    );\n  }\n);\nSearchFieldInput.displayName = 'SearchFieldInput';\n\nfunction getDefaultTimeRange(): TimeRange {\n  const fromDateTime = dateTime().subtract(30, 'days');\n  const toDateTime = dateTime();\n  return {\n    from: fromDateTime,\n    to: toDateTime,\n    raw: { from: fromDateTime, to: toDateTime },\n  };\n}\n\nexport const getStyles = (theme: GrafanaTheme2) => ({\n  fullSize: css`\n    min-width: 100%;\n    height: 100%;\n\n    display: flex;\n    flex-direction: column;\n  `,\n  graphWrapper: css`\n    padding: ${theme.spacing()} 0;\n  `,\n  emptyState: css`\n    color: ${theme.colors.text.secondary};\n\n    display: flex;\n    flex-direction: column;\n    gap: ${theme.spacing(2)};\n    align-items: center;\n    margin: auto auto;\n  `,\n  moreInstancesWarning: css`\n    color: ${theme.colors.warning.text};\n    padding: ${theme.spacing()};\n  `,\n  commonLabels: css`\n    display: grid;\n    grid-template-columns: max-content auto;\n  `,\n  // we need !important here to override the list item default styles\n  highlightedLogRecord: css`\n    background: ${theme.colors.primary.transparent} !important;\n    outline: 1px solid ${theme.colors.primary.shade} !important;\n  `,\n});\n\nexport default LokiStateHistory;\n","import { isEqual, uniqBy } from 'lodash';\n\nimport { GrafanaAlertStateWithReason } from 'app/types/unified-alerting-dto';\n\nexport interface Line {\n  previous: GrafanaAlertStateWithReason;\n  current: GrafanaAlertStateWithReason;\n  values?: Record<string, number>;\n  labels?: Record<string, string>;\n}\n\nexport interface LogRecord {\n  timestamp: number;\n  line: Line;\n}\n\nexport type Label = [string, string];\n\n// omit \"common\" labels from \"labels\"\nexport function omitLabels(labels: Label[], common: Label[]): Label[] {\n  return labels.filter((label) => {\n    return !common.find((commonLabel) => JSON.stringify(commonLabel) === JSON.stringify(label));\n  });\n}\n\n// find all common labels by looking at which ones occur in every record, then create a unique array of items for those\nexport function extractCommonLabels(labels: Label[][]): Label[] {\n  const flatLabels = labels.flatMap((label) => label);\n\n  const commonLabels = uniqBy(\n    flatLabels.filter((label) => {\n      const count = flatLabels.filter((l) => isEqual(label, l)).length;\n      return count === Object.keys(labels).length;\n    }),\n    (label) => JSON.stringify(label)\n  );\n\n  return commonLabels;\n}\n"],"names":["stateHistoryApi","alertingApi","build","ruleUid","from","to","limit","groupRecordsByTimestamp","records","groupedLines","acc","current","tsGroup","a","b","LogRecordViewerByTimestamp","commonLabels","onLabelClick","onRecordsRendered","styles","getStyles","timestampRefs","key","element","Timestamp","line","AlertInstanceValues","value","LogRecordViewerByInstance","record","timestamp","time","dateTime","formatDistanceToNowStrict","values","theme","replaceVariables","v","LogTimelineViewer","frames","timeRange","onPointerMove","setupCursorTracking","useCursorTimelinePosition","width","TimelineChart","builder","pointerSubject","BehaviorSubject","subscription","seriesIdx","pointIdx","interpolator","u","currentPointer","useRuleHistoryRecords","stateHistory","filter","tsValues","timestamps","isNumbers","lines","logRecords","index","isLine","logRecordsByInstance","groupLabelsArray","label","filterMatchers","dataFrames","labels","logRecordsToDataFrame","instanceLabels","parsedInstanceLabels","timeField","timeIndex","_","stateValues","frame","i","field","MAX_TIMELINE_SERIES","LokiStateHistory","ruleUID","instancesFilter","setInstancesFilter","logsRef","getValues","setValue","register","handleSubmit","useGetRuleHistoryQuery","queryTimeRange","getDefaultTimeRange","isLoading","isError","error","historyRecords","totalRecordsCount","frameSubset","frameSubsetTimestamps","frameTimeRange","useFrameSubset","onLogRecordLabelClick","matcherString","onFilterCleared","refToHighlight","onTimelinePointerMove","newTimestampRef","Alert","hasMoreInstances","emptyStateMessage","data","SearchFieldInput","Tooltip","AlertLabels","Button","recordRefs","minTs","maxTs","rangeStart","rangeStop","showClearFilterSuffix","onClearFilterClick","rest","ref","Field","Label","HoverCard","Input","fromDateTime","toDateTime","omitLabels","common","commonLabel","extractCommonLabels","flatLabels","l"],"sourceRoot":""}